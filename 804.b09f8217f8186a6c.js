(self.webpackChunkasct=self.webpackChunkasct||[]).push([[804],{473:function(lf,Ko){var Ki;void 0!==(Ki=function(){"use strict";function Xn(ue,ge,Ct){var Q=new XMLHttpRequest;Q.open("GET",ue),Q.responseType="blob",Q.onload=function(){mi(Q.response,ge,Ct)},Q.onerror=function(){console.error("could not download file")},Q.send()}function Gr(ue){var ge=new XMLHttpRequest;ge.open("HEAD",ue,!1);try{ge.send()}catch(Ct){}return 200<=ge.status&&299>=ge.status}function pi(ue){try{ue.dispatchEvent(new MouseEvent("click"))}catch(Ct){var ge=document.createEvent("MouseEvents");ge.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),ue.dispatchEvent(ge)}}var At="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,Yr=At.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),mi=At.saveAs||("object"!=typeof window||window!==At?function(){}:"download"in HTMLAnchorElement.prototype&&!Yr?function(ue,ge,Ct){var Q=At.URL||At.webkitURL,R=document.createElement("a");R.download=ge=ge||ue.name||"download",R.rel="noopener","string"==typeof ue?(R.href=ue,R.origin===location.origin?pi(R):Gr(R.href)?Xn(ue,ge,Ct):pi(R,R.target="_blank")):(R.href=Q.createObjectURL(ue),setTimeout(function(){Q.revokeObjectURL(R.href)},4e4),setTimeout(function(){pi(R)},0))}:"msSaveOrOpenBlob"in navigator?function(ue,ge,Ct){if(ge=ge||ue.name||"download","string"!=typeof ue)navigator.msSaveOrOpenBlob(function(ue,ge){return void 0===ge?ge={autoBom:!1}:"object"!=typeof ge&&(console.warn("Deprecated: Expected third argument to be a object"),ge={autoBom:!ge}),ge.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(ue.type)?new Blob(["\ufeff",ue],{type:ue.type}):ue}(ue,Ct),ge);else if(Gr(ue))Xn(ue,ge,Ct);else{var Q=document.createElement("a");Q.href=ue,Q.target="_blank",setTimeout(function(){pi(Q)})}}:function(ue,ge,Ct,Q){if((Q=Q||open("","_blank"))&&(Q.document.title=Q.document.body.innerText="downloading..."),"string"==typeof ue)return Xn(ue,ge,Ct);var R="application/octet-stream"===ue.type,uf=/constructor/i.test(At.HTMLElement)||At.safari,Jo=/CriOS\/[\d]+/.test(navigator.userAgent);if((Jo||R&&uf||Yr)&&"undefined"!=typeof FileReader){var He=new FileReader;He.onloadend=function(){var Re=He.result;Re=Jo?Re:Re.replace(/^data:[^;]*;/,"data:attachment/file;"),Q?Q.location.href=Re:location=Re,Q=null},He.readAsDataURL(ue)}else{var nt=At.URL||At.webkitURL,Ee=nt.createObjectURL(ue);Q?Q.location=Ee:location.href=Ee,Q=null,setTimeout(function(){nt.revokeObjectURL(Ee)},4e4)}});At.saveAs=mi.saveAs=mi,lf.exports=mi}.apply(Ko,[]))&&(lf.exports=Ki)},804:(lf,Ko,le)=>{"use strict";le.r(Ko),le.d(Ko,{GraphController:()=>bV});var Vr={};le.r(Vr),le.d(Vr,{aggregate:()=>Ei,bin:()=>wh,collect:()=>Mh,compare:()=>av,countpattern:()=>Dh,cross:()=>Eh,density:()=>kh,dotbin:()=>Ch,expression:()=>hv,extent:()=>Sh,facet:()=>El,field:()=>dv,filter:()=>Fh,flatten:()=>Bh,fold:()=>Ih,formula:()=>Rh,generate:()=>gv,impute:()=>Oh,joinaggregate:()=>Lh,kde:()=>zh,key:()=>pv,load:()=>mv,lookup:()=>Ph,multiextent:()=>yv,multivalues:()=>vv,params:()=>xv,pivot:()=>Uh,prefacet:()=>bv,project:()=>jh,proxy:()=>_v,quantile:()=>qh,relay:()=>wv,sample:()=>Vh,sequence:()=>$h,sieve:()=>Mv,subflow:()=>Th,timeunit:()=>Gh,tupleindex:()=>Ev,values:()=>kv,window:()=>Yh});var Ki={};le.r(Ki),le.d(Ki,{interpolate:()=>Fi,interpolateArray:()=>ZT,interpolateBasis:()=>hx,interpolateBasisClosed:()=>dx,interpolateCubehelix:()=>N6,interpolateCubehelixLong:()=>P6,interpolateDate:()=>vx,interpolateDiscrete:()=>_6,interpolateHcl:()=>O6,interpolateHclLong:()=>L6,interpolateHsl:()=>F6,interpolateHslLong:()=>B6,interpolateHue:()=>w6,interpolateLab:()=>R6,interpolateNumber:()=>pn,interpolateNumberArray:()=>fd,interpolateObject:()=>xx,interpolateRgb:()=>cd,interpolateRgbBasis:()=>HT,interpolateRgbBasisClosed:()=>XT,interpolateRound:()=>Cs,interpolateString:()=>bx,interpolateTransformCss:()=>E6,interpolateTransformSvg:()=>k6,interpolateZoom:()=>T6,piecewise:()=>Md,quantize:()=>U6});var $r={};le.r($r),le.d($r,{bound:()=>l_,identifier:()=>j0,mark:()=>c_,overlap:()=>f_,render:()=>y_,viewlayout:()=>M_});var Xn={};le.r(Xn),le.d(Xn,{axisticks:()=>E_,datajoin:()=>k_,encode:()=>A_,legendentries:()=>C_,linkpath:()=>q0,pie:()=>V0,scale:()=>R_,sortitems:()=>z_,stack:()=>G0});var Gr={};le.r(Gr),le.d(Gr,{contour:()=>wg,geojson:()=>Eg,geopath:()=>kg,geopoint:()=>Ag,geoshape:()=>Cg,graticule:()=>Sg,heatmap:()=>Tg,isocontour:()=>xg,kde2d:()=>_g,projection:()=>eM});var pi={};le.r(pi),le.d(pi,{force:()=>Lg});var At={};le.r(At),le.d(At,{nest:()=>Vg,pack:()=>Gg,partition:()=>Wg,stratify:()=>Hg,tree:()=>Zg,treelinks:()=>Kg,treemap:()=>Qg});var Yr={};le.r(Yr),le.d(Yr,{label:()=>op});var mi={};le.r(mi),le.d(mi,{loess:()=>lp,regression:()=>cp});var ue={};le.r(ue),le.d(ue,{voronoi:()=>pp});var ge={};le.r(ge),le.d(ge,{wordcloud:()=>yp});var Ct={};le.r(Ct),le.d(Ct,{crossfilter:()=>vp,resolvefilter:()=>xp});var Q=le(239),R=le(785);class Jo extends class{constructor(t){this.verticesCT=t,this.outDegree=new Map,this.involved=new Map,this.initializeContainment(),this.parseContainment(),this.parseInvolvedVertices(this.root),this.parseAbstractRectangles()}parseContainment(){this.containment=[],this.worker(this.root)}worker(t){t in this.outDegree?this.outDegree[t].forEach(i=>{this.worker(i)}):this.containment.push(t)}parseInvolvedVertices(t){if(t in this.outDegree){let n=[];this.outDegree[t].forEach(i=>{this.parseInvolvedVertices(i),n=n.concat(this.involved[i])}),this.involved[t]=n}else this.involved[t]=[t]}parseAbstractRectangles(){let t=this.root;this.numRectangles=0,this.rectangleMap=new Map,this.rectIDArtificialIDMap=new Map,this.artificialIdRectIDMap=new Map,t in this.outDegree&&this.outDegree[t].forEach(n=>{this.abstractRectangleWorker(n)})}abstractRectangleWorker(t){t in this.outDegree&&(this.rectangleMap[this.numRectangles]=this.involved[t],this.rectIDArtificialIDMap[this.numRectangles]=t,this.artificialIdRectIDMap[t]=this.numRectangles,this.numRectangles+=1,this.outDegree[t].forEach(n=>{this.abstractRectangleWorker(n)}))}update(){this.parseContainment(),this.parseInvolvedVertices(this.root),this.parseAbstractRectangles()}}{constructor(t){super(t)}initializeContainment(){let n=-4e5,i=this.verticesCT.map(r=>({value:r,sort:Math.random()})).sort((r,a)=>r.sort-a.sort).map(({value:r})=>r).splice(0);for(;i.length>1;){let r=[];for(let a=1;a<i.length;a+=2)r.push(n),this.outDegree[n]=i.length%2==1&&a+1==i.length-1?[i[a-1],i[a],i[a+1]]:[i[a-1],i[a]],n-=1;i=r}this.root=i[0],this.initialRoot=this.root}}class He{constructor(t){if(this.vertexSize=new Map,1==t.length){this.organ=t[0],this.vertices=[],this.inDegree=new Map,this.outDegree=new Map,this.vertexType=new Map,this.vertexLabel=new Map,this.vertexVisible=new Map,this.vertexColor=new Map,this.IDtoOntologyType=new Map,this.IDtoOntologyID=new Map,this.ready=!1;const n=(0,R.Sq)(this.organ);this.readyPromise=this.initializeGraph(n).then(i=>{let r=Math.sqrt(window.screen.height*window.screen.height+window.screen.width*window.screen.width)/2;this.vertices.forEach(a=>this.vertexSize[a]=r),this.ready=!0,this.containment=new Jo(this.verticesCT)})}else this.organ=t[0],this.vertices=t[1],this.inDegree=t[2],this.outDegree=t[3],this.vertexType=t[4],this.vertexLabel=t[5],this.vertexVisible=t[6],this.vertexColor=t[7],this.IDtoOntologyType=t[8],this.IDtoOntologyID=t[9],this.verticesAS=[],this.verticesCT=[],this.verticesBM=[],this.numVertices=this.vertices.length,this.numVerticesAS=0,this.numVerticesCT=0,this.numVerticesBM=0,this.vertices.forEach(n=>{switch(this.vertexType[n]){case R.Dy.AS:this.verticesAS.push(n),this.numVerticesAS+=1;break;case R.Dy.CT:this.verticesCT.push(n),this.numVerticesCT+=1;break;case R.Dy.BM:this.verticesBM.push(n),this.numVerticesBM+=1}this.vertexSize[n]=300}),this.ready=!0}processOntologyID(t,n){if(""!=t.ontologyId){let i=t.ontologyId;if(-1!=i.indexOf(":")){i=i.split(" ")[0];const[a,s]=i.split(":");switch(a){case"HGNC":this.IDtoOntologyType[n]=R.V4.HGNC;break;case"UBERON":this.IDtoOntologyType[n]=R.V4.UBERON;break;case"FMAID":this.IDtoOntologyType[n]=R.V4.FMAID;break;case"CL":this.IDtoOntologyType[n]=R.V4.CL}this.IDtoOntologyID[n]=s}}}initializeGraph(t){var n=this;return(0,Q.Z)(function*(){const i=yield fetch(t).then(r=>r.json()).then(r=>r.data);n.verticesAS=[],n.verticesCT=[],n.verticesBM=[];for(const r of i.nodes){const{id:a,type:s,name:o,metadata:l}=r;switch(n.processOntologyID(l,a),s){case"AS":n.vertexType[a]=R.Dy.AS,n.vertexColor[a]="red",n.verticesAS.push(a);break;case"CT":n.vertexType[a]=R.Dy.CT,n.vertexColor[a]="blue",n.verticesCT.push(a);break;case"BM":case"gene":n.vertexType[a]=R.Dy.BM,n.vertexColor[a]="green",n.verticesBM.push(a);break;case"protein":n.vertexType[a]=R.Dy.BM,n.vertexColor[a]="Chartreuse",n.verticesBM.push(a)}n.vertexVisible[a]=1,n.vertices.push(a),n.vertexLabel[a]=o}for(const r of i.edges){const{source:a,target:s}=r;n.vertexType[a]==R.Dy.CT&&n.vertexType[s]==R.Dy.CT&&n.organ==R.jM.Heart&&console.log("SOURCE: ",a,"TARGET",s,n.organ),(n.vertexType[a]!=R.Dy.CT||n.vertexType[s]!=R.Dy.CT)&&(n.vertexType[a]!=R.Dy.AS||n.vertexType[s]!=R.Dy.BM)&&(s in n.inDegree?n.inDegree[s].includes(a)||n.inDegree[s].push(a):n.inDegree[s]=[a],a in n.outDegree?n.outDegree[a].includes(s)||n.outDegree[a].push(s):n.outDegree[a]=[s])}n.numVerticesAS=n.verticesAS.length,n.numVerticesCT=n.verticesCT.length,n.numVerticesBM=n.verticesBM.length,n.numVertices=n.numVerticesAS+n.numVerticesCT+n.numVerticesBM})()}}function nt(e,t,n){return e.fields=t||[],e.fname=n,e}function Ee(e){return null==e?null:e.fname}function Re(e){return null==e?null:e.fields}function Lm(e){return 1===e.length?_k(e[0]):wk(e)}const _k=e=>function(t){return t[e]},wk=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function I(e){throw Error(e)}function cf(e){const t=[],n=e.length;let s,o,l,i=null,r=0,a="";function u(){t.push(a+e.substring(s,o)),a="",s=o+1}for(e+="",s=o=0;o<n;++o)if(l=e[o],"\\"===l)a+=e.substring(s,o),a+=e.substring(++o,++o),s=o;else if(l===i)u(),i=null,r=-1;else{if(i)continue;s===r&&'"'===l||s===r&&"'"===l?(s=o+1,i=l):"."!==l||r?"["===l?(o>s&&u(),r=s=o+1):"]"===l&&(r||I("Access path missing open bracket: "+e),r>0&&u(),r=0,s=o+1):o>s?u():s=o+1}return r&&I("Access path missing closing bracket: "+e),i&&I("Access path missing closing quote: "+e),o>s&&(o++,u()),t}function Pt(e,t,n){const i=cf(e);return e=1===i.length?i[0]:e,nt((n&&n.get||Lm)(i),[e],t||e)}const Qo=Pt("id"),St=nt(e=>e,[],"identity"),Ji=nt(()=>0,[],"zero"),Ga=nt(()=>1,[],"one"),hn=nt(()=>!0,[],"true"),Qi=nt(()=>!1,[],"false");function Mk(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}function Ck(e,t,n=Mk){let i=e||0;return{level(r){return arguments.length?(i=+r,this):i},error(){return i>=1&&n(t||"error","ERROR",arguments),this},warn(){return i>=2&&n(t||"warn","WARN",arguments),this},info(){return i>=3&&n(t||"log","INFO",arguments),this},debug(){return i>=4&&n(t||"log","DEBUG",arguments),this}}}var $=Array.isArray;function ee(e){return e===Object(e)}const Nm=e=>"__proto__"!==e;function Pm(e,t,n,i){if(!Nm(t))return;let r,a;if(ee(n)&&!$(n))for(r in a=ee(e[t])?e[t]:e[t]={},n)i&&(!0===i||i[r])?Pm(a,r,n[r]):Nm(r)&&(a[r]=n[r]);else e[t]=n}function Tk(e,t){if(null==e)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function ce(e){return e[e.length-1]}function ft(e){return null==e||""===e?null:+e}const Um=e=>t=>e*Math.exp(t),jm=e=>t=>Math.log(e*t),qm=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Vm=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,el=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function tl(e,t,n,i){const r=n(e[0]),a=n(ce(e)),s=(a-r)*t;return[i(r-s),i(a-s)]}function nl(e,t,n,i,r){const a=i(e[0]),s=i(ce(e)),o=null!=t?i(t):(a+s)/2;return[r(o+(a-o)*n),r(o+(s-o)*n)]}function $m(e,t,n){return nl(e,t,n,ft,St)}function Gm(e,t,n){const i=Math.sign(e[0]);return nl(e,t,n,jm(i),Um(i))}function ff(e,t,n,i){return nl(e,t,n,el(i),el(1/i))}function Ym(e,t,n,i){return nl(e,t,n,qm(i),Vm(i))}function K(e){return null!=e?$(e)?e:[e]:[]}function ne(e){return"function"==typeof e}function Wm(e,t,n){n=n||{},t=K(t)||[];const i=[],r=[],a={},s=n.comparator||Pk;return K(e).forEach((o,l)=>{null!=o&&(i.push("descending"===t[l]?-1:1),r.push(o=ne(o)?o:Pt(o,null,n)),(Re(o)||[]).forEach(u=>a[u]=1))}),0===r.length?null:nt(s(r,i),Object.keys(a))}const hf=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),Pk=(e,t)=>1===e.length?Uk(e[0],t[0]):jk(e,t,e.length),Uk=(e,t)=>function(n,i){return hf(e(n),e(i))*t},jk=(e,t,n)=>(t.push(0),function(i,r){let a,s=0,o=-1;for(;0===s&&++o<n;)a=e[o],s=hf(a(i),a(r));return s*t[o]});function ht(e){return ne(e)?e:()=>e}function Hm(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(t(i),n=null),e)}}function te(e){for(let t,n,i=1,r=arguments.length;i<r;++i)for(n in t=arguments[i],t)e[n]=t[n];return e}function Zn(e,t){let i,r,a,s,n=0;if(e&&(i=e.length))if(null==t){for(r=e[n];n<i&&(null==r||r!=r);r=e[++n]);for(a=s=r;n<i;++n)r=e[n],null!=r&&(r<a&&(a=r),r>s&&(s=r))}else{for(r=t(e[n]);n<i&&(null==r||r!=r);r=t(e[++n]));for(a=s=r;n<i;++n)r=t(e[n]),null!=r&&(r<a&&(a=r),r>s&&(s=r))}return[a,s]}const Vk=Object.prototype.hasOwnProperty;function J(e,t){return Vk.call(e,t)}const il={};function Ya(e){let n,t={};function i(a){return J(t,a)&&t[a]!==il}const r={size:0,empty:0,object:t,has:i,get:a=>i(a)?t[a]:void 0,set(a,s){return i(a)||(++r.size,t[a]===il&&--r.empty),t[a]=s,this},delete(a){return i(a)&&(--r.size,++r.empty,t[a]=il),this},clear(){r.size=r.empty=0,r.object=t={}},test(a){return arguments.length?(n=a,r):n},clean(){const a={};let s=0;for(const o in t){const l=t[o];l!==il&&(!n||!n(l))&&(a[o]=l,++s)}r.size=s,r.empty=0,r.object=t=a}};return e&&Object.keys(e).forEach(a=>{r.set(a,e[a])}),r}function z(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),te(i,n)}function Wa(e,t,n,i){let s,r=t[0],a=t[t.length-1];return r>a&&(s=r,r=a,a=s),i=void 0===i||i,((n=void 0===n||n)?r<=e:r<e)&&(i?e<=a:e<a)}function er(e){return"[object Date]"===Object.prototype.toString.call(e)}function Ha(e){return"number"==typeof e}function ke(e){return"string"==typeof e}function Xm(e,t,n){e&&(e=t?K(e).map(o=>o.replace(/\\(.)/g,"$1")):K(e));const i=e&&e.length,r=n&&n.get||Lm,a=o=>r(t?[o]:cf(o));let s;if(i)if(1===i){const o=a(e[0]);s=function(l){return""+o(l)}}else{const o=e.map(a);s=function(l){let u=""+o[0](l),c=0;for(;++c<i;)u+="|"+o[c](l);return u}}else s=function(){return""};return nt(s,e,"key")}function rl(e,t){let n="";for(;--t>=0;)n+=e;return n}function al(e){return e&&ce(e)-e[0]||0}function W(e){return $(e)?"["+e.map(W)+"]":ee(e)||ke(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Zm(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)}const Qk=e=>Ha(e)||er(e)?e:Date.parse(e);function Km(e,t){return t=t||Qk,null==e||""===e?null:t(e)}function Jm(e){return null==e||""===e?null:e+""}function Sn(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function tr(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const a=t(e[r]);a&&n(a,r,e)}}else e.forEach(n)}function Qm(e,t,n){if($(e))return`[${e.map(i=>t(ke(i)?i:e1(i,n))).join(", ")}]`;if(ee(e)){let i="";const r=e,{title:a,image:s}=r,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(r,["title","image"]);a&&(i+=`<h2>${t(a)}</h2>`),s&&(i+=`<img src="${t(s)}">`);const l=Object.keys(o);if(l.length>0){i+="<table>";for(const u of l){let c=o[u];void 0!==c&&(ee(c)&&(c=e1(c,n)),i+=`<tr><td class="key">${t(u)}:</td><td class="value">${t(c)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function e1(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,i){if("object"!=typeof i||null===i)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}(t))}const t1="vg-tooltip-element",DA={offsetX:10,offsetY:10,id:t1,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2,formatTooltip:Qm};class n1{constructor(t){this.options=Object.assign(Object.assign({},DA),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(t1,e)}(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){var a;if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!==(a=document.fullscreenElement)&&void 0!==a?a:document.body).appendChild(this.el),null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:o,y:l}=function(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let a=e.clientY+i;return a+t.height>window.innerHeight&&(a=+e.clientY-i-t.height),{x:r,y:a}}(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${l}px; left: ${o}px`)}}class CA{constructor(t){this.currentString="",this.lastID=null,this.controller=t}compute(t,n,i){if(this.controller.gui.appearance[1].sel){let a=this.createTooltip();this.processEvent(t,n,a,i)}else this.removeCurrentTooltip()}processOntologyStrings(t,n){let i="Not Available ",r="Not Available";if(t in n.IDtoOntologyID)switch(i=n.IDtoOntologyID[t],n.IDtoOntologyType[t]){case R.V4.UBERON:r="UBERON";break;case R.V4.CL:r="CL";break;case R.V4.HGNC:r="HGNC";break;case R.V4.FMAID:r="FMAID"}return[r,i]}processDescription(t){let n=t.description,i=" ",r=n.split(" "),a=0,s=t.link.length-4;return r.forEach(o=>{a>s&&(i+="<br>",a=0),i+=o+" ",a+=o.length}),0!=n.length?i:"Not Available "}processColor(t,n){let i="";switch(t.vertexType[n]){case R.Dy.AS:i="red";break;case R.Dy.CT:i="deepskyblue";break;case R.Dy.BM:i="greenyellow"}return"color:"+i}processEvent(t,n,i,r){if(null!=n){let a=n.datum.id;a!=this.lastID&&(0,R.Ie)(a,r).then(s=>{if(null!=s){let[o,l]=this.processOntologyStrings(a,r),u=this.processDescription(s),c=this.processColor(r,a);this.currentString="<div style='font-size: 2vh'> <u>Name:</u>  "+r.vertexLabel[a]+"<br>Database:  "+o+"<br>Ontology ID:  "+l+"<br><div style="+c+">"+s.link+"</div><u>  Description: </u> <br>"+u+"</div>",i.call(i,t,{},"foo")}}).catch(s=>{this.removeCurrentTooltip()}),this.lastID=a}else this.removeCurrentTooltip()}removeCurrentTooltip(){let t=document.getElementById("vg-tooltip-element");null!=t&&t.remove()}createTooltip(){return new n1({offsetX:30,offsetY:10,id:"vg-tooltip-element",styleId:"vega-tooltip-style",theme:"dark",disableDefaultStyle:!1,sanitize:n=>this.currentString,formatTooltip:Qm})}}var SA=le(473);class Wr{constructor(t){this.rotateAngle=this.rotateStringToNumber(t),this.rotate=0!=this.rotateAngle}rotateStringToNumber(t){switch(t){case"90 Degree":return 180;case"180 Degree":return 90;case"270 Degree":return 270;default:return 0}}}class Xa{constructor(t,n){this.type=n,this.controller=t,this.toolTip=new CA(t),this.firstTime=!0}exportImage(){var t=this;return(0,Q.Z)(function*(){let n=yield t.currentView.toSVG(),i=new Blob([n],{type:"image/svg+xml"});SA(i,"graph.jpg")})()}intersectRule(t,n){const i=t.x||0,r=t.y||0;return this.intersectBoxLine(n,i,r,null!=t.x2?t.x2:i,null!=t.y2?t.y2:r)}intersectBoxLine(t,n,i,r,a){const{x1:s,y1:o,x2:l,y2:u}=t,c=r-n,f=a-i;let g,p,m,y,h=0,d=1;for(y=0;y<4;++y){if(0===y&&(g=-c,p=-(s-n)),1===y&&(g=c,p=l-n),2===y&&(g=-f,p=-(o-i)),3===y&&(g=f,p=u-i),Math.abs(g)<1e-10&&p<0)return!1;if(m=p/g,g<0){if(m>d)return!1;m>h&&(h=m)}else if(g>0){if(m<h)return!1;m<d&&(d=m)}}return!0}boundingBoxIntersection(t){let i=t.scenegraph().root.items[0].items[1].items,r=[];i.forEach(s=>{r.push(s.bounds)});let a=!1;for(let s=0;s<r.length;s++)for(let o=0;o<r.length&&!a;o++)if(s!=o&&this.intersectBoxLine(r[s],r[o].x1,r[o].y1,r[o].x2,r[o].y2)){a=!0;break}return a}resizeView(t,n,i,r,a,s,o){t.runAfter(function(h){var d=0;h._autosize=0,h.width()!==r&&(d=1,h.signal("width",r),h._resizeWidth.skip(!0)),h.height()!==a&&(d=1,h.signal("height",a),h._resizeHeight.skip(!0)),(h._viewWidth!==n||h._viewHeight!==i)&&(d=1,h._resize=1,h._viewWidth=r,h._viewHeight=a),(h._origin[0]!==s[0]||h._origin[1]!==s[1])&&(h._resize=1,h._origin=s),d&&h.run("enter"),o&&h.runAfter(function(){h.resize()})},!1,1)}contentRectInDrawingArea(){let t=!1,n=document.querySelectorAll(".mark-symbol.role-mark");if(n.length>0){let i=n[0].getBoundingClientRect();i.height<this.controller.properties.heightDrawingDIV&&i.width<this.controller.properties.withDrawingDIV&&(t=!0)}return t}fitContent(t){let n=document.querySelectorAll(".mark-symbol.role-mark");if(n.length>0){this.controller.currentMode.reset();let i=n[0].getBoundingClientRect(),r=new Wr(this.controller.gui.selectedRotation);t.signal("xdom",[0,t.signal("width")]),t.signal("ydom",[0,t.signal("height")]),t.signal("sizeVertexDom",[50,300]),t.signal("xdomContainment",[0,t.signal("width")]),t.signal("ydomContainment",[0,t.signal("height")]),t.signal("sizeLabelDom",[6,8]),t.signal("anchor","Explore"==this.type||180==r.rotateAngle||270==r.rotateAngle?[0,0]:[this.controller.properties.totalWidth/2,0]),t.signal("zoom",i.width>i.height?i.width/(.98*this.controller.properties.totalWidth):i.height/(.9*this.controller.properties.heightDrawingDIV)),t.runAsync().then(()=>{this.currentView=t})}}setBackground(t){t.signal("background",this.darkMode?"black":"white")}setGraph2DParameter(t){let n=this.controller.gui.appearance[2].sel,i=this.controller.gui.appearance[0].sel;this.darkMode=n,t.graphStyle.labelEnabled=i,n?(t.graphStyle.darkMode=!0,t.graphStyle.labelFill="#fff"):(t.graphStyle.darkMode=!1,t.graphStyle.labelFill="#000")}updateView(t,n){let i=n.getState();i.data=t.getState().data,i.signals.width=t.getState().signals.width,i.signals.height=t.getState().signals.height,t.setState(i),n.finalize()}calculateContainerStrings(){let t=this.controller.graphs[this.controller.currentOrgan].containment,n=[],i=1;return t.outDegree[t.initialRoot].forEach(r=>{n.push("Container "+i),i+=1}),n}}const TA={$schema:"https://vega.github.io/schema/vega/v5.json",description:"Graph Drawing",padding:{top:25,left:0,right:0,bottom:0},autosize:"none",signals:[{name:"shape",value:"line"},{name:"xrange",update:"[0, width]"},{name:"yrange",update:"[ 0,height]"},{name:"down",value:null,on:[{events:"touchend",update:"null"},{events:"mousedown, touchstart",update:"xy()"}]},{name:"hover",on:[{events:"*:mouseover",encode:"hover"},{events:"*:mouseout",encode:"leave"},{events:"*:mousedown",encode:"select"},{events:"*:mouseup",encode:"release"}]},{name:"xoffset",update:"-(width + padding.bottom)"},{name:"yoffset",update:"-(height + padding.left)"},{name:"xcur",value:null,on:[{events:"mousedown, touchstart, touchend",update:"slice(xdom)"}]},{name:"ycur",value:null,on:[{events:"mousedown, touchstart, touchend",update:"slice(ydom)"}]},{name:"delta",value:[0,0],on:[{events:[{source:"window",type:"mousemove",consume:!0,between:[{type:"mousedown"},{source:"window",type:"mouseup"}]},{type:"touchmove",consume:!0,filter:"event.touches.length === 1"}],update:"down ? [down[0]-x(), y()-down[1]] : [0,0]"}]},{name:"anchor",value:[0,0],on:[{events:"wheel",update:"[ invert('xscale', x()), invert('yscale', y())]"},{events:{type:"touchstart",filter:"event.touches.length===2"},update:"[(xdom[0] + xdom[1]) / 2, (ydom[0] + ydom[1]) / 2]"}]},{name:"zoom",value:1,on:[{events:"wheel!",force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"},{events:{signal:"dist2"},force:!0,update:"dist1 / dist2"}]},{name:"dist1",value:0,on:[{events:{type:"touchstart",filter:"event.touches.length===2"},update:"pinchDistance(event)"},{events:{signal:"dist2"},update:"dist2"}]},{name:"dist2",value:0,on:[{events:{type:"touchmove",consume:!0,filter:"event.touches.length===2"},update:"pinchDistance(event)"}]},{name:"sizeLabelRange",update:"[8,14]"},{name:"sizeLabelDom",update:"[8,14]",on:[{events:{signal:"zoom"},update:"[ sizeLabelDom[0] * zoom, sizeLabelDom[1] * zoom]"}]},{name:"sizeVertexRange",update:"[50,300]"},{name:"sizeVertexDom",update:"[50,300]",on:[{events:{signal:"zoom"},update:"[ sizeVertexDom[0] * zoom, sizeVertexDom[1] * zoom]"}]},{name:"ydomLabelOffset",update:"[0,height]",on:[{events:{signal:"zoom"},update:"[ydomLabelOffset[0], ydomLabelOffset[1]]"}]},{name:"xdomContainment",update:"[0,width]",on:[{events:{signal:"zoom"},update:"[ xdomContainment[0] * zoom, xdomContainment[1] * zoom]"}]},{name:"ydomContainment",update:"[0,height]",on:[{events:{signal:"zoom"},update:"[ydomContainment[0]* zoom, ydomContainment[1] * zoom]"}]},{name:"xdom",update:"[0,width]",on:[{events:{signal:"delta"},update:"[xcur[0] + span(xcur) * delta[0] / width, xcur[1] + span(xcur) * delta[0] / width]"},{events:{signal:"zoom"},update:"[anchor[0] + (xdom[0] - anchor[0]) * zoom, anchor[0] + (xdom[1] - anchor[0]) * zoom]"}]},{name:"ydom",update:"[0,height]",on:[{events:{signal:"delta"},update:"[ycur[0] - span(ycur) * delta[1] / height, ycur[1] - span(ycur) * delta[1] / height]"},{events:{signal:"zoom"},update:"[anchor[1] + (ydom[0] - anchor[1]) * zoom, anchor[1] + (ydom[1] - anchor[1]) * zoom]"}]},{name:"xdomC2",update:"[0,width]",on:[{events:{signal:"zoom"},update:"[anchor[0] + (xdom[0] - anchor[0]) * zoom, anchor[0] + (xdom[1] - anchor[0]) * zoom]"}]},{name:"ydomC2",update:"[0,height]",on:[{events:{signal:"zoom"},update:"[anchor[1] + (ydom[0] - anchor[1]) * zoom, anchor[1] + (ydom[1] - anchor[1]) * zoom]"}]}],data:[{name:"vertices",values:[]},{name:"edges",values:[],transform:[{type:"lookup",from:"vertices",key:"id",fields:["source","target"],as:["source","target"]},{type:"linkpath",shape:"diagonal",orient:"horizontal",sourceX:{field:"source.x",scale:"xscale"},sourceY:{field:"source.y",scale:"yscale"},targetX:{field:"target.x",scale:"xscale"},targetY:{field:"target.y",scale:"yscale"},as:"lp"}]},{name:"rects",values:[]},{name:"edges2",values:[],transform:[{type:"lookup",from:"vertices",key:"id",fields:["source","target"],as:["source","target"]}]}],projections:[],scales:[{name:"labelSizeScale",zero:!1,domain:{signal:"sizeLabelDom"},range:{signal:"sizeLabelRange"}},{name:"vertexSizeScale",zero:!1,domain:{signal:"sizeVertexDom"},range:{signal:"sizeVertexRange"}},{name:"xscaleC2",zero:!1,domain:{signal:"xdomC2"},range:{signal:"xrange"}},{name:"yscaleC2",zero:!1,domain:{signal:"ydomC2"},range:{signal:"yrange"}},{name:"xscale",zero:!1,domain:{signal:"xdom"},range:{signal:"xrange"}},{name:"yscale",zero:!1,domain:{signal:"ydom"},range:{signal:"yrange"}},{name:"xscaleC",zero:!1,domain:{signal:"xdomContainment"},range:{signal:"xrange"}},{name:"yscaleLabel",zero:!1,domain:{signal:"ydomLabelOffset"},range:{signal:"yrange"}},{name:"yscaleC",zero:!1,domain:{signal:"ydomContainment"},range:{signal:"yrange"}}],marks:[{type:"symbol",from:{data:"vertices"},encode:{enter:{size:{field:"vertexSize"},tooltip:{value:""},fill:{field:"color"},shape:{field:"vertexShape"},opacity:{field:"visible"},stroke:{value:"white"},strokeWidth:{value:2.5},strokeOpacity:{value:0}},update:{size:{signal:"min(datum.vertexSize,scale('vertexSizeScale',datum.vertexSize))"},x:{field:"x",scale:"xscale"},y:{field:"y",scale:"yscale"}}},zindex:1},{type:"rect",from:{data:"rects"},encode:{enter:{fill:{value:"#ffffff"},stroke:{value:"#000000"}},update:{x:{field:"x",scale:"xscale"},y:{field:"y",scale:"yscale"},width:{field:"w",scale:"xscaleC"},height:{field:"h",scale:"yscaleC"},blend:{value:"exclusion"},cornerRadius:{value:"35"},strokeWidth:{value:"2"}}}},{type:"path",interactive:!1,from:{data:"edges"},encode:{enter:{stroke:{field:"color"}},update:{path:{signal:"'M'+ scale('xscale',substring(split(datum.lp,',')[0],1)) + ',' + scale('yscale',split(split(datum.lp,',')[1],'C')[0]) + 'C' + scale('xscale',split(split(datum.lp,',')[1],'C')[1]) + ',' + scale('yscale',split(split(datum.lp,',')[2],' ')[0]) + ' '+ scale('xscale',split(split(datum.lp,',')[2],' ')[1]) + ',' + scale('yscale',split(split(datum.lp,',')[3],' ')[0]) + ','  + scale('xscale',split(split(datum.lp,',')[3],' ')[1])  +',' + scale('yscale',split(datum.lp,',')[4]) "}}}},{type:"path",interactive:!1,from:{data:"edges2"},encode:{enter:{stroke:{field:"color"}},update:{path:{signal:" 'M'+ scale('xscale',datum.source.x) + ',' + scale('yscale',datum.source.y) + 'L' + scale('xscale',datum.target.x) + ',' + scale('yscale',datum.target.y)"}}}}]};class FA{constructor(t,n,i,r){this.properties=r,this.drawingHeight=Math.max(t,this.properties.heightDrawingDIV),this.drawingWidth=Math.max(n+this.properties.widthRightPadding,this.properties.withDrawingDIV),this.darkMode=i,this.initializeLabelParameter()}initializeLabelParameter(){this.labelEnabled=!0,this.labelSize=this.properties.vertexLabelSize,this.labelFill=this.darkMode?"#fff":"#000"}toggleLabelEnabled(t){this.labelEnabled=!this.labelEnabled}exportSpezificationAnimation(t,n){let i=t;i.width=this.drawingWidth,i.height=this.drawingHeight;let r="";switch(n.angle){case 0:case 90:r="horizontal";break;default:r="vertical"}return i.data[1].transform[1].orient=r,t.marks[2].encode.enter.stroke={field:"color"},this.darkMode?(t.marks[1].encode.enter.fill={value:"#000000"},t.marks[1].encode.enter.stroke={value:"#ffffff"},t.marks[2].encode.enter.opacity={field:"opacity"},t.marks[3].encode.enter.opacity={field:"opacity"}):(t.marks[2].encode.enter.opacity={value:.5},t.marks[2].encode.enter.strokeOpacity={field:"opacity"},t.marks[3].encode.enter.opacity={value:.5},t.marks[3].encode.enter.strokeOpacity={field:"opacity"}),t.signals[4].value=[1,this.drawingWidth],t.signals[5].value=[this.drawingHeight,1],this.labelEnabled&&(i.marks=[i.marks[1],i.marks[0],i.marks[2],i.marks[3],{type:"text",from:{data:"vertices"},encode:{enter:{fill:{field:"labelColor"}},update:{x:{field:"x"},y:{field:"y"},lineHeight:0,angle:{field:"angle"},dy:{field:"labelOffsetY"},dx:{field:"labelOffsetX"},fontSize:{value:this.labelSize},fillOpacity:{value:1},strokeOpacity:{value:1},align:{value:"center"}}},zindex:2}]),i}exportSpezification(t,n){let i=t;i.width=this.drawingWidth,i.height=this.drawingHeight;let r="";switch(n.angle){case 0:case 90:r="horizontal";break;default:r="vertical"}return i.data[1].transform[1].orient=r,t.marks[2].encode.enter.stroke={field:"color"},this.darkMode?(t.marks[1].encode.enter.fill={value:"#000000"},t.marks[1].encode.enter.stroke={value:"#ffffff"},t.marks[2].encode.enter.opacity={field:"opacity"},t.marks[3].encode.enter.opacity={field:"opacity"}):(t.marks[2].encode.enter.opacity={value:.5},t.marks[2].encode.enter.strokeOpacity={field:"opacity"},t.marks[3].encode.enter.opacity={value:.5},t.marks[3].encode.enter.strokeOpacity={field:"opacity"}),t.signals[4].value=[1,this.drawingWidth],t.signals[5].value=[this.drawingHeight,1],this.labelEnabled&&(i.marks=[i.marks[1],i.marks[0],i.marks[2],i.marks[3],{type:"text",from:{data:"vertices"},encode:{enter:{fill:{field:"labelColor"},text:{field:"label"}},update:{text:{signal:"if(scale('labelSizeScale',20)< 8,' ',datum.label)"},x:{field:"x",scale:"xscale"},y:{field:"y",scale:"yscale"},lineHeight:0,angle:{field:"angle"},dy:{signal:"if(isNumber(datum.label),datum.labelOffsetY,max("+this.properties.twoLineLabelOffset+",scale('yscaleC',datum.labelOffsetY)))"},fillOpacity:{value:1},strokeOpacity:{value:1},align:{value:"center"}}},zindex:2}]),i}}class fe{constructor(t,n){this.vertices=n.slice(0),this.createVertexInducedMap(t,n),this.numVertices=n.length,this.outDegree=new Map,this.inDegree=new Map,this.vertexVisible=new Map,this.induceEdges(n,t.outDegree,this.outDegree),this.induceEdges(n,t.inDegree,this.inDegree),this.induceVertexArrays(n,t),this.vertexType=new Map,this.vertexLabel=new Map,this.vertexColor=new Map,this.induceDataContainer(n,t.vertexType,this.vertexType),this.induceDataContainer(n,t.vertexLabel,this.vertexLabel),this.induceDataContainer(n,t.vertexVisible,this.vertexVisible),this.induceDataContainer(n,t.vertexColor,this.vertexColor),this.organ=t.organ,this.IDtoOntologyType=new Map,this.IDtoOntologyID=new Map,this.induceDataContainer(n,t.IDtoOntologyType,this.IDtoOntologyType),this.induceDataContainer(n,t.IDtoOntologyID,this.IDtoOntologyID),this.vertexSize=new Map,this.induceDataContainer(n,t.vertexSize,this.vertexSize)}addVertex(t,n,i,r,a,s){switch(t){case R.Dy.AS:this.verticesAS.push(n),this.numVerticesAS+=1;break;case R.Dy.CT:this.verticesCT.push(n),this.numVerticesCT+=1;break;case R.Dy.BM:this.verticesBM.push(n),this.numVerticesBM+=1}this.vertices.push(n),this.vertexType[n]=t,this.vertexColor[n]=i,this.vertexVisible[n]=1,this.vertexSize[n]=a,this.vertexLabel[n]=s,this.numVertices+=1}createVertexInducedMap(t,n){this.vertexInduced=new Map,t.vertices.forEach(i=>{this.vertexInduced[i]=!!n.includes(i)})}induceVertexArrays(t,n){this.verticesAS=[],this.verticesCT=[],this.verticesBM=[],t.forEach(i=>{switch(n.vertexType[i]){case R.Dy.AS:this.verticesAS.push(i);break;case R.Dy.CT:this.verticesCT.push(i);break;case R.Dy.BM:this.verticesBM.push(i)}}),this.numVerticesAS=this.verticesAS.length,this.numVerticesCT=this.verticesCT.length,this.numVerticesBM=this.verticesBM.length}induceEdges(t,n,i){t.forEach(r=>{if(r in n){let a=[];n[r].forEach(s=>{this.vertexInduced[s]&&a.push(s)}),a.length>0&&(i[r]=a)}})}induceDataContainer(t,n,i){t.forEach(r=>{i[r]=n[r]})}merge(t){let n=t.vertices;n.forEach(i=>{i in t.outDegree&&(this.outDegree[i]=t.outDegree[i]),i in t.inDegree&&(this.inDegree[i]=t.inDegree[i])}),this.induceDataContainer(n,t.vertexType,this.vertexType),this.induceDataContainer(n,t.vertexLabel,this.vertexLabel),this.induceDataContainer(n,t.vertexVisible,this.vertexVisible),this.induceDataContainer(n,t.vertexColor,this.vertexColor),this.induceDataContainer(n,t.IDtoOntologyType,this.IDtoOntologyType),this.induceDataContainer(n,t.IDtoOntologyID,this.IDtoOntologyID),this.induceDataContainer(n,t.vertexSize,this.vertexSize),n.forEach(i=>{switch(t.vertexType[i]){case R.Dy.AS:this.verticesAS.push(i),this.numVerticesAS+=1;break;case R.Dy.CT:this.verticesCT.push(i),this.numVerticesCT+=1;break;case R.Dy.BM:this.verticesBM.push(i),this.numVerticesBM+=1}this.vertices.push(i)}),this.numVerticesAS=this.verticesAS.length,this.numVerticesCT=this.verticesCT.length,this.numVerticesBM=this.verticesBM.length}}class se{constructor(t,n){this.x=t,this.y=n}}class BA{constructor(t,n){n.rotate&&(90==n.rotateAngle?this.apply90Rot(t,n.rotateAngle):180==n.rotateAngle?this.applyXYSwap(t):270==n.rotateAngle&&(this.applyXYSwap(t),this.apply90Rot(t,270)),this.updateDimensions(t))}applyXYSwap(t){Object.keys(t).forEach(n=>{let i=t[parseFloat(n)];i=new se(i.y+20,i.x+20),t[parseFloat(n)]=i})}translateMap(t){Object.keys(t).forEach(n=>{t[parseFloat(n)]=this.translate(t[parseFloat(n)],Math.abs(this.minX),Math.abs(this.minY))})}translate(t,n,i){return new se(t.x+n,t.y+i)}scaleXY(t,n){this.matrix11=t,this.matrix12=0,this.matrix21=0,this.matrix22=n}rotate(t){let n=t*Math.PI/180;this.matrix11=Math.cos(n),this.matrix12=-Math.sin(n),this.matrix21=Math.sin(n),this.matrix22=Math.cos(n)}calculateMap(t){return new se(this.matrix11*t.x+this.matrix21*t.y,this.matrix12*t.x+this.matrix22*t.y)}apply90Rot(t,n){this.rotate(n),Object.keys(t).forEach(r=>{let a=t[parseFloat(r)];a=this.calculateMap(a),t[parseFloat(r)]=a}),this.updateDimensions(t),Object.keys(t).forEach(r=>{let a=t[parseFloat(r)],s=20,o=20;this.minX<0&&(s+=Math.abs(this.minX)),this.minY<0&&(o+=Math.abs(this.minY)),a=this.translate(a,s,o),t[parseFloat(r)]=new se(a.y,a.x)})}applyMap(t){Object.keys(t).forEach(n=>{t[parseFloat(n)]=this.calculateMap(t[parseFloat(n)])})}updateDimensions(t){let n=Number.MAX_VALUE,i=Number.MIN_VALUE,r=Number.MAX_VALUE,a=Number.MIN_VALUE;Object.keys(t).forEach(s=>{let o=t[s];o.x<n&&(n=o.x),o.x>i&&(i=o.x),o.y<r&&(r=o.y),o.y>a&&(a=o.y)}),this.minX=n,this.maxX=i,this.minY=r,this.maxY=a}}class sl{constructor(t,n,i){this.graph=t,this.drawing=new Map,this.highlightedEdge=new Map,this.rects=[],this.labelPosition=new Map,this.graph.vertices.forEach(r=>this.labelPosition[r]="0"),this.angle=n.rotateAngle,this.rotate=n.rotate,this.rotation=n,this.properties=i}initializeHighlights(t,n){t.vertices.forEach(i=>{i in t.outDegree&&t.outDegree[i].forEach(r=>{let a=String(i)+"|"+String(r);n[a]=!1})})}rotateAngle(t,n){n.leaves.forEach(i=>{this.labelPosition[i]=t,i in this.graph.inDegree&&this.graph.inDegree[i].forEach(r=>this.labelPosition[r]=t)}),this.graph.verticesCT.forEach(i=>this.labelPosition[i]=t),this.graph.verticesBM.forEach(i=>this.labelPosition[i]=t)}calculateWidthHeight(){this.maximumWidth=0,this.maximumHeight=0,this.graph.vertices.forEach(t=>{this.drawing[t].y>this.maximumHeight&&(this.maximumHeight=this.drawing[t].y),this.drawing[t].x>this.maximumWidth&&(this.maximumWidth=this.drawing[t].x)}),this.maximumHeight+=Math.max(this.offsetIncrementAS,this.offsetIncrementBM,this.offsetIncrementCT)}calculateDepth(){let t=new fe(this.graph,this.graph.verticesAS),n=null;return t.vertices.forEach(i=>{i in t.inDegree||(n=i)}),this.calculateDepthWorker(t,n)}calculateDepthWorker(t,n){if(n in t.outDegree){let i=Number.NEGATIVE_INFINITY;return t.outDegree[n].forEach(r=>{let a=this.calculateDepthWorker(t,r);a>i&&(i=a)}),i+1}return 1}calculateParameter(){this.depth=this.calculateDepth()-1,0==this.rotation.rotateAngle||90==this.rotation.rotateAngle?(this.depthMultiplier=0==this.depth?this.properties.totalWidth/3:this.properties.totalWidth/3/this.depth,this.offsetCTBM=this.properties.totalWidth/3,this.xPositionCT=this.properties.totalWidth-this.offsetCTBM,this.xPositionBM=this.properties.totalWidth):(this.depthMultiplier=0==this.depth?.9*this.properties.heightDrawingDIV/3:.9*this.properties.heightDrawingDIV/3/this.depth,this.offsetCTBM=.9*this.properties.heightDrawingDIV/3,this.xPositionCT=.9*this.properties.heightDrawingDIV-this.offsetCTBM,this.xPositionBM=.9*this.properties.heightDrawingDIV),this.class==Xe.Containment?(this.offsetIncrementAS=this.properties.offsetIncrementTwoLines,this.offsetIncrementCT=2*this.offsetIncrementAS,this.offsetIncrementBM=this.properties.offsetIncrementTwoLines):(this.offsetIncrementCT=this.properties.offsetIncrementTwoLines,this.offsetIncrementBM=this.properties.offsetIncrementTwoLines,this.offsetIncrementAS=this.properties.offsetIncrementTwoLines)}feasibleClippingCT(){return this.graph.verticesCT.length>0&&this.graph.verticesBM.length>0}applyLinearMap(t,n){let i=new BA(this.drawing,t);t.rotate&&(this.maximumHeight=i.maxY+30,this.maximumWidth=i.maxX+30),(t.rotate&&180==t.rotateAngle||t.rotate&&270==t.rotateAngle)&&this.rotateAngle(-90,n)}}var Xe=(()=>{return(e=Xe||(Xe={}))[e.Partial=0]="Partial",e[e.Subgraph=1]="Subgraph",e[e.Exploration=2]="Exploration",e[e.Containment=3]="Containment",Xe;var e})();class Za{constructor(t,n,i){this.graph=t,this.layout=n,this.properties=i,this.graphStyle=new FA(n.maximumHeight,n.maximumWidth,!0,i),this.vertexPosition=n.drawing}exportSpecification(t){let o,n=JSON.parse(JSON.stringify(TA)),i=[],r=[],a=[],s=[];return o=this.graphStyle.darkMode?"white":"black",this.applyLayoutSpecifics(s),this.processGraph(i,r,a,o),n.data[0].values=i,n.data[1].values=r,n.data[2].values=s,n.data[3].values=a,t?this.graphStyle.exportSpezificationAnimation(n,this.layout):this.graphStyle.exportSpezification(n,this.layout)}applyLayoutSpecifics(t){switch(this.layout.class){case Xe.Partial:case Xe.Subgraph:case Xe.Exploration:break;case Xe.Containment:this.processContainment(t)}}formatLabelTwoLines(t,n){let i=t.vertexLabel[n];if("string"==typeof i){let r=i.split(" "),a="",s="",o=0;return r.forEach(l=>{o>i.length/3?s=s+" "+l:a=a+" "+l,o+=l.length}),s.length>0?[a,s]:[a]}return i}processContainment(t){this.layout.rects.length>0&&this.layout.rects.forEach(n=>{t.push({x:n.positionX,y:n.positionY,w:n.width,h:n.height})})}processGraph(t,n,i,r){this.graph.vertices.forEach(a=>{a in this.vertexPosition||console.log("IDDDD",a,console.log(this.graph.vertexType[a]));const s=this.vertexPosition[a];let l=this.calculateVertexLabel(a);this.graph.vertexLabel[a]=l;let c,u=this.graph.vertexSize[a];c=this.graphStyle.darkMode?"#fff":"#000",this.layout.class==Xe.Containment&&(this.graph.vertexType[a]==R.Dy.CT||this.graph.vertexType[a]==R.Dy.AS)&&"black"==this.graph.vertexColor[a]&&(c=this.graphStyle.darkMode?"#000":"#fff");let p,h=this.calculateLabelOffset(a),d=this.graph.vertexColor[a];this.graphStyle.darkMode&&"black"==d&&(d="white"),p=0==this.layout.rotation.rotateAngle||90==this.layout.rotation.rotateAngle?0:270,p=t.push({id:a,x:s.x,y:s.y,color:d,label:l,visible:this.graph.vertexVisible[a],labelOffsetX:0,labelOffsetY:h,labelColor:c,vertexSize:u,vertexShape:"circle",angle:p}),a in this.graph.outDegree&&this.graph.outDegree[a].forEach(y=>{let x,v=String(a)+"|"+String(y);x=this.layout.highlightedEdge[v]?1:.4,this.graph.vertexType[a]==R.Dy.AS&&this.graph.vertexType[y]==R.Dy.AS?n.push({source:a,target:y,color:r,opacity:x}):i.push({source:a,target:y,color:r,opacity:x})})})}calculateVertexLabel(t){let n,i=this.graph.vertexLabel[t],r=this.formatLabelTwoLines(this.graph,t);if(this.layout.class===Xe.Containment)switch(this.graph.vertexType[t]){case R.Dy.AS:case R.Dy.CT:n=r;break;case R.Dy.BM:n=i}else switch(this.graph.vertexType[t]){case R.Dy.AS:n=r;break;case R.Dy.CT:case R.Dy.BM:n=i}return n}calculateLabelOffset(t){let n,i=this.graph.vertexLabel[t];if(null==i)return 0;switch(this.layout.class){case Xe.Containment:this.graph.vertexType[t]===R.Dy.BM?n=this.properties.oneLineLabelOffset:(n=2==i.length?this.properties.twoLineLabelOffset:this.properties.oneLineLabelOffset,"black"==this.graph.vertexColor[t]&&(n=this.properties.collapsedCTLabelOffset));break;case Xe.Exploration:this.graph.vertexType[t]===R.Dy.AS?2==i.length?(n=this.properties.twoLineLabelOffset,this.graph.vertexSize[t]==this.properties.rootExplorationVertexSize&&(n=this.properties.rootExplorationTwoLineLabelOffset)):(n=this.properties.oneLineLabelOffset,this.graph.vertexSize[t]==this.properties.rootExplorationVertexSize&&(n=this.properties.rootExplorationOneLineLabelOffset)):n=this.properties.oneLineLabelOffset;break;default:n=2==i.length?this.properties.twoLineLabelOffset:this.properties.oneLineLabelOffset}return n}}var i1={},df={};function r1(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function a1(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function Tt(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function LA(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(f,h){var y,d=[],g=f.length,p=0,m=0,v=g<=0,x=!1;function b(){if(v)return df;if(x)return x=!1,i1;var M,E,_=p;if(34===f.charCodeAt(_)){for(;p++<g&&34!==f.charCodeAt(p)||34===f.charCodeAt(++p););return(M=p)>=g?v=!0:10===(E=f.charCodeAt(p++))?x=!0:13===E&&(x=!0,10===f.charCodeAt(p)&&++p),f.slice(_+1,M-1).replace(/""/g,'"')}for(;p<g;){if(10===(E=f.charCodeAt(M=p++)))x=!0;else if(13===E)x=!0,10===f.charCodeAt(p)&&++p;else if(E!==n)continue;return f.slice(_,M)}return v=!0,f.slice(_,g)}for(10===f.charCodeAt(g-1)&&--g,13===f.charCodeAt(g-1)&&--g;(y=b())!==df;){for(var w=[];y!==i1&&y!==df;)w.push(y),y=b();h&&null==(w=h(w,m++))||d.push(w)}return d}function a(f,h){return f.map(function(d){return h.map(function(g){return c(d[g])}).join(e)})}function u(f){return f.map(c).join(e)}function c(f){return null==f?"":f instanceof Date?function(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+Tt(-e,6):e>9999?"+"+Tt(e,6):Tt(e,4)}(e.getUTCFullYear())+"-"+Tt(e.getUTCMonth()+1,2)+"-"+Tt(e.getUTCDate(),2)+(r?"T"+Tt(t,2)+":"+Tt(n,2)+":"+Tt(i,2)+"."+Tt(r,3)+"Z":i?"T"+Tt(t,2)+":"+Tt(n,2)+":"+Tt(i,2)+"Z":n||t?"T"+Tt(t,2)+":"+Tt(n,2)+"Z":"")}(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:function(f,h){var d,g,p=r(f,function(m,y){if(d)return d(m,y-1);g=m,d=h?function(e,t){var n=r1(e);return function(i,r){return t(n(i),r,e)}}(m,h):r1(m)});return p.columns=g||[],p},parseRows:r,format:function(f,h){return null==h&&(h=a1(f)),[h.map(c).join(e)].concat(a(f,h)).join("\n")},formatBody:function(f,h){return null==h&&(h=a1(f)),a(f,h).join("\n")},formatRows:function(f){return f.map(u).join("\n")},formatRow:u,formatValue:c}}function NA(e){return e}function UA(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(n){return s1(e,n)})}:s1(e,t)}function s1(e,t){var n=t.id,i=t.bbox,r=null==t.properties?{}:t.properties,a=o1(e,t);return null==n&&null==i?{type:"Feature",properties:r,geometry:a}:null==i?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function o1(e,t){var n=function(e){if(null==e)return NA;var t,n,i=e.scale[0],r=e.scale[1],a=e.translate[0],s=e.translate[1];return function(o,l){l||(t=n=0);var u=2,c=o.length,f=new Array(c);for(f[0]=(t+=o[0])*i+a,f[1]=(n+=o[1])*r+s;u<c;)f[u]=o[u],++u;return f}}(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var h=i[c<0?~c:c],d=0,g=h.length;d<g;++d)f.push(n(h[d],d));c<0&&function(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}(f,g)}function a(c){return n(c)}function s(c){for(var f=[],h=0,d=c.length;h<d;++h)r(c[h],f);return f.length<2&&f.push(f[0]),f}function o(c){for(var f=s(c);f.length<4;)f.push(f[0]);return f}function l(c){return c.map(o)}return function u(c){var h,f=c.type;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(u)};case"Point":h=a(c.coordinates);break;case"MultiPoint":h=c.coordinates.map(a);break;case"LineString":h=s(c.arcs);break;case"MultiLineString":h=c.arcs.map(s);break;case"Polygon":h=l(c.arcs);break;case"MultiPolygon":h=c.arcs.map(l);break;default:return null}return{type:f,coordinates:h}}(t)}function jA(e,t){var n={},i={},r={},a=[],s=-1;function l(u,c){for(var f in u){var h=u[f];delete c[h.start],delete h.start,delete h.end,h.forEach(function(d){n[d<0?~d:d]=1}),a.push(h)}}return t.forEach(function(u,c){var h,f=e.arcs[u<0?~u:u];f.length<3&&!f[1][0]&&!f[1][1]&&(h=t[++s],t[s]=u,t[c]=h)}),t.forEach(function(u){var d,g,c=function(u){var h,c=e.arcs[u<0?~u:u],f=c[0];return e.transform?(h=[0,0],c.forEach(function(d){h[0]+=d[0],h[1]+=d[1]})):h=c[c.length-1],u<0?[h,f]:[f,h]}(u),f=c[0],h=c[1];if(d=r[f])if(delete r[d.end],d.push(u),d.end=h,g=i[h]){delete i[g.start];var p=g===d?d:d.concat(g);i[p.start=d.start]=r[p.end=g.end]=p}else i[d.start]=r[d.end]=d;else if(d=i[h])if(delete i[d.start],d.unshift(u),d.start=f,g=r[f]){delete r[g.end];var m=g===d?d:g.concat(d);i[m.start=g.start]=r[m.end=d.end]=m}else i[d.start]=r[d.end]=d;else i[(d=[u]).start=f]=r[d.end=h]=d}),l(r,i),l(i,r),t.forEach(function(u){n[u<0?~u:u]||a.push([u])}),a}function qA(e){return o1(e,VA.apply(this,arguments))}function VA(e,t,n){var i,r,a;if(arguments.length>1)i=$A(0,t,n);else for(r=0,i=new Array(a=e.arcs.length);r<a;++r)i[r]=r;return{type:"MultiLineString",arcs:jA(e,i)}}function $A(e,t,n){var a,i=[],r=[];function s(f){var h=f<0?~f:f;(r[h]||(r[h]=[])).push({i:f,g:a})}function o(f){f.forEach(s)}function l(f){f.forEach(o)}return function c(f){switch(a=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":o(f.arcs);break;case"MultiLineString":case"Polygon":l(f.arcs);break;case"MultiPolygon":!function(f){f.forEach(l)}(f.arcs)}}(t),r.forEach(null==n?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}var mf=Math.sqrt(50),yf=Math.sqrt(10),vf=Math.sqrt(2);function xf(e,t,n){var i,a,s,o,r=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((i=t<e)&&(a=e,e=t,t=a),0===(o=l1(e,t,n))||!isFinite(o))return[];if(o>0){let l=Math.round(e/o),u=Math.round(t/o);for(l*o<e&&++l,u*o>t&&--u,s=new Array(a=u-l+1);++r<a;)s[r]=(l+r)*o}else{o=-o;let l=Math.round(e*o),u=Math.round(t*o);for(l/o<e&&++l,u/o>t&&--u,s=new Array(a=u-l+1);++r<a;)s[r]=(l+r)/o}return i&&s.reverse(),s}function l1(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=mf?10:a>=yf?5:a>=vf?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=mf?10:a>=yf?5:a>=vf?2:1)}function yi(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=mf?r*=10:a>=yf?r*=5:a>=vf&&(r*=2),t<e?-r:r}var h1,GA=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Hr(e){if(!(t=GA.exec(e)))throw new Error("invalid format: "+e);var t;return new bf({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function bf(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function ol(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Xr(e){return(e=ol(Math.abs(e)))?e[1]:NaN}function u1(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Xr(t)/3)))-Xr(Math.abs(e)))}function c1(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Xr(t)-Xr(e))+1}function f1(e){return Math.max(0,-Xr(Math.abs(e)))}function d1(e,t){var n=ol(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}Hr.prototype=bf.prototype,bf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const g1={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>d1(100*e,t),r:d1,s:function(e,t){var n=ol(e,t);if(!n)return e+"";var i=n[0],r=n[1],a=r-(h1=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,s=i.length;return a===s?i:a>s?i+new Array(a-s+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+ol(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function p1(e){return e}var ll,ul,_f,m1=Array.prototype.map,y1=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function v1(e){var t=void 0===e.grouping||void 0===e.thousands?p1:function(e,t){return function(n,i){for(var r=n.length,a=[],s=0,o=e[0],l=0;r>0&&o>0&&(l+o+1>i&&(o=Math.max(1,i-l)),a.push(n.substring(r-=o,r+o)),!((l+=o+1)>i));)o=e[s=(s+1)%e.length];return a.reverse().join(t)}}(m1.call(e.grouping,Number),e.thousands+""),n=void 0===e.currency?"":e.currency[0]+"",i=void 0===e.currency?"":e.currency[1]+"",r=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?p1:function(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}(m1.call(e.numerals,String)),s=void 0===e.percent?"%":e.percent+"",o=void 0===e.minus?"\u2212":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function u(f){var h=(f=Hr(f)).fill,d=f.align,g=f.sign,p=f.symbol,m=f.zero,y=f.width,v=f.comma,x=f.precision,b=f.trim,w=f.type;"n"===w?(v=!0,w="g"):g1[w]||(void 0===x&&(x=12),b=!0,w="g"),(m||"0"===h&&"="===d)&&(m=!0,h="0",d="=");var M="$"===p?n:"#"===p&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",_="$"===p?i:/[%p]/.test(w)?s:"",E=g1[w],A=/[defgprs%]/.test(w);function D(k){var L,C,O,T=M,S=_;if("c"===w)S=E(k)+S,k="";else{var P=(k=+k)<0||1/k<0;if(k=isNaN(k)?l:E(Math.abs(k),x),b&&(k=function(e){e:for(var r,t=e.length,n=1,i=-1;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":0===i&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(r+1):e}(k)),P&&0==+k&&"+"!==g&&(P=!1),T=(P?"("===g?g:o:"-"===g||"("===g?"":g)+T,S=("s"===w?y1[8+h1/3]:"")+S+(P&&"("===g?")":""),A)for(L=-1,C=k.length;++L<C;)if(48>(O=k.charCodeAt(L))||O>57){S=(46===O?r+k.slice(L+1):k.slice(L))+S,k=k.slice(0,L);break}}v&&!m&&(k=t(k,1/0));var U=T.length+k.length+S.length,Z=U<y?new Array(y-U+1).join(h):"";switch(v&&m&&(k=t(Z+k,Z.length?y-S.length:1/0),Z=""),d){case"<":k=T+k+S+Z;break;case"=":k=T+Z+k+S;break;case"^":k=Z.slice(0,U=Z.length>>1)+T+k+S+Z.slice(U);break;default:k=Z+T+k+S}return a(k)}return x=void 0===x?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x)),D.toString=function(){return f+""},D}return{format:u,formatPrefix:function(f,h){var d=u(((f=Hr(f)).type="f",f)),g=3*Math.max(-8,Math.min(8,Math.floor(Xr(h)/3))),p=Math.pow(10,-g),m=y1[8+g/3];return function(y){return d(p*y)+m}}}}ll=v1({thousands:",",grouping:[3],currency:["$",""]}),ul=ll.format,_f=ll.formatPrefix;var wf=new Date,Mf=new Date;function Ue(e,t,n,i){function r(a){return e(a=0===arguments.length?new Date:new Date(+a)),a}return r.floor=function(a){return e(a=new Date(+a)),a},r.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},r.round=function(a){var s=r(a),o=r.ceil(a);return a-s<o-a?s:o},r.offset=function(a,s){return t(a=new Date(+a),null==s?1:Math.floor(s)),a},r.range=function(a,s,o){var u,l=[];if(a=r.ceil(a),o=null==o?1:Math.floor(o),!(a<s&&o>0))return l;do{l.push(u=new Date(+a)),t(a,o),e(a)}while(u<a&&a<s);return l},r.filter=function(a){return Ue(function(s){if(s>=s)for(;e(s),!a(s);)s.setTime(s-1)},function(s,o){if(s>=s)if(o<0)for(;++o<=0;)for(;t(s,-1),!a(s););else for(;--o>=0;)for(;t(s,1),!a(s););})},n&&(r.count=function(a,s){return wf.setTime(+a),Mf.setTime(+s),e(wf),e(Mf),Math.floor(n(wf,Mf))},r.every=function(a){return a=Math.floor(a),isFinite(a)&&a>0?a>1?r.filter(i?function(s){return i(s)%a==0}:function(s){return r.count(0,s)%a==0}):r:null}),r}const Kn=1e3,Zt=6e4,Jn=60*Zt,nr=24*Jn,Df=7*nr,x1=30*nr,Ef=365*nr;var b1=Ue(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Zt)/nr,e=>e.getDate()-1);const vi=b1;function ir(e){return Ue(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+7*n)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Zt)/Df})}var Zr=ir(0),cl=ir(1),Kr=(ir(2),ir(3),ir(4)),_1=(ir(5),ir(6),Ue(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/nr},function(e){return e.getUTCDate()-1}));const xi=_1;function rr(e){return Ue(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+7*n)},function(t,n){return(n-t)/Df})}var Jr=rr(0),fl=rr(1),Qr=(rr(2),rr(3),rr(4)),kf=(rr(5),rr(6),Ue(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}));kf.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Ue(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)}):null};const bi=kf;var w1=Ue(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()});const hl=w1;var M1=Ue(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Kn-e.getMinutes()*Zt)},function(e,t){e.setTime(+e+t*Jn)},function(e,t){return(t-e)/Jn},function(e){return e.getHours()});const Af=M1;var D1=Ue(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Kn)},function(e,t){e.setTime(+e+t*Zt)},function(e,t){return(t-e)/Zt},function(e){return e.getMinutes()});const Cf=D1;var E1=Ue(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*Kn)},function(e,t){return(t-e)/Kn},function(e){return e.getUTCSeconds()});const _i=E1;var dl=Ue(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});dl.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Ue(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):dl:null};const Sf=dl;var Tf=Ue(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Tf.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Ue(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null};const wi=Tf;var k1=Ue(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()});const gl=k1;var A1=Ue(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Jn)},function(e,t){return(t-e)/Jn},function(e){return e.getUTCHours()});const Ff=A1;var C1=Ue(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*Zt)},function(e,t){return(t-e)/Zt},function(e){return e.getUTCMinutes()});const Bf=C1;function ea(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ja(e){let t=e,n=e;function i(s,o,l,u){for(null==l&&(l=0),null==u&&(u=s.length);l<u;){const c=l+u>>>1;n(s[c],o)<0?l=c+1:u=c}return l}return 1===e.length&&(t=(s,o)=>e(s)-o,n=function(e){return(t,n)=>ea(e(t),n)}(e)),{left:i,center:function(s,o,l,u){null==l&&(l=0),null==u&&(u=s.length);const c=i(s,o,l,u-1);return c>l&&t(s[c-1],o)>-t(s[c],o)?c-1:c},right:function(s,o,l,u){for(null==l&&(l=0),null==u&&(u=s.length);l<u;){const c=l+u>>>1;n(s[c],o)>0?u=c:l=c+1}return l}}}const it="year",Ut="quarter",dt="month",je="week",jt="date",gt="day",Qn="dayofyear",Kt="hours",Jt="minutes",dn="seconds",Tn="milliseconds",S1=[it,Ut,dt,je,jt,gt,Qn,Kt,Jt,dn,Tn],If=S1.reduce((e,t,n)=>(e[t]=1+n,e),{});function T1(e){const t=K(e).slice(),n={};return t.length||I("Missing time unit."),t.forEach(r=>{J(If,r)?n[r]=1:I("Invalid time unit: ".concat(r,"."))}),(n[je]||n.day?1:0)+(n[Ut]||n[dt]||n[jt]?1:0)+(n[Qn]?1:0)>1&&I("Incompatible time units: ".concat(e)),t.sort((r,a)=>If[r]-If[a]),t}const oC={[it]:"%Y ",[Ut]:"Q%q ",[dt]:"%b ",[jt]:"%d ",[je]:"W%U ",[gt]:"%a ",[Qn]:"%j ",[Kt]:"%H:00",[Jt]:"00:%M",[dn]:":%S",[Tn]:".%L",["".concat(it,"-").concat(dt)]:"%Y-%m ",["".concat(it,"-").concat(dt,"-").concat(jt)]:"%Y-%m-%d ",["".concat(Kt,"-").concat(Jt)]:"%H:%M"},ar=new Date;function Rf(e){return ar.setFullYear(e),ar.setMonth(0),ar.setDate(1),ar.setHours(0,0,0,0),ar}function F1(e){return vi.count(Rf(e.getFullYear())-1,e)}function Of(e){return Zr.count(Rf(e.getFullYear())-1,e)}function Lf(e){return Rf(e).getDay()}function fC(e,t,n,i,r,a,s){if(0<=e&&e<100){const o=new Date(-1,t,n,i,r,a,s);return o.setFullYear(e),o}return new Date(e,t,n,i,r,a,s)}function B1(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return xi.count(t-1,e)}function zf(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Jr.count(t-1,e)}function Nf(e){return ar.setTime(Date.UTC(e,0,1)),ar.getUTCDay()}function gC(e,t,n,i,r,a,s){if(0<=e&&e<100){const o=new Date(Date.UTC(-1,t,n,i,r,a,s));return o.setUTCFullYear(n.y),o}return new Date(Date.UTC(e,t,n,i,r,a,s))}function I1(e,t,n,i,r){const a=t||1,s=ce(e),o=(y,v,x)=>function(e,t,n,i){const r=n<=1?e:i?(a,s)=>i+n*Math.floor((e(a,s)-i)/n):(a,s)=>n*Math.floor(e(a,s)/n);return t?(a,s)=>t(r(a,s),s):r}(n[x=x||y],i[x],y===s&&a,v),l=new Date,u=Sn(e),c=u[it]?o(it):ht(2012),f=u[dt]?o(dt):u[Ut]?o(Ut):Ji,h=u[je]&&u.day?o(gt,1,je+gt):u[je]?o(je,1):u.day?o(gt,1):u[jt]?o(jt,1):u[Qn]?o(Qn,1):Ga,d=u[Kt]?o(Kt):Ji,g=u[Jt]?o(Jt):Ji,p=u[dn]?o(dn):Ji,m=u[Tn]?o(Tn):Ji;return function(y){l.setTime(+y);const v=c(l);return r(v,f(l),h(l,v),d(l),g(l),p(l),m(l))}}function ta(e,t,n){return t+7*e-(n+6)%7}const mC={[it]:e=>e.getFullYear(),[Ut]:e=>Math.floor(e.getMonth()/3),[dt]:e=>e.getMonth(),[jt]:e=>e.getDate(),[Kt]:e=>e.getHours(),[Jt]:e=>e.getMinutes(),[dn]:e=>e.getSeconds(),[Tn]:e=>e.getMilliseconds(),[Qn]:e=>F1(e),[je]:e=>Of(e),[je+gt]:(e,t)=>ta(Of(e),e.getDay(),Lf(t)),[gt]:(e,t)=>ta(1,e.getDay(),Lf(t))},yC={[Ut]:e=>3*e,[je]:(e,t)=>ta(e,0,Lf(t))};function vC(e,t){return I1(e,t||1,mC,yC,fC)}const xC={[it]:e=>e.getUTCFullYear(),[Ut]:e=>Math.floor(e.getUTCMonth()/3),[dt]:e=>e.getUTCMonth(),[jt]:e=>e.getUTCDate(),[Kt]:e=>e.getUTCHours(),[Jt]:e=>e.getUTCMinutes(),[dn]:e=>e.getUTCSeconds(),[Tn]:e=>e.getUTCMilliseconds(),[Qn]:e=>B1(e),[je]:e=>zf(e),[gt]:(e,t)=>ta(1,e.getUTCDay(),Nf(t)),[je+gt]:(e,t)=>ta(zf(e),e.getUTCDay(),Nf(t))},bC={[Ut]:e=>3*e,[je]:(e,t)=>ta(e,0,Nf(t))};function _C(e,t){return I1(e,t||1,xC,bC,gC)}const wC={[it]:bi,[Ut]:hl.every(3),[dt]:hl,[je]:Zr,[jt]:vi,[gt]:vi,[Qn]:vi,[Kt]:Af,[Jt]:Cf,[dn]:_i,[Tn]:Sf},MC={[it]:wi,[Ut]:gl.every(3),[dt]:gl,[je]:Jr,[jt]:xi,[gt]:xi,[Qn]:xi,[Kt]:Ff,[Jt]:Bf,[dn]:_i,[Tn]:Sf};function Qa(e){return wC[e]}function es(e){return MC[e]}function R1(e,t,n){return e?e.offset(t,n):void 0}function O1(e,t,n,i){return e?e.range(t,n,i):void 0}const ns=6e4,is=60*ns,pl=24*is,L1=30*pl,Pf=365*pl,z1=[it,dt,jt,Kt,Jt,dn,Tn],rs=z1.slice(0,-1),as=rs.slice(0,-1),ss=as.slice(0,-1),SC=ss.slice(0,-1),N1=[it,dt],P1=[it],os=[[rs,1,1e3],[rs,5,5e3],[rs,15,15e3],[rs,30,3e4],[as,1,ns],[as,5,5*ns],[as,15,15*ns],[as,30,30*ns],[ss,1,is],[ss,3,3*is],[ss,6,6*is],[ss,12,12*is],[SC,1,pl],[[it,je],1,6048e5],[N1,1,L1],[N1,3,3*L1],[P1,1,Pf]];function Uf(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function jf(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ls(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function U1(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,a=e.days,s=e.shortDays,o=e.months,l=e.shortMonths,u=us(r),c=cs(r),f=us(a),h=cs(a),d=us(s),g=cs(s),p=us(o),m=cs(o),y=us(l),v=cs(l),x={a:function(j){return s[j.getDay()]},A:function(j){return a[j.getDay()]},b:function(j){return l[j.getMonth()]},B:function(j){return o[j.getMonth()]},c:null,d:Y1,e:Y1,f:eS,g:cS,G:hS,H:KC,I:JC,j:QC,L:W1,m:tS,M:nS,p:function(j){return r[+(j.getHours()>=12)]},q:function(j){return 1+~~(j.getMonth()/3)},Q:Q1,s:ey,S:iS,u:rS,U:aS,V:sS,w:oS,W:lS,x:null,X:null,y:uS,Y:fS,Z:dS,"%":J1},b={a:function(j){return s[j.getUTCDay()]},A:function(j){return a[j.getUTCDay()]},b:function(j){return l[j.getUTCMonth()]},B:function(j){return o[j.getUTCMonth()]},c:null,d:X1,e:X1,f:yS,g:AS,G:SS,H:gS,I:pS,j:mS,L:Z1,m:vS,M:xS,p:function(j){return r[+(j.getUTCHours()>=12)]},q:function(j){return 1+~~(j.getUTCMonth()/3)},Q:Q1,s:ey,S:bS,u:_S,U:wS,V:MS,w:DS,W:ES,x:null,X:null,y:kS,Y:CS,Z:TS,"%":J1},w={a:function(j,ae,ye){var N=d.exec(ae.slice(ye));return N?(j.w=g.get(N[0].toLowerCase()),ye+N[0].length):-1},A:function(j,ae,ye){var N=f.exec(ae.slice(ye));return N?(j.w=h.get(N[0].toLowerCase()),ye+N[0].length):-1},b:function(j,ae,ye){var N=y.exec(ae.slice(ye));return N?(j.m=v.get(N[0].toLowerCase()),ye+N[0].length):-1},B:function(j,ae,ye){var N=p.exec(ae.slice(ye));return N?(j.m=m.get(N[0].toLowerCase()),ye+N[0].length):-1},c:function(j,ae,ye){return E(j,t,ae,ye)},d:$1,e:$1,f:WC,g:V1,G:q1,H:G1,I:G1,j:VC,L:YC,m:qC,M:$C,p:function(j,ae,ye){var N=u.exec(ae.slice(ye));return N?(j.p=c.get(N[0].toLowerCase()),ye+N[0].length):-1},q:jC,Q:XC,s:ZC,S:GC,u:LC,U:zC,V:NC,w:OC,W:PC,x:function(j,ae,ye){return E(j,n,ae,ye)},X:function(j,ae,ye){return E(j,i,ae,ye)},y:V1,Y:q1,Z:UC,"%":HC};function M(j,ae){return function(ye){var Xt,qr,bk,N=[],Nt=-1,De=0,Ht=j.length;for(ye instanceof Date||(ye=new Date(+ye));++Nt<Ht;)37===j.charCodeAt(Nt)&&(N.push(j.slice(De,Nt)),null!=(qr=j1[Xt=j.charAt(++Nt)])?Xt=j.charAt(++Nt):qr="e"===Xt?" ":"0",(bk=ae[Xt])&&(Xt=bk(ye,qr)),N.push(Xt),De=Nt+1);return N.push(j.slice(De,Nt)),N.join("")}}function _(j,ae){return function(ye){var De,Ht,N=ls(1900,void 0,1);if(E(N,j,ye+="",0)!=ye.length)return null;if("Q"in N)return new Date(N.Q);if("s"in N)return new Date(1e3*N.s+("L"in N?N.L:0));if(ae&&!("Z"in N)&&(N.Z=0),"p"in N&&(N.H=N.H%12+12*N.p),void 0===N.m&&(N.m="q"in N?N.q:0),"V"in N){if(N.V<1||N.V>53)return null;"w"in N||(N.w=1),"Z"in N?(Ht=(De=jf(ls(N.y,0,1))).getUTCDay(),De=Ht>4||0===Ht?fl.ceil(De):fl(De),De=xi.offset(De,7*(N.V-1)),N.y=De.getUTCFullYear(),N.m=De.getUTCMonth(),N.d=De.getUTCDate()+(N.w+6)%7):(Ht=(De=Uf(ls(N.y,0,1))).getDay(),De=Ht>4||0===Ht?cl.ceil(De):cl(De),De=vi.offset(De,7*(N.V-1)),N.y=De.getFullYear(),N.m=De.getMonth(),N.d=De.getDate()+(N.w+6)%7)}else("W"in N||"U"in N)&&("w"in N||(N.w="u"in N?N.u%7:"W"in N?1:0),Ht="Z"in N?jf(ls(N.y,0,1)).getUTCDay():Uf(ls(N.y,0,1)).getDay(),N.m=0,N.d="W"in N?(N.w+6)%7+7*N.W-(Ht+5)%7:N.w+7*N.U-(Ht+6)%7);return"Z"in N?(N.H+=N.Z/100|0,N.M+=N.Z%100,jf(N)):Uf(N)}}function E(j,ae,ye,N){for(var Xt,qr,Nt=0,De=ae.length,Ht=ye.length;Nt<De;){if(N>=Ht)return-1;if(37===(Xt=ae.charCodeAt(Nt++))){if(Xt=ae.charAt(Nt++),!(qr=w[Xt in j1?ae.charAt(Nt++):Xt])||(N=qr(j,ye,N))<0)return-1}else if(Xt!=ye.charCodeAt(N++))return-1}return N}return x.x=M(n,x),x.X=M(i,x),x.c=M(t,x),b.x=M(n,b),b.X=M(i,b),b.c=M(t,b),{format:function(j){var ae=M(j+="",x);return ae.toString=function(){return j},ae},parse:function(j){var ae=_(j+="",!1);return ae.toString=function(){return j},ae},utcFormat:function(j){var ae=M(j+="",b);return ae.toString=function(){return j},ae},utcParse:function(j){var ae=_(j+="",!0);return ae.toString=function(){return j},ae}}}var na,qf,ty,Vf,ny,j1={"-":"",_:" ",0:"0"},qe=/^\s*\d+/,BC=/^%/,IC=/[\\^$*+?|[\]().{}]/g;function pe(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function RC(e){return e.replace(IC,"\\$&")}function us(e){return new RegExp("^(?:"+e.map(RC).join("|")+")","i")}function cs(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function OC(e,t,n){var i=qe.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function LC(e,t,n){var i=qe.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function zC(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function NC(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function PC(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function q1(e,t,n){var i=qe.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function V1(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function UC(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function jC(e,t,n){var i=qe.exec(t.slice(n,n+1));return i?(e.q=3*i[0]-3,n+i[0].length):-1}function qC(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function $1(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function VC(e,t,n){var i=qe.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function G1(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function $C(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function GC(e,t,n){var i=qe.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function YC(e,t,n){var i=qe.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function WC(e,t,n){var i=qe.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function HC(e,t,n){var i=BC.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function XC(e,t,n){var i=qe.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function ZC(e,t,n){var i=qe.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function Y1(e,t){return pe(e.getDate(),t,2)}function KC(e,t){return pe(e.getHours(),t,2)}function JC(e,t){return pe(e.getHours()%12||12,t,2)}function QC(e,t){return pe(1+vi.count(bi(e),e),t,3)}function W1(e,t){return pe(e.getMilliseconds(),t,3)}function eS(e,t){return W1(e,t)+"000"}function tS(e,t){return pe(e.getMonth()+1,t,2)}function nS(e,t){return pe(e.getMinutes(),t,2)}function iS(e,t){return pe(e.getSeconds(),t,2)}function rS(e){var t=e.getDay();return 0===t?7:t}function aS(e,t){return pe(Zr.count(bi(e)-1,e),t,2)}function H1(e){var t=e.getDay();return t>=4||0===t?Kr(e):Kr.ceil(e)}function sS(e,t){return e=H1(e),pe(Kr.count(bi(e),e)+(4===bi(e).getDay()),t,2)}function oS(e){return e.getDay()}function lS(e,t){return pe(cl.count(bi(e)-1,e),t,2)}function uS(e,t){return pe(e.getFullYear()%100,t,2)}function cS(e,t){return pe((e=H1(e)).getFullYear()%100,t,2)}function fS(e,t){return pe(e.getFullYear()%1e4,t,4)}function hS(e,t){var n=e.getDay();return pe((e=n>=4||0===n?Kr(e):Kr.ceil(e)).getFullYear()%1e4,t,4)}function dS(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+pe(t/60|0,"0",2)+pe(t%60,"0",2)}function X1(e,t){return pe(e.getUTCDate(),t,2)}function gS(e,t){return pe(e.getUTCHours(),t,2)}function pS(e,t){return pe(e.getUTCHours()%12||12,t,2)}function mS(e,t){return pe(1+xi.count(wi(e),e),t,3)}function Z1(e,t){return pe(e.getUTCMilliseconds(),t,3)}function yS(e,t){return Z1(e,t)+"000"}function vS(e,t){return pe(e.getUTCMonth()+1,t,2)}function xS(e,t){return pe(e.getUTCMinutes(),t,2)}function bS(e,t){return pe(e.getUTCSeconds(),t,2)}function _S(e){var t=e.getUTCDay();return 0===t?7:t}function wS(e,t){return pe(Jr.count(wi(e)-1,e),t,2)}function K1(e){var t=e.getUTCDay();return t>=4||0===t?Qr(e):Qr.ceil(e)}function MS(e,t){return e=K1(e),pe(Qr.count(wi(e),e)+(4===wi(e).getUTCDay()),t,2)}function DS(e){return e.getUTCDay()}function ES(e,t){return pe(fl.count(wi(e)-1,e),t,2)}function kS(e,t){return pe(e.getUTCFullYear()%100,t,2)}function AS(e,t){return pe((e=K1(e)).getUTCFullYear()%100,t,2)}function CS(e,t){return pe(e.getUTCFullYear()%1e4,t,4)}function SS(e,t){var n=e.getUTCDay();return pe((e=n>=4||0===n?Qr(e):Qr.ceil(e)).getUTCFullYear()%1e4,t,4)}function TS(){return"+0000"}function J1(){return"%"}function Q1(e){return+e}function ey(e){return Math.floor(+e/1e3)}function fs(e){const t={};return n=>t[n]||(t[n]=e(n))}function iy(e){const t=fs(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){const r=Hr(i||",");if(null==r.precision){switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1}return function(e,t){return n=>{const i=e(n),r=i.indexOf(t);if(r<0)return i;let a=function(e,t){let i,n=e.lastIndexOf("e");if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}(i,r);const s=a<i.length?i.slice(a):"";for(;--a>r;)if("0"!==i[a]){++a;break}return i.slice(0,a)+s}}(t(r),t(".1f")(1)[1])}return t(r)},formatSpan(i,r,a,s){s=Hr(null==s?",f":s);const o=yi(i,r,a),l=Math.max(Math.abs(i),Math.abs(r));let u;if(null==s.precision)switch(s.type){case"s":return isNaN(u=u1(o,l))||(s.precision=u),n(s,l);case"":case"e":case"g":case"p":case"r":isNaN(u=c1(o,l))||(s.precision=u-("e"===s.type));break;case"f":case"%":isNaN(u=f1(o))||(s.precision=u-2*("%"===s.type))}return t(s)}}}let $f,Yf;function ay(e){return iy(v1(e))}function Gf(e){return arguments.length?$f=ay(e):$f}function sy(e,t,n){ee(n=n||{})||I("Invalid time multi-format specifier: ".concat(n));const i=t(dn),r=t(Jt),a=t(Kt),s=t(jt),o=t(je),l=t(dt),u=t(Ut),c=t(it),f=e(n[Tn]||".%L"),h=e(n[dn]||":%S"),d=e(n[Jt]||"%I:%M"),g=e(n[Kt]||"%I %p"),p=e(n[jt]||n.day||"%a %d"),m=e(n[je]||"%b %d"),y=e(n[dt]||"%B"),v=e(n[Ut]||"%B"),x=e(n[it]||"%Y");return b=>(i(b)<b?f:r(b)<b?h:a(b)<b?d:s(b)<b?g:l(b)<b?o(b)<b?p:m:c(b)<b?u(b)<b?y:v:x)(b)}function oy(e){const t=fs(e.format),n=fs(e.utcFormat);return{timeFormat:i=>ke(i)?t(i):sy(t,Qa,i),utcFormat:i=>ke(i)?n(i):sy(n,es,i),timeParse:fs(e.parse),utcParse:fs(e.utcParse)}}function uy(e){return oy(U1(e))}function ml(e){return arguments.length?Yf=uy(e):Yf}na=U1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),qf=na.format,ty=na.parse,Vf=na.utcFormat,ny=na.utcParse,$f=iy({format:ul,formatPrefix:_f}),Yf=oy({format:qf,parse:ty,utcFormat:Vf,utcParse:ny});const Wf=(e,t)=>te({},e,t);const OS=/^(data:|([A-Za-z]+:)?\/\/)/,LS=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,zS=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,fy="file://";function PS(e,t){return Hf.apply(this,arguments)}function Hf(){return(Hf=(0,Q.Z)(function*(e,t){const n=yield this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)})).apply(this,arguments)}function US(e,t){return Xf.apply(this,arguments)}function Xf(){return(Xf=(0,Q.Z)(function*(e,t){t=te({},this.options,t);const n=this.fileAccess,i={href:null};let r,a,s;const o=LS.test(e.replace(zS,""));(null==e||"string"!=typeof e||!o)&&I("Sanitize failure, invalid URI: "+W(e));const l=OS.test(e);return(s=t.baseURL)&&!l&&(!e.startsWith("/")&&!s.endsWith("/")&&(e="/"+e),e=s+e),a=(r=e.startsWith(fy))||"file"===t.mode||"http"!==t.mode&&!l&&n,r?e=e.slice(fy.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!a}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i})).apply(this,arguments)}function jS(e){return e?t=>new Promise((n,i)=>{e.readFile(t,(r,a)=>{r?i(r):n(a)})}):qS}function qS(){return Zf.apply(this,arguments)}function Zf(){return(Zf=(0,Q.Z)(function*(){I("No file system access.")})).apply(this,arguments)}function VS(e){return e?function(){var t=(0,Q.Z)(function*(n,i){const r=te({},this.options.http,i),a=i&&i.response,s=yield e(n,r);return s.ok?ne(s[a])?s[a]():s.text():I(s.status+""+s.statusText)});return function(n,i){return t.apply(this,arguments)}}():$S}function $S(){return Kf.apply(this,arguments)}function Kf(){return(Kf=(0,Q.Z)(function*(){I("No HTTP fetch method available.")})).apply(this,arguments)}const GS=e=>null!=e&&e==e,hy=e=>!(Number.isNaN(+e)||e instanceof Date),dy={boolean:Zm,integer:ft,number:ft,date:Km,string:Jm,unknown:St},yl=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>hy(e)&&Number.isInteger(+e),hy,e=>!Number.isNaN(Date.parse(e))],XS=["boolean","integer","number","date"];function gy(e){const t=function(n,i){const r={delimiter:e};return Jf(n,i?te(i,r):r)};return t.responseType="text",t}function Jf(e,t){return t.header&&(e=t.header.map(W).join(t.delimiter)+"\n"+e),LA(t.delimiter).parse(e+"")}function Qf(e,t){const n=t&&t.property?Pt(t.property):St;return ee(e)&&!function(e){return!("function"!=typeof Buffer||!ne(Buffer.isBuffer))&&Buffer.isBuffer(e)}(e)?function(e,t){return!$(e)&&function(e){return e&&ne(e[Symbol.iterator])}(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t):n(JSON.parse(e))}Jf.responseType="text",Qf.responseType="json";const e3={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function py(e,t){let n,i,r,a;return e=Qf(e,t),t&&t.feature?(n=UA,r=t.feature):t&&t.mesh?(n=qA,r=t.mesh,a=e3[t.filter]):I("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,a):I("Invalid TopoJSON object: "+r),i&&i.features||[i]}py.responseType="json";const eh={dsv:Jf,csv:gy(","),tsv:gy("\t"),json:Qf,topojson:py};function my(e,t){return arguments.length>1?(eh[e]=t,this):J(eh,e)?eh[e]:null}function t3(e){const t=my(e);return t&&t.responseType||"text"}function n3(e,t,n,i){const r=my((t=t||{}).type||"json");return r||I("Unknown data format type: "+t.type),e=r(e,t),t.parse&&function(e,t,n,i){if(!e.length)return;const r=ml();n=n||r.timeParse,i=i||r.utcParse;let s,o,l,u,c,f,a=e.columns||Object.keys(e[0]);"auto"===t&&(t=function(e,t){return t.reduce((n,i)=>(n[i]=function(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=yl.length,r=yl.map((a,s)=>s+1);for(let o,l,a=0,s=0;a<n;++a)for(l=t?e[a][t]:e[a],o=0;o<i;++o)if(r[o]&&GS(l)&&!yl[o](l)&&(r[o]=0,++s,s===yl.length))return"string";return XS[r.reduce((a,s)=>0===a?s:a,0)-1]}(e,i),n),{})}(e,a)),a=Object.keys(t);const h=a.map(d=>{const g=t[d];let p,m;if(g&&(g.startsWith("date:")||g.startsWith("utc:")))return p=g.split(/:(.+)?/,2),m=p[1],("'"===m[0]&&"'"===m[m.length-1]||'"'===m[0]&&'"'===m[m.length-1])&&(m=m.slice(1,-1)),("utc"===p[0]?i:n)(m);if(!dy[g])throw Error("Illegal format pattern: "+d+":"+g);return dy[g]});for(l=0,c=e.length,f=a.length;l<c;++l)for(s=e[l],u=0;u<f;++u)o=a[u],s[o]=h[u](s[o])}(e,t.parse,n,i),J(e,"columns")&&delete e.columns,e}const th=(e="undefined"!=typeof fetch&&fetch,n=>({options:n||{},sanitize:US,load:PS,fileAccess:!1,file:jS(null),http:VS(e)}));var e;function vl(e){const t=e||St,n=[],i={};return n.add=r=>{const a=t(r);return i[a]||(i[a]=1,n.push(r)),n},n.remove=r=>{const a=t(r);if(i[a]){i[a]=0;const s=n.indexOf(r);s>=0&&n.splice(s,1)}return n},n}function xl(e,t){return nh.apply(this,arguments)}function nh(){return nh=(0,Q.Z)(function*(e,t){try{yield t(e)}catch(n){e.error(n)}}),nh.apply(this,arguments)}const yy=Symbol("vega_id");let r3=1;function ih(e){return!(!e||!Y(e))}function Y(e){return e[yy]}function vy(e,t){return e[yy]=t,e}function xe(e){const t=e===Object(e)?e:{data:e};return Y(t)?t:vy(t,r3++)}function rh(e){return bl(e,xe({}))}function bl(e,t){for(const n in e)t[n]=e[n];return t}function xy(e,t){return vy(t,Y(e))}function sr(e,t){return e?t?(n,i)=>e(n,i)||Y(t(n))-Y(t(i)):(n,i)=>e(n,i)||Y(n)-Y(i):null}function by(e){return e&&e.constructor===ia}function ia(){const e=[],t=[],n=[],i=[],r=[];let a=null,s=!1;return{constructor:ia,insert(o){const l=K(o),u=l.length;for(let c=0;c<u;++c)e.push(l[c]);return this},remove(o){const l=ne(o)?i:t,u=K(o),c=u.length;for(let f=0;f<c;++f)l.push(u[f]);return this},modify(o,l,u){const c={field:l,value:ht(u)};return ne(o)?(c.filter=o,r.push(c)):(c.tuple=o,n.push(c)),this},encode(o,l){return ne(o)?r.push({filter:o,field:l}):n.push({tuple:o,field:l}),this},clean(o){return a=o,this},reflow(){return s=!0,this},pulse(o,l){const u={},c={};let f,h,d,g,p,m;for(f=0,h=l.length;f<h;++f)u[Y(l[f])]=1;for(f=0,h=t.length;f<h;++f)p=t[f],u[Y(p)]=-1;for(f=0,h=i.length;f<h;++f)g=i[f],l.forEach(v=>{g(v)&&(u[Y(v)]=-1)});for(f=0,h=e.length;f<h;++f)p=e[f],m=Y(p),u[m]?u[m]=1:o.add.push(xe(e[f]));for(f=0,h=l.length;f<h;++f)p=l[f],u[Y(p)]<0&&o.rem.push(p);function y(v,x,b){b?v[x]=b(v):o.encode=x,s||(c[Y(v)]=v)}for(f=0,h=n.length;f<h;++f)d=n[f],p=d.tuple,g=d.field,m=u[Y(p)],m>0&&(y(p,g,d.value),o.modifies(g));for(f=0,h=r.length;f<h;++f)d=r[f],g=d.filter,l.forEach(v=>{g(v)&&u[Y(v)]>0&&y(v,d.field,d.value)}),o.modifies(d.field);if(s)o.mod=t.length||i.length?l.filter(v=>u[Y(v)]>0):l.slice();else for(m in c)o.mod.push(c[m]);return(a||null==a&&(t.length||i.length))&&o.clean(!0),o}}}const _l="_:mod:_";function ah(){Object.defineProperty(this,_l,{writable:!0,value:{}})}ah.prototype={set(e,t,n,i){const r=this,a=r[e],s=r[_l];return null!=t&&t>=0?(a[t]!==n||i)&&(a[t]=n,s[t+":"+e]=-1,s[e]=-1):(a!==n||i)&&(r[e]=n,s[e]=$(n)?1+n.length:-1),r},modified(e,t){const n=this[_l];if(!arguments.length){for(const i in n)if(n[i])return!0;return!1}if($(e)){for(let i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[_l]={},this}};let a3=0;const o3=new ah;function Me(e,t,n,i){this.id=++a3,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function _y(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Me.prototype={targets(){return this._targets||(this._targets=vl(Qo))},set(e){return this.value!==e?(this.value=e,1):0},skip:_y(1),modified:_y(2),parameters(e,t,n){t=!1!==t;const i=this._argval=this._argval||new ah,r=this._argops=this._argops||[],a=[];let s,o,l,u;const c=(f,h,d)=>{d instanceof Me?(d!==this&&(t&&d.targets().add(this),a.push(d)),r.push({op:d,name:f,index:h})):i.set(f,h,d)};for(s in e)if(o=e[s],"pulse"===s)K(o).forEach(f=>{f instanceof Me?f!==this&&(f.targets().add(this),a.push(f)):I("Pulse parameters must be operator instances.")}),this.source=o;else if($(o))for(i.set(s,-1,Array(l=o.length)),u=0;u<l;++u)c(s,u,o[u]);else c(s,-1,o);return this.marshall().clear(),n&&(r.initonly=!0),a},marshall(e){const t=this._argval||o3,n=this._argops;let i,r,a,s;if(n){const o=n.length;for(r=0;r<o;++r)i=n[r],a=i.op,s=a.modified()&&a.stamp===e,t.set(i.name,i.index,a.value,s);if(n.initonly){for(r=0;r<o;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let h3=0;function sh(e,t,n){this.id=++h3,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Mi(e,t,n){return new sh(e,t,n)}function oh(){return oh=(0,Q.Z)(function*(e,t){const n=this;let r,i=0;try{r=yield n.loader().load(e,{context:"dataflow",response:t3(t&&t.type)});try{r=n.parse(r,t)}catch(a){i=-2,n.warn("Data ingestion failed",e,a)}}catch(a){i=-1,n.warn("Loading failed",e,a)}return{data:r,status:i}}),oh.apply(this,arguments)}function lh(){return lh=(0,Q.Z)(function*(e,t,n){const i=this,r=i._pending||v3(i);r.requests+=1;const a=yield i.request(t,n);return i.pulse(e,i.changeset().remove(hn).insert(a.data||[])),r.done(),a}),lh.apply(this,arguments)}function v3(e){let t;const n=new Promise(i=>t=i);return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}sh.prototype={_filter:hn,_apply:St,targets(){return this._targets||(this._targets=vl(Qo))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Mi(e);return this.targets().add(t),t},apply(e){const t=Mi(null,e);return this.targets().add(t),t},merge(){const e=Mi();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Mi();return this.targets().add(Mi(null,null,Hm(e,n=>{const i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},between(e,t){let n=!1;return e.targets().add(Mi(null,null,()=>n=!0)),t.targets().add(Mi(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=hn,this._targets=null}};const x3={skip:!0};function _3(e,t,n,i,r,a){const s=te({},a,x3);let o,l;ne(n)||(n=ht(n)),void 0===i?o=u=>e.touch(n(u)):ne(i)?(l=new Me(null,i,r,!1),o=u=>{l.evaluate(u);const c=n(u),f=l.value;by(f)?e.pulse(c,f,a):e.update(c,f,s)}):o=u=>e.update(n(u),i,s),t.apply(o)}function w3(e,t,n,i,r,a){if(void 0===i)t.targets().add(n);else{const s=a||{},o=new Me(null,function(e,t){return t=ne(t)?t:ht(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}(n,i),r,!1);o.modified(s.force),o.rank=t.rank,t.targets().add(o),n&&(o.skip(!0),o.value=n.value,o.targets().add(n),e.connect(n,[o]))}}const wl={};function or(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function uh(e,t){const n=[];return tr(e,t,i=>n.push(i)),n}function ky(e,t){const n={};return e.visit(t,i=>{n[Y(i)]=1}),i=>n[Y(i)]?null:i}function Ml(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}function Ay(e,t,n,i){const r=this,a=n.length;let s=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(let o=0;o<a;++o){const l=n[o];if(l.stamp===t){if(l.fields){const u=r.fields||(r.fields={});for(const c in l.fields)u[c]=1}l.changed(r.ADD)&&(s|=r.ADD),l.changed(r.REM)&&(s|=r.REM),l.changed(r.MOD)&&(s|=r.MOD)}}this.changes=s}function ch(){return ch=(0,Q.Z)(function*(e,t,n){const i=this,r=[];if(i._pulse)return Cy(i);if(i._pending&&(yield i._pending),t&&(yield xl(i,t)),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const a=++i._clock;i._pulse=new or(i,a,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=vl(Qo);let o,l,u,s=0;try{for(;i._heap.size()>0;)o=i._heap.pop(),o.rank===o.qrank?(l=o.run(i._getPulse(o,e)),l.then?l=yield l:l.async&&(r.push(l.async),l=wl),l!==wl&&o._targets&&o._targets.forEach(c=>i._enqueue(c)),++s):i._enqueue(o,!0)}catch(c){i._heap.clear(),u=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${a}: ${s} operators`),u&&(i._postrun=[],i.error(u)),i._postrun.length){const c=i._postrun.sort((f,h)=>h.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)yield xl(i,c[f].callback)}return n&&(yield xl(i,n)),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(h){i.error(h)}})})),i}),ch.apply(this,arguments)}function fh(){return fh=(0,Q.Z)(function*(e,t,n){for(;this._running;)yield this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}),fh.apply(this,arguments)}function Cy(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}or.prototype={StopPropagation:wl,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new or(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new or(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(64&t)&&(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,ky(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return $(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?$(e)?e.some(i=>n[i]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=Ml(n.addF,t)),2&e&&(n.remF=Ml(n.remF,t)),4&e&&(n.modF=Ml(n.modF,t)),16&e&&(n.srcF=Ml(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=uh(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=uh(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=uh(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(16&e)return tr(n.source,n.srcF,i),n;1&e&&tr(n.add,n.addF,i),2&e&&tr(n.rem,n.remF,i),4&e&&tr(n.mod,n.modF,i);const r=n.source;if(8&e&&r){const a=n.add.length+n.mod.length;a===r.length||tr(r,a?ky(n,5):n.srcF,i)}return n}},z(Ay,or,{fork(e){const t=new or(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?$(e)?e.some(i=>n[i]):n[e]:0},filter(){I("MultiPulse does not support filtering.")},materialize(){I("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,r=i.length;let a=0;if(e&n.SOURCE)for(;a<r;++a)i[a].visit(e,t);else for(;a<r;++a)i[a].stamp===n.stamp&&i[a].visit(e,t);return n}});const hh={skip:!1,force:!1};function Sy(e,t,n,i){let r,a;const s=e[n];for(;n>t&&(a=n-1>>1,r=e[a],i(s,r)<0);)e[n]=r,n=a;return e[n]=s}function ds(){this.logger(Ck()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=function(e,t){const n=arguments.length;return n&&2!==n&&I("defaultLocale expects either zero or two arguments."),n?Wf(Gf(e),ml(t)):Wf(Gf(),ml())}();try{this._loader=th()}catch(e){}this._touched=vl(Qo),this._input={},this._pulse=null,this._heap=function(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Sy(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,function(e,t,n){const i=t,r=e.length,a=e[t];let o,s=1+(t<<1);for(;s<r;)o=s+1,o<r&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,Sy(e,i,t,n)}(t,0,e)):i=n,i}}}((e,t)=>e.qrank-t.qrank),this._postrun=[]}function gs(e){return function(){return this._log[e].apply(this,arguments)}}function F(e,t){Me.call(this,e,null,t)}ds.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:gs("error"),warn:gs("warn"),info:gs("info"),debug:gs("debug"),logLevel:gs("level"),cleanThreshold:1e4,add:function(e,t,n,i){let a,r=1;return e instanceof Me?a=e:e&&e.prototype instanceof Me?a=new e:ne(e)?a=new Me(null,e):(r=0,a=new Me(e,t)),this.rank(a),r&&(i=n,n=t),n&&this.connect(a,a.parameters(n,i)),this.touch(a),a},connect:function(e,t){const n=e.rank,i=t.length;for(let r=0;r<i;++r)if(n<t[r].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,i,r;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&I("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||hh);const i=new or(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this},touch:function(e,t){const n=t||hh;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const i=n||hh;return(e.set(t)||i.force)&&this.touch(e,i),this},changeset:ia,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return n3(e,t,n.timeParse,n.utcParse)},preload:function(e,t,n){return lh.apply(this,arguments)},request:function(e,t){return oh.apply(this,arguments)},events:function(e,t,n,i){const r=this,a=Mi(n,i),s=function(u){u.dataflow=r;try{a.receive(u)}catch(c){r.error(c)}finally{r.run()}};let o;o="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):K(e);const l=o.length;for(let u=0;u<l;++u)o[u].addEventListener(t,s);return a},on:function(e,t,n,i,r){return(e instanceof Me?w3:_3)(this,e,t,n,i,r),this},evaluate:function(e,t,n){return ch.apply(this,arguments)},run:function(e,t,n){return this._pulse?Cy(this):(this.evaluate(e,t,n),this)},runAsync:function(e,t,n){return fh.apply(this,arguments)},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,i=this._clock;return n&&$(n)?new Ay(this,i,n.map(r=>r.pulse),t):this._input[e.id]||function(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==wl&&(e.source=t.source),e)}(this._pulse,n&&n.pulse)}},z(F,Me,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const ps={};function lr(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function dh(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function Ty(e,t,n=0,i=e.length-1,r=ea){for(;i>n;){if(i-n>600){const l=i-n+1,u=t-n+1,c=Math.log(l),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1);Ty(e,t,Math.max(n,Math.floor(t-u*f/l+h)),Math.min(i,Math.floor(t+(l-u)*f/l+h)),r)}const a=e[t];let s=n,o=i;for(ms(e,n,t),r(e[i],a)>0&&ms(e,n,i);s<o;){for(ms(e,s,o),++s,--o;r(e[s],a)<0;)++s;for(;r(e[o],a)>0;)--o}0===r(e[n],a)?ms(e,n,o):(++o,ms(e,o,i)),o<=t&&(n=o+1),t<=o&&(i=o-1)}return e}function ms(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Fy(e){return null===e?NaN:+e}function gh(e,t,n){if(e=Float64Array.from(function*(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(i=+i)>=i&&(yield i)}}(e,n)),i=e.length){if((t=+t)<=0||i<2)return dh(e);if(t>=1)return lr(e);var i,r=(i-1)*t,a=Math.floor(r),s=lr(Ty(e,a).subarray(0,a+1));return s+(dh(e.subarray(a+1))-s)*(r-a)}}function By(e,t,n=Fy){if(i=e.length){if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,a=Math.floor(r),s=+n(e[a],a,e);return s+(+n(e[a+1],a+1,e)-s)*(r-a)}}function Iy(e,t){return gh(e,.5,t)}function*Ry(e,t){if(null==t)for(let n of e)null!=n&&""!==n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),null!=i&&""!==i&&(i=+i)>=i&&(yield i)}}function Oy(e,t,n){const i=Float64Array.from(Ry(e,n));return i.sort(ea),t.map(r=>By(i,r))}function Ly(e,t){return Oy(e,[.25,.5,.75],t)}function zy(e,t){const n=e.length,i=function(e,t){const n=function(e,t){let i,n=0,r=0,a=0;if(void 0===t)for(let s of e)null!=s&&(s=+s)>=s&&(i=s-r,r+=i/++n,a+=i*(s-r));else{let s=-1;for(let o of e)null!=(o=t(o,++s,e))&&(o=+o)>=o&&(i=o-r,r+=i/++n,a+=i*(o-r))}if(n>1)return a/(n-1)}(e,t);return n&&Math.sqrt(n)}(e,t),r=Ly(e,t);return 1.06*(Math.min(i,(r[2]-r[0])/1.34)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}var gn=Math.random;function Y3(e,t,n,i){i=i||(h=>h);const r=e.length,a=new Float64Array(r);let f,s=0,o=1,l=i(e[0]),u=l,c=l+t;for(;o<r;++o){if(f=i(e[o]),f>=c){for(u=(l+u)/2;s<o;++s)a[s]=u;c=f+t,l=f}u=f}for(u=(l+u)/2;s<o;++s)a[s]=u;return n?function(e,t){const n=e.length;let a,s,i=0,r=1;for(;e[i]===e[r];)++r;for(;r<n;){for(a=r+1;e[r]===e[a];)++a;if(e[r]-e[r-1]<t){for(s=r+(i+a-r-r>>1);s<r;)e[s++]=e[r];for(;s>r;)e[s--]=e[i]}i=r,r=a}return e}(a,t+t/4):a}const Ny=Math.sqrt(2*Math.PI),H3=Math.SQRT2;let ys=NaN;function ph(e,t){e=e||0,t=null==t?1:t;let r,a,n=0,i=0;if(ys==ys)n=ys,ys=NaN;else{do{n=2*gn()-1,i=2*gn()-1,r=n*n+i*i}while(0===r||r>1);a=Math.sqrt(-2*Math.log(r)/r),n*=a,ys=i*a}return e+n*t}function Py(e,t,n){const i=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*i*i)/(n*Ny)}function mh(e,t,n){const i=(e-(t=t||0))/(n=null==n?1:n),r=Math.abs(i);let a;if(r>37)a=0;else{const s=Math.exp(-r*r/2);let o;r<7.07106781186547?(o=.0352624965998911*r+.700383064443688,o=o*r+6.37396220353165,o=o*r+33.912866078383,o=o*r+112.079291497871,o=o*r+221.213596169931,o=o*r+220.206867912376,a=s*o,o=.0883883476483184*r+1.75566716318264,o=o*r+16.064177579207,o=o*r+86.7807322029461,o=o*r+296.564248779674,o=o*r+637.333633378831,o=o*r+793.826512519948,o=o*r+440.413735824752,a/=o):(o=r+.65,o=r+4/o,o=r+3/o,o=r+2/o,o=r+1/o,a=s/o/2.506628274631)}return i>0?1-a:a}function yh(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*H3*function(e){let n,t=-Math.log((1-e)*(1+e));return t<6.25?(t-=3.125,n=-364441206401782e-35,n=n*t-16850591381820166e-35,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=n*t-1333171662854621e-31,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=n*t-4054566272975207e-29,n=n*t-8151934197605472e-29,n=26335093153082323e-28+n*t,n=n*t-12975133253453532e-27,n=n*t-5415412054294628e-26,n=1.0512122733215323e-9+n*t,n=n*t-4.112633980346984e-9,n=n*t-2.9070369957882005e-8,n=4.2347877827932404e-7+n*t,n=n*t-13654692000834679e-22,n=n*t-13882523362786469e-21,n=.00018673420803405714+n*t,n=n*t-.000740702534166267,n=n*t-.006033670871430149,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=2.2137376921775787e-9,n=9.075656193888539e-8+n*t,n=n*t-2.7517406297064545e-7,n=1.8239629214389228e-8+n*t,n=15027403968909828e-22+n*t,n=n*t-4013867526981546e-21,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=n*t-47318229009055734e-21,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=n*t-.0003550375203628475,n=.0009532893797373805+n*t,n=n*t-.0016882755560235047,n=.002491442096107851+n*t,n=n*t-.003751208507569241,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=n*t-2.555641816996525e-10,n=1.5076572693500548e-9+n*t,n=n*t-3.789465440126737e-9,n=7.61570120807834e-9+n*t,n=n*t-1.496002662714924e-8,n=2.914795345090108e-8+n*t,n=n*t-6.771199775845234e-8,n=2.2900482228026655e-7+n*t,n=n*t-9.9298272942317e-7,n=4526062597223154e-21+n*t,n=n*t-1968177810553167e-20,n=7599527703001776e-20+n*t,n=n*t-.00021503011930044477,n=n*t-.00013871931833623122,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}(2*e-1)}function Uy(e,t){let n,i;const r={mean(a){return arguments.length?(n=a||0,r):n},stdev(a){return arguments.length?(i=null==a?1:a,r):i},sample:()=>ph(n,i),pdf:a=>Py(a,n,i),cdf:a=>mh(a,n,i),icdf:a=>yh(a,n,i)};return r.mean(e).stdev(t)}function jy(e,t){const n=Uy();let i=0;const r={data(a){return arguments.length?(e=a,i=a?a.length:0,r.bandwidth(t)):e},bandwidth(a){return arguments.length?(!(t=a)&&e&&(t=zy(e)),r):t},sample:()=>e[~~(gn()*i)]+t*n.sample(),pdf(a){let s=0,o=0;for(;o<i;++o)s+=n.pdf((a-e[o])/t);return s/t/i},cdf(a){let s=0,o=0;for(;o<i;++o)s+=n.cdf((a-e[o])/t);return s/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(e)}function qy(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+ph()*t)}function Vy(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*Ny*e)}function $y(e,t,n){return mh(Math.log(e),t,n)}function Gy(e,t,n){return Math.exp(yh(e,t,n))}function Yy(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*gn()}function Wy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function Hy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Xy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function vs(e,t,n,i){const r=i-e*e,a=Math.abs(r)<1e-24?0:(n-e*t)/r;return[t-a*e,a]}function Dl(e,t,n,i){e=e.filter(d=>{let g=t(d),p=n(d);return null!=g&&(g=+g)>=g&&null!=p&&(p=+p)>=p}),i&&e.sort((d,g)=>t(d)-t(g));const r=e.length,a=new Float64Array(r),s=new Float64Array(r);let c,f,h,o=0,l=0,u=0;for(h of e)a[o]=c=+t(h),s[o]=f=+n(h),++o,l+=(c-l)/o,u+=(f-u)/o;for(o=0;o<r;++o)a[o]-=l,s[o]-=u;return[a,s,l,u]}function xs(e,t,n,i){let a,s,r=-1;for(const o of e)a=t(o),s=n(o),null!=a&&(a=+a)>=a&&null!=s&&(s=+s)>=s&&i(a,s,++r)}function aa(e,t,n,i,r){let a=0,s=0;return xs(e,t,n,(o,l)=>{const u=l-r(o),c=l-i;a+=u*u,s+=c*c}),1-a/s}function Zy(e,t,n){let i=0,r=0,a=0,s=0,o=0;xs(e,t,n,(c,f)=>{++o,i+=(c-i)/o,r+=(f-r)/o,a+=(c*f-a)/o,s+=(c*c-s)/o});const l=vs(i,r,a,s),u=c=>l[0]+l[1]*c;return{coef:l,predict:u,rSquared:aa(e,t,n,r,u)}}function Ky(e,t,n){const[i,r,a,s]=Dl(e,t,n),o=i.length;let d,g,p,m,l=0,u=0,c=0,f=0,h=0;for(d=0;d<o;)g=i[d],p=r[d++],m=g*g,l+=(m-l)/d,u+=(m*g-u)/d,c+=(m*m-c)/d,f+=(g*p-f)/d,h+=(m*p-h)/d;const y=c-l*l,v=l*y-u*u,x=(h*l-f*u)/v,b=(f*y-h*u)/v,w=-x*l,M=_=>x*(_-=a)*_+b*_+w+s;return{coef:[w-b*a+x*a*a+s,b-2*x*a,x],predict:M,rSquared:aa(e,t,n,s,M)}}function i5(e,t,n,i){const r=Array(e);let a,s,o,l;for(a=0;a<e;++a)r[a]=0;for(a=e-1;a>=0;--a)for(o=t[a],l=1,r[a]+=o,s=1;s<=a;++s)l*=(a+1-s)/s,r[a-s]+=o*Math.pow(n,s)*l;return r[0]+=i,r}function s5(e){return(e=1-e*e*e)*e*e}function o5(e,t,n){const i=e[t];let r=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>r&&e[a]-i<=i-e[r];)n[0]=++r,n[1]=a,++a}const u5=.5*Math.PI/180;function vh(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=p=>[p,e(p)],a=t[0],s=t[1],o=s-a,l=o/i,u=[r(a)],c=[];if(n===i){for(let p=1;p<i;++p)u.push(r(a+p/n*o));return u.push(r(s)),u}c.push(r(s));for(let p=n;--p>0;)c.push(r(a+p/n*o));let f=u[0],h=c[c.length-1];const d=1/o,g=function(e,t){let n=e,i=e;const r=t.length;for(let a=0;a<r;++a){const s=t[a][1];s<n&&(n=s),s>i&&(i=s)}return 1/(i-n)}(f[1],c);for(;h;){const p=r((f[0]+h[0])/2);p[0]-f[0]>=l&&f5(f,p,h,d,g)>u5?c.push(p):(f=h,u.push(h),c.pop()),h=c[c.length-1]}return u}function f5(e,t,n,i,r){const a=Math.atan2(r*(n[1]-e[1]),i*(n[0]-e[0])),s=Math.atan2(r*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(a-s)}function qt(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(r);++i<r;)a[i]=e+i*n;return a}function xh(e){return e&&e.length?1===e.length?e[0]:function(e){return t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}}(e):function(){return""}}function ev(e,t,n){return n||e+(t?"_"+t:"")}const bh=()=>{},g5={init:bh,add:bh,rem:bh,idx:0},bs={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},_s=Object.keys(bs);function tv(e,t){return bs[e](t)}function nv(e,t){return e.idx-t.idx}function y5(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function v5(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function x5(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function b5(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function iv(e,t){const n=t||St,i=function(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{!i.req||i.req.forEach(r=>{t[r]||n(t[r]=bs[r]())})};return e.forEach(n),Object.values(t).sort(nv)}(e),r=e.slice().sort(nv);function a(s){this._ops=i,this._out=r,this.cell=s,this.init()}return a.prototype.init=y5,a.prototype.add=v5,a.prototype.rem=x5,a.prototype.set=b5,a.prototype.get=n,a.fields=e.map(s=>s.out),a}function _h(e){this._key=e?Pt(e):Y,this.reset()}_s.forEach(e=>{bs[e]=function(e,t){return n=>te({name:e,out:n||e},g5,t)}(e,bs[e])});const Ze=_h.prototype;function Ei(e){F.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function wh(e){F.call(this,null,e)}function rv(e,t,n){const i=e;let r=t||[],a=n||[],s={},o=0;return{add:l=>a.push(l),remove:l=>s[i(l)]=++o,size:()=>r.length,data:(l,u)=>(o&&(r=r.filter(c=>!s[i(c)]),s={},o=0),u&&l&&r.sort(l),a.length&&(r=l?function(e,t,n,i){const r=t.length,a=n.length;if(!a)return t;if(!r)return n;const s=new t.constructor(r+a);let o=0,l=0,u=0;for(;o<r&&l<a;++u)s[u]=e(t[o],n[l])>0?n[l++]:t[o++];for(;o<r;++o,++u)s[u]=t[o];for(;l<a;++l,++u)s[u]=n[l];return s}(l,r,a.sort(l)):r.concat(a),a=[]),r)}}function Mh(e){F.call(this,[],e)}function av(e){Me.call(this,null,w5,e)}function w5(e){return this.value&&!e.modified()?this.value:Wm(e.fields,e.orders)}function Dh(e){F.call(this,null,e)}function Eh(e){F.call(this,null,e)}Ze.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Ze.add=function(e){this._add.push(e)},Ze.rem=function(e){this._rem.push(e)},Ze.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,a=Array(i-r),s={};let o,l,u;for(o=0;o<r;++o)s[n(t[o])]=1;for(o=0,l=0;o<i;++o)s[n(u=e[o])]?s[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},Ze.distinct=function(e){const t=this.values(),n={};let a,i=t.length,r=0;for(;--i>=0;)a=e(t[i])+"",J(n,a)||(n[a]=1,++r);return r},Ze.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=function(e,t){const n=e.length;let r,a,s,o,l,i=-1;if(null==t){for(;++i<n;)if(a=e[i],null!=a&&a>=a){r=s=a;break}if(i===n)return[-1,-1];for(o=l=i;++i<n;)a=e[i],null!=a&&(r>a&&(r=a,o=i),s<a&&(s=a,l=i))}else{for(;++i<n;)if(a=t(e[i],i,e),null!=a&&a>=a){r=s=a;break}if(i===n)return[-1,-1];for(o=l=i;++i<n;)a=t(e[i],i,e),null!=a&&(r>a&&(r=a,o=i),s<a&&(s=a,l=i))}return[o,l]}(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Ze.argmin=function(e){return this.extent(e)[0]||{}},Ze.argmax=function(e){return this.extent(e)[1]||{}},Ze.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},Ze.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},Ze.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=Ly(this.values(),e),this._get=e),this._q},Ze.q1=function(e){return this.quartile(e)[0]},Ze.q2=function(e){return this.quartile(e)[1]},Ze.q3=function(e){return this.quartile(e)[2]},Ze.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=function(e,t,n,i){if(!e.length)return[void 0,void 0];const r=Float64Array.from(Ry(e,i)),a=r.length;let o,l,u,c;for(u=0,c=Array(1e3);u<1e3;++u){for(o=0,l=0;l<a;++l)o+=r[~~(gn()*a)];c[u]=o/a}return c.sort(ea),[gh(c,.025),gh(c,.975)]}(this.values(),0,0,e),this._get=e),this._ci},Ze.ci0=function(e){return this.ci(e)[0]},Ze.ci1=function(e){return this.ci(e)[1]},Ei.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:_s},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},z(Ei,F,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(n.value=n.value||n.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),i.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map(()=>({})),r=n.length;function a(o){let l,u,c,f;for(l in o)for(c=o[l].tuple,u=0;u<r;++u)i[u][f=c[n[u]]]=f}a(e._prev),a(t),function s(o,l,u){const c=n[u],f=i[u++];for(const h in f){const d=o?o+"|"+h:h;l[c]=f[h],u<r?s(d,l,u):t[d]||e.cell(d,l)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function r(m){const y=K(Re(m)),v=y.length;let b,x=0;for(;x<v;++x)i[b=y[x]]||(i[b]=1,t.push(b))}this._dims=K(e.groupby),this._dnames=this._dims.map(m=>{const y=Ee(m);return r(m),n.push(y),y}),this.cellkey=e.key?e.key:xh(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],s=e.ops||["count"],o=e.as||[],l=a.length,u={};let c,f,h,d,g,p;for(l!==s.length&&I("Unmatched number of fields and aggregate ops."),p=0;p<l;++p)c=a[p],f=s[p],null==c&&"count"!==f&&I("Null aggregate field specified."),d=Ee(c),g=ev(f,d,o[p]),n.push(g),"count"!==f?(h=u[d],h||(r(c),h=u[d]=[],h.field=c,this._measures.push(h)),"count"!==f&&(this._countOnly=!1),h.push(tv(f,g))):this._counts.push(g);return this._measures=this._measures.map(m=>iv(m,m.field)),{}},cellkey:xh(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,r=i.length;n.agg=Array(r);for(let a=0;a<r;++a)n.agg[a]=new i[a](n)}return n.store&&(n.data=new _h),n},newtuple(e,t){const n=this._dnames,i=this._dims,r=i.length,a={};for(let s=0;s<r;++s)a[n[s]]=i[s](e);return t?xy(t.tuple,a):xe(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let r=0,a=i.length;r<a;++r)i[r].add(i[r].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let r=0,a=i.length;r<a;++r)i[r].rem(i[r].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,r=n.length;i<r;++i)t[n[i]]=e.num;if(!this._countOnly){const i=e.agg;for(let r=0,a=i.length;r<a;++r)i[r].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,r=this._drop,a=e.add,s=e.rem,o=e.mod;let l,u,c,f;if(i)for(u in i)l=i[u],(!r||l.num)&&s.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(0===l.num&&r?s:o).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}}),wh.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},z(wh,F,{transform(e,t){const n=!1!==e.interval,i=this._bins(e),r=i.start,a=i.step,s=e.as||["bin0","bin1"],o=s[0],l=s[1];let u;return u=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Re(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?c=>{const f=i(c);c[o]=f,c[l]=null==f?null:r+a*(1+(f-r)/a)}:c=>c[o]=i(c)),t.modifies(n?s:o)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=function(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2];let o,l,u,c,f,h,a=e.extent[0],s=e.extent[1];const d=e.span||s-a||Math.abs(a)||1;if(e.step)o=e.step;else if(e.steps){for(c=d/t,f=0,h=e.steps.length;f<h&&e.steps[f]<c;++f);o=e.steps[Math.max(0,f-1)]}else{for(l=Math.ceil(Math.log(t)/i),u=e.minstep||0,o=Math.max(u,Math.pow(n,Math.round(Math.log(d)/i)-l));Math.ceil(d/o)>t;)o*=n;for(f=0,h=r.length;f<h;++f)c=o/r[f],c>=u&&d/c<=t&&(o=c)}c=Math.log(o);const p=Math.pow(n,-(c>=0?0:1+~~(-c/i))-1);return(e.nice||void 0===e.nice)&&(c=Math.floor(a/o+p)*o,a=a<c?c-o:c,s=Math.ceil(s/o)*o),{start:a,stop:s===a?a+o:s,step:o}}(e),i=n.step;let s,o,r=n.start,a=r+Math.ceil((n.stop-r)/i)*i;null!=(s=e.anchor)&&(o=s-(r+i*Math.floor((s-r)/i)),r+=o,a+=o);const l=function(u){let c=ft(t(u));return null==c?null:c<r?-1/0:c>a?1/0:(c=Math.max(r,Math.min(c,a-i)),r+i*Math.floor(1e-14+(c-r)/i))};return l.start=r,l.stop=n.stop,l.step=i,this.value=nt(l,Re(t),e.name||"bin_"+Ee(t))}}),Mh.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},z(Mh,F,{transform(e,t){const n=t.fork(t.ALL),i=rv(Y,this.value,n.materialize(n.ADD).add),r=e.sort,a=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(a),this.value=n.source=i.data(sr(r),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),z(av,Me),Dh.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},z(Dh,F,{transform(e,t){const n=f=>h=>{for(var g,d=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(o(h),e.case,a)||[],p=0,m=d.length;p<m;++p)s.test(g=d[p])||f(g)},i=this._parameterCheck(e,t),r=this._counts,a=this._match,s=this._stop,o=e.field,l=e.as||["text","count"],u=n(f=>r[f]=1+(r[f]||0)),c=n(f=>r[f]-=1);return i?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],a=t[1],s=e.fork(e.NO_SOURCE|e.NO_FIELDS);let o,l,u;for(o in n)l=i[o],u=n[o]||0,!l&&u?(i[o]=l=xe({}),l[r]=o,l[a]=u,s.add.push(l)):0===u?(l&&s.rem.push(l),n[o]=null,i[o]=null):l[a]!==u&&(l[a]=u,s.mod.push(l));return s.modifies(t)}}),Eh.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},z(Eh,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],r=i[0],a=i[1],s=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let o=this.value;return s?(o&&(n.rem=o),o=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,i){for(var l,u,r=[],a={},s=e.length,o=0;o<s;++o)for(a[t]=u=e[o],l=0;l<s;++l)a[n]=e[l],i(a)&&(r.push(xe(a)),(a={})[t]=u);return r}(o,r,a,e.filter||hn)):n.mod=o,n.source=this.value,n.modifies(i)}});const sv={kde:jy,mixture:function(e,t){let i,n=0;const a={weights(s){return arguments.length?(i=function(s){const o=[];let u,l=0;for(u=0;u<n;++u)l+=o[u]=null==s[u]?1:+s[u];for(u=0;u<n;++u)o[u]/=l;return o}(t=s||[]),a):t},distributions(s){return arguments.length?(s?(n=s.length,e=s):(n=0,e=[]),a.weights(t)):e},sample(){const s=gn();let o=e[n-1],l=i[0],u=0;for(;u<n-1;l+=i[++u])if(s<l){o=e[u];break}return o.sample()},pdf(s){let o=0,l=0;for(;l<n;++l)o+=i[l]*e[l].pdf(s);return o},cdf(s){let o=0,l=0;for(;l<n;++l)o+=i[l]*e[l].cdf(s);return o},icdf(){throw Error("Mixture icdf not supported.")}};return a.distributions(e).weights(t)},normal:Uy,lognormal:function(e,t){let n,i;const r={mean(a){return arguments.length?(n=a||0,r):n},stdev(a){return arguments.length?(i=null==a?1:a,r):i},sample:()=>qy(n,i),pdf:a=>Vy(a,n,i),cdf:a=>$y(a,n,i),icdf:a=>Gy(a,n,i)};return r.mean(e).stdev(t)},uniform:function(e,t){let n,i;const r={min(a){return arguments.length?(n=a||0,r):n},max(a){return arguments.length?(i=null==a?1:a,r):i},sample:()=>Yy(n,i),pdf:a=>Wy(a,n,i),cdf:a=>Hy(a,n,i),icdf:a=>Xy(a,n,i)};return null==t&&(t=null==e?1:e,e=0),r.min(e).max(t)}},ov="function";function lv(e,t){const n=e[ov];J(sv,n)||I("Unknown distribution function: "+n);const i=sv[n]();for(const r in e)"field"===r?i.data((e.from||t()).map(e[r])):"distributions"===r?i[r](e[r].map(a=>lv(a,t))):typeof i[r]===ov&&i[r](e[r]);return i}function kh(e){F.call(this,null,e)}const uv=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];function cv(e,t){return e?e.map((n,i)=>t[i]||Ee(n)):null}function Ah(e,t,n){const i=[],r=f=>f(l);let a,s,o,l,u,c;if(null==t)i.push(e.map(n));else for(a={},s=0,o=e.length;s<o;++s)l=e[s],u=t.map(r),c=a[u],c||(a[u]=c=[],c.dims=u,i.push(c)),c.push(n(l));return i}function Ch(e){F.call(this,null,e)}function hv(e){Me.call(this,null,T5,e),this.modified(!0)}function T5(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:nt(n=>t(n,e),Re(t),Ee(t))}function Sh(e){F.call(this,[void 0,void 0],e)}function Th(e,t){Me.call(this,e),this.parent=t,this.count=0}function El(e){F.call(this,{},e),this._keys=Ya();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}function dv(e){Me.call(this,null,F5,e)}function F5(e){return this.value&&!e.modified()?this.value:$(e.name)?K(e.name).map(t=>Pt(t)):Pt(e.name,e.as)}function Fh(e){F.call(this,Ya(),e)}function Bh(e){F.call(this,[],e)}function Ih(e){F.call(this,[],e)}function Rh(e){F.call(this,null,e)}function gv(e){F.call(this,[],e)}kh.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:uv.concat({key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:uv},{name:"weights",type:"number",array:!0}]})},{name:"as",type:"string",array:!0,default:["value","density"]}]},z(kh,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=lv(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),r=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let s=e.method||"pdf";"pdf"!==s&&"cdf"!==s&&I("Invalid density method: "+s),!e.extent&&!i.data&&I("Missing density extent parameter."),s=i[s];const o=e.as||["value","density"],u=vh(s,e.extent||Zn(i.data()),r,a).map(c=>{const f={};return f[o[0]]=c[0],f[o[1]]=c[1],xe(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),Ch.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},z(Ch,F,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,i=Ah(t.source,e.groupby,St),r=e.smooth||!1,a=e.field,s=e.step||((e,t)=>al(Zn(e,t))/30)(n,a),o=sr((g,p)=>a(g)-a(p)),l=e.as||"bin",u=i.length;let d,c=1/0,f=-1/0,h=0;for(;h<u;++h){const g=i[h].sort(o);d=-1;for(const p of Y3(g,s,r,a))p<c&&(c=p),p>f&&(f=p),g[++d][l]=p}return this.value={start:c,stop:f,step:s},t.reflow(!0).modifies(l)}}),z(hv,Me),Sh.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},z(Sh,F,{transform(e,t){const n=this.value,i=e.field,r=t.changed()||t.modified(i.fields)||e.modified("field");let a=n[0],s=n[1];if((r||null==a)&&(a=1/0,s=-1/0),t.visit(r?t.SOURCE:t.ADD,o=>{const l=ft(i(o));null!=l&&(l<a&&(a=l),l>s&&(s=l))}),!Number.isFinite(a)||!Number.isFinite(s)){let o=Ee(i);o&&(o=` for field "${o}"`),t.dataflow.warn(`Infinite extent${o}: [${a}, ${s}]`),a=s=void 0}this.value=[a,s]}}),z(Th,Me,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),z(El,F,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const r=this.value;let s,o,a=J(r,e)&&r[e];return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(o=i||(o=this._group[e])&&o.tuple,s=n.dataflow,a=new Th(n.fork(n.NO_SOURCE),this),s.add(a).connect(t(s,e,o)),r[e]=a,this.activate(a)),a},clean(){const e=this.value;let t=0;for(const n in e)if(0===e[n].count){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let r=0;for(;r<i;++r)t[r]=e[r];for(;r<n&&null!=t[r];++r)t[r]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,r=e.subflow,a=this._keys,s=e.modified("key"),o=l=>this.subflow(l,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,l=>{const u=Y(l),c=a.get(u);void 0!==c&&(a.delete(u),o(c).rem(l))}),t.visit(t.ADD,l=>{const u=i(l);a.set(Y(l),u),o(u).add(l)}),s||t.modified(i.fields)?t.visit(t.MOD,l=>{const u=Y(l),c=a.get(u),f=i(l);c===f?o(f).mod(l):(a.set(u,f),o(c).rem(l),o(f).add(l))}):t.changed(t.MOD)&&t.visit(t.MOD,l=>{o(a.get(Y(l))).mod(l)}),s&&t.visit(t.REFLOW,l=>{const u=Y(l),c=a.get(u),f=i(l);c!==f&&(a.set(u,f),o(c).rem(l),o(f).add(l))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),z(dv,Me),Fh.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},z(Fh,F,{transform(e,t){const n=t.dataflow,i=this.value,r=t.fork(),a=r.add,s=r.rem,o=r.mod,l=e.expr;let u=!0;function c(f){const h=Y(f),d=l(f,e),g=i.get(h);d&&g?(i.delete(h),a.push(f)):d||g?u&&d&&!g&&o.push(f):(i.set(h,1),s.push(f))}return t.visit(t.REM,f=>{const h=Y(f);i.has(h)?i.delete(h):s.push(f)}),t.visit(t.ADD,f=>{l(f,e)?a.push(f):i.set(Y(f),1)}),t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}}),Bh.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},z(Bh,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=cv(i,e.as||[]),a=e.index||null,s=r.length;return n.rem=this.value,t.visit(t.SOURCE,o=>{const l=i.map(g=>g(o)),u=l.reduce((g,p)=>Math.max(g,p.length),0);let f,h,d,c=0;for(;c<u;++c){for(h=rh(o),f=0;f<s;++f)h[r[f]]=null==(d=l[f][c])?null:d;a&&(h[a]=c),n.add.push(h)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(r)}}),Ih.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},z(Ih,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(Ee),a=e.as||["key","value"],s=a[0],o=a[1],l=i.length;return n.rem=this.value,t.visit(t.SOURCE,u=>{for(let f,c=0;c<l;++c)f=rh(u),f[s]=r[c],f[o]=i[c](u),n.add.push(f)}),this.value=n.source=n.add,n.modifies(a)}}),Rh.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},z(Rh,F,{transform(e,t){const n=e.expr,i=e.as,r=e.modified(),a=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(a,s=>s[i]=n(s,e))}}),z(gv,F,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let s,o,l,r=this.value,a=e.size-r.length;if(a>0){for(s=[];--a>=0;)s.push(l=xe(i(e))),r.push(l);n.add=n.add.length?n.materialize(n.ADD).add.concat(s):s}else o=r.slice(0,-a),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(o):o,r=r.slice(-a);return n.source=this.value=r,n}});const kl={value:"value",median:Iy,mean:function(e,t){let n=0,i=0;if(void 0===t)for(let r of e)null!=r&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(a=+a)>=a&&(++n,i+=a)}if(n)return i/n},min:dh,max:lr},B5=[];function Oh(e){F.call(this,[],e)}function Lh(e){Ei.call(this,e)}function zh(e){F.call(this,null,e)}function pv(e){Me.call(this,null,L5,e)}function L5(e){return this.value&&!e.modified()?this.value:Xm(e.fields,e.flat)}function mv(e){F.call(this,[],e),this._pending=null}function Nh(e,t,n){n.forEach(xe);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Ph(e){F.call(this,{},e)}function yv(e){Me.call(this,null,N5,e)}function N5(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let a,s,i=1/0,r=-1/0;for(a=0;a<n;++a)s=t[a],s[0]<i&&(i=s[0]),s[1]>r&&(r=s[1]);return[i,r]}function vv(e){Me.call(this,null,P5,e)}function P5(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function xv(e){F.call(this,null,e)}function Uh(e){Ei.call(this,e)}function bv(e){El.call(this,e)}function jh(e){F.call(this,null,e)}function _v(e){F.call(this,null,e)}function qh(e){F.call(this,null,e)}function wv(e){F.call(this,null,e)}function Vh(e){F.call(this,[],e),this.count=0}function $h(e){F.call(this,null,e)}function Mv(e){F.call(this,null,e),this.modified(!0)}function Gh(e){F.call(this,null,e)}Oh.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},z(Oh,F,{transform(e,t){var h,d,g,p,m,y,v,x,b,w,n=t.fork(t.ALL),i=function(e){var n,t=e.method||kl.value;if(null!=kl[t])return t===kl.value?(n=void 0!==e.value?e.value:0,()=>n):kl[t];I("Unrecognized imputation method: "+t)}(e),r=function(e){const t=e.field;return n=>n?t(n):NaN}(e),a=Ee(e.field),s=Ee(e.key),o=(e.groupby||[]).map(Ee),l=function(e,t,n,i){var u,c,f,h,d,g,p,m,r=y=>y(m),a=[],s=i?i.slice():[],o={},l={};for(s.forEach((y,v)=>o[y]=v+1),h=0,p=e.length;h<p;++h)g=n(m=e[h]),d=o[g]||(o[g]=s.push(g)),(f=l[c=(u=t?t.map(r):B5)+""])||(f=l[c]=[],a.push(f),f.values=u),f[d-1]=m;return a.domain=s,a}(t.source,e.groupby,e.key,e.keyvals),u=[],c=this.value,f=l.domain.length;for(m=0,x=l.length;m<x;++m)for(g=(h=l[m]).values,d=NaN,v=0;v<f;++v)if(null==h[v]){for(p=l.domain[v],w={_impute:!0},y=0,b=g.length;y<b;++y)w[o[y]]=g[y];w[s]=p,w[a]=Number.isNaN(d)?d=i(h,r):d,u.push(xe(w))}return u.length&&(n.add=n.materialize(n.ADD).add.concat(u)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=u,n}}),Lh.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:_s},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},z(Lh,Ei,{transform(e,t){const n=this,i=e.modified();let r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(r=n.value=n.value||this.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),n.changes(),t.visit(t.SOURCE,a=>{te(a,r[n.cellkey(a)].tuple)}),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),zh.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},z(zh,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=Ah(i,e.groupby,e.field),a=(e.groupby||[]).map(Ee),s=e.bandwidth,o=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;"pdf"!==o&&"cdf"!==o&&I("Invalid density method: "+o),"shared"===e.resolve&&(c||(c=Zn(i,e.field)),f=h=e.steps||h),r.forEach(d=>{const g=jy(d,s)[o],p=e.counts?d.length:1;vh(g,c||Zn(d),f,h).forEach(y=>{const v={};for(let x=0;x<a.length;++x)v[a[x]]=d.dims[x];v[l[0]]=y[0],v[l[1]]=y[1]*p,u.push(xe(v))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),z(pv,Me),z(mv,F,{transform(e,t){const n=t.dataflow;return this._pending?Nh(this,t,this._pending):function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e)?t.StopPropagation:e.values?Nh(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=K(r.data),a=>a.touch(this)))}:n.request(e.url,e.format).then(i=>Nh(this,t,K(i.data)))}}),Ph.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},z(Ph,F,{transform(e,t){const n=e.fields,i=e.index,r=e.values,a=null==e.default?null:e.default,s=e.modified(),o=n.length;let f,h,d,l=s?t.SOURCE:t.ADD,u=t,c=e.as;return r?(h=r.length,o>1&&!c&&I('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==o*h&&I('The "as" parameter has too few output field names.'),c=c||r.map(Ee),f=function(g){for(var y,v,p=0,m=0;p<o;++p)if(null==(v=i.get(n[p](g))))for(y=0;y<h;++y,++m)g[c[m]]=a;else for(y=0;y<h;++y,++m)g[c[m]]=r[y](v)}):(c||I("Missing output field names."),f=function(g){for(var m,p=0;p<o;++p)m=i.get(n[p](g)),g[c[p]]=null==m?a:m}),s?u=t.reflow(!0):(d=n.some(g=>t.modified(g.fields)),l|=d?t.MOD:0),t.visit(l,f),u.modifies(c)}}),z(yv,Me),z(vv,Me),z(xv,F,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Uh.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:_s,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},z(Uh,Ei,{_transform:Ei.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,i=e.value,r=("count"===e.op?"__count__":e.op)||"sum",a=Re(n).concat(Re(i)),s=function(e,t,n){const i={},r=[];return n.visit(n.SOURCE,a=>{const s=e(a);i[s]||(i[s]=1,r.push(s))}),r.sort(hf),t?r.slice(0,t):r}(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:s.map(()=>r),fields:s.map(o=>function(e,t,n,i){return nt(r=>t(r)===e?n(r):NaN,i,e+"")}(o,n,i,a)),as:s.map(o=>o+""),modified:e.modified.bind(e)}}(e,t),t)}}),z(bv,El,{transform(e,t){const n=e.subflow,i=e.field,r=a=>this.subflow(Y(a),n,t,a);return(e.modified("field")||i&&t.modified(Re(i)))&&I("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,a=>{const s=r(a);i(a).forEach(o=>s.mod(o))}),t.visit(t.ADD,a=>{const s=r(a);i(a).forEach(o=>s.add(xe(o)))}),t.visit(t.REM,a=>{const s=r(a);i(a).forEach(o=>s.rem(o))})):(t.visit(t.MOD,a=>r(a).mod(a)),t.visit(t.ADD,a=>r(a).add(a)),t.visit(t.REM,a=>r(a).rem(a))),t.clean()&&t.runAfter(()=>this.clean()),t}}),jh.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},z(jh,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=cv(e.fields,e.as||[]),a=i?(o,l)=>function(e,t,n,i){for(let r=0,a=n.length;r<a;++r)t[i[r]]=n[r](e);return t}(o,l,i,r):bl;let s;return this.value?s=this.value:(t=t.addAll(),s=this.value={}),t.visit(t.REM,o=>{const l=Y(o);n.rem.push(s[l]),s[l]=null}),t.visit(t.ADD,o=>{const l=a(o,xe({}));s[Y(o)]=l,n.add.push(l)}),t.visit(t.MOD,o=>{n.mod.push(a(o,s[Y(o)]))}),n}}),z(_v,F,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),qh.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},z(qh,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const a=Ah(t.materialize(t.SOURCE).source,e.groupby,e.field),s=(e.groupby||[]).map(Ee),o=[],l=e.step||.01,u=e.probs||qt(l/2,1-1e-14,l),c=u.length;return a.forEach(f=>{const h=Oy(f,u);for(let d=0;d<c;++d){const g={};for(let p=0;p<s.length;++p)g[s[p]]=f.dims[p];g[i[0]]=u[d],g[i[1]]=h[d],o.push(xe(g))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),z(wv,F,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{const a=Y(r);n.rem.push(i[a]),i[a]=null}),t.visit(t.ADD,r=>{const a=rh(r);i[Y(r)]=a,n.add.push(a)}),t.visit(t.MOD,r=>{const a=i[Y(r)];for(const s in r)a[s]=r[s],n.modifies(s);n.mod.push(a)})),n}}),Vh.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},z(Vh,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,a=this.value.reduce((c,f)=>(c[Y(f)]=1,c),{});let s=this.value,o=this.count,l=0;function u(c){let f,h;s.length<r?s.push(c):(h=~~((o+1)*gn()),h<s.length&&h>=l&&(f=s[h],a[Y(f)]&&n.rem.push(f),s[h]=c)),++o}if(t.rem.length&&(t.visit(t.REM,c=>{const f=Y(c);a[f]&&(a[f]=-1,n.rem.push(c)),--o}),s=s.filter(c=>-1!==a[Y(c)])),(t.rem.length||i)&&s.length<r&&t.source&&(l=o=s.length,t.visit(t.SOURCE,c=>{a[Y(c)]||u(c)}),l=-1),i&&s.length>r){const c=s.length-r;for(let f=0;f<c;++f)a[Y(s[f])]=-1,n.rem.push(s[f]);s=s.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{a[Y(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=s.filter(c=>!a[Y(c)])),this.count=o,this.value=n.source=s,n}}),$h.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},z($h,F,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=qt(e.start,e.stop,e.step||1).map(r=>{const a={};return a[i]=r,xe(a)}),n.add=t.add.concat(this.value),n}}),z(Mv,F,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Dv=["unit0","unit1"];function Ev(e){F.call(this,Ya(),e)}function kv(e){F.call(this,null,e)}Gh.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:S1,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Dv}]},z(Gh,F,{transform(e,t){const n=e.field,i=!1!==e.interval,r="utc"===e.timezone,a=this._floor(e,t),s=(r?es:Qa)(a.unit).offset,o=e.as||Dv,l=o[0],u=o[1],c=a.step;let f=a.start||1/0,h=a.stop||-1/0,d=t.ADD;return(e.modified()||t.modified(Re(n)))&&(d=(t=t.reflow(!0)).SOURCE,f=1/0,h=-1/0),t.visit(d,g=>{const p=n(g);let m,y;null==p?(g[l]=null,i&&(g[u]=null)):(g[l]=m=y=a(p),i&&(g[u]=y=s(m,c)),m<f&&(f=m),y>h&&(h=y))}),a.start=f,a.stop=h,t.modifies(i?o:l)},_floor(e,t){const n="utc"===e.timezone,{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:function(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(al(t))/n;let a,s,r=Ja(o=>o[2]).right(os,i);return r===os.length?(a=P1,s=yi(t[0]/Pf,t[1]/Pf,n)):r?(r=os[i/os[r-1][2]<os[r][2]/i?r-1:r],a=r[0],s=r[1]):(a=z1,s=Math.max(yi(t[0],t[1],n),1)),{units:a,step:s}}({extent:e.extent||Zn(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=T1(i),s=this.value||{},o=(n?_C:vC)(a,r);return o.unit=ce(a),o.units=a,o.step=r,o.start=s.start,o.stop=s.stop,this.value=o}}),z(Ev,F,{transform(e,t){const n=t.dataflow,i=e.field,r=this.value,a=o=>r.set(i(o),o);let s=!0;return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,o=>r.delete(i(o))),t.visit(t.ADD,a)):s=!1,this.modified(s),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()}}),z(kv,F,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(sr(e.sort)):t.source).map(e.field))}});const ws={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=ws.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let r=t.index;if(e<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;e=r}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||I("ntile num must be greater than zero.");const n=ws.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||I("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return null!=i?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const r=i.data;return i.index<=n?t:(n=function(e,t,n){for(let i=t.length;n<i;++n)if(null!=e(t[n]))return n;return-1}(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}},W5=Object.keys(ws);function Av(e){const t=K(e.ops),n=K(e.fields),i=K(e.params),r=K(e.as),a=this.outputs=[],s=this.windows=[],o={},l={},u=[],c=[];let f=!0;function h(d){K(Re(d)).forEach(g=>o[g]=1)}h(e.sort),t.forEach((d,g)=>{const p=n[g],m=Ee(p),y=ev(d,m,r[g]);if(h(p),a.push(y),J(ws,d))s.push(function(e,t,n,i){const r=ws[e](t,n);return{init:r.init||Ji,update:function(a,s){s[i]=r.next(a)}}}(d,n[g],i[g],y));else{if(null==p&&"count"!==d&&I("Null aggregate field specified."),"count"===d)return void u.push(y);f=!1;let v=l[m];v||(v=l[m]=[],v.field=p,c.push(v)),v.push(tv(d,y))}}),(u.length||c.length)&&(this.cell=function(e,t,n){e=e.map(l=>iv(l,l.field));const i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,a=i.agg=Array(r),s=0;s<r;++s)a[s]=new e[s](i);if(i.store)var o=i.data=new _h;return i.add=function(l){if(i.num+=1,!n){o&&o.add(l);for(let u=0;u<r;++u)a[u].add(a[u].get(l),l)}},i.rem=function(l){if(i.num-=1,!n){o&&o.rem(l);for(let u=0;u<r;++u)a[u].rem(a[u].get(l),l)}},i.set=function(l){let u,c;for(o&&o.values(),u=0,c=t.length;u<c;++u)l[t[u]]=i.num;if(!n)for(u=0,c=a.length;u<c;++u)a[u].set(l)},i.init=function(){i.num=0,o&&o.reset();for(let l=0;l<r;++l)a[l].init()},i}(c,u,f)),this.inputs=Object.keys(o)}const Cv=Av.prototype;function Yh(e){F.call(this,{},e),this._mlen=0,this._mods=[]}function X5(e,t,n,i){const r=i.sort,a=r&&!i.ignorePeers,s=i.frame||[null,0],o=e.data(n),l=o.length,u=a?Ja(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:r||ht(-1)};t.init();for(let f=0;f<l;++f)Z5(c,s,f,l),a&&K5(c,u),t.update(c,o[f])}function Z5(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function K5(e,t){const n=e.i0,i=e.i1-1,r=e.compare,a=e.data,s=a.length-1;n>0&&!r(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),i<s&&!r(a[i],a[i+1])&&(e.i1=t.right(a,a[i]))}function Al(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Cl(e){this._context=e}function ki(){}function Sv(e){this._context=e}function Tv(e){this._context=e}function Fv(e,t){this._basis=new Cl(e),this._beta=t}Cv.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},Cv.update=function(e,t){const n=this.cell,i=this.windows,r=e.data,a=i&&i.length;let s;if(n){for(s=e.p0;s<e.i0;++s)n.rem(r[s]);for(s=e.p1;s<e.i1;++s)n.add(r[s]);n.set(t)}for(s=0;s<a;++s)i[s].update(e,t)},Yh.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:W5.concat(_s)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},z(Yh,F,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=sr(e.sort),r=xh(e.groupby),a=o=>this.group(r(o));let s=this.state;(!s||n)&&(s=this.state=new Av(e)),n||t.modified(s.inputs)?(this.value={},t.visit(t.SOURCE,o=>a(o).add(o))):(t.visit(t.REM,o=>a(o).remove(o)),t.visit(t.ADD,o=>a(o).add(o)));for(let o=0,l=this._mlen;o<l;++o)X5(this._mods[o],s,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(s.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=rv(Y),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),Cl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Al(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Al(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Sv.prototype={areaStart:ki,areaEnd:ki,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Al(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Tv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:Al(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Fv.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var l,i=e[0],r=t[0],a=e[n]-i,s=t[n]-r,o=-1;++o<=n;)this._basis.point(this._beta*e[o]+(1-this._beta)*(i+(l=o/n)*a),this._beta*t[o]+(1-this._beta)*(r+l*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const tT=function e(t){function n(i){return 1===t?new Cl(i):new Fv(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function Sl(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Wh(e,t){this._context=e,this._k=(1-t)/6}Wh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Sl(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Sl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const nT=function e(t){function n(i){return new Wh(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Hh(e,t){this._context=e,this._k=(1-t)/6}Hh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Sl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const iT=function e(t){function n(i){return new Hh(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Xh(e,t){this._context=e,this._k=(1-t)/6}Xh.prototype={areaStart:ki,areaEnd:ki,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Sl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const rT=function e(t){function n(i){return new Xh(i,t)}return n.tension=function(i){return e(+i)},n}(0);var Bv=Math.abs,rt=Math.atan2,ur=Math.cos,aT=Math.max,Zh=Math.min,Bn=Math.sin,sa=Math.sqrt,at=1e-12,Ai=Math.PI,Tl=Ai/2,Ms=2*Ai;function sT(e){return e>1?0:e<-1?Ai:Math.acos(e)}function Iv(e){return e>=1?Tl:e<=-1?-Tl:Math.asin(e)}function Kh(e,t,n){var i=e._x1,r=e._y1,a=e._x2,s=e._y2;if(e._l01_a>at){var o=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*o-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*o-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>at){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,s=(s*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,a,s,e._x2,e._y2)}function Rv(e,t){this._context=e,this._alpha=t}Rv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Kh(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const oT=function e(t){function n(i){return t?new Rv(i,t):new Wh(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function Ov(e,t){this._context=e,this._alpha=t}Ov.prototype={areaStart:ki,areaEnd:ki,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Kh(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const lT=function e(t){function n(i){return t?new Ov(i,t):new Xh(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function Lv(e,t){this._context=e,this._alpha=t}Lv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Kh(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const uT=function e(t){function n(i){return t?new Lv(i,t):new Hh(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function zv(e){this._context=e}function Jh(e){return new zv(e)}function Nv(e){this._context=e}function Pv(e){return e<0?-1:1}function Uv(e,t,n){var i=e._x1-e._x0,r=t-e._x1,a=(e._y1-e._y0)/(i||r<0&&-0),s=(n-e._y1)/(r||i<0&&-0),o=(a*r+s*i)/(i+r);return(Pv(a)+Pv(s))*Math.min(Math.abs(a),Math.abs(s),.5*Math.abs(o))||0}function jv(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Qh(e,t,n){var i=e._x0,a=e._x1,s=e._y1,o=(a-i)/3;e._context.bezierCurveTo(i+o,e._y0+o*t,a-o,s-o*n,a,s)}function Fl(e){this._context=e}function qv(e){this._context=new Vv(e)}function Vv(e){this._context=e}function $v(e){this._context=e}function Gv(e){var t,i,n=e.length-1,r=new Array(n),a=new Array(n),s=new Array(n);for(r[0]=0,a[0]=2,s[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,a[t]=4,s[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,a[n-1]=7,s[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)a[t]-=i=r[t]/a[t-1],s[t]-=i*s[t-1];for(r[n-1]=s[n-1]/a[n-1],t=n-2;t>=0;--t)r[t]=(s[t]-r[t+1])/a[t];for(a[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-r[t+1];return[r,a]}function Bl(e,t){this._context=e,this._t=t}zv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},Nv.prototype={areaStart:ki,areaEnd:ki,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},Fl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Qh(this,this._t0,jv(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Qh(this,jv(this,n=Uv(this,e,t)),n);break;default:Qh(this,this._t0,n=Uv(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(qv.prototype=Object.create(Fl.prototype)).point=function(e,t){Fl.prototype.point.call(this,t,e)},Vv.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,a){this._context.bezierCurveTo(t,e,i,n,a,r)}},$v.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var i=Gv(e),r=Gv(t),a=0,s=1;s<n;++a,++s)this._context.bezierCurveTo(i[0][a],r[0][a],i[1][a],r[1][a],e[s],t[s]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},Bl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const ed=Math.PI,td=2*ed,cr=1e-6,yT=td-cr;function nd(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Yv(){return new nd}nd.prototype=Yv.prototype={constructor:nd,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(e,t,n,i,r){var a=this._x1,s=this._y1,o=(n=+n)-(e=+e),l=(i=+i)-(t=+t),u=a-e,c=s-t,f=u*u+c*c;if((r=+r)<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>cr)if(Math.abs(c*o-l*u)>cr&&r){var h=n-a,d=i-s,g=o*o+l*l,p=h*h+d*d,m=Math.sqrt(g),y=Math.sqrt(f),v=r*Math.tan((ed-Math.acos((g+f-p)/(2*m*y)))/2),x=v/y,b=v/m;Math.abs(x-1)>cr&&(this._+="L"+(e+x*u)+","+(t+x*c)),this._+="A"+r+","+r+",0,0,"+ +(c*h>u*d)+","+(this._x1=e+b*o)+","+(this._y1=t+b*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,i,r,a){e=+e,t=+t,a=!!a;var s=(n=+n)*Math.cos(i),o=n*Math.sin(i),l=e+s,u=t+o,c=1^a,f=a?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>cr||Math.abs(this._y1-u)>cr)&&(this._+="L"+l+","+u),n&&(f<0&&(f=f%td+td),f>yT?this._+="A"+n+","+n+",0,1,"+c+","+(e-s)+","+(t-o)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>cr&&(this._+="A"+n+","+n+",0,"+ +(f>=ed)+","+c+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};const oa=Yv;function be(e){return function(){return e}}function vT(e){return e.innerRadius}function xT(e){return e.outerRadius}function bT(e){return e.startAngle}function _T(e){return e.endAngle}function wT(e){return e&&e.padAngle}function MT(e,t,n,i,r,a,s,o){var l=n-e,u=i-t,c=s-r,f=o-a,h=f*l-c*u;if(!(h*h<at))return[e+(h=(c*(t-a)-f*(e-r))/h)*l,t+h*u]}function Il(e,t,n,i,r,a,s){var o=e-n,l=t-i,u=(s?a:-a)/sa(o*o+l*l),c=u*l,f=-u*o,h=e+c,d=t+f,g=n+c,p=i+f,m=(h+g)/2,y=(d+p)/2,v=g-h,x=p-d,b=v*v+x*x,w=r-a,M=h*p-g*d,_=(x<0?-1:1)*sa(aT(0,w*w*b-M*M)),E=(M*x-v*_)/b,A=(-M*v-x*_)/b,D=(M*x+v*_)/b,k=(-M*v+x*_)/b,T=E-m,S=A-y,L=D-m,C=k-y;return T*T+S*S>L*L+C*C&&(E=D,A=k),{cx:E,cy:A,x01:-c,y01:-f,x11:E*(r/w-1),y11:A*(r/w-1)}}function Wv(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Hv(e){return e[0]}function Xv(e){return e[1]}function Zv(e,t){var n=be(!0),i=null,r=Jh,a=null;function s(o){var l,c,h,u=(o=Wv(o)).length,f=!1;for(null==i&&(a=r(h=oa())),l=0;l<=u;++l)!(l<u&&n(c=o[l],l,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(c,l,o),+t(c,l,o));if(h)return a=null,h+""||null}return e="function"==typeof e?e:void 0===e?Hv:be(e),t="function"==typeof t?t:void 0===t?Xv:be(t),s.x=function(o){return arguments.length?(e="function"==typeof o?o:be(+o),s):e},s.y=function(o){return arguments.length?(t="function"==typeof o?o:be(+o),s):t},s.defined=function(o){return arguments.length?(n="function"==typeof o?o:be(!!o),s):n},s.curve=function(o){return arguments.length?(r=o,null!=i&&(a=r(i)),s):r},s.context=function(o){return arguments.length?(null==o?i=a=null:a=r(i=o),s):i},s}function Kv(e,t,n){var i=null,r=be(!0),a=null,s=Jh,o=null;function l(c){var f,h,d,p,y,g=(c=Wv(c)).length,m=!1,v=new Array(g),x=new Array(g);for(null==a&&(o=s(y=oa())),f=0;f<=g;++f){if(!(f<g&&r(p=c[f],f,c))===m)if(m=!m)h=f,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),d=f-1;d>=h;--d)o.point(v[d],x[d]);o.lineEnd(),o.areaEnd()}m&&(v[f]=+e(p,f,c),x[f]=+t(p,f,c),o.point(i?+i(p,f,c):v[f],n?+n(p,f,c):x[f]))}if(y)return o=null,y+""||null}function u(){return Zv().defined(r).curve(s).context(a)}return e="function"==typeof e?e:void 0===e?Hv:be(+e),t="function"==typeof t?t:be(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?Xv:be(+n),l.x=function(c){return arguments.length?(e="function"==typeof c?c:be(+c),i=null,l):e},l.x0=function(c){return arguments.length?(e="function"==typeof c?c:be(+c),l):e},l.x1=function(c){return arguments.length?(i=null==c?null:"function"==typeof c?c:be(+c),l):i},l.y=function(c){return arguments.length?(t="function"==typeof c?c:be(+c),n=null,l):t},l.y0=function(c){return arguments.length?(t="function"==typeof c?c:be(+c),l):t},l.y1=function(c){return arguments.length?(n=null==c?null:"function"==typeof c?c:be(+c),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(i).y(t)},l.defined=function(c){return arguments.length?(r="function"==typeof c?c:be(!!c),l):r},l.curve=function(c){return arguments.length?(s=c,null!=a&&(o=s(a)),l):s},l.context=function(c){return arguments.length?(null==c?a=o=null:o=s(a=c),l):a},l}const Jv={draw:function(e,t){var n=Math.sqrt(t/Ai);e.moveTo(n,0),e.arc(0,0,n,0,Ms)}};Math.sqrt(1/3);Math.sin(Ai/10),Math.sin(7*Ai/10);function la(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Math.sin(Ms/10),Math.cos(Ms/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const tx=Ja(ea),Rl=tx.right,zT=tx.left,Ds=(Ja(Fy),Rl);function In(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Ci(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const ad=Symbol("implicit");function sd(){var e=new Map,t=[],n=[],i=ad;function r(a){var s=a+"",o=e.get(s);if(!o){if(i!==ad)return i;e.set(s,o=t.push(a))}return n[(o-1)%n.length]}return r.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new Map;for(const s of a){const o=s+"";e.has(o)||e.set(o,t.push(s))}return r},r.range=function(a){return arguments.length?(n=Array.from(a),r):n.slice()},r.unknown=function(a){return arguments.length?(i=a,r):i},r.copy=function(){return sd(t,n).unknown(i)},In.apply(r,arguments),r}function nx(e,t,n,i){var a,r=yi(e,t,n);switch((i=Hr(null==i?",f":i)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null==i.precision&&!isNaN(a=u1(r,s))&&(i.precision=a),_f(i,s);case"":case"e":case"g":case"p":case"r":null==i.precision&&!isNaN(a=c1(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=a-("e"===i.type));break;case"f":case"%":null==i.precision&&!isNaN(a=f1(r))&&(i.precision=a-2*("%"===i.type))}return ul(i)}function ua(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Es(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Si(){}var ca=1/.7,fa="\\s*([+-]?\\d+)\\s*",ks="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Rn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",NT=/^#([0-9a-f]{3,8})$/,PT=new RegExp("^rgb\\("+[fa,fa,fa]+"\\)$"),UT=new RegExp("^rgb\\("+[Rn,Rn,Rn]+"\\)$"),jT=new RegExp("^rgba\\("+[fa,fa,fa,ks]+"\\)$"),qT=new RegExp("^rgba\\("+[Rn,Rn,Rn,ks]+"\\)$"),VT=new RegExp("^hsl\\("+[ks,Rn,Rn]+"\\)$"),$T=new RegExp("^hsla\\("+[ks,Rn,Rn,ks]+"\\)$"),ix={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function rx(){return this.rgb().formatHex()}function ax(){return this.rgb().formatRgb()}function As(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=NT.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?sx(t):3===n?new Ke(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ol(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ol(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=PT.exec(e))?new Ke(t[1],t[2],t[3],1):(t=UT.exec(e))?new Ke(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=jT.exec(e))?Ol(t[1],t[2],t[3],t[4]):(t=qT.exec(e))?Ol(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=VT.exec(e))?ux(t[1],t[2]/100,t[3]/100,1):(t=$T.exec(e))?ux(t[1],t[2]/100,t[3]/100,t[4]):ix.hasOwnProperty(e)?sx(ix[e]):"transparent"===e?new Ke(NaN,NaN,NaN,0):null}function sx(e){return new Ke(e>>16&255,e>>8&255,255&e,1)}function Ol(e,t,n,i){return i<=0&&(e=t=n=NaN),new Ke(e,t,n,i)}function od(e){return e instanceof Si||(e=As(e)),e?new Ke((e=e.rgb()).r,e.g,e.b,e.opacity):new Ke}function Ti(e,t,n,i){return 1===arguments.length?od(e):new Ke(e,t,n,null==i?1:i)}function Ke(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function ox(){return"#"+ld(this.r)+ld(this.g)+ld(this.b)}function lx(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function ld(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function ux(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new On(e,t,n,i)}function cx(e){if(e instanceof On)return new On(e.h,e.s,e.l,e.opacity);if(e instanceof Si||(e=As(e)),!e)return new On;if(e instanceof On)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),a=Math.max(t,n,i),s=NaN,o=a-r,l=(a+r)/2;return o?(s=t===a?(n-i)/o+6*(n<i):n===a?(i-t)/o+2:(t-n)/o+4,o/=l<.5?a+r:2-a-r,s*=60):o=l>0&&l<1?0:s,new On(s,o,l,e.opacity)}function Ll(e,t,n,i){return 1===arguments.length?cx(e):new On(e,t,n,null==i?1:i)}function On(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function ud(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function fx(e,t,n,i,r){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*n+(1+3*e+3*a-3*s)*i+s*r)/6}function hx(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],a=e[i+1];return fx((n-i/t)*t,i>0?e[i-1]:2*r-a,r,a,i<t-1?e[i+2]:2*a-r)}}function dx(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t);return fx((n-i/t)*t,e[(i+t-1)%t],e[i%t],e[(i+1)%t],e[(i+2)%t])}}ua(Si,As,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:rx,formatHex:rx,formatHsl:function(){return cx(this).formatHsl()},formatRgb:ax,toString:ax}),ua(Ke,Ti,Es(Si,{brighter:function(e){return e=null==e?ca:Math.pow(ca,e),new Ke(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Ke(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ox,formatHex:ox,formatRgb:lx,toString:lx})),ua(On,Ll,Es(Si,{brighter:function(e){return e=null==e?ca:Math.pow(ca,e),new On(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new On(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Ke(ud(e>=240?e-240:e+120,r,i),ud(e,r,i),ud(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const zl=e=>()=>e;function gx(e,t){return function(n){return e+n*t}}function Nl(e,t){var n=t-e;return n?gx(e,n>180||n<-180?n-360*Math.round(n/360):n):zl(isNaN(e)?t:e)}function Ve(e,t){var n=t-e;return n?gx(e,n):zl(isNaN(e)?t:e)}const cd=function e(t){var n=function(e){return 1==(e=+e)?Ve:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):zl(isNaN(t)?n:t)}}(t);function i(r,a){var s=n((r=Ti(r)).r,(a=Ti(a)).r),o=n(r.g,a.g),l=n(r.b,a.b),u=Ve(r.opacity,a.opacity);return function(c){return r.r=s(c),r.g=o(c),r.b=l(c),r.opacity=u(c),r+""}}return i.gamma=e,i}(1);function px(e){return function(t){var s,o,n=t.length,i=new Array(n),r=new Array(n),a=new Array(n);for(s=0;s<n;++s)o=Ti(t[s]),i[s]=o.r||0,r[s]=o.g||0,a[s]=o.b||0;return i=e(i),r=e(r),a=e(a),o.opacity=1,function(l){return o.r=i(l),o.g=r(l),o.b=a(l),o+""}}}var HT=px(hx),XT=px(dx);function fd(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function mx(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ZT(e,t){return(mx(t)?fd:yx)(e,t)}function yx(e,t){var s,n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),a=new Array(n);for(s=0;s<i;++s)r[s]=Fi(e[s],t[s]);for(;s<n;++s)a[s]=t[s];return function(o){for(s=0;s<i;++s)a[s]=r[s](o);return a}}function vx(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function pn(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function xx(e,t){var r,n={},i={};for(r in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)r in e?n[r]=Fi(e[r],t[r]):i[r]=t[r];return function(a){for(r in n)i[r]=n[r](a);return i}}var hd=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dd=new RegExp(hd.source,"g");function bx(e,t){var i,r,a,n=hd.lastIndex=dd.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(i=hd.exec(e))&&(r=dd.exec(t));)(a=r.index)>n&&(a=t.slice(n,a),o[s]?o[s]+=a:o[++s]=a),(i=i[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:pn(i,r)})),n=dd.lastIndex;return n<t.length&&(a=t.slice(n),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(u){for(var f,c=0;c<t;++c)o[(f=l[c]).i]=f.x(u);return o.join("")})}function Fi(e,t){var i,n=typeof t;return null==t||"boolean"===n?zl(t):("number"===n?pn:"string"===n?(i=As(t))?(t=i,cd):bx:t instanceof As?cd:t instanceof Date?vx:mx(t)?fd:Array.isArray(t)?yx:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?xx:pn)(e,t)}function Cs(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function gd(e){return+e}var _x=[0,1];function Ft(e){return e}function pd(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function t6(e,t,n){var i=e[0],r=e[1],a=t[0],s=t[1];return r<i?(i=pd(r,i),a=n(s,a)):(i=pd(i,r),a=n(a,s)),function(o){return a(i(o))}}function n6(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),a=new Array(i),s=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=pd(e[s],e[s+1]),a[s]=n(t[s],t[s+1]);return function(o){var l=Ds(e,o,1,i)-1;return a[l](r[l](o))}}function Ss(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Pl(){var i,r,a,o,l,u,e=_x,t=_x,n=Fi,s=Ft;function c(){var h=Math.min(e.length,t.length);return s!==Ft&&(s=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}(e[0],e[h-1])),o=h>2?n6:t6,l=u=null,f}function f(h){return null==h||isNaN(h=+h)?a:(l||(l=o(e.map(i),t,n)))(i(s(h)))}return f.invert=function(h){return s(r((u||(u=o(t,e.map(i),pn)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,gd),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=Cs,c()},f.clamp=function(h){return arguments.length?(s=!!h||Ft,c()):s!==Ft},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(a=h,f):a},function(h,d){return i=h,r=d,c()}}function wx(){return Pl()(Ft,Ft)}function hr(e){var t=e.domain;return e.ticks=function(n){var i=t();return xf(i[0],i[i.length-1],null==n?10:n)},e.tickFormat=function(n,i){var r=t();return nx(r[0],r[r.length-1],null==n?10:n,i)},e.nice=function(n){null==n&&(n=10);var l,u,i=t(),r=0,a=i.length-1,s=i[r],o=i[a],c=10;for(o<s&&(u=s,s=o,o=u,u=r,r=a,a=u);c-- >0;){if((u=l1(s,o,n))===l)return i[r]=s,i[a]=o,t(i);if(u>0)s=Math.floor(s/u)*u,o=Math.ceil(o/u)*u;else{if(!(u<0))break;s=Math.ceil(s*u)/u,o=Math.floor(o*u)/u}l=u}return e},e}function Ex(e,t){var s,n=0,i=(e=e.slice()).length-1,r=e[n],a=e[i];return a<r&&(s=n,n=i,i=s,s=r,r=a,a=s),e[n]=t.floor(r),e[i]=t.ceil(a),e}function kx(e){return Math.log(e)}function Ax(e){return Math.exp(e)}function i6(e){return-Math.log(-e)}function r6(e){return-Math.exp(-e)}function a6(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Cx(e){return function(t){return-e(-t)}}function md(e){var r,a,t=e(kx,Ax),n=t.domain,i=10;function s(){return r=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(i),a=function(e){return 10===e?a6:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(i),n()[0]<0?(r=Cx(r),a=Cx(a),e(i6,r6)):e(kx,Ax),t}return t.base=function(o){return arguments.length?(i=+o,s()):i},t.domain=function(o){return arguments.length?(n(o),s()):n()},t.ticks=function(o){var f,l=n(),u=l[0],c=l[l.length-1];(f=c<u)&&(h=u,u=c,c=h);var g,p,m,h=r(u),d=r(c),y=null==o?10:+o,v=[];if(!(i%1)&&d-h<y){if(h=Math.floor(h),d=Math.ceil(d),u>0){for(;h<=d;++h)for(p=1,g=a(h);p<i;++p)if(!((m=g*p)<u)){if(m>c)break;v.push(m)}}else for(;h<=d;++h)for(p=i-1,g=a(h);p>=1;--p)if(!((m=g*p)<u)){if(m>c)break;v.push(m)}2*v.length<y&&(v=xf(u,c,y))}else v=xf(h,d,Math.min(d-h,y)).map(a);return f?v.reverse():v},t.tickFormat=function(o,l){if(null==l&&(l=10===i?".0e":","),"function"!=typeof l&&(l=ul(l)),o===1/0)return l;null==o&&(o=10);var u=Math.max(1,i*o/t.ticks().length);return function(c){var f=c/a(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=u?l(c):""}},t.nice=function(){return n(Ex(n(),{floor:function(o){return a(Math.floor(r(o)))},ceil:function(o){return a(Math.ceil(r(o)))}}))},t}function Tx(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function l6(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function u6(e){return e<0?-e*e:e*e}function yd(e){var t=e(Ft,Ft),n=1;function i(){return 1===n?e(Ft,Ft):.5===n?e(l6,u6):e(Tx(n),Tx(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},hr(t)}function vd(){var e=yd(Pl());return e.copy=function(){return Ss(e,vd()).exponent(e.exponent())},In.apply(e,arguments),e}function Fx(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Bx(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function xd(e){var t=1,n=e(Fx(t),Bx(t));return n.constant=function(i){return arguments.length?e(Fx(t=+i),Bx(t)):t},hr(n)}function Rx(e,t,n,i,r,a){const s=[[_i,1,Kn],[_i,5,5e3],[_i,15,15e3],[_i,30,3e4],[a,1,Zt],[a,5,5*Zt],[a,15,15*Zt],[a,30,30*Zt],[r,1,Jn],[r,3,3*Jn],[r,6,6*Jn],[r,12,12*Jn],[i,1,nr],[i,2,2*nr],[n,1,Df],[t,1,x1],[t,3,3*x1],[e,1,Ef]];function l(u,c,f){const h=Math.abs(c-u)/f,d=Ja(([,,m])=>m).right(s,h);if(d===s.length)return e.every(yi(u/Ef,c/Ef,f));if(0===d)return Sf.every(Math.max(yi(u,c,f),1));const[g,p]=s[h/s[d-1][2]<s[d][2]/h?d-1:d];return g.every(p)}return[function(u,c,f){const h=c<u;h&&([u,c]=[c,u]);const d=f&&"function"==typeof f.range?f:l(u,c,f),g=d?d.range(u,+c+1):[];return h?g.reverse():g},l]}const[f6,h6]=Rx(wi,gl,Jr,xi,Ff,Bf),[d6,g6]=Rx(bi,hl,Zr,vi,Af,Cf);function p6(e){return new Date(e)}function m6(e){return e instanceof Date?+e:+new Date(+e)}function bd(e,t,n,i,r,a,s,o,l,u){var c=wx(),f=c.invert,h=c.domain,d=u(".%L"),g=u(":%S"),p=u("%I:%M"),m=u("%I %p"),y=u("%a %d"),v=u("%b %d"),x=u("%B"),b=u("%Y");function w(M){return(l(M)<M?d:o(M)<M?g:s(M)<M?p:a(M)<M?m:i(M)<M?r(M)<M?y:v:n(M)<M?x:b)(M)}return c.invert=function(M){return new Date(f(M))},c.domain=function(M){return arguments.length?h(Array.from(M,m6)):h().map(p6)},c.ticks=function(M){var _=h();return e(_[0],_[_.length-1],null==M?10:M)},c.tickFormat=function(M,_){return null==_?w:u(_)},c.nice=function(M){var _=h();return(!M||"function"!=typeof M.range)&&(M=t(_[0],_[_.length-1],null==M?10:M)),M?h(Ex(_,M)):c},c.copy=function(){return Ss(c,bd(e,t,n,i,r,a,s,o,l,u))},c}function Ul(){var n,i,r,a,l,e=0,t=1,s=Ft,o=!1;function u(f){return null==f||isNaN(f=+f)?l:s(0===r?.5:(f=(a(f)-n)*r,o?Math.max(0,Math.min(1,f)):f))}function c(f){return function(h){var d,g;return arguments.length?([d,g]=h,s=f(d,g),u):[s(0),s(1)]}}return u.domain=function(f){return arguments.length?([e,t]=f,n=a(e=+e),i=a(t=+t),r=n===i?0:1/(i-n),u):[e,t]},u.clamp=function(f){return arguments.length?(o=!!f,u):o},u.interpolator=function(f){return arguments.length?(s=f,u):s},u.range=c(Fi),u.rangeRound=c(Cs),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return a=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),u}}function Bi(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function _d(){var e=hr(Ul()(Ft));return e.copy=function(){return Bi(e,_d())},Ci.apply(e,arguments)}function wd(){var e=yd(Ul());return e.copy=function(){return Bi(e,wd()).exponent(e.exponent())},Ci.apply(e,arguments)}function Md(e,t){void 0===t&&(t=e,e=Fi);for(var n=0,i=t.length-1,r=t[0],a=new Array(i<0?0:i);n<i;)a[n]=e(r,r=t[++n]);return function(s){var o=Math.max(0,Math.min(i-1,Math.floor(s*=i)));return a[o](s-o)}}function jl(){var r,a,s,o,l,c,h,e=0,t=.5,n=1,i=1,u=Ft,f=!1;function d(p){return isNaN(p=+p)?h:(p=.5+((p=+c(p))-a)*(i*p<i*a?o:l),u(f?Math.max(0,Math.min(1,p)):p))}function g(p){return function(m){var y,v,x;return arguments.length?([y,v,x]=m,u=Md(p,[y,v,x]),d):[u(0),u(.5),u(1)]}}return d.domain=function(p){return arguments.length?([e,t,n]=p,r=c(e=+e),a=c(t=+t),s=c(n=+n),o=r===a?0:.5/(a-r),l=a===s?0:.5/(s-a),i=a<r?-1:1,d):[e,t,n]},d.clamp=function(p){return arguments.length?(f=!!p,d):f},d.interpolator=function(p){return arguments.length?(u=p,d):u},d.range=g(Fi),d.rangeRound=g(Cs),d.unknown=function(p){return arguments.length?(h=p,d):h},function(p){return c=p,r=p(e),a=p(t),s=p(n),o=r===a?0:.5/(a-r),l=a===s?0:.5/(s-a),i=a<r?-1:1,d}}function Dd(){var e=yd(jl());return e.copy=function(){return Bi(e,Dd()).exponent(e.exponent())},Ci.apply(e,arguments)}function _6(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function w6(e,t){var n=Nl(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}var ql,Vx=180/Math.PI,Ed={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function $x(e,t,n,i,r,a){var s,o,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,l/=o),e*i<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*Vx,skewX:Math.atan(l)*Vx,scaleX:s,scaleY:o}}function Gx(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}return function(u,c){var f=[],h=[];return u=e(u),c=e(c),function(u,c,f,h,d,g){if(u!==f||c!==h){var p=d.push("translate(",null,t,null,n);g.push({i:p-4,x:pn(u,f)},{i:p-2,x:pn(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}(u.translateX,u.translateY,c.translateX,c.translateY,f,h),function(u,c,f,h){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),h.push({i:f.push(r(f)+"rotate(",null,i)-2,x:pn(u,c)})):c&&f.push(r(f)+"rotate("+c+i)}(u.rotate,c.rotate,f,h),function(u,c,f,h){u!==c?h.push({i:f.push(r(f)+"skewX(",null,i)-2,x:pn(u,c)}):c&&f.push(r(f)+"skewX("+c+i)}(u.skewX,c.skewX,f,h),function(u,c,f,h,d,g){if(u!==f||c!==h){var p=d.push(r(d)+"scale(",null,",",null,")");g.push({i:p-4,x:pn(u,f)},{i:p-2,x:pn(c,h)})}else(1!==f||1!==h)&&d.push(r(d)+"scale("+f+","+h+")")}(u.scaleX,u.scaleY,c.scaleX,c.scaleY,f,h),u=c=null,function(d){for(var m,g=-1,p=h.length;++g<p;)f[(m=h[g]).i]=m.x(d);return f.join("")}}}var E6=Gx(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Ed:$x(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),k6=Gx(function(e){return null!=e&&(ql||(ql=document.createElementNS("http://www.w3.org/2000/svg","g")),ql.setAttribute("transform",e),e=ql.transform.baseVal.consolidate())?$x((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Ed},", ",")",")");function Yx(e){return((e=Math.exp(e))+1/e)/2}const T6=function e(t,n,i){function r(a,s){var m,y,o=a[0],l=a[1],u=a[2],h=s[2],d=s[0]-o,g=s[1]-l,p=d*d+g*g;if(p<1e-12)y=Math.log(h/u)/t,m=function(_){return[o+_*d,l+_*g,u*Math.exp(t*_*y)]};else{var v=Math.sqrt(p),x=(h*h-u*u+i*p)/(2*u*n*v),b=(h*h-u*u-i*p)/(2*h*n*v),w=Math.log(Math.sqrt(x*x+1)-x),M=Math.log(Math.sqrt(b*b+1)-b);y=(M-w)/t,m=function(_){var E=_*y,A=Yx(w),D=u/(n*v)*(A*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*E+w)-function(e){return((e=Math.exp(e))-1/e)/2}(w));return[o+D*d,l+D*g,u*A/Yx(t*E+w)]}}return m.duration=1e3*y*t/Math.SQRT2,m}return r.rho=function(a){var s=Math.max(.001,+a),o=s*s;return e(s,o,o*o)},r}(Math.SQRT2,2,4);function Wx(e){return function(t,n){var i=e((t=Ll(t)).h,(n=Ll(n)).h),r=Ve(t.s,n.s),a=Ve(t.l,n.l),s=Ve(t.opacity,n.opacity);return function(o){return t.h=i(o),t.s=r(o),t.l=a(o),t.opacity=s(o),t+""}}}const F6=Wx(Nl);var B6=Wx(Ve);const Hx=Math.PI/180,Xx=180/Math.PI,Qx=4/29,ha=6/29,e2=3*ha*ha;function t2(e){if(e instanceof mn)return new mn(e.l,e.a,e.b,e.opacity);if(e instanceof Ln)return i2(e);e instanceof Ke||(e=od(e));var a,s,t=Sd(e.r),n=Sd(e.g),i=Sd(e.b),r=kd((.2225045*t+.7168786*n+.0606169*i)/1);return t===n&&n===i?a=s=r:(a=kd((.4360747*t+.3850649*n+.1430804*i)/.96422),s=kd((.0139322*t+.0971045*n+.7141733*i)/.82521)),new mn(116*r-16,500*(a-r),200*(r-s),e.opacity)}function $l(e,t,n,i){return 1===arguments.length?t2(e):new mn(e,t,n,null==i?1:i)}function mn(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}function kd(e){return e>.008856451679035631?Math.pow(e,1/3):e/e2+Qx}function Ad(e){return e>ha?e*e*e:e2*(e-Qx)}function Cd(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Sd(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function n2(e){if(e instanceof Ln)return new Ln(e.h,e.c,e.l,e.opacity);if(e instanceof mn||(e=t2(e)),0===e.a&&0===e.b)return new Ln(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Xx;return new Ln(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Gl(e,t,n,i){return 1===arguments.length?n2(e):new Ln(e,t,n,null==i?1:i)}function Ln(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function i2(e){if(isNaN(e.h))return new mn(e.l,0,0,e.opacity);var t=e.h*Hx;return new mn(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function R6(e,t){var n=Ve((e=$l(e)).l,(t=$l(t)).l),i=Ve(e.a,t.a),r=Ve(e.b,t.b),a=Ve(e.opacity,t.opacity);return function(s){return e.l=n(s),e.a=i(s),e.b=r(s),e.opacity=a(s),e+""}}function r2(e){return function(t,n){var i=e((t=Gl(t)).h,(n=Gl(n)).h),r=Ve(t.c,n.c),a=Ve(t.l,n.l),s=Ve(t.opacity,n.opacity);return function(o){return t.h=i(o),t.c=r(o),t.l=a(o),t.opacity=s(o),t+""}}}ua(mn,$l,Es(Si,{brighter:function(e){return new mn(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new mn(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Ke(Cd(3.1338561*(t=.96422*Ad(t))-1.6168667*(e=1*Ad(e))-.4906146*(n=.82521*Ad(n))),Cd(-.9787684*t+1.9161415*e+.033454*n),Cd(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),ua(Ln,Gl,Es(Si,{brighter:function(e){return new Ln(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new Ln(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return i2(this).rgb()}}));const O6=r2(Nl);var L6=r2(Ve),Td=1.78277,Fd=-.29227,Yl=-.90649,Ts=1.97294,s2=Ts*Yl,o2=Ts*Td,l2=Td*Fd- -.14861*Yl;function z6(e){if(e instanceof dr)return new dr(e.h,e.s,e.l,e.opacity);e instanceof Ke||(e=od(e));var n=e.g/255,i=e.b/255,r=(l2*i+s2*(e.r/255)-o2*n)/(l2+s2-o2),a=i-r,s=(Ts*(n-r)-Fd*a)/Yl,o=Math.sqrt(s*s+a*a)/(Ts*r*(1-r)),l=o?Math.atan2(s,a)*Xx-120:NaN;return new dr(l<0?l+360:l,o,r,e.opacity)}function Bd(e,t,n,i){return 1===arguments.length?z6(e):new dr(e,t,n,null==i?1:i)}function dr(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function u2(e){return function t(n){function i(r,a){var s=e((r=Bd(r)).h,(a=Bd(a)).h),o=Ve(r.s,a.s),l=Ve(r.l,a.l),u=Ve(r.opacity,a.opacity);return function(c){return r.h=s(c),r.s=o(c),r.l=l(Math.pow(c,n)),r.opacity=u(c),r+""}}return n=+n,i.gamma=t,i}(1)}ua(dr,Bd,Es(Si,{brighter:function(e){return e=null==e?ca:Math.pow(ca,e),new dr(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new dr(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Hx,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new Ke(255*(t+n*(-.14861*i+Td*r)),255*(t+n*(Fd*i+Yl*r)),255*(t+n*(Ts*i)),this.opacity)}}));const N6=u2(Nl);var P6=u2(Ve);function U6(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}function Id(e,t,n){const i=e-t+2*n;return e?i>0?i:1:0}const da="linear",ti="log",Fs="pow",Bs="sqrt",Wl="symlog",gr="time",pr="utc",zn="sequential",ga="diverging",pa="quantile",Hl="quantize",Xl="threshold",Rd="ordinal",Od="point",Ld="bin-ordinal",Le="continuous",Is="discrete",Rs="discretizing",tn="interpolating",zd="temporal";function Nd(){const e=sd().unknown(void 0),t=e.domain,n=e.range;let r,a,i=[0,1],s=!1,o=0,l=0,u=.5;function c(){const f=t().length,h=i[1]<i[0],d=i[1-h],g=Id(f,o,l);let p=i[h-0];r=(d-p)/(g||1),s&&(r=Math.floor(r)),p+=(d-p-r*(f-o))*u,a=r*(1-o),s&&(p=Math.round(p),a=Math.round(a));const m=qt(f).map(y=>p+r*y);return n(h?m.reverse():m)}return delete e.unknown,e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],s=!0,c()},e.bandwidth=function(){return a},e.step=function(){return r},e.round=function(f){return arguments.length?(s=!!f,c()):s},e.padding=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),o=l,c()):o},e.paddingInner=function(f){return arguments.length?(o=Math.max(0,Math.min(1,f)),c()):o},e.paddingOuter=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.invertRange=function(f){if(null==f[0]||null==f[1])return;const h=i[1]<i[0],d=h?n().reverse():n(),g=d.length-1;let y,v,x,p=+f[0],m=+f[1];return p!=p||m!=m||(m<p&&(x=p,p=m,m=x),m<d[0]||p>i[1-h])?void 0:(y=Math.max(0,Rl(d,p)-1),v=p===m?y:Rl(d,m)-1,p-d[y]>a+1e-10&&++y,h&&(x=y,y=g-v,v=g-x),y>v?void 0:t().slice(y,v+1))},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return Nd().domain(t()).range(i).round(s).paddingInner(o).paddingOuter(l).align(u)},c()}function f2(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return f2(t())},e}var G6=Array.prototype.map;function Y6(e){return G6.call(e,ft)}const W6=Array.prototype.slice,Zl={};function H6(e,t,n){const i=function(){const a=t();return a.invertRange||(a.invertRange=a.invert?function(e){return function(t){let r,n=t[0],i=t[1];return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}(a):a.invertExtent?function(e){return function(t){const n=e.range();let s,o,l,u,i=t[0],r=t[1],a=-1;for(r<i&&(o=i,i=r,r=o),l=0,u=n.length;l<u;++l)n[l]>=i&&n[l]<=r&&(a<0&&(a=l),s=l);if(!(a<0))return i=e.invertExtent(n[a]),r=e.invertExtent(n[s]),[void 0===i[0]?i[1]:i[0],void 0===r[1]?r[0]:r[1]]}}(a):void 0),a.type=e,a};return i.metadata=Sn(K(n)),i}function ve(e,t,n){return arguments.length>1?(Zl[e]=H6(e,t,n),this):d2(e)?Zl[e]:void 0}function d2(e){return J(Zl,e)}function mr(e,t){const n=Zl[e];return n&&n.metadata[t]}function Pd(e){return mr(e,Le)}function ma(e){return mr(e,Is)}function Ud(e){return mr(e,Rs)}function g2(e){return mr(e,ti)}function p2(e){return mr(e,tn)}function m2(e){return mr(e,pa)}ve("identity",function Dx(e){var t;function n(i){return null==i||isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,gd),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return Dx(e).unknown(t)},e=arguments.length?Array.from(e,gd):[0,1],hr(n)}),ve(da,function Mx(){var e=wx();return e.copy=function(){return Ss(e,Mx())},In.apply(e,arguments),hr(e)},Le),ve(ti,function Sx(){var e=md(Pl()).domain([1,10]);return e.copy=function(){return Ss(e,Sx()).base(e.base())},In.apply(e,arguments),e},[Le,ti]),ve(Fs,vd,Le),ve(Bs,function(){return vd.apply(null,arguments).exponent(.5)},Le),ve(Wl,function Ix(){var e=xd(Pl());return e.copy=function(){return Ss(e,Ix()).constant(e.constant())},In.apply(e,arguments)},Le),ve(gr,function(){return In.apply(bd(d6,g6,bi,hl,Zr,vi,Af,Cf,_i,qf).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[Le,zd]),ve(pr,function(){return In.apply(bd(f6,h6,wi,gl,Jr,xi,Ff,Bf,_i,Vf).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},[Le,zd]),ve(zn,_d,[Le,tn]),ve("".concat(zn,"-").concat(da),_d,[Le,tn]),ve("".concat(zn,"-").concat(ti),function Ox(){var e=md(Ul()).domain([1,10]);return e.copy=function(){return Bi(e,Ox()).base(e.base())},Ci.apply(e,arguments)},[Le,tn,ti]),ve("".concat(zn,"-").concat(Fs),wd,[Le,tn]),ve("".concat(zn,"-").concat(Bs),function(){return wd.apply(null,arguments).exponent(.5)},[Le,tn]),ve("".concat(zn,"-").concat(Wl),function Lx(){var e=xd(Ul());return e.copy=function(){return Bi(e,Lx()).constant(e.constant())},Ci.apply(e,arguments)},[Le,tn]),ve("".concat(ga,"-").concat(da),function zx(){var e=hr(jl()(Ft));return e.copy=function(){return Bi(e,zx())},Ci.apply(e,arguments)},[Le,tn]),ve("".concat(ga,"-").concat(ti),function Nx(){var e=md(jl()).domain([.1,1,10]);return e.copy=function(){return Bi(e,Nx()).base(e.base())},Ci.apply(e,arguments)},[Le,tn,ti]),ve("".concat(ga,"-").concat(Fs),Dd,[Le,tn]),ve("".concat(ga,"-").concat(Bs),function(){return Dd.apply(null,arguments).exponent(.5)},[Le,tn]),ve("".concat(ga,"-").concat(Wl),function Px(){var e=xd(jl());return e.copy=function(){return Bi(e,Px()).constant(e.constant())},Ci.apply(e,arguments)},[Le,tn]),ve(pa,function Ux(){var i,e=[],t=[],n=[];function r(){var s=0,o=Math.max(1,t.length);for(n=new Array(o-1);++s<o;)n[s-1]=By(e,s/o);return a}function a(s){return null==s||isNaN(s=+s)?i:t[Ds(n,s)]}return a.invertExtent=function(s){var o=t.indexOf(s);return o<0?[NaN,NaN]:[o>0?n[o-1]:e[0],o<n.length?n[o]:e[e.length-1]]},a.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let o of s)null!=o&&!isNaN(o=+o)&&e.push(o);return e.sort(ea),r()},a.range=function(s){return arguments.length?(t=Array.from(s),r()):t.slice()},a.unknown=function(s){return arguments.length?(i=s,a):i},a.quantiles=function(){return n.slice()},a.copy=function(){return Ux().domain(e).range(t).unknown(i)},In.apply(a,arguments)},[Rs,pa]),ve(Hl,function jx(){var a,e=0,t=1,n=1,i=[.5],r=[0,1];function s(l){return null!=l&&l<=l?r[Ds(i,l,0,n)]:a}function o(){var l=-1;for(i=new Array(n);++l<n;)i[l]=((l+1)*t-(l-n)*e)/(n+1);return s}return s.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,o()):[e,t]},s.range=function(l){return arguments.length?(n=(r=Array.from(l)).length-1,o()):r.slice()},s.invertExtent=function(l){var u=r.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,i[0]]:u>=n?[i[n-1],t]:[i[u-1],i[u]]},s.unknown=function(l){return arguments.length&&(a=l),s},s.thresholds=function(){return i.slice()},s.copy=function(){return jx().domain([e,t]).range(r).unknown(a)},In.apply(hr(s),arguments)},Rs),ve(Xl,function qx(){var n,e=[.5],t=[0,1],i=1;function r(a){return null!=a&&a<=a?t[Ds(e,a,0,i)]:n}return r.domain=function(a){return arguments.length?(e=Array.from(a),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(a){return arguments.length?(t=Array.from(a),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(a){var s=t.indexOf(a);return[e[s-1],e[s]]},r.unknown=function(a){return arguments.length?(n=a,r):n},r.copy=function(){return qx().domain(e).range(t).unknown(n)},In.apply(r,arguments)},Rs),ve(Ld,function h2(){let e=[],t=[];function n(i){return null==i||i!=i?void 0:t[(Ds(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=Y6(i),n):e.slice()},n.range=function(i){return arguments.length?(t=W6.call(i),n):t.slice()},n.tickFormat=function(i,r){return nx(e[0],ce(e),null==i?10:i,r)},n.copy=function(){return h2().domain(n.domain()).range(n.range())},n},[Is,Rs]),ve(Rd,sd,Is),ve("band",Nd,Is),ve(Od,function(){return f2(Nd().paddingInner(1))},Is);const Z6=["clamp","base","constant","exponent"];function jd(e,t,n){return Md(v2(t||"rgb",n),e)}function y2(e,t,n){const i=n-t;let r,a,s;return i&&Number.isFinite(i)?(r=(a=e.type).indexOf("-"),a=r<0?a:a.slice(r+1),s=ve(a)().domain([t,n]).range([0,1]),Z6.forEach(o=>e[o]?s[o](e[o]()):0),s):ht(.5)}function v2(e,t){const n=Ki[function(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function x2(e){const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(6*i,6*++i);return n}function b2(e,t){for(const n in e)w2(n,t(e[n]))}const _2={};function w2(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(_2[e]=t,this):_2[e]}b2({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},x2),b2({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>jd(x2(e)));const Kl="symbol",r4=e=>$(e)?e.map(t=>String(t)):String(e),a4=(e,t)=>e[1]-t[1],s4=(e,t)=>t[1]-e[1];function qd(e,t,n){let i;return Ha(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(al(e.domain())/n||1)))),ee(t)&&(i=t.step,t=t.interval),ke(t)&&(t=e.type===gr?Qa(t):e.type==pr?es(t):I("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function M2(e,t,n){let i=e.range(),r=i[0],a=ce(i),s=a4;if(r>a&&(i=a,a=r,r=i,s=s4),r=Math.floor(r),a=Math.ceil(a),t=t.map(o=>[o,e(o)]).filter(o=>r<=o[1]&&o[1]<=a).sort(s).map(o=>o[0]),n>0&&t.length>1){const o=[t[0],ce(t)];for(;t.length>n&&t.length>=3;)t=t.filter((l,u)=>!(u%2));t.length<3&&(t=o)}return t}function Vd(e,t){return e.bins?M2(e,e.bins):e.ticks?e.ticks(t):e.domain()}function D2(e,t,n,i,r,a){const s=t.type;let o=r4;if(s===gr||r===gr)o=e.timeFormat(i);else if(s===pr||r===pr)o=e.utcFormat(i);else if(g2(s)){const l=e.formatFloat(i);if(a||t.bins)o=l;else{const u=E2(t,n,!1);o=c=>u(c)?l(c):""}}else if(t.tickFormat){const l=t.domain();o=e.formatSpan(l[0],l[l.length-1],n,i)}else i&&(o=e.format(i));return o}function E2(e,t,n){const i=Vd(e,t),r=e.base(),a=Math.log(r),s=Math.max(1,r*t/i.length),o=l=>{let u=l/Math.pow(r,Math.round(Math.log(l)/a));return u*r<r-.5&&(u*=r),u<=s};return n?i.filter(o):o}const $d={[pa]:"quantiles",[Hl]:"thresholds",[Xl]:"domain"},k2={[pa]:"quantiles",[Hl]:"domain"};function A2(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=ce(e),t}(e.bins):e.type===ti?E2(e,t,!0):$d[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[$d[e.type]]()):Vd(e,t)}function C2(e,t,n,i,r,a,s){const o=k2[t.type]&&a!==gr&&a!==pr?function(e,t,n){const i=t[k2[t.type]](),r=i.length;let s,a=r>1?i[1]-i[0]:i[0];for(s=1;s<r;++s)a=Math.min(a,i[s]-i[s-1]);return e.formatSpan(0,a,30,n)}(e,t,r):D2(e,t,n,r,a,s);return i===Kl&&(e=>$d[e.type]||e.bins)(t)?f4(o):"discrete"===i?h4(o):d4(o)}const f4=e=>(t,n,i)=>{const r=S2(i[n+1],S2(i.max,1/0)),a=T2(t,e),s=T2(r,e);return a&&s?a+" \u2013 "+s:s?"< "+s:"\u2265 "+a},S2=(e,t)=>null!=e?e:t,h4=e=>(t,n)=>n?e(t):null,d4=e=>t=>e(t),T2=(e,t)=>Number.isFinite(e)?t(e):null;function F2(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=function(e,t,n,i){const r=i||t.type;return ke(n)&&function(e){return mr(e,zd)}(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||r!==gr?n||r!==pr?C2(e,t,5,null,n,i,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}(e,t,n.format,n.formatType);if(Ud(t.type)){const a=A2(t).slice(1).map(r),s=a.length;return"".concat(s," boundar").concat(1===s?"y":"ies",": ").concat(a.join(", "))}if(ma(t.type)){const a=t.domain(),s=a.length,o=s>i?a.slice(0,i-2).map(r).join(", ")+", ending with "+a.slice(-1).map(r):a.map(r).join(", ");return"".concat(s," value").concat(1===s?"":"s",": ").concat(o)}{const a=t.domain();return"values from ".concat(r(a[0])," to ").concat(r(ce(a)))}}let B2=0;function Gd(e){return e&&e.gradient}function I2(e,t,n){const i=e.gradient;let r=e.id,a="radial"===i?"p_":"";return r||(r=e.id="gradient_"+B2++,"radial"===i?(e.x1=Nn(e.x1,.5),e.y1=Nn(e.y1,.5),e.r1=Nn(e.r1,0),e.x2=Nn(e.x2,.5),e.y2=Nn(e.y2,.5),e.r2=Nn(e.r2,.5),a="p_"):(e.x1=Nn(e.x1,0),e.y1=Nn(e.y1,0),e.x2=Nn(e.x2,1),e.y2=Nn(e.y2,0))),t[r]=e,"url("+(n||"")+"#"+a+r+")"}function Nn(e,t){return null!=e?e:t}const R2={basis:{curve:function(e){return new Cl(e)}},"basis-closed":{curve:function(e){return new Sv(e)}},"basis-open":{curve:function(e){return new Tv(e)}},bundle:{curve:tT,tension:"beta",value:.85},cardinal:{curve:nT,tension:"tension",value:0},"cardinal-open":{curve:iT,tension:"tension",value:0},"cardinal-closed":{curve:rT,tension:"tension",value:0},"catmull-rom":{curve:oT,tension:"alpha",value:.5},"catmull-rom-closed":{curve:lT,tension:"alpha",value:.5},"catmull-rom-open":{curve:uT,tension:"alpha",value:.5},linear:{curve:Jh},"linear-closed":{curve:function(e){return new Nv(e)}},monotone:{horizontal:function(e){return new qv(e)},vertical:function(e){return new Fl(e)}},natural:{curve:function(e){return new $v(e)}},step:{curve:function(e){return new Bl(e,.5)}},"step-after":{curve:function(e){return new Bl(e,1)}},"step-before":{curve:function(e){return new Bl(e,0)}}};function O2(e,t,n){var i=J(R2,e)&&R2[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&null!=n&&(r=r[i.tension](n))),r}const v4={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Os=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Ls(e){const t=[];let n,i,r,a,s,o,l,u,c,f;const h=e.slice().replace(Os[0],"###$1").split(Os[1]).slice(1);for(l=0,c=h.length;l<c;++l){for(n=h[l],i=n.slice(1).trim().replace(Os[2],"$1###$2").replace(Os[3],"$1###$2").split(Os[4]),s=n.charAt(0),r=[s],u=0,f=i.length;u<f;++u)(a=+i[u])===a&&r.push(a);if(o=v4[s.toLowerCase()],r.length-1>o){const d=r.length;for(u=1,t.push([s].concat(r.slice(u,u+=o))),s="M"===s?"L":"m"===s?"l":s;u<d;u+=o)t.push([s].concat(r.slice(u,u+o)))}else t.push(r)}return t}const Ii=Math.PI/180,yr=Math.PI/2,Pn=2*Math.PI,ya=Math.sqrt(3)/2;var Yd={},Wd={},L2=[].join;function _4(e){const t=L2.call(e);if(Wd[t])return Wd[t];var n=e[0],i=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7];const c=u*s,f=-l*o,h=l*s,d=u*o,g=Math.cos(r),p=Math.sin(r),m=Math.cos(a),y=Math.sin(a),v=.5*(a-r),x=Math.sin(.5*v),b=8/3*x*x/Math.sin(v),w=n+g-b*p,M=i+p+b*g,_=n+m,E=i+y,A=_+b*y,D=E-b*m;return Wd[t]=[c*w+f*M,h*w+d*M,c*A+f*D,h*A+d*D,c*_+f*E,h*_+d*E]}const nn=["l",0,0,0,0,0,0,0];function w4(e,t,n){const i=nn[0]=e[0];if("a"===i||"A"===i)nn[1]=t*e[1],nn[2]=n*e[2],nn[3]=e[3],nn[4]=e[4],nn[5]=e[5],nn[6]=t*e[6],nn[7]=n*e[7];else if("h"===i||"H"===i)nn[1]=t*e[1];else if("v"===i||"V"===i)nn[1]=n*e[1];else for(var r=1,a=e.length;r<a;++r)nn[r]=(r%2==1?t:n)*e[r];return nn}function Ql(e,t,n,i,r,a){var s,h,d,g,p,o=null,l=0,u=0,c=0,f=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),null==a&&(a=r),e.beginPath&&e.beginPath();for(var m=0,y=t.length;m<y;++m){switch(s=t[m],(1!==r||1!==a)&&(s=w4(s,r,a)),s[0]){case"l":e.lineTo((l+=s[1])+n,(u+=s[2])+i);break;case"L":e.lineTo((l=s[1])+n,(u=s[2])+i);break;case"h":e.lineTo((l+=s[1])+n,u+i);break;case"H":e.lineTo((l=s[1])+n,u+i);break;case"v":e.lineTo(l+n,(u+=s[1])+i);break;case"V":e.lineTo(l+n,(u=s[1])+i);break;case"m":e.moveTo((l+=s[1])+n,(u+=s[2])+i);break;case"M":e.moveTo((l=s[1])+n,(u=s[2])+i);break;case"c":e.bezierCurveTo(l+s[1]+n,u+s[2]+i,(c=l+s[3])+n,(f=u+s[4])+i,(h=l+s[5])+n,(d=u+s[6])+i),l=h,u=d;break;case"C":e.bezierCurveTo(s[1]+n,s[2]+i,(c=s[3])+n,(f=s[4])+i,(l=s[5])+n,(u=s[6])+i);break;case"s":e.bezierCurveTo((c=2*l-c)+n,(f=2*u-f)+i,l+s[1]+n,u+s[2]+i,(h=l+s[3])+n,(d=u+s[4])+i),c=l+s[1],f=u+s[2],l=h,u=d;break;case"S":e.bezierCurveTo((c=2*l-c)+n,(f=2*u-f)+i,s[1]+n,s[2]+i,(h=s[3])+n,(d=s[4])+i),l=h,u=d,c=s[1],f=s[2];break;case"q":e.quadraticCurveTo((c=l+s[1])+n,(f=u+s[2])+i,(h=l+s[3])+n,(d=u+s[4])+i),l=h,u=d;break;case"Q":e.quadraticCurveTo(s[1]+n,s[2]+i,(h=s[3])+n,(d=s[4])+i),l=h,u=d,c=s[1],f=s[2];break;case"t":h=l+s[1],d=u+s[2],null===o[0].match(/[QqTt]/)?(c=l,f=u):"t"===o[0]?(c=2*l-g,f=2*u-p):"q"===o[0]&&(c=2*l-c,f=2*u-f),g=c,p=f,e.quadraticCurveTo(c+n,f+i,h+n,d+i),c=(l=h)+s[1],f=(u=d)+s[2];break;case"T":e.quadraticCurveTo((c=2*l-c)+n,(f=2*u-f)+i,(h=s[1])+n,(d=s[2])+i),l=h,u=d;break;case"a":z2(e,l+n,u+i,[s[1],s[2],s[3],s[4],s[5],s[6]+l+n,s[7]+u+i]),l+=s[6],u+=s[7];break;case"A":z2(e,l+n,u+i,[s[1],s[2],s[3],s[4],s[5],s[6]+n,s[7]+i]),l=s[6],u=s[7];break;case"z":case"Z":e.closePath()}o=s}}function z2(e,t,n,i){const r=function(e,t,n,i,r,a,s,o,l){const u=L2.call(arguments);if(Yd[u])return Yd[u];const c=s*Ii,f=Math.sin(c),h=Math.cos(c),d=h*(o-e)*.5+f*(l-t)*.5,g=h*(l-t)*.5-f*(o-e)*.5;let p=d*d/((n=Math.abs(n))*n)+g*g/((i=Math.abs(i))*i);p>1&&(p=Math.sqrt(p),n*=p,i*=p);const m=h/n,y=f/n,v=-f/i,x=h/i,b=m*o+y*l,w=v*o+x*l,M=m*e+y*t,_=v*e+x*t;let A=1/((M-b)*(M-b)+(_-w)*(_-w))-.25;A<0&&(A=0);let D=Math.sqrt(A);a==r&&(D=-D);const k=.5*(b+M)-D*(_-w),T=.5*(w+_)+D*(M-b),S=Math.atan2(w-T,b-k);let C=Math.atan2(_-T,M-k)-S;C<0&&1===a?C+=Pn:C>0&&0===a&&(C-=Pn);const O=Math.ceil(Math.abs(C/(yr+.001))),P=[];for(let U=0;U<O;++U)P[U]=[k,T,S+U*C/O,S+(U+1)*C/O,n,i,f,h];return Yd[u]=P}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let a=0;a<r.length;++a){const s=_4(r[a]);e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}}const N2=.5773502691896257,P2={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Pn)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,a=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-a),e.lineTo(r,-a),e.lineTo(0,-n),e.lineTo(-r,-a),e.lineTo(-i,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=ya*n,r=i-n*N2,a=n/4;e.moveTo(0,-i-r),e.lineTo(-a,i-r),e.lineTo(a,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=ya*n,r=i-n*N2;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=ya*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=ya*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=ya*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=ya*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};var Hd={};const Ri=.448084975506;function E4(e){return e.x}function k4(e){return e.y}function A4(e){return e.width}function C4(e){return e.height}function ni(e){return"function"==typeof e?e:()=>+e}function eu(e,t,n){return Math.max(t,Math.min(e,n))}function zs(e,t){return null!=e?e:t}const Ns=e=>e.x||0,Ps=e=>e.y||0,tu=e=>!1!==e.defined,H4=function(){var e=vT,t=xT,n=be(0),i=null,r=bT,a=_T,s=wT,o=null;function l(){var u,c,f=+e.apply(this,arguments),h=+t.apply(this,arguments),d=r.apply(this,arguments)-Tl,g=a.apply(this,arguments)-Tl,p=Bv(g-d),m=g>d;if(o||(o=u=oa()),h<f&&(c=h,h=f,f=c),h>at)if(p>Ms-at)o.moveTo(h*ur(d),h*Bn(d)),o.arc(0,0,h,d,g,!m),f>at&&(o.moveTo(f*ur(g),f*Bn(g)),o.arc(0,0,f,g,d,m));else{var T,S,y=d,v=g,x=d,b=g,w=p,M=p,_=s.apply(this,arguments)/2,E=_>at&&(i?+i.apply(this,arguments):sa(f*f+h*h)),A=Zh(Bv(h-f)/2,+n.apply(this,arguments)),D=A,k=A;if(E>at){var L=Iv(E/f*Bn(_)),C=Iv(E/h*Bn(_));(w-=2*L)>at?(x+=L*=m?1:-1,b-=L):(w=0,x=b=(d+g)/2),(M-=2*C)>at?(y+=C*=m?1:-1,v-=C):(M=0,y=v=(d+g)/2)}var O=h*ur(y),P=h*Bn(y),U=f*ur(b),Z=f*Bn(b);if(A>at){var ct,oe=h*ur(v),Ce=h*Bn(v),Te=f*ur(x),kt=f*Bn(x);if(p<Ai&&(ct=MT(O,P,Te,kt,oe,Ce,U,Z))){var fn=O-ct[0],Ho=P-ct[1],Xo=oe-ct[0],Zo=Ce-ct[1],j=1/Bn(sT((fn*Xo+Ho*Zo)/(sa(fn*fn+Ho*Ho)*sa(Xo*Xo+Zo*Zo)))/2),ae=sa(ct[0]*ct[0]+ct[1]*ct[1]);D=Zh(A,(f-ae)/(j-1)),k=Zh(A,(h-ae)/(j+1))}}M>at?k>at?(T=Il(Te,kt,O,P,h,k,m),S=Il(oe,Ce,U,Z,h,k,m),o.moveTo(T.cx+T.x01,T.cy+T.y01),k<A?o.arc(T.cx,T.cy,k,rt(T.y01,T.x01),rt(S.y01,S.x01),!m):(o.arc(T.cx,T.cy,k,rt(T.y01,T.x01),rt(T.y11,T.x11),!m),o.arc(0,0,h,rt(T.cy+T.y11,T.cx+T.x11),rt(S.cy+S.y11,S.cx+S.x11),!m),o.arc(S.cx,S.cy,k,rt(S.y11,S.x11),rt(S.y01,S.x01),!m))):(o.moveTo(O,P),o.arc(0,0,h,y,v,!m)):o.moveTo(O,P),f>at&&w>at?D>at?(T=Il(U,Z,oe,Ce,f,-D,m),S=Il(O,P,Te,kt,f,-D,m),o.lineTo(T.cx+T.x01,T.cy+T.y01),D<A?o.arc(T.cx,T.cy,D,rt(T.y01,T.x01),rt(S.y01,S.x01),!m):(o.arc(T.cx,T.cy,D,rt(T.y01,T.x01),rt(T.y11,T.x11),!m),o.arc(0,0,f,rt(T.cy+T.y11,T.cx+T.x11),rt(S.cy+S.y11,S.cx+S.x11),m),o.arc(S.cx,S.cy,D,rt(S.y11,S.x11),rt(S.y01,S.x01),!m))):o.arc(0,0,f,b,x,m):o.lineTo(U,Z)}else o.moveTo(0,0);if(o.closePath(),u)return o=null,u+""||null}return l.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+r.apply(this,arguments)+ +a.apply(this,arguments))/2-Ai/2;return[ur(c)*u,Bn(c)*u]},l.innerRadius=function(u){return arguments.length?(e="function"==typeof u?u:be(+u),l):e},l.outerRadius=function(u){return arguments.length?(t="function"==typeof u?u:be(+u),l):t},l.cornerRadius=function(u){return arguments.length?(n="function"==typeof u?u:be(+u),l):n},l.padRadius=function(u){return arguments.length?(i=null==u?null:"function"==typeof u?u:be(+u),l):i},l.startAngle=function(u){return arguments.length?(r="function"==typeof u?u:be(+u),l):r},l.endAngle=function(u){return arguments.length?(a="function"==typeof u?u:be(+u),l):a},l.padAngle=function(u){return arguments.length?(s="function"==typeof u?u:be(+u),l):s},l.context=function(u){return arguments.length?(o=null==u?null:u,l):o},l}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),X4=Kv().x(Ns).y1(Ps).y0(e=>(e.y||0)+(e.height||0)).defined(tu),Z4=Kv().y(Ps).x1(Ns).x0(e=>(e.x||0)+(e.width||0)).defined(tu),K4=Zv().x(Ns).y(Ps).defined(tu),J4=function(){var e=E4,t=k4,n=A4,i=C4,r=ni(0),a=r,s=r,o=r,l=null;function u(c,f,h){var d,g=null!=f?f:+e.call(this,c),p=null!=h?h:+t.call(this,c),m=+n.call(this,c),y=+i.call(this,c),v=Math.min(m,y)/2,x=eu(+r.call(this,c),0,v),b=eu(+a.call(this,c),0,v),w=eu(+s.call(this,c),0,v),M=eu(+o.call(this,c),0,v);if(l||(l=d=oa()),x<=0&&b<=0&&w<=0&&M<=0)l.rect(g,p,m,y);else{var _=g+m,E=p+y;l.moveTo(g+x,p),l.lineTo(_-b,p),l.bezierCurveTo(_-Ri*b,p,_,p+Ri*b,_,p+b),l.lineTo(_,E-M),l.bezierCurveTo(_,E-Ri*M,_-Ri*M,E,_-M,E),l.lineTo(g+w,E),l.bezierCurveTo(g+Ri*w,E,g,E-Ri*w,g,E-w),l.lineTo(g,p+x),l.bezierCurveTo(g,p+Ri*x,g+Ri*x,p,g+x,p),l.closePath()}if(d)return l=null,d+""||null}return u.x=function(c){return arguments.length?(e=ni(c),u):e},u.y=function(c){return arguments.length?(t=ni(c),u):t},u.width=function(c){return arguments.length?(n=ni(c),u):n},u.height=function(c){return arguments.length?(i=ni(c),u):i},u.cornerRadius=function(c,f,h,d){return arguments.length?(r=ni(c),a=null!=f?ni(f):r,o=null!=h?ni(h):r,s=null!=d?ni(d):a,u):r},u.context=function(c){return arguments.length?(l=null==c?null:c,u):l},u}().x(Ns).y(Ps).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>zs(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>zs(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>zs(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>zs(e.cornerRadiusBottomLeft,e.cornerRadius)||0),Q4=function(e,t){var n=null;function i(){var r;if(n||(n=r=oa()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:be(e||Jv),t="function"==typeof t?t:be(void 0===t?64:+t),i.type=function(r){return arguments.length?(e="function"==typeof r?r:be(r),i):e},i.size=function(r){return arguments.length?(t="function"==typeof r?r:be(+r),i):t},i.context=function(r){return arguments.length?(n=null==r?null:r,i):n},i}().type(e=>function(e){return J(P2,e)?P2[e]:function(e){if(!J(Hd,e)){const t=Ls(e);Hd[e]={draw:function(n,i){Ql(n,t,0,0,Math.sqrt(i)/2)}}}return Hd[e]}(e)}(e.shape||"circle")).size(e=>zs(e.size,64)),e8=function(){var e,t,n,i,a,s,o,l,r=null;function u(f,h,d){const g=d/2;if(a){var p=o-h,m=f-s;if(p||m){var y=Math.sqrt(p*p+m*m),v=(p/=y)*l,x=(m/=y)*l,b=Math.atan2(m,p);r.moveTo(s-v,o-x),r.lineTo(f-p*g,h-m*g),r.arc(f,h,g,b-Math.PI,b),r.lineTo(s+v,o+x),r.arc(s,o,l,b,b+Math.PI)}else r.arc(f,h,g,0,Pn);r.closePath()}else a=1;s=f,o=h,l=g}function c(f){var h,g,m,d=f.length,p=!1;for(null==r&&(r=m=oa()),h=0;h<=d;++h)!(h<d&&i(g=f[h],h,f))===p&&(p=!p)&&(a=0),p&&u(+e(g,h,f),+t(g,h,f),+n(g,h,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(r=null==f?null:f,c):r},c}().x(Ns).y(Ps).defined(tu).size(e=>e.size||1);function Xd(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function va(e,t,n,i){return J4.context(e)(t,n,i)}var U2=1;function Zd(e,t,n){var i=t.clip,r=e._defs,a=t.clip_id||(t.clip_id="clip"+U2++),s=r.clipping[a]||(r.clipping[a]={id:a});return ne(i)?s.path=i(null):Xd(n)?s.path=va(null,n,0,0):(s.width=n.width||0,s.height=n.height||0),"url(#"+a+")"}function $e(e){this.clear(),e&&this.union(e)}function Kd(e){this.mark=e,this.bounds=this.bounds||new $e}function Jd(e){Kd.call(this,e),this.items=this.items||[]}function j2(e){this._pending=0,this._loader=e||th()}function q2(e){e._pending+=1}function Us(e){e._pending-=1}function Oi(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const i=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(i+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,i):0))}return e}$e.prototype={clone(){return new $e(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:r,x2:a,y2:s}=this,o=Math.cos(e),l=Math.sin(e),u=t-t*o+n*l,c=n-t*l-n*o;return[o*i-l*r+u,l*i+o*r+c,o*i-l*s+u,l*i+o*s+c,o*a-l*r+u,l*a+o*r+c,o*a-l*s+u,l*a+o*s+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},z(Jd,Kd),j2.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return q2(t),t._loader.sanitize(e,{context:"href"}).then(n=>(Us(t),n)).catch(()=>(Us(t),null))},loadImage(e){const t=this,n="undefined"!=typeof Image?Image:null;return q2(t),t._loader.sanitize(e,{context:"image"}).then(i=>{const r=i.href;if(!r||!n)throw{url:r};const a=new n,s=J(i,"crossOrigin")?i.crossOrigin:"anonymous";return null!=s&&(a.crossOrigin=s),a.onload=()=>Us(t),a.onerror=()=>Us(t),a.src=r,a}).catch(i=>(Us(t),{complete:!1,width:0,height:0,src:i&&i.url||""}))},ready(){const e=this;return new Promise(t=>{!function n(i){e.pending()?setTimeout(()=>{n(!0)},10):t(i)}(!1)})}};const u8=Pn-1e-8;let nu,iu,ru,vr,Qd,au,e0,t0;const Li=(e,t)=>nu.add(e,t),su=(e,t)=>Li(iu=e,ru=t),V2=e=>Li(e,nu.y1),$2=e=>Li(nu.x1,e),xr=(e,t)=>Qd*e+e0*t,br=(e,t)=>au*e+t0*t,n0=(e,t)=>Li(xr(e,t),br(e,t)),i0=(e,t)=>su(xr(e,t),br(e,t));function ou(e,t){return nu=e,t?(vr=t*Ii,Qd=t0=Math.cos(vr),au=Math.sin(vr),e0=-au):(Qd=t0=1,vr=au=e0=0),c8}const c8={beginPath(){},closePath(){},moveTo:i0,lineTo:i0,rect(e,t,n,i){vr?(n0(e+n,t),n0(e+n,t+i),n0(e,t+i),i0(e,t)):(Li(e+n,t+i),su(e,t))},quadraticCurveTo(e,t,n,i){const r=xr(e,t),a=br(e,t),s=xr(n,i),o=br(n,i);G2(iu,r,s,V2),G2(ru,a,o,$2),su(s,o)},bezierCurveTo(e,t,n,i,r,a){const s=xr(e,t),o=br(e,t),l=xr(n,i),u=br(n,i),c=xr(r,a),f=br(r,a);Y2(iu,s,l,c,V2),Y2(ru,o,u,f,$2),su(c,f)},arc(e,t,n,i,r,a){if(i+=vr,r+=vr,iu=n*Math.cos(r)+e,ru=n*Math.sin(r)+t,Math.abs(r-i)>u8)Li(e-n,t-n),Li(e+n,t+n);else{const s=u=>Li(n*Math.cos(u)+e,n*Math.sin(u)+t);let o,l;if(s(i),s(r),r!==i)if((i%=Pn)<0&&(i+=Pn),(r%=Pn)<0&&(r+=Pn),r<i&&(a=!a,o=i,i=r,r=o),a)for(r-=Pn,o=i-i%yr,l=0;l<4&&o>r;++l,o-=yr)s(o);else for(o=i-i%yr+yr,l=0;l<4&&o<r;++l,o+=yr)s(o)}}};function G2(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function Y2(e,t,n,i,r){const a=i-e+3*t-3*n,s=e+n-2*t,o=e-t;let c,l=0,u=0;Math.abs(a)>1e-14?(c=s*s+o*a,c>=0&&(c=Math.sqrt(c),l=(-s+c)/a,u=(-s-c)/a)):l=.5*o/s,0<l&&l<1&&r(W2(l,e,t,n,i)),0<u&&u<1&&r(W2(u,e,t,n,i))}function W2(e,t,n,i,r){const a=1-e,s=a*a,o=e*e;return s*a*t+3*s*e*n+3*a*o*i+o*e*r}var zi=(zi=la(1,1))?zi.getContext("2d"):null;const r0=new $e;function H2(e){return function(t,n){if(!zi)return!0;e(zi,t),r0.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:a,y2:s}=r0;for(let o=r;o<=s;++o)for(let l=i;l<=a;++l)if(zi.isPointInPath(l,o))return!0;return!1}}function X2(e,t){return t.contains(e.x||0,e.y||0)}function Z2(e,t){const n=e.x||0,i=e.y||0;return t.intersects(r0.set(n,i,n+(e.width||0),i+(e.height||0)))}function js(e,t,n,i,r){const{x1:a,y1:s,x2:o,y2:l}=e,u=i-t,c=r-n;let d,g,p,m,f=0,h=1;for(m=0;m<4;++m){if(0===m&&(d=-u,g=-(a-t)),1===m&&(d=u,g=o-t),2===m&&(d=-c,g=-(s-n)),3===m&&(d=c,g=l-n),Math.abs(d)<1e-10&&g<0)return!1;if(p=g/d,d<0){if(p>h)return!1;p>f&&(f=p)}else if(d>0){if(p<f)return!1;p<h&&(h=p)}}return!0}function xa(e,t){e.globalCompositeOperation=t.blend||"source-over"}function yn(e,t){return null==e?t:e}function K2(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function J2(e,t,n){return Gd(n)?function(e,t,n){const i=n.width(),r=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+yn(t.x1,.5)*i,n.y1+yn(t.y1,.5)*r,Math.max(i,r)*yn(t.r1,0),n.x1+yn(t.x2,.5)*i,n.y1+yn(t.y2,.5)*r,Math.max(i,r)*yn(t.r2,.5));else{const s=yn(t.x1,0),o=yn(t.y1,0),l=yn(t.x2,1),u=yn(t.y2,0);if(s!==l&&o!==u&&i!==r){const c=la(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=K2(f.createLinearGradient(s,o,l,u),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}a=e.createLinearGradient(n.x1+s*i,n.y1+o*r,n.x1+l*i,n.y1+u*r)}return K2(a,t.stops)}(e,n,t.bounds):n}function lu(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=J2(e,t,t.fill),!0)}var d8=[];function ba(e,t,n){var i=null!=(i=t.strokeWidth)?i:1;return!(i<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=J2(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||d8),e.lineDashOffset=t.strokeDashOffset||0),!0)}function g8(e,t){return e.zindex-t.zindex||e.index-t.index}function Q2(e){if(!e.zdirty)return e.zitems;var i,r,a,t=e.items,n=[];for(r=0,a=t.length;r<a;++r)(i=t[r]).index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(g8)}function Un(e,t){var i,r,n=e.items;if(!n||!n.length)return;const a=Q2(e);if(a&&a.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=a}for(i=0,r=n.length;i<r;++i)t(n[i])}function a0(e,t){var i,r,n=e.items;if(!n||!n.length)return null;const a=Q2(e);for(a&&a.length&&(n=a),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===a)for(r=(n=e.items).length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i;return null}function s0(e){return function(t,n,i){Un(n,r=>{(!i||i.intersects(r.bounds))&&eb(e,t,r,r)})}}function p8(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&eb(e,t,n.items[0],n.items)}}function eb(e,t,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(e(t,i)||(xa(t,n),n.fill&&lu(t,n,r)&&t.fill(),n.stroke&&ba(t,n,r)&&t.stroke()))}function uu(e){return e=e||hn,function(t,n,i,r,a,s){return i*=t.pixelRatio,r*=t.pixelRatio,a0(n,o=>{const l=o.bounds;if((!l||l.contains(a,s))&&l&&e(t,o,i,r,a,s))return o})}}function qs(e,t){return function(n,i,r,a){var u,c,s=Array.isArray(i)?i[0]:i,o=null==t?s.fill:t,l=s.stroke&&n.isPointInStroke;return l&&(c=s.strokeCap,n.lineWidth=null!=(u=s.strokeWidth)?u:1,n.lineCap=null!=c?c:"butt"),!e(n,i)&&(o&&n.isPointInPath(r,a)||l&&n.isPointInStroke(r,a))}}function o0(e){return uu(qs(e))}function _r(e,t){return"translate("+e+","+t+")"}function l0(e){return"rotate("+e+")"}function tb(e){return _r(e.x||0,e.y||0)}function u0(e,t,n){function a(s,o){var l=o.x||0,u=o.y||0,c=o.angle||0;s.translate(l,u),c&&s.rotate(c*=Ii),s.beginPath(),t(s,o),c&&s.rotate(-c),s.translate(-l,-u)}return{type:e,tag:"path",nested:!1,attr:function(s,o){s("transform",function(e){return _r(e.x||0,e.y||0)+(e.angle?" "+l0(e.angle):"")}(o)),s("d",t(null,o))},bound:function(s,o){return t(ou(s,o.angle),o),Oi(s,o).translate(o.x||0,o.y||0)},draw:s0(a),pick:o0(a),isect:n||H2(a)}}var x8=u0("arc",function(e,t){return H4.context(e)(t)});function c0(e,t,n){function a(l,u){l.beginPath(),t(l,u)}const s=qs(a);return{type:e,tag:"path",nested:!0,attr:function(l,u){var c=u.mark.items;c.length&&l("d",t(null,c))},bound:function(l,u){var c=u.items;return 0===c.length?l:(t(ou(l),c),Oi(l,c[0]))},draw:p8(a),pick:function(l,u,c,f,h,d){var g=u.items,p=u.bounds;return!g||!g.length||p&&!p.contains(h,d)?null:s(l,g,c*=l.pixelRatio,f*=l.pixelRatio)?g[0]:null},isect:X2,tip:n}}var M8=c0("area",function(e,t){const n=t[0];return("horizontal"===n.orient?Z4:X4).curve(O2(n.interpolate||"linear",n.orient,n.tension)).context(e)(t)},function(e,t){for(var s,o,n="horizontal"===e[0].orient?t[1]:t[0],i="horizontal"===e[0].orient?"y":"x",r=e.length,a=1/0;--r>=0;)!1!==e[r].defined&&(o=Math.abs(e[r][i]-n))<a&&(a=o,s=e[r]);return s});function nb(e,t){e.beginPath(),Xd(t)?va(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function ib(e){const t=yn(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function rb(e,t){const n=ib(t);e("d",va(null,t,n,n))}function Vs(e,t,n,i){const r=ib(t);e.beginPath(),va(e,t,(n||0)+r,(i||0)+r)}const T8=qs(Vs),F8=qs(Vs,!1),B8=qs(Vs,!0);var L8={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",tb(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Oi(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){Un(t,i=>{const r=i.x||0,a=i.y||0,s=i.strokeForeground,o=null==i.opacity?1:i.opacity;(i.stroke||i.fill)&&o&&(Vs(e,i,r,a),xa(e,i),i.fill&&lu(e,i,o)&&e.fill(),i.stroke&&!s&&ba(e,i,o)&&e.stroke()),e.save(),e.translate(r,a),i.clip&&nb(e,i),n&&n.translate(-r,-a),Un(i,l=>{this.draw(e,l,n)}),n&&n.translate(r,a),e.restore(),s&&i.stroke&&o&&(Vs(e,i,r,a),xa(e,i),ba(e,i,o)&&e.stroke())})},pick:function(e,t,n,i,r,a){if(t.bounds&&!t.bounds.contains(r,a)||!t.items)return null;const s=n*e.pixelRatio,o=i*e.pixelRatio;return a0(t,l=>{let u,c,f;const h=l.bounds;if(h&&!h.contains(r,a))return;c=l.x||0,f=l.y||0;const p=l.clip;if(p&&(r<c||r>c+(l.width||0)||a<f||a>f+(l.height||0)))return;if(e.save(),e.translate(c,f),c=r-c,f=a-f,p&&Xd(l)&&!B8(e,l,s,o))return e.restore(),null;const m=l.strokeForeground,y=!1!==t.interactive;return y&&m&&l.stroke&&F8(e,l,s,o)?(e.restore(),l):(u=a0(l,v=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(v,c,f)?this.pick(v,n,i,c,f):null),!u&&y&&(l.fill||!m&&l.stroke)&&T8(e,l,s,o)&&(u=l),e.restore(),u||null)})},isect:Z2,content:function(e,t,n){e("clip-path",t.clip?Zd(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),rb(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?rb(e,t):e("d","")}},$s={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function f0(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function h0(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function d0(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function cu(e,t){return"center"===e?t/2:"right"===e?t:0}function fu(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var U8={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const i=f0(t,n),r=h0(t,i),a=d0(t,i),s=(t.x||0)-cu(t.align,r),o=(t.y||0)-fu(t.baseline,a);e("href",!i.src&&i.toDataURL?i.toDataURL():i.src||"",$s["xmlns:xlink"],"xlink:href"),e("transform",_r(s,o)),e("width",r),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,i=h0(t,n),r=d0(t,n),a=(t.x||0)-cu(t.align,i),s=(t.y||0)-fu(t.baseline,r);return e.set(a,s,a+i,s+r)},draw:function(e,t,n){Un(t,i=>{if(n&&!n.intersects(i.bounds))return;const r=f0(i,this);let a=h0(i,r),s=d0(i,r);if(0===a||0===s)return;let u,c,f,h,o=(i.x||0)-cu(i.align,a),l=(i.y||0)-fu(i.baseline,s);!1!==i.aspect&&(c=r.width/r.height,f=i.width/i.height,c==c&&f==f&&c!==f&&(f<c?(h=a/c,l+=(s-h)/2,s=h):(h=s*c,o+=(a-h)/2,a=h))),(r.complete||r.toDataURL)&&(xa(e,i),e.globalAlpha=null!=(u=i.opacity)?u:1,e.imageSmoothingEnabled=!1!==i.smooth,e.drawImage(r,o,l,a,s))})},pick:uu(),isect:hn,get:f0,xOffset:cu,yOffset:fu},j8=c0("line",function(e,t){const n=t[0];return K4.curve(O2(n.interpolate||"linear",n.orient,n.tension)).context(e)(t)},function(e,t){for(var r,a,n=Math.pow(e[0].strokeWidth||1,2),i=e.length;--i>=0;)if(!1!==e[i].defined&&(r=e[i].x-t[0])*r+(a=e[i].y-t[1])*a<n)return e[i];return null});function hu(e,t){var n=t.path;if(null==n)return!0;var i=t.x||0,r=t.y||0,a=t.scaleX||1,s=t.scaleY||1,o=(t.angle||0)*Ii,l=t.pathCache;(!l||l.path!==n)&&((t.pathCache=l=Ls(n)).path=n),o&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(o),Ql(e,l,0,0,a,s),e.rotate(-o),e.translate(-i,-r)):Ql(e,l,i,r,a,s)}var $8={type:"path",tag:"path",nested:!1,attr:function(e,t){(1!==(t.scaleX||1)||1!==(t.scaleY||1))&&e("vector-effect","non-scaling-stroke"),e("transform",function(e){return _r(e.x||0,e.y||0)+(e.angle?" "+l0(e.angle):"")+(e.scaleX||e.scaleY?" "+function(e,t){return"scale("+e+","+t+")"}(e.scaleX||1,e.scaleY||1):"")}(t)),e("d",t.path)},bound:function(e,t){return hu(ou(e,t.angle),t)?e.set(0,0,0,0):Oi(e,t,!0)},draw:s0(hu),pick:o0(hu),isect:H2(hu)};function ab(e,t){e.beginPath(),va(e,t)}var W8={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",va(null,t))},bound:function(e,t){var n,i;return Oi(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)},draw:s0(ab),pick:o0(ab),isect:Z2};function sb(e,t,n){var i,r,a,s;return!(!t.stroke||!ba(e,t,n)||(i=t.x||0,r=t.y||0,a=null!=t.x2?t.x2:i,s=null!=t.y2?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(a,s),0))}var J8={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",tb(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,i;return Oi(e.set(n=t.x||0,i=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i),t)},draw:function(e,t,n){Un(t,i=>{if(!n||n.intersects(i.bounds)){var r=null==i.opacity?1:i.opacity;r&&sb(e,i,r)&&(xa(e,i),e.stroke())}})},pick:uu(function(e,t,n,i){return!!e.isPointInStroke&&sb(e,t,1)&&e.isPointInStroke(n,i)}),isect:function(e,t){const n=e.x||0,i=e.y||0;return js(t,n,i,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i)}},Q8=u0("shape",function(e,t){return(t.mark.shape||t.shape).context(e)(t)}),e7=u0("symbol",function(e,t){return Q4.context(e)(t)},X2);const ob=function(e){let t,n,i;e=+e||1e4;const r=()=>{t={},n={},i=0},a=(s,o)=>(++i>e&&(n=t,t={},i=1),t[s]=o);return r(),{clear:r,has:s=>J(t,s)||J(n,s),get:s=>J(t,s)?t[s]:J(n,s)?a(s,n[s]):void 0,set:(s,o)=>J(t,s)?t[s]=o:a(s,o)}}();var ii={height:ri,measureWidth:p0,estimateWidth:g0,width:g0,canvas:lb};function lb(e){ii.width=e&&zi?p0:g0}function g0(e,t){return ub(Ni(e,t),ri(e))}function ub(e,t){return~~(.8*e.length*t)}function p0(e,t){return ri(e)<=0||!(t=Ni(e,t))?0:cb(t,m0(e))}function cb(e,t){const n=`(${t}) ${e}`;let i=ob.get(n);return void 0===i&&(zi.font=t,i=zi.measureText(e).width,ob.set(n,i)),i}function ri(e){return null!=e.fontSize?+e.fontSize||0:11}function wr(e){return null!=e.lineHeight?e.lineHeight:ri(e)+2}function Gs(e){return function(e){return $(e)?e.length>1?e:e[0]:e}(e.lineBreak&&e.text&&!$(e.text)?e.text.split(e.lineBreak):e.text)}function fb(e){const t=Gs(e);return($(t)?t.length-1:0)*wr(e)}function Ni(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,i=function(e){if(ii.width===p0){const t=m0(e);return n=>cb(n,t)}{const t=ri(e);return n=>ub(n,t)}}(e);if(i(t)<n)return t;var l,r=e.ellipsis||"\u2026",a="rtl"===e.dir,s=0,o=t.length;if(n-=i(r),a){for(;s<o;)i(t.slice(l=s+o>>>1))>n?s=l+1:o=l;return r+t.slice(s)}for(;s<o;)i(t.slice(0,l=1+(s+o>>>1)))<n?s=l:o=l-1;return t.slice(0,s)+r}(e,n):n}function du(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function m0(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+ri(e)+"px "+du(e,t)}function y0(e){var t=e.baseline,n=ri(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*wr(e):"line-bottom"===t?.29*n-.5*wr(e):0)}lb(!0);const r7={left:"start",center:"middle",right:"end"},Ys=new $e;function gu(e){var r,t=e.x||0,n=e.y||0,i=e.radius||0;return i&&(r=(e.theta||0)-yr,t+=i*Math.cos(r),n+=i*Math.sin(r)),Ys.x1=t,Ys.y1=n,Ys}function v0(e,t,n){var f,i=ii.height(t),r=t.align,a=gu(t),s=a.x1,o=a.y1,l=t.dx||0,u=(t.dy||0)+y0(t)-Math.round(.8*i),c=Gs(t);if($(c)?(i+=wr(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,ii.width(t,d)),0)):f=ii.width(t,c),"center"===r?l-=f/2:"right"===r&&(l-=f),e.set(l+=s,u+=o,l+f,u+i),t.angle&&!n)e.rotate(t.angle*Ii,s,o);else if(2===n)return e.rotatedPoints(t.angle*Ii,s,o);return e}var u7={type:"text",tag:"text",nested:!1,attr:function(e,t){var l,n=t.dx||0,i=(t.dy||0)+y0(t),r=gu(t),a=r.x1,s=r.y1,o=t.angle||0;e("text-anchor",r7[t.align]||"start"),o?(l=_r(a,s)+" "+l0(o),(n||i)&&(l+=" "+_r(n,i))):l=_r(a+n,s+i),e("transform",l)},bound:v0,draw:function(e,t,n){Un(t,i=>{var a,s,o,l,u,c,f,r=null==i.opacity?1:i.opacity;if(!(n&&!n.intersects(i.bounds)||0===r||i.fontSize<=0||null==i.text||0===i.text.length)){if(e.font=m0(i),e.textAlign=i.align||"left",s=(a=gu(i)).x1,o=a.y1,i.angle&&(e.save(),e.translate(s,o),e.rotate(i.angle*Ii),s=o=0),s+=i.dx||0,o+=(i.dy||0)+y0(i),c=Gs(i),xa(e,i),$(c))for(u=wr(i),l=0;l<c.length;++l)f=Ni(i,c[l]),i.fill&&lu(e,i,r)&&e.fillText(f,s,o),i.stroke&&ba(e,i,r)&&e.strokeText(f,s,o),o+=u;else f=Ni(i,c),i.fill&&lu(e,i,r)&&e.fillText(f,s,o),i.stroke&&ba(e,i,r)&&e.strokeText(f,s,o);i.angle&&e.restore()}})},pick:uu(function(e,t,n,i,r,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var s=gu(t),o=s.x1,l=s.y1,u=v0(Ys,t,1),c=-t.angle*Ii,f=Math.cos(c),h=Math.sin(c);return u.contains(f*r-h*a+(o-f*o+h*l),h*r+f*a+(l-h*o-f*l))}),isect:function(e,t){const n=v0(Ys,e,2);return js(t,n[0],n[1],n[2],n[3])||js(t,n[0],n[1],n[4],n[5])||js(t,n[4],n[5],n[6],n[7])||js(t,n[2],n[3],n[6],n[7])}},c7=c0("trail",function(e,t){return e8.context(e)(t)},function(e,t){for(var i,r,n=e.length;--n>=0;)if(!1!==e[n].defined&&(i=e[n].x-t[0])*i+(r=e[n].y-t[1])*r<(i=e[n].size||1)*i)return e[n];return null}),rn={arc:x8,area:M8,group:L8,image:U8,line:j8,path:$8,rect:W8,rule:J8,shape:Q8,symbol:e7,text:u7,trail:c7};function hb(e,t,n){var i=rn[e.mark.marktype];return i.nested&&(e=e.mark),(t||i.bound)(e.bounds||(e.bounds=new $e),e,n)}var db={mark:null};const h7=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function g7(e){return gb("string"==typeof e?JSON.parse(e):e)}function gb(e){var i,r,a,t=e.marktype,n=e.items;if(n)for(r=0,a=n.length;r<a;++r)n[r][i=t?"mark":"group"]=e,n[r].zindex&&(n[r][i].zdirty=!0),"group"===(t||i)&&gb(n[r]);return t&&function(e,t,n){var o,l,u,c,i=rn[e.marktype],r=i.bound,a=e.items,s=a&&a.length;if(i.nested)return s?u=a[0]:(db.mark=e,u=db),c=hb(u,r,n),t&&t.union(c)||c;if(t=t||e.bounds&&e.bounds.clear()||new $e,s)for(o=0,l=a.length;o<l;++o)t.union(hb(a[o],r,n));e.bounds=t}(e),e}function pb(e){arguments.length?this.root=g7(e):(this.root=mb({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Jd(this.root)])}function mb(e,t){const n={bounds:new $e,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Mr(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function yb(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function Vt(e,t,n,i){var a,r=e.childNodes[t];return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(a=r||null,r=Mr(e.ownerDocument,n,i),e.insertBefore(r,a)),r}function jn(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function vb(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function x0(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function Dr(e,t){this._active=null,this._handlers={},this._loader=e||th(),this._tooltip=t||m7}function m7(e,t,n,i){e.element().setAttribute("title",i||"")}function ai(e){this._el=null,this._bgcolor=null,this._loader=new j2(e)}pb.prototype={toJSON(e){return function(e,t){return JSON.stringify(e,h7,t)}(this.root,e||0)},mark(e,t,n){const i=mb(e,t=t||this.root.items[0]);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}},Dr.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const i in t)n.push(...t[i]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),a=Mr(null,"a");for(const s in i)a.setAttribute(s,i[s]);a.dispatchEvent(r)}).catch(()=>{})},handleTooltip(e,t,n){t&&null!=t.tooltip&&(t=function(e,t,n,i){var a,s,r=e&&e.mark;if(r&&(a=rn[r.marktype]).tip){for((s=x0(t,n))[0]-=i[0],s[1]-=i[1];e=e.mark.group;)s[0]-=e.x||0,s[1]-=e.y||0;e=a.tip(r.items,s)}return e}(t,e,this.canvas(),this._origin),this._tooltip.call(this._obj,this,e,t,n&&t&&t.tooltip||null))},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,a=r.width(),s=r.height();let o=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)o+=e.x||0,l+=e.y||0;return{x:o,y:l,width:a,height:s,left:o,top:l,right:o+a,bottom:l+s}}},ai.prototype={initialize(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,i=n._loader[e](t);if(!n._ready){const r=n._call;n._ready=n._loader.ready().then(a=>{a&&r(),n._ready=null})}return i},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const xb="dragenter",pu="dragleave",bb="dragover",b0="mousedown",mu="mousemove",Ws="mouseout",_b="mouseover",yu="click",wb="mousewheel",vu="touchstart",xu="touchmove",bu="touchend",_0=mu,Hs=Ws,w0=yu;function _u(e,t){Dr.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function Mb(e,t){(e=>e===vu||e===xu||e===bu?[vu,xu,bu]:[e])(t).forEach(n=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}(e,n))}function Db(e,t,n){return function(i){const r=this._active,a=this.pickEvent(i);a===r||((!r||!r.exit)&&this.fire(n,i),this._active=a,this.fire(t,i)),this.fire(e,i)}}function Eb(e){return function(t){this.fire(e,t),this._active=null}}z(_u,Dr,{initialize(e,t,n){return this._canvas=e&&yb(e,"canvas"),[yu,b0,mu,Ws,pu].forEach(i=>Mb(this,i)),Dr.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",xb,pu,bb,b0,"mouseup",mu,Ws,_b,yu,"dblclick","wheel",wb,vu,xu,bu],DOMMouseScroll(e){this.fire(wb,e)},mousemove:Db(mu,_b,Ws),dragover:Db(bb,xb,pu),mouseout:Eb(Ws),dragleave:Eb(pu),mousedown(e){this._down=this._active,this.fire(b0,e)},click(e){this._down===this._active&&(this.fire(yu,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(vu,e,!0)},touchmove(e){this.fire(xu,e,!0)},touchend(e){this.fire(bu,e,!0),this._touch=null},fire(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===w0&&i&&i.href?this.handleHref(t,i,i.href):(e===_0||e===Hs)&&this.handleTooltip(t,i,e!==Hs),r)for(let a=0,s=r.length;a<s;++a)r[a].handler.call(this._obj,t,i)},on(e,t){const n=this.eventName(e),i=this._handlers;return this._handlerIndex(i[n],e,t)<0&&(Mb(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},pickEvent(e){const t=x0(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,i,r){const a=this.context();return rn[e.marktype].pick.call(this,a,e,t,n,i,r)}});var A7="undefined"!=typeof window&&window.devicePixelRatio||1;function M0(e){ai.call(this,e),this._options={},this._redraw=!1,this._dirty=new $e,this._tempb=new $e}const kb=ai.prototype;function Ab(e,t){Dr.call(this,e,t);const n=this;n._hrefHandler=D0(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=D0(n,(i,r)=>{n.handleTooltip(i,r,i.type!==Hs)})}z(M0,ai,{initialize(e,t,n,i,r,a){return this._options=a||{},this._canvas=this._options.externalContext?null:la(1,1),e&&this._canvas&&(jn(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),kb.initialize.call(this,e,t,n,i,r)},resize(e,t,n,i){if(kb.resize.call(this,e,t,n,i),this._canvas)!function(e,t,n,i,r,a){const s="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,o=e.getContext("2d"),l=s?A7:r;e.width=t*l,e.height=n*l;for(const u in a)o[u]=a[u];s&&1!==l&&(e.style.width=t+"px",e.style.height=n+"px"),o.pixelRatio=l,o.setTransform(l,0,0,l,l*i[0],l*i[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||I("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,a=this._dirty,s=((e,t,n)=>(new $e).set(0,0,t,n).translate(-e[0],-e[1]))(n,i,r);t.save();const o=this._redraw||a.empty()?(this._redraw=!1,s.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,s.intersect(a),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,o),t.restore(),a.clear(),this},draw(e,t,n){const i=rn[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),ne(n)?(e.beginPath(),n(e),e.clip()):nb(e,t.group)}(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,i){const r=this._options,a=this.context();"pdf"!==r.type&&!r.externalContext&&a.clearRect(e,t,n,i),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,i))}});const D0=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};z(Ab,Dr,{initialize(e,t,n){let i=this._svg;return i&&(i.removeEventListener(w0,this._hrefHandler),i.removeEventListener(_0,this._tooltipHandler),i.removeEventListener(Hs,this._tooltipHandler)),this._svg=i=e&&yb(e,"svg"),i&&(i.addEventListener(w0,this._hrefHandler),i.addEventListener(_0,this._tooltipHandler),i.addEventListener(Hs,this._tooltipHandler)),Dr.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[n],e,t)<0){const a={type:e,handler:t,listener:D0(this,t)};(i[n]||(i[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const Cb="aria-hidden",E0="aria-label",k0="role",A0="aria-roledescription",Sb="graphics-object",C0="graphics-symbol",Tb=(e,t,n)=>({[k0]:e,[A0]:t,[E0]:n||void 0}),F7=Sn(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Fb={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,i=t.title?Lb(e):null,r=e.context,a=r.scales[t.scale].value,s=r.dataflow.locale(),o=a.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(i?` titled '${i}'`:"")+` for a ${ma(o)?"discrete":o} scale with ${F2(s,a,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?Lb(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,a=Object.keys(r),s=e.context,o=s.scales[r[a[0]]].value,l=s.dataflow.locale();return function(e){return e.length?e[0].toUpperCase()+e.slice(1):e}(i)+(n?` titled '${n}'`:"")+` for ${function(e){return e=e.map(t=>t+("fill"===t||"stroke"===t?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ce(e)}(a)} with ${F2(l,o,e)}`}},"title-text":{desc:"title",caption:e=>`Title text '${Ob(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${Ob(e)}'`}},Bb={ariaRole:k0,ariaRoleDescription:A0,description:E0};function Ib(e,t){const n=!1===t.aria;if(e(Cb,n||void 0),n||null==t.description)for(const i in Bb)e(Bb[i],void 0);else{const i=t.mark.marktype;e(E0,t.description),e(k0,t.ariaRole||("group"===i?Sb:C0)),e(A0,t.ariaRoleDescription||`${i} mark`)}}function Rb(e){return!1===e.aria?{[Cb]:!0}:F7[e.role]?null:Fb[e.role]?function(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return Tb(t.role||C0,t.desc,n.description||i(n))}catch(n){return null}}(e,Fb[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some(i=>null!=i.description&&!1!==i.aria);return Tb(n?Sb:C0,`${t} mark container`,e.description)}(e)}function Ob(e){return K(e.text).join(" ")}function Lb(e){try{return K(ce(e.items).items[0].text).join(" ")}catch(t){return null}}const zb=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function Nb(){let e="",t="",n="";const i=[],r=()=>t=n="",s=(l,u)=>(null!=u&&(t+=` ${l}="${(e=>zb(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))(u)}"`),o),o={open(l,...u){(l=>{t&&(e+=`${t}>${n}`,r()),i.push(l)})(l),t="<"+l;for(const c of u)for(const f in c)s(f,c[f]);return o},close(){const l=i.pop();return e+=t?t+(n?`>${n}</${l}>`:"/>"):`</${l}>`,r(),o},attr:s,text:l=>(n+=zb(l),o),toString:()=>e};return o}const P7=e=>Pb(Nb(),e)+"";function Pb(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,i=n.length;for(let r=0;r<i;++r)e.attr(n[r].name,n[r].value)}if(t.hasChildNodes()){const n=t.childNodes,i=n.length;for(let r=0;r<i;r++){const a=n[r];3===a.nodeType?e.text(a.nodeValue):Pb(e,a)}}return e.close()}const wu={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Ub={fill:"none","stroke-miterlimit":10},jb="http://www.w3.org/2000/xmlns/",ze=$s.xmlns;function qb(e){ai.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const S0=ai.prototype;function Vb(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function U7(e,t,n){let i,r,a;if("radial"===t.gradient){let s=Vt(e,n++,"pattern",ze);Pi(s,{id:"p_"+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),s=Vt(s,0,"rect",ze),Pi(s,{width:1,height:1,fill:`url(${Gb()}#${t.id})`}),Pi(e=Vt(e,n++,"radialGradient",ze),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else Pi(e=Vt(e,n++,"linearGradient",ze),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,r=t.stops.length;i<r;++i)a=Vt(e,i,"stop",ze),a.setAttribute("offset",t.stops[i].offset),a.setAttribute("stop-color",t.stops[i].color);return jn(e,i),n}function j7(e,t,n){let i;return(e=Vt(e,n,"clipPath",ze)).setAttribute("id",t.id),t.path?(i=Vt(e,0,"path",ze),i.setAttribute("d",t.path)):(i=Vt(e,0,"rect",ze),Pi(i,{x:0,y:0,width:t.width,height:t.height})),jn(e,1),n+1}function $b(e,t,n,i,r){let s,a=e._svg;if(!a&&(s=t.ownerDocument,a=Mr(s,i,ze),e._svg=a,e.mark&&(a.__data__=e,a.__values__={fill:"default"},"g"===i))){const o=Mr(s,"path",ze);a.appendChild(o),o.__data__=e;const l=Mr(s,"g",ze);a.appendChild(l),l.__data__=e;const u=Mr(s,"path",ze);a.appendChild(u),u.__data__=e,u.__values__={fill:"default"}}return(a.ownerSVGElement!==r||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(a,n))&&t.insertBefore(a,n?n.nextSibling:t.firstChild),a}z(qb,ai,{initialize(e,t,n,i,r){return this._defs={},this._clearDefs(),e&&(this._svg=Vt(e,0,"svg",ze),this._svg.setAttributeNS(jb,"xmlns",ze),this._svg.setAttributeNS(jb,"xmlns:xlink",$s["xmlns:xlink"]),this._svg.setAttribute("version",$s.version),this._svg.setAttribute("class","marks"),jn(e,1),this._root=Vt(this._svg,0,"g",ze),Pi(this._root,Ub),jn(this._svg,1)),this.background(this._bgcolor),S0.initialize.call(this,e,t,n,i,r)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),S0.background.apply(this,arguments)},resize(e,t,n,i){return S0.resize.call(this,e,t,n,i),this._svg&&(Pi(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=Vt(e,0,"rect",ze),Pi(n,{width:this._width,height:this._height,fill:t}));const i=P7(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),i},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),jn(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,i,r,a,s,o,l;for(s=0,o=e.length;s<o;++s)if(n=e[s],i=n.mark,i.marktype!==r&&(r=i.marktype,a=rn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,Vb(n,t),i.items.forEach(u=>{u.dirty=t})),!i.zdirty){if(n.exit){a.nested&&i.items.length?(l=i.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null;continue}n=a.nested?i.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,Vb(n,t)),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const i=this._svg,r=rn[t.marktype],a=!1===t.interactive?"none":null,s="g"===r.tag;let o=null,l=0;const u=$b(t,e,n,"g",i);u.setAttribute("class",vb(t));const c=Rb(t);for(const h in c)pt(u,h,c[h]);s||pt(u,"pointer-events",a),pt(u,"clip-path",t.clip?Zd(this,t,t.group):null);const f=h=>{const d=this.isDirty(h),g=$b(h,u,o,r.tag,i);d&&(this._update(r,g,h),s&&function(e,t,n){t=t.lastChild.previousSibling;let i,r=0;Un(n,a=>{i=e.mark(t,a,i),++r}),jn(t,1+r)}(this,g,h)),o=g,++l};return r.nested?t.items.length&&f(t.items[0]):Un(t,f),jn(u,l),u},_update(e,t,n){si=t,st=t.__values__,Ib(Zs,n),e.attr(Zs,n,this);const i=$7[e.type];i&&i.call(this,e,t,n),si&&this.style(si,n)},style(e,t){if(null!=t)for(const n in wu){let i="font"===n?du(t):t[n];if(i===st[n])continue;const r=wu[n];null==i?e.removeAttribute(r):(Gd(i)&&(i=I2(i,this._defs.gradient,Gb())),e.setAttribute(r,i+"")),st[n]=i}},defs(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=Vt(e,1,"defs",ze)),i=U7(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=Vt(e,1,"defs",ze)),i=j7(n,t.clipping[r],i);n&&(0===i?(e.removeChild(n),t.el=null):jn(n,i))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let si=null,st=null;const $7={group(e,t,n){const i=si=t.childNodes[2];st=i.__values__,e.foreground(Zs,n,this),st=t.__values__,si=t.childNodes[1],e.content(Zs,n,this);const r=si=t.childNodes[0];e.background(Zs,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==st.events&&(pt(i,"pointer-events",a),pt(r,"pointer-events",a),st.events=a),n.strokeForeground&&n.stroke){const s=n.fill;pt(i,"display",null),this.style(r,n),pt(r,"stroke",null),s&&(n.fill=null),st=i.__values__,this.style(i,n),s&&(n.fill=s),si=null}else pt(i,"display","none")},image(e,t,n){!1===n.smooth?(T0(t,"image-rendering","optimizeSpeed"),T0(t,"image-rendering","pixelated")):T0(t,"image-rendering",null)},text(e,t,n){const i=Gs(n);let r,a,s,o;$(i)?(a=i.map(l=>Ni(n,l)),r=a.join("\n"),r!==st.text&&(jn(t,0),s=t.ownerDocument,o=wr(n),a.forEach((l,u)=>{const c=Mr(s,"tspan",ze);c.__data__=n,c.textContent=l,u&&(c.setAttribute("x",0),c.setAttribute("dy",o)),t.appendChild(c)}),st.text=r)):(a=Ni(n,i),a!==st.text&&(t.textContent=a,st.text=a)),pt(t,"font-family",du(n)),pt(t,"font-size",ri(n)+"px"),pt(t,"font-style",n.fontStyle),pt(t,"font-variant",n.fontVariant),pt(t,"font-weight",n.fontWeight)}};function Zs(e,t,n){t!==st[e]&&(n?function(e,t,n,i){null!=n?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}(si,e,t,n):pt(si,e,t),st[e]=t)}function T0(e,t,n){n!==st[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),st[t]=n)}function Pi(e,t){for(const n in t)pt(e,n,t[n])}function pt(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function Gb(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Yb(e){ai.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}z(Yb,ai,{svg(){return this._text},_render(e){const t=Nb();t.open("svg",te({},$s,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Ub,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=rn[t.marktype],i=n.tag,r=[Ib,n.attr];e.open("g",{class:vb(t),"clip-path":t.clip?Zd(this,t,t.group):null},Rb(t),{"pointer-events":"g"!==i&&!1===t.interactive?"none":null});const a=s=>{const o=this.href(s);if(o&&e.open("a",o),e.open(i,this.attr(t,s,r,"g"!==i?i:null)),"text"===i){const l=Gs(s);if($(l)){const u={x:0,dy:wr(s)};for(let c=0;c<l.length;++c)e.open("tspan",c?u:null).text(Ni(s,l[c])).close()}else e.text(Ni(s,l))}else if("g"===i){const l=s.strokeForeground,u=s.fill,c=s.stroke;l&&c&&(s.stroke=null),e.open("path",this.attr(t,s,n.background,"bgrect")).close(),e.open("g",this.attr(t,s,n.content)),Un(s,f=>this.mark(e,f)),e.close(),l&&c?(u&&(s.fill=null),s.stroke=c,e.open("path",this.attr(t,s,n.foreground,"bgrect")).close(),u&&(s.fill=u)):e.open("path",this.attr(t,s,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):Un(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[t]=i})}return null},attr(e,t,n,i){const r={},a=(s,o,l,u)=>{r[u||s]=o};return Array.isArray(n)?n.forEach(s=>s(a,t,this)):n(a,t,this),i&&function(e,t,n,i,r){if(null==t||("bgrect"===i&&!1===n.interactive&&(e["pointer-events"]="none"),"bgfore"===i&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill)))return e;"image"===i&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===i&&(e["font-family"]=du(t),e["font-size"]=ri(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const a in wu){let s=t[a];const o=wu[a];"transparent"===s&&("fill"===o||"stroke"===o)||null!=s&&(Gd(s)&&(s=I2(s,r.gradient,"")),e[o]=s)}}(r,t,e,i,this._defs),r},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const a=t[r],s=a.stops;"radial"===a.gradient?(e.open("pattern",{id:"p_"+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:a.x1,fy:a.y1,fr:a.r1,cx:a.x2,cy:a.y2,r:a.r2})):e.open("linearGradient",{id:r,x1:a.x1,x2:a.x2,y1:a.y1,y2:a.y2});for(let o=0;o<s.length;++o)e.open("stop",{offset:s[o].offset,"stop-color":s[o].color}).close();e.close()}for(const r in n){const a=n[r];e.open("clipPath",{id:r}),a.path?e.open("path",{d:a.path}).close():e.open("rect",{x:0,y:0,width:a.width,height:a.height}).close(),e.close()}e.close()}}});const _a={};function F0(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(_a[e]=t,this):_a[e]}function Kb(e,t,n,i){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const r=e.items,a=e.marktype,s=r.length;let o=0;if("group"===a)for(;o<s;++o)Jb(r[o],t,n,i);else for(const l=rn[a].isect;o<s;++o){const u=r[o];Qb(u,t,l)&&i.push(u)}}return i}function Jb(e,t,n,i){n&&n(e.mark)&&Qb(e,t,rn.group.isect)&&i.push(e);const r=e.items,a=r&&r.length;if(a){const s=e.x||0,o=e.y||0;t.translate(-s,-o);for(let l=0;l<a;++l)Kb(r[l],t,n,i);t.translate(s,o)}return i}function Qb(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}_a.canvas=_a.png={renderer:M0,headless:M0,handler:_u},_a.svg={renderer:qb,headless:Yb,handler:Ab},_a.none={};const B0=new $e,wa="top",vn="left",xn="right",Ui="bottom",I0="start",R0="middle",mt="end",Mu="group",O0="axis",L0="title",z0="legend",t_="row-header",n_="row-footer",i_="row-title",r_="column-header",a_="column-footer",s_="column-title",N0="none",Du="all",P0="each",U0="flush",ji="column",qi="row";function l_(e){F.call(this,null,e)}function Eu(e,t,n){return t(e.bounds.clear(),e,n)}z(l_,F,{transform(e,t){const n=t.dataflow,i=e.mark,r=i.marktype,a=rn[r],s=a.bound;let l,o=i.bounds;if(a.nested)i.items.length&&n.dirty(i.items[0]),o=Eu(i,s),i.items.forEach(u=>{u.bounds.clear().union(o)});else if(r===Mu||e.modified())switch(t.visit(t.MOD,u=>n.dirty(u)),o.clear(),i.items.forEach(u=>o.union(Eu(u,s))),i.role){case O0:case z0:case L0:t.reflow()}else l=t.changed(t.REM),t.visit(t.ADD,u=>{o.union(Eu(u,s))}),t.visit(t.MOD,u=>{l=l||o.alignsWith(u.bounds),n.dirty(u),o.union(Eu(u,s))}),l&&(o.clear(),i.items.forEach(u=>o.union(u.bounds)));return function(e){const t=e.clip;if(ne(t))t(ou(B0.clear()));else{if(!t)return;B0.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(B0)}(i),t.modifies("bounds")}});const u_=":vega_identifier:";function j0(e){F.call(this,0,e)}function c_(e){F.call(this,null,e)}function f_(e){F.call(this,null,e)}j0.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},z(j0,F,{transform(e,t){const n=function(e){return e._signals[u_]||(e._signals[u_]=e.add(0))}(t.dataflow),i=e.as;let r=n.value;return t.visit(t.ADD,a=>a[i]=a[i]||++r),n.set(this.value=r),t}}),z(c_,F,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===Mu?Jd:Kd;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const h_={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((i,r)=>r&&d_(n.bounds,i.bounds,t)?i.opacity=0:(n=i,1))}},d_=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),g_=(e,t)=>{for(var a,n=1,i=e.length,r=e[0].bounds;n<i;r=a,++n)if(d_(r,a=e[n].bounds,t))return!0},g9=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},p_=e=>(e.forEach(t=>t.opacity=1),e),m_=(e,t)=>e.reflow(t.modified()).modifies("opacity");function y_(e){F.call(this,null,e)}z(f_,F,{transform(e,t){const n=h_[e.method]||h_.parity,i=e.separation||0;let a,s,r=t.materialize(t.SOURCE).source;if(!r||!r.length)return;if(!e.method)return e.modified("method")&&(p_(r),t=m_(t,e)),t;if(r=r.filter(g9),!r.length)return;if(e.sort&&(r=r.slice().sort(e.sort)),a=p_(r),t=m_(t,e),a.length>=3&&g_(a,i)){do{a=n(a,i)}while(a.length>=3&&g_(a,i));a.length<3&&!ce(r).opacity&&(a.length>1&&(ce(a).opacity=0),ce(r).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(s=((e,t,n)=>{var i=e.range(),r=new $e;return t===wa||t===Ui?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),a=>r.encloses(a.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),r.forEach(l=>{s(l)||(l.opacity=0)}));const o=a[0].mark.bounds.clear();return r.forEach(l=>{l.opacity&&o.union(l.bounds)}),t}}),z(y_,F,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,i=>n.dirty(i)),t.fields&&t.fields.zindex){const i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}}});const ot=new $e;function Ma(e,t,n){return e[t]===n?0:(e[t]=n,1)}function m9(e){var t=e.items[0].orient;return t===vn||t===xn}function v9(e,t,n,i){var b,w,r=t.items[0],a=r.datum,s=null!=r.translate?r.translate:.5,o=r.orient,l=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(a),u=r.range,c=r.offset,f=r.position,h=r.minExtent,d=r.maxExtent,g=a.title&&r.items[l[2]].items[0],p=r.titlePadding,m=r.bounds,y=g&&fb(g),v=0,x=0;switch(ot.clear().union(m),m.clear(),(b=l[0])>-1&&m.union(r.items[b].bounds),(b=l[1])>-1&&m.union(r.items[b].bounds),o){case wa:v=f||0,x=-c,w=Math.max(h,Math.min(d,-m.y1)),m.add(0,-w).add(u,0),g&&ku(e,g,w,p,y,0,-1,m);break;case vn:v=-c,x=f||0,w=Math.max(h,Math.min(d,-m.x1)),m.add(-w,0).add(0,u),g&&ku(e,g,w,p,y,1,-1,m);break;case xn:v=n+c,x=f||0,w=Math.max(h,Math.min(d,m.x2)),m.add(0,0).add(w,u),g&&ku(e,g,w,p,y,1,1,m);break;case Ui:v=f||0,x=i+c,w=Math.max(h,Math.min(d,m.y2)),m.add(0,0).add(u,w),g&&ku(e,g,w,p,0,0,1,m);break;default:v=r.x,x=r.y}return Oi(m.translate(v,x),r),Ma(r,"x",v+s)|Ma(r,"y",x+s)&&(r.bounds=ot,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function ku(e,t,n,i,r,a,s,o){const l=t.bounds;if(t.auto){const u=s*(n+r+i);let c=0,f=0;e.dirty(t),a?c=(t.x||0)-(t.x=u):f=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-c,-f)),e.dirty(t)}o.union(l)}const v_=(e,t)=>Math.floor(Math.min(e,t)),x_=(e,t)=>Math.ceil(Math.max(e,t));function b9(e){return(new $e).set(0,0,e.width||0,e.height||0)}function _9(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Se(e,t,n){const i=ee(e)?e[t]:e;return null!=i?i:void 0!==n?n:0}function b_(e){return e<0?Math.ceil(-e):0}function __(e,t,n){var M,_,E,A,D,k,T,S,L,C,O,i=!n.nodirty,r=n.bounds===U0?b9:_9,a=ot.set(0,0,0,0),s=Se(n.align,ji),o=Se(n.align,qi),l=Se(n.padding,ji),u=Se(n.padding,qi),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),h=t.length,d=Array(h),g=Array(c),p=0,m=Array(h),y=Array(f),v=0,x=Array(h),b=Array(h),w=Array(h);for(_=0;_<c;++_)g[_]=0;for(_=0;_<f;++_)y[_]=0;for(_=0;_<h;++_)D=w[_]=r(k=t[_]),k.x=k.x||0,x[_]=0,k.y=k.y||0,b[_]=0,E=_%c,A=~~(_/c),p=Math.max(p,T=Math.ceil(D.x2)),v=Math.max(v,S=Math.ceil(D.y2)),g[E]=Math.max(g[E],T),y[A]=Math.max(y[A],S),d[_]=l+b_(D.x1),m[_]=u+b_(D.y1),i&&e.dirty(t[_]);for(_=0;_<h;++_)_%c==0&&(d[_]=0),_<c&&(m[_]=0);if(s===P0)for(E=1;E<c;++E){for(O=0,_=E;_<h;_+=c)O<d[_]&&(O=d[_]);for(_=E;_<h;_+=c)d[_]=O+g[E-1]}else if(s===Du){for(O=0,_=0;_<h;++_)_%c&&O<d[_]&&(O=d[_]);for(_=0;_<h;++_)_%c&&(d[_]=O+p)}else for(s=!1,E=1;E<c;++E)for(_=E;_<h;_+=c)d[_]+=g[E-1];if(o===P0)for(A=1;A<f;++A){for(O=0,M=(_=A*c)+c;_<M;++_)O<m[_]&&(O=m[_]);for(_=A*c;_<M;++_)m[_]=O+y[A-1]}else if(o===Du){for(O=0,_=c;_<h;++_)O<m[_]&&(O=m[_]);for(_=c;_<h;++_)m[_]=O+v}else for(o=!1,A=1;A<f;++A)for(M=(_=A*c)+c;_<M;++_)m[_]+=y[A-1];for(L=0,_=0;_<h;++_)x[_]+=(L=d[_]+(_%c?L:0))-t[_].x;for(E=0;E<c;++E)for(C=0,_=E;_<h;_+=c)b[_]+=(C+=m[_])-t[_].y;if(s&&Se(n.center,ji)&&f>1)for(_=0;_<h;++_)(L=(D=s===Du?p:g[_%c])-w[_].x2-t[_].x-x[_])>0&&(x[_]+=L/2);if(o&&Se(n.center,qi)&&1!==c)for(_=0;_<h;++_)(C=(D=o===Du?v:y[~~(_/c)])-w[_].y2-t[_].y-b[_])>0&&(b[_]+=C/2);for(_=0;_<h;++_)a.union(w[_].translate(x[_],b[_]));switch(L=Se(n.anchor,"x"),C=Se(n.anchor,"y"),Se(n.anchor,ji)){case mt:L-=a.width();break;case R0:L-=a.width()/2}switch(Se(n.anchor,qi)){case mt:C-=a.height();break;case R0:C-=a.height()/2}for(L=Math.round(L),C=Math.round(C),a.clear(),_=0;_<h;++_)t[_].mark.bounds.clear();for(_=0;_<h;++_)(k=t[_]).x+=x[_]+=L,k.y+=b[_]+=C,a.union(k.mark.bounds.union(k.bounds.translate(x[_],b[_]))),i&&e.dirty(k);return a}function M9(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function D9(e,t){return e.bounds[t]}function Au(e,t,n,i,r,a,s,o,l,u,c,f,h,d){var y,v,x,b,w,M,_,E,A,g=n.length,p=0,m=0;if(!g)return p;for(y=c;y<g;y+=f)n[y]&&(p=s(p,l(n[y],u)));if(!t.length)return p;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),p+=a,v=0,b=t.length;v<b;++v)e.dirty(t[v]),t[v].mark.bounds.clear();for(y=c,v=0,b=t.length;v<b;++v,y+=f){for(w=(M=t[v]).mark.bounds,x=y;x>=0&&null==(_=n[x]);x-=h);o?(E=null==d?_.x:Math.round(_.bounds.x1+d*_.bounds.width()),A=p):(E=p,A=null==d?_.y:Math.round(_.bounds.y1+d*_.bounds.height())),w.union(M.bounds.translate(E-(M.x||0),A-(M.y||0))),M.x=E,M.y=A,e.dirty(M),m=s(m,w[u])}return m}function w_(e,t,n,i,r,a){if(t){e.dirty(t);var s=n,o=n;i?s=Math.round(r.x1+a*r.width()):o=Math.round(r.y1+a*r.height()),t.bounds.translate(s-(t.x||0),o-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=s,t.y=o,e.dirty(t)}}function A9(e,t,n,i,r,a,s){const o=function(e,t){const n=e[t]||{};return(i,r)=>null!=n[i]?n[i]:null!=e[i]?e[i]:r}(n,t),l=function(e,t){let n=-1/0;return e.forEach(i=>{null!=i.offset&&(n=Math.max(n,i.offset))}),n>-1/0?n:t}(e,o("offset",0)),u=o("anchor",I0),c=u===mt?1:u===R0?.5:0,f={align:P0,bounds:o("bounds",U0),columns:"vertical"===o("direction")?1:e.length,padding:o("margin",8),center:o("center"),nodirty:!0};switch(t){case vn:f.anchor={x:Math.floor(i.x1)-l,column:mt,y:c*(s||i.height()+2*i.y1),row:u};break;case xn:f.anchor={x:Math.ceil(i.x2)+l,y:c*(s||i.height()+2*i.y1),row:u};break;case wa:f.anchor={y:Math.floor(r.y1)-l,row:mt,x:c*(a||r.width()+2*r.x1),column:u};break;case Ui:f.anchor={y:Math.ceil(r.y2)+l,x:c*(a||r.width()+2*r.x1),column:u};break;case"top-left":f.anchor={x:l,y:l};break;case"top-right":f.anchor={x:a-l,y:l,column:mt};break;case"bottom-left":f.anchor={x:l,y:s-l,row:mt};break;case"bottom-right":f.anchor={x:a-l,y:s-l,column:mt,row:mt}}return f}function C9(e,t){var l,u,n=t.items[0],i=n.datum,r=n.orient,a=n.bounds,s=n.x,o=n.y;return n._bounds?n._bounds.clear().union(a):n._bounds=a.clone(),a.clear(),function(e,t,n){var i=t.padding,r=i-n.x,a=i-n.y;if(t.datum.title){var s=t.items[1].items[0],o=s.anchor,l=t.titlePadding||0,u=i-s.x,c=i-s.y;switch(s.orient){case vn:r+=Math.ceil(s.bounds.width())+l;break;case xn:case Ui:break;default:a+=s.bounds.height()+l}switch((r||a)&&Ks(e,n,r,a),s.orient){case vn:c+=Da(t,n,s,o,1,1);break;case xn:u+=Da(t,n,s,mt,0,0)+l,c+=Da(t,n,s,o,1,1);break;case Ui:u+=Da(t,n,s,o,0,0),c+=Da(t,n,s,mt,-1,0,1)+l;break;default:u+=Da(t,n,s,o,0,0)}(u||c)&&Ks(e,s,u,c),(u=Math.round(s.bounds.x1-i))<0&&(Ks(e,n,-u,0),Ks(e,s,-u,0))}else(r||a)&&Ks(e,n,r,a)}(e,n,n.items[0].items[0]),a=function(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}(n,a),l=2*n.padding,u=2*n.padding,a.empty()||(l=Math.ceil(a.width()+l),u=Math.ceil(a.height()+u)),"symbol"===i.type&&function(e){const t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}(n.items[0].items[0].items[0].items),r!==N0&&(n.x=s=0,n.y=o=0),n.width=l,n.height=u,Oi(a.set(s,o,s+l,o+u),n),n.mark.bounds.clear().union(a),n}function Da(e,t,n,i,r,a,s){const l=n.datum.vgrad,c=("symbol"===e.datum.type||!a&&l||s?t:t.items[0]).bounds[r?"y2":"x2"]-e.padding,f=l&&a?c:0,h=l&&a?0:c,d=r<=0?0:fb(n);return Math.round(i===I0?f:i===mt?h-d:.5*(c-d))}function Ks(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function M_(e){F.call(this,null,e)}function D_(e,t){let n=0;if(void 0===t)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function E_(e){F.call(this,null,e)}function k_(e){F.call(this,null,e)}function L9(){return xe({})}function A_(e){F.call(this,null,e)}function C_(e){F.call(this,[],e)}z(M_,F,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&function(e,t,n){var c,f,h,d,g,p,m,i=function(e){var r,a,t=e.items,n=t.length,i=0;const s={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(a=(r=t[i]).items,r.marktype===Mu)switch(r.role){case O0:case z0:case L0:break;case t_:s.rowheaders.push(...a);break;case n_:s.rowfooters.push(...a);break;case r_:s.colheaders.push(...a);break;case a_:s.colfooters.push(...a);break;case i_:s.rowtitle=a[0];break;case s_:s.coltitle=a[0];break;default:s.marks.push(...a)}return s}(t),r=i.marks,a=n.bounds===U0?M9:D9,s=n.offset,o=n.columns||r.length,l=o<=0?1:Math.ceil(r.length/o),u=l*o;const y=__(e,r,n);y.empty()&&y.set(0,0,0,0),i.rowheaders&&(p=Se(n.headerBand,qi,null),c=Au(e,i.rowheaders,r,0,l,-Se(s,"rowHeader"),v_,0,a,"x1",0,o,1,p)),i.colheaders&&(p=Se(n.headerBand,ji,null),f=Au(e,i.colheaders,r,0,o,-Se(s,"columnHeader"),v_,1,a,"y1",0,1,o,p)),i.rowfooters&&(p=Se(n.footerBand,qi,null),h=Au(e,i.rowfooters,r,0,l,Se(s,"rowFooter"),x_,0,a,"x2",o-1,o,1,p)),i.colfooters&&(p=Se(n.footerBand,ji,null),d=Au(e,i.colfooters,r,0,o,Se(s,"columnFooter"),x_,1,a,"y2",u-o,1,o,p)),i.rowtitle&&(g=Se(n.titleAnchor,qi),m=Se(s,"rowTitle"),m=g===mt?h+m:c-m,p=Se(n.titleBand,qi,.5),w_(e,i.rowtitle,m,0,y,p)),i.coltitle&&(g=Se(n.titleAnchor,ji),m=Se(s,"columnTitle"),m=g===mt?d+m:f-m,p=Se(n.titleBand,ji,.5),w_(e,i.coltitle,m,1,y,p))}(n,i,e.layout),function(e,t,n){var c,f,h,g,p,i=t.items,r=Math.max(0,t.width||0),a=Math.max(0,t.height||0),s=(new $e).set(0,0,r,a),o=s.clone(),l=s.clone(),u=[];for(g=0,p=i.length;g<p;++g)switch(f=i[g],f.role){case O0:(m9(f)?o:l).union(v9(e,f,r,a));break;case L0:c=f;break;case z0:u.push(C9(e,f));break;case"frame":case"scope":case t_:case n_:case i_:case r_:case a_:case s_:o.union(f.bounds),l.union(f.bounds);break;default:s.union(f.bounds)}if(u.length){const m={};u.forEach(y=>{(h=y.orient||xn)!==N0&&(m[h]||(m[h]=[])).push(y)});for(const y in m){const v=m[y];__(e,v,A9(v,y,n.legends,o,l,r,a))}u.forEach(y=>{const v=y.bounds;if(v.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=v,e.dirty(y)),n.autosize&&"fit"===n.autosize.type)switch(y.orient){case vn:case xn:s.add(v.x1,0).add(v.x2,0);break;case wa:case Ui:s.add(0,v.y1).add(0,v.y2)}else s.union(v)})}s.union(o).union(l),c&&s.union(function(e,t,n,i,r){var x,a=t.items[0],o=a.orient,l=a.anchor,u=a.offset,c=a.padding,f=a.items[0].items[0],h=a.items[1]&&a.items[1].items[0],d=o===vn||o===xn?i:n,g=0,p=0,m=0,y=0,v=0;if(a.frame!==Mu?o===vn?(g=r.y2,d=r.y1):o===xn?(g=r.y1,d=r.y2):(g=r.x1,d=r.x2):o===vn&&(g=i,d=0),x=l===I0?g:l===mt?d:(g+d)/2,h&&h.text){switch(o){case wa:case Ui:v=f.bounds.height()+c;break;case vn:y=f.bounds.width()+c;break;case xn:y=-f.bounds.width()-c}ot.clear().union(h.bounds),ot.translate(y-(h.x||0),v-(h.y||0)),Ma(h,"x",y)|Ma(h,"y",v)&&(e.dirty(h),h.bounds.clear().union(ot),h.mark.bounds.clear().union(ot),e.dirty(h)),ot.clear().union(h.bounds)}else ot.clear();switch(ot.union(f.bounds),o){case wa:p=x,m=r.y1-ot.height()-u;break;case vn:p=r.x1-ot.width()-u,m=x;break;case xn:p=r.x2+ot.width()+u,m=x;break;case Ui:p=x,m=r.y2+u;break;default:p=a.x,m=a.y}return Ma(a,"x",p)|Ma(a,"y",m)&&(ot.translate(p,m),e.dirty(a),a.bounds.clear().union(ot),t.bounds.clear().union(ot),e.dirty(a)),a.bounds}(e,c,r,a,s)),t.clip&&s.set(0,0,t.width||0,t.height||0),function(e,t,n,i){const r=i.autosize||{},a=r.type;if(e._autosize<1||!a)return;let s=e._width,o=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-l)),d=Math.max(0,Math.ceil(n.y2-c));if("padding"===r.contains){const g=e.padding();s-=g.left+g.right,o-=g.top+g.bottom}a===N0?(u=0,f=0,l=s,c=o):"fit"===a?(l=Math.max(0,s-u-h),c=Math.max(0,o-f-d)):"fit-x"===a?(l=Math.max(0,s-u-h),o=c+f+d):"fit-y"===a?(s=l+u+h,c=Math.max(0,o-f-d)):"pad"===a&&(s=l+u+h,o=c+f+d),e._resizeView(s,o,l,c,[u,f],r.resize)}(e,t,s,n)}(n,i,e)}),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}}),z(E_,F,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.scale,o=qd(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),l=e.format||D2(n,a,o,e.formatSpecifier,e.formatType,!!e.values),u=e.values?M2(a,e.values,o):Vd(a,o);return r&&(i.rem=r),r=u.map((c,f)=>xe({index:f/(u.length-1||1),value:c,label:l(c)})),e.extra&&r.length&&r.push(xe({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}}),z(k_,F,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||L9,a=e.key||Y,s=this.value;return $(i.encode)&&(i.encode=null),s&&(e.modified("key")||t.modified(a))&&I("DataJoin does not support modified key function or fields."),s||(t=t.addAll(),this.value=s=function(e){const t=Ya().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,o=>{const l=a(o);let u=s.get(l);u?u.exit?(s.empty--,i.add.push(u)):i.mod.push(u):(u=r(o),s.set(l,u),i.add.push(u)),u.datum=o,u.exit=!1}),t.visit(t.MOD,o=>{const l=a(o),u=s.get(l);u&&(u.datum=o,i.mod.push(u))}),t.visit(t.REM,o=>{const l=a(o),u=s.get(l);o===u.datum&&!u.exit&&(i.rem.push(u),u.exit=!0,++s.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&s.empty>n.cleanThreshold)&&n.runAfter(s.clean),i}}),z(A_,F,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,a=t.encode;if($(a)){if(!n.changed()&&!a.every(f=>r[f]))return t.StopPropagation;a=a[0],n.encode=null}var s="enter"===a,o=r.update||Qi,l=r.enter||Qi,u=r.exit||Qi,c=(a&&!s?r[a]:o)||Qi;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{l(f,e),o(f,e)}),n.modifies(l.output),n.modifies(o.output),c!==Qi&&c!==o&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==Qi&&(t.visit(t.REM,f=>{u(f,e)}),n.modifies(u.output)),s||c!==Qi){const f=t.MOD|(e.modified()?t.REFLOW:0);s?(t.visit(f,h=>{const d=l(h,e)||i;(c(h,e)||d)&&n.mod.push(h)}),n.mod.length&&n.modifies(l.output)):t.visit(f,h=>{(c(h,e)||i)&&n.mod.push(h)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),z(C_,F,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var h,d,g,p,m,n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.type||Kl,s=e.scale,o=+e.limit,l=qd(s,null==e.count?5:e.count,e.minstep),c=e.format||C2(n,s,l,a,e.formatSpecifier,e.formatType,!!e.values||a===Kl),f=e.values||A2(s,l);return r&&(i.rem=r),a===Kl?(o&&f.length>o?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,o-1),m=!0):r=f,ne(g=e.size)?(!e.values&&0===s(r[0])&&(r=r.slice(1)),p=r.reduce((y,v)=>Math.max(y,g(v,e)),0)):g=ht(p=g||8),r=r.map((y,v)=>xe({index:v,label:c(y,v,r),value:y,offset:p,size:g(y,e)})),m&&(m=f[r.length],r.push(xe({index:r.length,label:"\u2026".concat(f.length-r.length," entries"),value:m,offset:p,size:g(m,e)})))):"gradient"===a?(h=s.domain(),d=y2(s,h[0],ce(h)),f.length<3&&!e.values&&h[0]!==ce(h)&&(f=[h[0],ce(h)]),r=f.map((y,v)=>xe({index:v,label:c(y,v,f),value:y,perc:d(y)}))):(g=f.length-1,d=function(e){const t=e.domain(),n=t.length-1;let i=+t[0],r=+ce(t),a=r-i;if(e.type===Xl){const s=n?a/n:.1;i-=s,r+=s,a=r-i}return s=>(s-i)/a}(s),r=f.map((y,v)=>xe({index:v,label:c(y,v,f),value:y,perc:v?d(y):0,perc2:v===g?1:d(f[v+1])}))),i.source=r,i.add=r,this.value=r,i}});const N9=e=>e.source.x,P9=e=>e.source.y,U9=e=>e.target.x,j9=e=>e.target.y;function q0(e){F.call(this,{},e)}q0.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},z(q0,F,{transform(e,t){var n=e.sourceX||N9,i=e.sourceY||P9,r=e.targetX||U9,a=e.targetY||j9,s=e.as||"path",l=e.shape||"line",u=B_.get(l+"-"+(e.orient||"vertical"))||B_.get(l);return u||I("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[s]=u(n(c),i(c),r(c),a(c))}),t.reflow(e.modified()).modifies(s)}});const S_=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,T_=(e,t,n,i)=>{var r=n-e,a=i-t,s=Math.sqrt(r*r+a*a)/2;return"M"+e+","+t+"A"+s+","+s+" "+180*Math.atan2(a,r)/Math.PI+" 0 1 "+n+","+i},F_=(e,t,n,i)=>{const r=n-e,a=i-t,s=.2*(r+a),o=.2*(a-r);return"M"+e+","+t+"C"+(e+s)+","+(t+o)+" "+(n+o)+","+(i-s)+" "+n+","+i},B_=Ya({line:S_,"line-radial":(e,t,n,i)=>S_(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),arc:T_,"arc-radial":(e,t,n,i)=>T_(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),curve:F_,"curve-radial":(e,t,n,i)=>F_(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),"orthogonal-horizontal":(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,"orthogonal-vertical":(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,"orthogonal-radial":(e,t,n,i)=>{const r=Math.cos(e),a=Math.sin(e),s=Math.cos(n),o=Math.sin(n);return"M"+t*r+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*s+","+t*o+"L"+i*s+","+i*o},"diagonal-horizontal":(e,t,n,i)=>{const r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i},"diagonal-vertical":(e,t,n,i)=>{const r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i},"diagonal-radial":(e,t,n,i)=>{const r=Math.cos(e),a=Math.sin(e),s=Math.cos(n),o=Math.sin(n),l=(t+i)/2;return"M"+t*r+","+t*a+"C"+l*r+","+l*a+" "+l*s+","+l*o+" "+i*s+","+i*o}});function V0(e){F.call(this,null,e)}function I_(e){return Pd(e)&&e!==zn}V0.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},z(V0,F,{transform(e,t){var g,p,m,n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],s=e.startAngle||0,o=null!=e.endAngle?e.endAngle:2*Math.PI,l=t.source,u=l.map(e.field||Ga),c=u.length,f=s,h=(o-s)/D_(u),d=qt(c);for(e.sort&&d.sort((y,v)=>u[y]-u[v]),g=0;g<c;++g)m=u[d[g]],(p=l[d[g]])[i]=f,p[r]=f+=m*h;return this.value=u,t.reflow(e.modified()).modifies(n)}});const Y9=Sn(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function R_(e){F.call(this,null,e),this.modified(!0)}function O_(e,t,n){return g2(e)&&Math.abs(t.reduce((r,a)=>r+(a<0?-1:a>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+W(t)),t}function L_(e,t,n){return ne(e)&&(t||n)?function(e,t){const n=t[0],i=ce(t)-n;return function(r){return e(n+r*i)}}(e,$0(t||[0,1],n)):e}function $0(e,t){return t?e.slice().reverse():e}function z_(e){F.call(this,null,e)}z(R_,F,{transform(e,t){var n=t.dataflow,i=this.value,r=function(e){var i,t=e.type,n="";return t===zn?zn+"-"+da:(function(e){const t=e.type;return Pd(t)&&t!==gr&&t!==pr&&(e.scheme||e.range&&e.range.length&&e.range.every(ke))}(e)&&(n=2===(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?zn+"-":3===i?ga+"-":""),(n+t||da).toLowerCase())}(e);for(r in(!i||r!==i.type)&&(this.value=i=ve(r)()),e)if(!Y9[r]){if("padding"===r&&I_(i.type))continue;ne(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return function(e,t,n){var i=e.type,r=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){return"band"!==e&&e!==Od&&I("Only band and point scales support rangeStep."),[0,t.rangeStep*Id(n,e===Od?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0,(null!=t.paddingOuter?t.paddingOuter:t.padding)||0)]}(i,t,n);else if(t.scheme&&ne(a=function(e,t,n){var a,i=t.schemeExtent;return $(t.scheme)?a=jd(t.scheme,t.interpolate,t.interpolateGamma):(a=w2(t.scheme.toLowerCase()))||I("Unrecognized scheme name: ".concat(t.scheme)),n=e===Xl?n+1:e===Ld?n-1:e===pa||e===Hl?+t.schemeCount||5:n,p2(e)?L_(a,i,t.reverse):ne(a)?function(e,t){const n=new Array(t),i=t+1;for(let r=0;r<t;)n[r]=e(++r/i);return n}(L_(a,i),n):e===Rd?a:a.slice(0,n)}(i,t,n))){if(e.interpolator)return e.interpolator(a);I("Scale type ".concat(i," does not support interpolating color schemes."))}if(a&&p2(i))return e.interpolator(jd($0(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(v2(t.interpolate,t.interpolateGamma)):ne(e.round)?e.round(r):ne(e.rangeRound)&&e.interpolate(r?Cs:Fi),a&&e.range($0(a,t.reverse))}(i,e,function(e,t,n){let i=t.bins;if(i&&!$(i)){const r=e.domain(),a=r[0],s=ce(r),o=i.step;let l=null==i.start?a:i.start,u=null==i.stop?s:i.stop;o||I("Scale bins parameter missing step property."),l<a&&(l=o*Math.ceil(a/o)),u>s&&(u=o*Math.floor(s/o)),i=qt(l,u+o/2,o)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Ld&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}(i,e,function(e,t,n){const i=function(e,t,n){return t?(e.domain(O_(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(i>-1)return i;var o,l,r=t.domain,a=e.type,s=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===da||t===Fs||t===Bs)}(e);if(!r)return 0;if(I_(a)&&t.padding&&r[0]!==ce(r)&&(r=function(e,t,n,i,r,a){var s=Math.abs(ce(n)-n[0]),o=s/(s-2*i),l=e===ti?Gm(t,null,o):e===Bs?ff(t,null,o,.5):e===Fs?ff(t,null,o,r||1):e===Wl?Ym(t,null,o,a||1):$m(t,null,o);return(t=t.slice())[0]=l[0],t[t.length-1]=l[1],t}(a,r,t.range,t.padding,t.exponent,t.constant)),(s||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(o=(r=r.slice()).length-1||1,s&&(r[0]>0&&(r[0]=0),r[o]<0&&(r[o]=0)),null!=t.domainMin&&(r[0]=t.domainMin),null!=t.domainMax&&(r[o]=t.domainMax),null!=t.domainMid)){const u=(l=t.domainMid)>r[o]?o+1:l<r[0]?0:o;u!==o&&n.warn("Scale domainMid exceeds domain min or max.",l),r.splice(u,0,l)}return e.domain(O_(a,r,n)),a===Rd&&e.unknown(t.domainImplicit?ad:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&qd(e,t.nice)||null),r.length}(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),z(z_,F,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(sr(e.sort)),this.modified(n),t}});const U_="normalize",j_=["y0","y1"];function G0(e){F.call(this,null,e)}function nF(e,t,n,i,r){for(var l,a=(t-e.sum)/2,s=e.length,o=0;o<s;++o)(l=e[o])[i]=a,l[r]=a+=Math.abs(n(l))}function iF(e,t,n,i,r){for(var c,a=1/e.sum,s=0,o=e.length,l=0,u=0;l<o;++l)(c=e[l])[i]=s,c[r]=s=a*(u+=Math.abs(n(c)))}function rF(e,t,n,i,r){for(var u,c,a=0,s=0,o=e.length,l=0;l<o;++l)(u=+n(c=e[l]))<0?(c[i]=s,c[r]=s+=u):(c[i]=a,c[r]=a+=u)}G0.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center",U_]},{name:"as",type:"string",array:!0,length:2,default:j_}]},z(G0,F,{transform(e,t){var l,u,c,f,n=e.as||j_,i=n[0],r=n[1],a=sr(e.sort),s=e.field||Ga,o="center"===e.offset?nF:e.offset===U_?iF:rF;for(l=function(e,t,n,i){var s,o,l,u,c,f,h,d,g,r=[],a=p=>p(c);if(null==t)r.push(e.slice());else for(s={},o=0,l=e.length;o<l;++o)c=e[o],(h=s[f=t.map(a)])||(s[f]=h=[],r.push(h)),h.push(c);for(f=0,g=0,u=r.length;f<u;++f){for(o=0,d=0,l=(h=r[f]).length;o<l;++o)d+=Math.abs(i(h[o]));h.sum=d,d>g&&(g=d),n&&h.sort(n)}return r.max=g,r}(t.source,e.groupby,a,s),u=0,c=l.length,f=l.max;u<c;++u)o(l[u],f,s,i,r);return t.reflow(e.modified()).modifies(n)}});const Js=e=>e;function Cu(e,t){e&&V_.hasOwnProperty(e.type)&&V_[e.type](e,t)}var q_={Feature:function(e,t){Cu(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)Cu(n[i].geometry,t)}},V_={Sphere:function(e,t){t.sphere()},Point:function(e,t){t.point((e=e.coordinates)[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)t.point((e=n[i])[0],e[1],e[2])},LineString:function(e,t){Y0(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Y0(n[i],t,0)},Polygon:function(e,t){$_(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)$_(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)Cu(n[i],t)}};function Y0(e,t,n){var a,i=-1,r=e.length-n;for(t.lineStart();++i<r;)t.point((a=e[i])[0],a[1],a[2]);t.lineEnd()}function $_(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Y0(e[n],t,1);t.polygonEnd()}function oi(e,t){e&&q_.hasOwnProperty(e.type)?q_[e.type](e,t):Cu(e,t)}class Je{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const a=n[r],s=t+a,o=Math.abs(t)<Math.abs(a)?t-(s-a):a-(s-t);o&&(n[i++]=o),t=s}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let i,r,a,n=this._n,s=0;if(n>0){for(s=t[--n];n>0&&(i=s,r=t[--n],s=i+r,a=r-(s-i),!a););n>0&&(a<0&&t[n-1]<0||a>0&&t[n-1]>0)&&(r=2*a,i=s+r,r==i-s&&(s=i))}return s}}var H=1e-6,Su=1e-12,ie=Math.PI,Be=ie/2,Tu=ie/4,yt=2*ie,Oe=180/ie,re=ie/180,he=Math.abs,Ea=Math.atan,an=Math.atan2,X=Math.cos,Fu=Math.ceil,G_=Math.exp,W0=(Math,Math.hypot),Bu=Math.log,H0=Math.pow,V=Math.sin,sn=Math.sign||function(e){return e>0?1:e<0?-1:0},vt=Math.sqrt,X0=Math.tan;function Y_(e){return e>1?0:e<-1?ie:Math.acos(e)}function Bt(e){return e>1?Be:e<-1?-Be:Math.asin(e)}function Qe(){}var W_,H_,J0,Q0,Z0=new Je,K0=new Je,Vi={point:Qe,lineStart:Qe,lineEnd:Qe,polygonStart:function(){Vi.lineStart=sF,Vi.lineEnd=lF},polygonEnd:function(){Vi.lineStart=Vi.lineEnd=Vi.point=Qe,Z0.add(he(K0)),K0=new Je},result:function(){var e=Z0/2;return Z0=new Je,e}};function sF(){Vi.point=oF}function oF(e,t){Vi.point=X_,W_=J0=e,H_=Q0=t}function X_(e,t){K0.add(Q0*e-J0*t),J0=e,Q0=t}function lF(){X_(W_,H_)}const Z_=Vi;var ka=1/0,Iu=ka,Qs=-ka,Ru=Qs,uF={point:function(e,t){e<ka&&(ka=e),e>Qs&&(Qs=e),t<Iu&&(Iu=t),t>Ru&&(Ru=t)},lineStart:Qe,lineEnd:Qe,polygonStart:Qe,polygonEnd:Qe,result:function(){var e=[[ka,Iu],[Qs,Ru]];return Qs=Ru=-(Iu=ka=1/0),e}};const Ou=uF;var K_,J_,qn,Vn,eg=0,tg=0,eo=0,Lu=0,zu=0,Aa=0,ng=0,ig=0,to=0,bn={point:kr,lineStart:Q_,lineEnd:ew,polygonStart:function(){bn.lineStart=dF,bn.lineEnd=gF},polygonEnd:function(){bn.point=kr,bn.lineStart=Q_,bn.lineEnd=ew},result:function(){var e=to?[ng/to,ig/to]:Aa?[Lu/Aa,zu/Aa]:eo?[eg/eo,tg/eo]:[NaN,NaN];return eg=tg=eo=Lu=zu=Aa=ng=ig=to=0,e}};function kr(e,t){eg+=e,tg+=t,++eo}function Q_(){bn.point=fF}function fF(e,t){bn.point=hF,kr(qn=e,Vn=t)}function hF(e,t){var n=e-qn,i=t-Vn,r=vt(n*n+i*i);Lu+=r*(qn+e)/2,zu+=r*(Vn+t)/2,Aa+=r,kr(qn=e,Vn=t)}function ew(){bn.point=kr}function dF(){bn.point=pF}function gF(){tw(K_,J_)}function pF(e,t){bn.point=tw,kr(K_=qn=e,J_=Vn=t)}function tw(e,t){var n=e-qn,i=t-Vn,r=vt(n*n+i*i);Lu+=r*(qn+e)/2,zu+=r*(Vn+t)/2,Aa+=r,ng+=(r=Vn*e-qn*t)*(qn+e),ig+=r*(Vn+t),to+=3*r,kr(qn=e,Vn=t)}const nw=bn;function iw(e){this._context=e}iw.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,yt)}},result:Qe};var ag,rw,aw,no,io,rg=new Je,Nu={point:Qe,lineStart:function(){Nu.point=mF},lineEnd:function(){ag&&sw(rw,aw),Nu.point=Qe},polygonStart:function(){ag=!0},polygonEnd:function(){ag=null},result:function(){var e=+rg;return rg=new Je,e}};function mF(e,t){Nu.point=sw,rw=no=e,aw=io=t}function sw(e,t){rg.add(vt((no-=e)*no+(io-=t)*io)),no=e,io=t}const ow=Nu;function lw(){this._string=[]}function uw(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function cw(e,t){var i,r,n=4.5;function a(s){return s&&("function"==typeof n&&r.pointRadius(+n.apply(this,arguments)),oi(s,i(r))),r.result()}return a.area=function(s){return oi(s,i(Z_)),Z_.result()},a.measure=function(s){return oi(s,i(ow)),ow.result()},a.bounds=function(s){return oi(s,i(Ou)),Ou.result()},a.centroid=function(s){return oi(s,i(nw)),nw.result()},a.projection=function(s){return arguments.length?(i=null==s?(e=null,Js):(e=s).stream,a):e},a.context=function(s){return arguments.length?(r=null==s?(t=null,new lw):new iw(t=s),"function"!=typeof n&&r.pointRadius(n),a):t},a.pointRadius=function(s){return arguments.length?(n="function"==typeof s?s:(r.pointRadius(+s),+s),a):n},a.projection(e).context(t)}function fw(){var t,e=[];return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:Qe,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Pu(e,t){return he(e[0]-t[0])<H&&he(e[1]-t[1])<H}function Uu(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function hw(e,t,n,i,r){var o,l,a=[],s=[];if(e.forEach(function(g){if(!((p=g.length-1)<=0)){var p,v,m=g[0],y=g[p];if(Pu(m,y)){if(!m[2]&&!y[2]){for(r.lineStart(),o=0;o<p;++o)r.point((m=g[o])[0],m[1]);return void r.lineEnd()}y[0]+=2*H}a.push(v=new Uu(m,g,null,!0)),s.push(v.o=new Uu(m,null,v,!1)),a.push(v=new Uu(y,g,null,!1)),s.push(v.o=new Uu(y,null,v,!0))}}),a.length){for(s.sort(t),dw(a),dw(s),o=0,l=s.length;o<l;++o)s[o].e=n=!n;for(var c,f,u=a[0];;){for(var h=u,d=!0;h.v;)if((h=h.n)===u)return;c=h.z,r.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(o=0,l=c.length;o<l;++o)r.point((f=c[o])[0],f[1]);else i(h.x,h.n.x,1,r);h=h.n}else{if(d)for(o=(c=h.p.z).length-1;o>=0;--o)r.point((f=c[o])[0],f[1]);else i(h.x,h.p.x,-1,r);h=h.p}c=(h=h.o).z,d=!d}while(!h.v);r.lineEnd()}}}function dw(e){if(t=e.length){for(var t,r,n=0,i=e[0];++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function ju(e){return[an(e[1],e[0]),Bt(e[2])]}function Ar(e){var t=e[0],n=e[1],i=X(n);return[i*X(t),i*V(t),V(n)]}function qu(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ca(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function sg(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Vu(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function $u(e){var t=vt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function og(e){return he(e[0])<=ie?e[0]:sn(e[0])*((he(e[0])+ie)%yt-ie)}function gw(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function pw(e,t,n,i){return function(r){var u,c,f,a=t(r),s=fw(),o=t(s),l=!1,h={point:d,lineStart:p,lineEnd:m,polygonStart:function(){h.point=y,h.lineStart=v,h.lineEnd=x,c=[],u=[]},polygonEnd:function(){h.point=d,h.lineStart=p,h.lineEnd=m,c=gw(c);var b=function(e,t){var n=og(t),i=t[1],r=V(i),a=[V(n),-X(n),0],s=0,o=0,l=new Je;1===r?i=Be+H:-1===r&&(i=-Be-H);for(var u=0,c=e.length;u<c;++u)if(h=(f=e[u]).length)for(var f,h,d=f[h-1],g=og(d),p=d[1]/2+Tu,m=V(p),y=X(p),v=0;v<h;++v,g=b,m=M,y=_,d=x){var x=f[v],b=og(x),w=x[1]/2+Tu,M=V(w),_=X(w),E=b-g,A=E>=0?1:-1,D=A*E,k=D>ie,T=m*M;if(l.add(an(T*A*V(D),y*_+T*X(D))),s+=k?E+A*yt:E,k^g>=n^b>=n){var S=Ca(Ar(d),Ar(x));$u(S);var L=Ca(a,S);$u(L);var C=(k^E>=0?-1:1)*Bt(L[2]);(i>C||i===C&&(S[0]||S[1]))&&(o+=k^E>=0?1:-1)}}return(s<-H||s<H&&l<-Su)^1&o}(u,i);c.length?(l||(r.polygonStart(),l=!0),hw(c,bF,b,n,r)):b&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),c=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(b,w){e(b,w)&&r.point(b,w)}function g(b,w){a.point(b,w)}function p(){h.point=g,a.lineStart()}function m(){h.point=d,a.lineEnd()}function y(b,w){f.push([b,w]),o.point(b,w)}function v(){o.lineStart(),f=[]}function x(){y(f[0][0],f[0][1]),o.lineEnd();var M,E,A,D,b=o.clean(),w=s.result(),_=w.length;if(f.pop(),u.push(f),f=null,_){if(1&b){if((E=(A=w[0]).length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),M=0;M<E;++M)r.point((D=A[M])[0],D[1]);r.lineEnd()}return}_>1&&2&b&&w.push(w.pop().concat(w.shift())),c.push(w.filter(xF))}}return h}}function xF(e){return e.length>1}function bF(e,t){return((e=e.x)[0]<0?e[1]-Be-H:Be-e[1])-((t=t.x)[0]<0?t[1]-Be-H:Be-t[1])}lw.prototype={_radius:4.5,_circle:uw(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=uw(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};const mw=pw(function(){return!0},function(e){var r,t=NaN,n=NaN,i=NaN;return{lineStart:function(){e.lineStart(),r=1},point:function(a,s){var o=a>0?ie:-ie,l=he(a-t);he(l-ie)<H?(e.point(t,n=(n+s)/2>0?Be:-Be),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(o,n),e.point(a,n),r=0):i!==o&&l>=ie&&(he(t-i)<H&&(t-=i*H),he(a-o)<H&&(a-=o*H),n=function(e,t,n,i){var r,a,s=V(e-n);return he(s)>H?Ea((V(t)*(a=X(i))*V(n)-V(i)*(r=X(t))*V(e))/(r*a*s)):(t+i)/2}(t,n,a,s),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(o,n),r=0),e.point(t=a,n=s),i=o},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}},function(e,t,n,i){var r;if(null==e)i.point(-ie,r=n*Be),i.point(0,r),i.point(ie,r),i.point(ie,0),i.point(ie,-r),i.point(0,-r),i.point(-ie,-r),i.point(-ie,0),i.point(-ie,r);else if(he(e[0]-t[0])>H){var a=e[0]<t[0]?ie:-ie;i.point(-a,r=n*a/2),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])},[-ie,-Be]);function vw(e,t){(t=Ar(t))[0]-=e,$u(t);var n=Y_(-t[1]);return((-t[2]<0?-n:n)+yt-H)%yt}function DF(e){var t=X(e),n=6*re,i=t>0,r=he(t)>H;function s(c,f){return X(c)*X(f)>t}function l(c,f,h){var p=[1,0,0],m=Ca(Ar(c),Ar(f)),y=qu(m,m),v=m[0],x=y-v*v;if(!x)return!h&&c;var b=t*y/x,w=-t*v/x,M=Ca(p,m),_=Vu(p,b);sg(_,Vu(m,w));var A=M,D=qu(_,A),k=qu(A,A),T=D*D-k*(qu(_,_)-1);if(!(T<0)){var S=vt(T),L=Vu(A,(-D-S)/k);if(sg(L,_),L=ju(L),!h)return L;var Z,C=c[0],O=f[0],P=c[1],U=f[1];O<C&&(Z=C,C=O,O=Z);var oe=O-C,Ce=he(oe-ie)<H;if(!Ce&&U<P&&(Z=P,P=U,U=Z),Ce||oe<H?Ce?P+U>0^L[1]<(he(L[0]-C)<H?P:U):P<=L[1]&&L[1]<=U:oe>ie^(C<=L[0]&&L[0]<=O)){var kt=Vu(A,(-D+S)/k);return sg(kt,_),[L,ju(kt)]}}}function u(c,f){var h=i?e:ie-e,d=0;return c<-h?d|=1:c>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return pw(s,function(c){var f,h,d,g,p;return{lineStart:function(){g=d=!1,p=1},point:function(m,y){var x,v=[m,y],b=s(m,y),w=i?b?0:u(m,y):b?u(m+(m<0?ie:-ie),y):0;if(!f&&(g=d=b)&&c.lineStart(),b!==d&&(!(x=l(f,v))||Pu(f,x)||Pu(v,x))&&(v[2]=1),b!==d)p=0,b?(c.lineStart(),x=l(v,f),c.point(x[0],x[1])):(x=l(f,v),c.point(x[0],x[1],2),c.lineEnd()),f=x;else if(r&&f&&i^b){var M;!(w&h)&&(M=l(v,f,!0))&&(p=0,i?(c.lineStart(),c.point(M[0][0],M[0][1]),c.point(M[1][0],M[1][1]),c.lineEnd()):(c.point(M[1][0],M[1][1]),c.lineEnd(),c.lineStart(),c.point(M[0][0],M[0][1],3)))}b&&(!f||!Pu(f,v))&&c.point(v[0],v[1]),f=v,d=b,h=w},lineEnd:function(){d&&c.lineEnd(),f=null},clean:function(){return p|(g&&d)<<1}}},function(c,f,h,d){!function(e,t,n,i,r,a){if(n){var s=X(t),o=V(t),l=i*n;null==r?(r=t+i*yt,a=t-l/2):(r=vw(s,r),a=vw(s,a),(i>0?r<a:r>a)&&(r+=i*yt));for(var u,c=r;i>0?c>a:c<a;c-=l)u=ju([s,-o*X(c),-o*V(c)]),e.point(u[0],u[1])}}(d,e,n,h,c,f)},i?[0,-e]:[-ie,e-ie])}var ro=1e9,Gu=-ro;function xw(e,t,n,i){function r(u,c){return e<=u&&u<=n&&t<=c&&c<=i}function a(u,c,f,h){var d=0,g=0;if(null==u||(d=s(u,f))!==(g=s(c,f))||l(u,c)<0^f>0)do{h.point(0===d||3===d?e:n,d>1?i:t)}while((d=(d+f+4)%4)!==g);else h.point(c[0],c[1])}function s(u,c){return he(u[0]-e)<H?c>0?0:3:he(u[0]-n)<H?c>0?2:1:he(u[1]-t)<H?c>0?1:0:c>0?3:2}function o(u,c){return l(u.x,c.x)}function l(u,c){var f=s(u,1),h=s(c,1);return f!==h?f-h:0===f?c[1]-u[1]:1===f?u[0]-c[0]:2===f?u[1]-c[1]:c[0]-u[0]}return function(u){var h,d,g,p,m,y,v,x,b,w,M,c=u,f=fw(),_={point:E,lineStart:function(){_.point=L,d&&d.push(g=[]),w=!0,b=!1,v=x=NaN},lineEnd:function(){h&&(L(p,m),y&&b&&f.rejoin(),h.push(f.result())),_.point=E,b&&c.lineEnd()},polygonStart:function(){c=f,h=[],d=[],M=!0},polygonEnd:function(){var C=function(){for(var C=0,O=0,P=d.length;O<P;++O)for(var Te,kt,U=d[O],Z=1,oe=U.length,Ce=U[0],ct=Ce[0],fn=Ce[1];Z<oe;++Z)Te=ct,kt=fn,ct=(Ce=U[Z])[0],fn=Ce[1],kt<=i?fn>i&&(ct-Te)*(i-kt)>(fn-kt)*(e-Te)&&++C:fn<=i&&(ct-Te)*(i-kt)<(fn-kt)*(e-Te)&&--C;return C}(),O=M&&C,P=(h=gw(h)).length;(O||P)&&(u.polygonStart(),O&&(u.lineStart(),a(null,null,1,u),u.lineEnd()),P&&hw(h,o,C,a,u),u.polygonEnd()),c=u,h=d=g=null}};function E(C,O){r(C,O)&&c.point(C,O)}function L(C,O){var P=r(C,O);if(d&&g.push([C,O]),w)p=C,m=O,y=P,w=!1,P&&(c.lineStart(),c.point(C,O));else if(P&&b)c.point(C,O);else{var U=[v=Math.max(Gu,Math.min(ro,v)),x=Math.max(Gu,Math.min(ro,x))],Z=[C=Math.max(Gu,Math.min(ro,C)),O=Math.max(Gu,Math.min(ro,O))];!function(e,t,n,i,r,a){var g,s=e[0],o=e[1],c=0,f=1,h=t[0]-s,d=t[1]-o;if(g=n-s,h||!(g>0)){if(g/=h,h<0){if(g<c)return;g<f&&(f=g)}else if(h>0){if(g>f)return;g>c&&(c=g)}if(g=r-s,h||!(g<0)){if(g/=h,h<0){if(g>f)return;g>c&&(c=g)}else if(h>0){if(g<c)return;g<f&&(f=g)}if(g=i-o,d||!(g>0)){if(g/=d,d<0){if(g<c)return;g<f&&(f=g)}else if(d>0){if(g>f)return;g>c&&(c=g)}if(g=a-o,d||!(g<0)){if(g/=d,d<0){if(g>f)return;g>c&&(c=g)}else if(d>0){if(g<c)return;g<f&&(f=g)}return c>0&&(e[0]=s+c*h,e[1]=o+c*d),f<1&&(t[0]=s+f*h,t[1]=o+f*d),!0}}}}}(U,Z,e,t,n,i)?P&&(c.lineStart(),c.point(C,O),M=!1):(b||(c.lineStart(),c.point(U[0],U[1])),c.point(Z[0],Z[1]),P||c.lineEnd(),M=!1)}v=C,x=O,b=P}return _}}function lg(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return(i=t.invert(i,r))&&e.invert(i[0],i[1])}),n}function ug(e,t){return[he(e)>ie?e+Math.round(-e/yt)*yt:e,t]}function bw(e,t,n){return(e%=yt)?t||n?lg(ww(e),Mw(t,n)):ww(e):t||n?Mw(t,n):ug}function _w(e){return function(t,n){return[(t+=e)>ie?t-yt:t<-ie?t+yt:t,n]}}function ww(e){var t=_w(e);return t.invert=_w(-e),t}function Mw(e,t){var n=X(e),i=V(e),r=X(t),a=V(t);function s(o,l){var u=X(l),c=X(o)*u,f=V(o)*u,h=V(l),d=h*n+c*i;return[an(f*r-d*a,c*n-h*i),Bt(d*r+f*a)]}return s.invert=function(o,l){var u=X(l),c=X(o)*u,f=V(o)*u,h=V(l),d=h*r-f*a;return[an(f*r+h*a,c*n+d*i),Bt(d*n-c*i)]},s}function ao(e){return function(t){var n=new cg;for(var i in e)n[i]=e[i];return n.stream=t,n}}function cg(){}function fg(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=i&&e.clipExtent(null),oi(n,e.stream(Ou)),t(Ou.result()),null!=i&&e.clipExtent(i),e}function Yu(e,t,n){return fg(e,function(i){var r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],s=Math.min(r/(i[1][0]-i[0][0]),a/(i[1][1]-i[0][1])),o=+t[0][0]+(r-s*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(a-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([o,l])},n)}function hg(e,t,n){return Yu(e,[[0,0],t],n)}function dg(e,t,n){return fg(e,function(i){var r=+t,a=r/(i[1][0]-i[0][0]),s=(r-a*(i[1][0]+i[0][0]))/2,o=-a*i[0][1];e.scale(150*a).translate([s,o])},n)}function gg(e,t,n){return fg(e,function(i){var r=+t,a=r/(i[1][1]-i[0][1]),s=-a*i[0][0],o=(r-a*(i[1][1]+i[0][1]))/2;e.scale(150*a).translate([s,o])},n)}ug.invert=ug,cg.prototype={constructor:cg,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var AF=X(30*re);function Ew(e,t){return+t?function(e,t){function n(i,r,a,s,o,l,u,c,f,h,d,g,p,m){var y=u-i,v=c-r,x=y*y+v*v;if(x>4*t&&p--){var b=s+h,w=o+d,M=l+g,_=vt(b*b+w*w+M*M),E=Bt(M/=_),A=he(he(M)-1)<H||he(a-f)<H?(a+f)/2:an(w,b),D=e(A,E),k=D[0],T=D[1],S=k-i,L=T-r,C=v*S-y*L;(C*C/x>t||he((y*S+v*L)/x-.5)>.3||s*h+o*d+l*g<AF)&&(n(i,r,a,s,o,l,k,T,A,b/=_,w/=_,M,p,m),m.point(k,T),n(k,T,A,b,w,M,u,c,f,h,d,g,p,m))}}return function(i){var r,a,s,o,l,u,c,f,h,d,g,p,m={point:y,lineStart:v,lineEnd:b,polygonStart:function(){i.polygonStart(),m.lineStart=w},polygonEnd:function(){i.polygonEnd(),m.lineStart=v}};function y(E,A){E=e(E,A),i.point(E[0],E[1])}function v(){f=NaN,m.point=x,i.lineStart()}function x(E,A){var D=Ar([E,A]),k=e(E,A);n(f,h,c,d,g,p,f=k[0],h=k[1],c=E,d=D[0],g=D[1],p=D[2],16,i),i.point(f,h)}function b(){m.point=y,i.lineEnd()}function w(){v(),m.point=M,m.lineEnd=_}function M(E,A){x(r=E,A),a=f,s=h,o=d,l=g,u=p,m.point=x}function _(){n(f,h,c,d,g,p,a,s,r,o,l,u,16,i),m.lineEnd=b,b()}return m}}(e,t):function(e){return ao({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var TF=ao({point:function(e,t){this.stream.point(e*re,t*re)}});function kw(e,t,n,i,r,a){if(!a)return function(e,t,n,i,r){function a(s,o){return[t+e*(s*=i),n-e*(o*=r)]}return a.invert=function(s,o){return[(s-t)/e*i,(n-o)/e*r]},a}(e,t,n,i,r);var s=X(a),o=V(a),l=s*e,u=o*e,c=s/e,f=o/e,h=(o*n-s*t)/e,d=(o*t+s*n)/e;function g(p,m){return[l*(p*=i)-u*(m*=r)+t,n-u*p-l*m]}return g.invert=function(p,m){return[i*(c*p-f*m+h),r*(d-f*p-c*m)]},g}function $n(e){return Aw(function(){return e})()}function Aw(e){var t,c,y,v,x,M,_,E,A,D,n=150,i=480,r=250,a=0,s=0,o=0,l=0,u=0,f=0,h=1,d=1,g=null,p=mw,m=null,b=Js,w=.5;function k(C){return E(C[0]*re,C[1]*re)}function T(C){return(C=E.invert(C[0],C[1]))&&[C[0]*Oe,C[1]*Oe]}function S(){var C=kw(n,0,0,h,d,f).apply(null,t(a,s)),O=kw(n,i-C[0],r-C[1],h,d,f);return c=bw(o,l,u),_=lg(t,O),E=lg(c,_),M=Ew(_,w),L()}function L(){return A=D=null,k}return k.stream=function(C){return A&&D===C?A:A=TF(function(e){return ao({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}(c)(p(M(b(D=C)))))},k.preclip=function(C){return arguments.length?(p=C,g=void 0,L()):p},k.postclip=function(C){return arguments.length?(b=C,m=y=v=x=null,L()):b},k.clipAngle=function(C){return arguments.length?(p=+C?DF(g=C*re):(g=null,mw),L()):g*Oe},k.clipExtent=function(C){return arguments.length?(b=null==C?(m=y=v=x=null,Js):xw(m=+C[0][0],y=+C[0][1],v=+C[1][0],x=+C[1][1]),L()):null==m?null:[[m,y],[v,x]]},k.scale=function(C){return arguments.length?(n=+C,S()):n},k.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],S()):[i,r]},k.center=function(C){return arguments.length?(a=C[0]%360*re,s=C[1]%360*re,S()):[a*Oe,s*Oe]},k.rotate=function(C){return arguments.length?(o=C[0]%360*re,l=C[1]%360*re,u=C.length>2?C[2]%360*re:0,S()):[o*Oe,l*Oe,u*Oe]},k.angle=function(C){return arguments.length?(f=C%360*re,S()):f*Oe},k.reflectX=function(C){return arguments.length?(h=C?-1:1,S()):h<0},k.reflectY=function(C){return arguments.length?(d=C?-1:1,S()):d<0},k.precision=function(C){return arguments.length?(M=Ew(_,w=C*C),L()):vt(w)},k.fitExtent=function(C,O){return Yu(k,C,O)},k.fitSize=function(C,O){return hg(k,C,O)},k.fitWidth=function(C,O){return dg(k,C,O)},k.fitHeight=function(C,O){return gg(k,C,O)},function(){return t=e.apply(this,arguments),k.invert=t.invert&&T,S()}}function pg(e){var t=0,n=ie/3,i=Aw(e),r=i(t,n);return r.parallels=function(a){return arguments.length?i(t=a[0]*re,n=a[1]*re):[t*Oe,n*Oe]},r}function RF(e,t){var n=V(e),i=(n+V(t))/2;if(he(i)<H)return function(e){var t=X(e);function n(i,r){return[i*t,V(r)/t]}return n.invert=function(i,r){return[i/t,Bt(r*t)]},n}(e);var r=1+n*(2*i-n),a=vt(r)/i;function s(o,l){var u=vt(r-2*i*V(l))/i;return[u*V(o*=i),a-u*X(o)]}return s.invert=function(o,l){var u=a-l,c=an(o,he(u))*sn(u);return u*i<0&&(c-=ie*sn(o)*sn(u)),[c/i,Bt((r-(o*o+u*u)*i*i)/(2*i))]},s}function Wu(){return pg(RF).scale(155.424).center([0,33.6442])}function Cw(){return Wu().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Sw(e){return function(t,n){var i=X(t),r=X(n),a=e(i*r);return a===1/0?[2,0]:[a*r*V(t),a*V(n)]}}function so(e){return function(t,n){var i=vt(t*t+n*n),r=e(i),a=V(r),s=X(r);return[an(t*a,i*s),Bt(i&&n*a/i)]}}var Tw=Sw(function(e){return vt(2/(1+e))});Tw.invert=so(function(e){return 2*Bt(e/2)});var Fw=Sw(function(e){return(e=Y_(e))&&e/V(e)});function Hu(e,t){return[e,Bu(X0((Be+t)/2))]}function Bw(e){var o,l,u,t=$n(e),n=t.center,i=t.scale,r=t.translate,a=t.clipExtent,s=null;function c(){var f=ie*i(),h=t(function(e){function t(n){return(n=e(n[0]*re,n[1]*re))[0]*=Oe,n[1]*=Oe,n}return e=bw(e[0]*re,e[1]*re,e.length>2?e[2]*re:0),t.invert=function(n){return(n=e.invert(n[0]*re,n[1]*re))[0]*=Oe,n[1]*=Oe,n},t}(t.rotate()).invert([0,0]));return a(null==s?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===Hu?[[Math.max(h[0]-f,s),o],[Math.min(h[0]+f,l),u]]:[[s,Math.max(h[1]-f,o)],[l,Math.min(h[1]+f,u)]])}return t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(null==f?s=o=l=u=null:(s=+f[0][0],o=+f[0][1],l=+f[1][0],u=+f[1][1]),c()):null==s?null:[[s,o],[l,u]]},c()}function Xu(e){return X0((Be+e)/2)}function UF(e,t){var n=X(e),i=e===t?V(e):Bu(n/X(t))/Bu(Xu(t)/Xu(e)),r=n*H0(Xu(e),i)/i;if(!i)return Hu;function a(s,o){r>0?o<-Be+H&&(o=-Be+H):o>Be-H&&(o=Be-H);var l=r/H0(Xu(o),i);return[l*V(i*s),r-l*X(i*s)]}return a.invert=function(s,o){var l=r-o,u=sn(i)*vt(s*s+l*l),c=an(s,he(l))*sn(l);return l*i<0&&(c-=ie*sn(s)*sn(l)),[c/i,2*Ea(H0(r/u,1/i))-Be]},a}function Zu(e,t){return[e,t]}function VF(e,t){var n=X(e),i=e===t?V(e):(n-X(t))/(t-e),r=n/i+e;if(he(i)<H)return Zu;function a(s,o){var l=r-o,u=i*s;return[l*V(u),r-l*X(u)]}return a.invert=function(s,o){var l=r-o,u=an(s,he(l))*sn(l);return l*i<0&&(u-=ie*sn(s)*sn(l)),[u/i,r-sn(i)*vt(s*s+l*l)]},a}Fw.invert=so(function(e){return e}),Hu.invert=function(e,t){return[e,2*Ea(G_(t))-Be]},Zu.invert=Zu;var oo=1.340264,lo=-.081106,uo=893e-6,co=.003796,Ku=vt(3)/2;function Iw(e,t){var n=Bt(Ku*V(t)),i=n*n,r=i*i*i;return[e*X(n)/(Ku*(oo+3*lo*i+r*(7*uo+9*co*i))),n*(oo+lo*i+r*(uo+co*i))]}function Rw(e,t){var n=X(t),i=X(e)*n;return[n*V(e)/i,V(t)/i]}function Ow(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}function Lw(e,t){return[X(t)*V(e),V(t)]}function zw(e,t){var n=X(t),i=1+X(e)*n;return[n*V(e)/i,V(t)/i]}function Nw(e,t){return[Bu(X0((Be+t)/2)),-e]}Iw.invert=function(e,t){for(var s,n=t,i=n*n,r=i*i*i,a=0;a<12&&(r=(i=(n-=s=(n*(oo+lo*i+r*(uo+co*i))-t)/(oo+3*lo*i+r*(7*uo+9*co*i)))*n)*i*i,!(he(s)<Su));++a);return[Ku*e*(oo+3*lo*i+r*(7*uo+9*co*i))/X(n),Bt(V(n)/Ku)]},Rw.invert=so(Ea),Ow.invert=function(e,t){var r,n=t,i=25;do{var a=n*n,s=a*a;n-=r=(n*(1.007226+a*(.015085+s*(.028874*a-.044475-.005916*s)))-t)/(1.007226+a*(.045255+s*(.259866*a-.311325-.005916*11*s)))}while(he(r)>H&&--i>0);return[e/(.8707+(a=n*n)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),n]},Lw.invert=so(Bt),zw.invert=so(function(e){return 2*Ea(e)}),Nw.invert=function(e,t){return[-t,2*Ea(G_(e))-Be]};var QF=Math.abs,mg=(Math,Math,Math,Math.cos),Ju=(Math,Math,Math,Math,Math,Math,Math,Math,Math.sin),$i=(Math,Math.PI),yg=$i/2,Uw=(Math,Qu(2));function jw(e){return e>1?yg:e<-1?-yg:Math.asin(e)}function Qu(e){return e>0?Math.sqrt(e):0}function tB(e,t){var r,n=e*Ju(t),i=30;do{t-=r=(t+Ju(t)-n)/(1+mg(t))}while(QF(r)>1e-6&&--i>0);return t/2}Qu($i);var iB=function(e,t,n){function i(r,a){return[e*r*mg(a=tB(n,a)),t*Ju(a)]}return i.invert=function(r,a){return a=jw(a/t),[r/(e*mg(a)),jw((2*a+Ju(2*a))/n)]},i}(Uw/yg,Uw,$i);const aB=cw(),vg=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function sB(e,t){return function n(){const i=t();return i.type=e,i.path=cw().projection(i),i.copy=i.copy||function(){const r=n();return vg.forEach(a=>{i[a]&&r[a](i[a]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function qw(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(ec[e]=sB(e,t),this):ec[e]||null}function Vw(e){return e&&e.path||aB}const ec={albers:Cw,albersusa:function(){var e,t,i,a,o,l,n=Cw(),r=Wu().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=Wu().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(h,d){l=[h,d]}};function c(h){var d=h[0],g=h[1];return l=null,i.point(d,g),l||(a.point(d,g),l)||(o.point(d,g),l)}function f(){return e=t=null,c}return c.invert=function(h){var d=n.scale(),g=n.translate(),p=(h[0]-g[0])/d,m=(h[1]-g[1])/d;return(m>=.12&&m<.234&&p>=-.425&&p<-.214?r:m>=.166&&m<.234&&p>=-.214&&p<-.115?s:n).invert(h)},c.stream=function(h){return e&&t===h?e:e=function(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}([n.stream(t=h),r.stream(h),s.stream(h)])},c.precision=function(h){return arguments.length?(n.precision(h),r.precision(h),s.precision(h),f()):n.precision()},c.scale=function(h){return arguments.length?(n.scale(h),r.scale(.35*h),s.scale(h),c.translate(n.translate())):n.scale()},c.translate=function(h){if(!arguments.length)return n.translate();var d=n.scale(),g=+h[0],p=+h[1];return i=n.translate(h).clipExtent([[g-.455*d,p-.238*d],[g+.455*d,p+.238*d]]).stream(u),a=r.translate([g-.307*d,p+.201*d]).clipExtent([[g-.425*d+H,p+.12*d+H],[g-.214*d-H,p+.234*d-H]]).stream(u),o=s.translate([g-.205*d,p+.212*d]).clipExtent([[g-.214*d+H,p+.166*d+H],[g-.115*d-H,p+.234*d-H]]).stream(u),f()},c.fitExtent=function(h,d){return Yu(c,h,d)},c.fitSize=function(h,d){return hg(c,h,d)},c.fitWidth=function(h,d){return dg(c,h,d)},c.fitHeight=function(h,d){return gg(c,h,d)},c.scale(1070)},azimuthalequalarea:function(){return $n(Tw).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return $n(Fw).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return pg(UF).scale(109.5).parallels([30,30])},conicequalarea:Wu,conicequidistant:function(){return pg(VF).scale(131.154).center([0,13.9389])},equalEarth:function(){return $n(Iw).scale(177.158)},equirectangular:function(){return $n(Zu).scale(152.63)},gnomonic:function(){return $n(Rw).scale(144.049).clipAngle(60)},identity:function(){var s,o,u,c,f,m,y,e=1,t=0,n=0,i=1,r=1,a=0,l=null,h=1,d=1,g=ao({point:function(b,w){var M=x([b,w]);this.stream.point(M[0],M[1])}}),p=Js;function v(){return h=e*i,d=e*r,m=y=null,x}function x(b){var w=b[0]*h,M=b[1]*d;if(a){var _=M*s-w*o;w=w*s+M*o,M=_}return[w+t,M+n]}return x.invert=function(b){var w=b[0]-t,M=b[1]-n;if(a){var _=M*s+w*o;w=w*s-M*o,M=_}return[w/h,M/d]},x.stream=function(b){return m&&y===b?m:m=g(p(y=b))},x.postclip=function(b){return arguments.length?(p=b,l=u=c=f=null,v()):p},x.clipExtent=function(b){return arguments.length?(p=null==b?(l=u=c=f=null,Js):xw(l=+b[0][0],u=+b[0][1],c=+b[1][0],f=+b[1][1]),v()):null==l?null:[[l,u],[c,f]]},x.scale=function(b){return arguments.length?(e=+b,v()):e},x.translate=function(b){return arguments.length?(t=+b[0],n=+b[1],v()):[t,n]},x.angle=function(b){return arguments.length?(o=V(a=b%360*re),s=X(a),v()):a*Oe},x.reflectX=function(b){return arguments.length?(i=b?-1:1,v()):i<0},x.reflectY=function(b){return arguments.length?(r=b?-1:1,v()):r<0},x.fitExtent=function(b,w){return Yu(x,b,w)},x.fitSize=function(b,w){return hg(x,b,w)},x.fitWidth=function(b,w){return dg(x,b,w)},x.fitHeight=function(b,w){return gg(x,b,w)},x},mercator:function(){return Bw(Hu).scale(961/yt)},mollweide:function(){return $n(iB).scale(169.529)},naturalEarth1:function(){return $n(Ow).scale(175.295)},orthographic:function(){return $n(Lw).scale(249.5).clipAngle(90+H)},stereographic:function(){return $n(zw).scale(250).clipAngle(142)},transversemercator:function(){var e=Bw(Nw),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):[(i=t())[1],-i[0]]},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):[(i=n())[0],i[1],i[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in ec)qw(e,ec[e]);function $w(e,t,n){var i=qt(e,t-H,n).concat(t);return function(r){return i.map(function(a){return[r,a]})}}function Gw(e,t,n){var i=qt(e,t-H,n).concat(t);return function(r){return i.map(function(a){return[a,r]})}}function oB(){}const li=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Ww(){var e=1,t=1,n=o;function i(l,u){return u.map(c=>r(l,c))}function r(l,u){var c=[],f=[];return function(l,u,c){var d,g,m,y,v,f=new Array,h=new Array;for(d=g=-1,li[(m=l[0]>=u)<<1].forEach(x);++d<e-1;)li[m|(m=l[d+1]>=u)<<1].forEach(x);for(li[m<<0].forEach(x);++g<t-1;){for(d=-1,li[(m=l[g*e+e]>=u)<<1|(y=l[g*e]>=u)<<2].forEach(x);++d<e-1;)v=y,li[m|(m=l[g*e+e+d+1]>=u)<<1|(y=l[g*e+d+1]>=u)<<2|v<<3].forEach(x);li[m|y<<3].forEach(x)}for(d=-1,li[(y=l[g*e]>=u)<<2].forEach(x);++d<e-1;)v=y,li[(y=l[g*e+d+1]>=u)<<2|v<<3].forEach(x);function x(b){var A,D,w=[b[0][0]+d,b[0][1]+g],M=[b[1][0]+d,b[1][1]+g],_=s(w),E=s(M);(A=h[_])?(D=f[E])?(delete h[A.end],delete f[D.start],A===D?(A.ring.push(M),c(A.ring)):f[A.start]=h[D.end]={start:A.start,end:D.end,ring:A.ring.concat(D.ring)}):(delete h[A.end],A.ring.push(M),h[A.end=E]=A):(A=f[E])?(D=h[_])?(delete f[A.start],delete h[D.end],A===D?(A.ring.push(M),c(A.ring)):f[D.start]=h[A.end]={start:D.start,end:A.end,ring:D.ring.concat(A.ring)}):(delete f[A.start],A.ring.unshift(w),f[A.start=_]=A):f[_]=h[E]={start:_,end:E,ring:[w,M]}}li[y<<3].forEach(x)}(l,u,h=>{n(h,l,u),function(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}(h)>0?c.push([h]):f.push(h)}),f.forEach(h=>{for(var p,d=0,g=c.length;d<g;++d)if(-1!==uB((p=c[d])[0],h))return void p.push(h)}),{type:"MultiPolygon",value:u,coordinates:c}}function s(l){return 2*l[0]+l[1]*(e+1)*4}function o(l,u,c){l.forEach(f=>{var m,h=f[0],d=f[1],g=0|h,p=0|d,y=u[p*e+g];h>0&&h<e&&g===h&&(f[0]=h+(c-(m=u[p*e+g-1]))/(y-m)-.5),d>0&&d<t&&p===d&&(f[1]=d+(c-(m=u[(p-1)*e+g]))/(y-m)-.5)})}return i.contour=r,i.size=function(l){if(!arguments.length)return[e,t];var u=Math.floor(l[0]),c=Math.floor(l[1]);return u>=0&&c>=0||I("invalid size"),e=u,t=c,i},i.smooth=function(l){return arguments.length?(n=l?o:oB,i):n===o},i}function uB(e,t){for(var r,n=-1,i=t.length;++n<i;)if(r=cB(e,t[n]))return r;return 0}function cB(e,t){for(var n=t[0],i=t[1],r=-1,a=0,s=e.length,o=s-1;a<s;o=a++){var l=e[a],u=l[0],c=l[1],f=e[o],h=f[0],d=f[1];if(fB(l,f,t))return 0;c>i!=d>i&&n<(h-u)*(i-c)/(d-c)+u&&(r=-r)}return r}function fB(e,t,n){var i;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&function(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}(e[i=+(e[0]===t[0])],n[i],t[i])}function Hw(e,t,n){return function(i){var r=Zn(i),a=n?Math.min(r[0],0):r[0],s=r[1],o=s-a,l=t?yi(a,s,e):o/(e+1);return qt(a+l,s,l)}}function xg(e){F.call(this,null,e)}function Xw(e,t,n,i,r){const a=e.x1||0,s=e.y1||0,o=t*n<0;function l(f){f.forEach(u)}function u(f){o&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-a)*t+i,f[1]=(f[1]-s)*n+r}return function(f){return f.coordinates.forEach(l),f}}function Zw(e,t,n){const i=e>=0?e:zy(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function bg(e){return ne(e)?e:ht(+e)}function Kw(){var e=l=>l[0],t=l=>l[1],n=Ga,i=[-1,-1],r=960,a=500,s=2;function o(l,u){const c=Zw(i[0],l,e)>>s,f=Zw(i[1],l,t)>>s,h=c?c+2:0,d=f?f+2:0,g=2*h+(r>>s),p=2*d+(a>>s),m=new Float32Array(g*p),y=new Float32Array(g*p);let v=m;l.forEach(b=>{const w=h+(+e(b)>>s),M=d+(+t(b)>>s);w>=0&&w<g&&M>=0&&M<p&&(m[w+M*g]+=+n(b))}),c>0&&f>0?(Sa(g,p,m,y,c),Ta(g,p,y,m,f),Sa(g,p,m,y,c),Ta(g,p,y,m,f),Sa(g,p,m,y,c),Ta(g,p,y,m,f)):c>0?(Sa(g,p,m,y,c),Sa(g,p,y,m,c),Sa(g,p,m,y,c),v=y):f>0&&(Ta(g,p,m,y,f),Ta(g,p,y,m,f),Ta(g,p,m,y,f),v=y);const x=u?Math.pow(2,-2*s):1/D_(v);for(let b=0,w=g*p;b<w;++b)v[b]*=x;return{values:v,scale:1<<s,width:g,height:p,x1:h,y1:d,x2:h+(r>>s),y2:d+(a>>s)}}return o.x=function(l){return arguments.length?(e=bg(l),o):e},o.y=function(l){return arguments.length?(t=bg(l),o):t},o.weight=function(l){return arguments.length?(n=bg(l),o):n},o.size=function(l){if(!arguments.length)return[r,a];var u=+l[0],c=+l[1];return u>=0&&c>=0||I("invalid size"),r=u,a=c,o},o.cellSize=function(l){return arguments.length?((l=+l)>=1||I("invalid cell size"),s=Math.floor(Math.log(l)/Math.LN2),o):1<<s},o.bandwidth=function(l){return arguments.length?(1===(l=K(l)).length&&(l=[+l[0],+l[0]]),2!==l.length&&I("invalid bandwidth"),i=l,o):i},o}function Sa(e,t,n,i,r){const a=1+(r<<1);for(let s=0;s<t;++s)for(let o=0,l=0;o<e+r;++o)o<e&&(l+=n[o+s*e]),o>=r&&(o>=a&&(l-=n[o-a+s*e]),i[o-r+s*e]=l/Math.min(o+1,e-1+a-o,a))}function Ta(e,t,n,i,r){const a=1+(r<<1);for(let s=0;s<e;++s)for(let o=0,l=0;o<t+r;++o)o<t&&(l+=n[s+o*e]),o>=r&&(o>=a&&(l-=n[s+(o-a)*e]),i[s+(o-r)*e]=l/Math.min(o+1,t-1+a-o,a))}function _g(e){F.call(this,null,e)}xg.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},z(xg,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||St,a=Ww().smooth(!1!==e.smooth),s=e.thresholds||function(e,t,n){const i=Hw(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?i:i(e.map(r=>lr(t(r).values)))}(i,r,e),o=null===e.as?null:e.as||"contour",l=[];return i.forEach(u=>{const c=r(u),f=a.size([c.width,c.height])(c.values,$(s)?s:s(c.values));(function(e,t,n,i){let r=i.scale||t.scale,a=i.translate||t.translate;if(ne(r)&&(r=r(n,i)),ne(a)&&(a=a(n,i)),(1===r||null==r)&&!a)return;const s=(Ha(r)?r:r[0])||1,o=(Ha(r)?r:r[1])||1;e.forEach(Xw(t,s,o,a&&a[0]||0,a&&a[1]||0))})(f,c,u,e),f.forEach(h=>{l.push(bl(u,xe(null!=o?{[o]:h}:h)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),_g.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const mB=["x","y","weight","size","cellSize","bandwidth"];function Jw(e,t){return mB.forEach(n=>null!=t[n]?e[n](t[n]):0),e}function wg(e){F.call(this,null,e)}z(_g,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var l,n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=function(e,t){var r,a,s,o,l,u,n=[],i=c=>c(o);if(null==t)n.push(e);else for(r={},a=0,s=e.length;a<s;++a)o=e[a],(u=r[l=t.map(i)])||(r[l]=u=[],u.dims=l,n.push(u)),u.push(o);return n}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(Ee),s=Jw(Kw(),e),o=e.as||"grid";return l=r.map(c=>xe(function(c,f){for(let h=0;h<a.length;++h)c[a[h]]=f[h];return c}({[o]:s(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),wg.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},z(wg,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var o,l,n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=Ww().smooth(!1!==e.smooth),r=e.values,a=e.thresholds||Hw(e.count||10,e.nice,!!r),s=e.size;return r||(r=t.materialize(t.SOURCE).source,l=Xw(o=Jw(Kw(),e)(r,!0),o.scale||1,o.scale||1,0,0),s=[o.width,o.height],r=o.values),a=$(a)?a:a(r),r=i.size(s)(r,a),l&&r.forEach(l),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(xe),n}});const Mg="Feature",Dg="FeatureCollection";function Eg(e){F.call(this,null,e)}function kg(e){F.call(this,null,e)}function Ag(e){F.call(this,null,e)}function Cg(e){F.call(this,null,e)}function Sg(e){F.call(this,[],e),this.generator=function(){var e,t,n,i,r,a,s,o,h,d,g,p,l=10,u=l,c=90,f=360,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return qt(Fu(i/c)*c,n,c).map(g).concat(qt(Fu(o/f)*f,s,f).map(p)).concat(qt(Fu(t/l)*l,e,l).filter(function(x){return he(x%c)>H}).map(h)).concat(qt(Fu(a/u)*u,r,u).filter(function(x){return he(x%f)>H}).map(d))}return y.lines=function(){return v().map(function(x){return{type:"LineString",coordinates:x}})},y.outline=function(){return{type:"Polygon",coordinates:[g(i).concat(p(s).slice(1),g(n).reverse().slice(1),p(o).reverse().slice(1))]}},y.extent=function(x){return arguments.length?y.extentMajor(x).extentMinor(x):y.extentMinor()},y.extentMajor=function(x){return arguments.length?(o=+x[0][1],s=+x[1][1],(i=+x[0][0])>(n=+x[1][0])&&(x=i,i=n,n=x),o>s&&(x=o,o=s,s=x),y.precision(m)):[[i,o],[n,s]]},y.extentMinor=function(x){return arguments.length?(a=+x[0][1],r=+x[1][1],(t=+x[0][0])>(e=+x[1][0])&&(x=t,t=e,e=x),a>r&&(x=a,a=r,r=x),y.precision(m)):[[t,a],[e,r]]},y.step=function(x){return arguments.length?y.stepMajor(x).stepMinor(x):y.stepMinor()},y.stepMajor=function(x){return arguments.length?(c=+x[0],f=+x[1],y):[c,f]},y.stepMinor=function(x){return arguments.length?(l=+x[0],u=+x[1],y):[l,u]},y.precision=function(x){return arguments.length?(m=+x,h=$w(a,r,90),d=Gw(t,e,m),g=$w(o,s,90),p=Gw(i,n,m),y):m},y.extentMajor([[-180,-90+H],[180,90-H]]).extentMinor([[-180,-80-H],[180,80+H]])}()}function Tg(e){F.call(this,null,e)}function Qw(e){if(!ne(e))return!1;const t=Sn(Re(e));return t.$x||t.$y||t.$value||t.$max}function eM(e){F.call(this,null,e),this.modified(!0)}function tM(e,t,n){ne(e[t])&&e[t](n)}function nM(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,f,h,d,g,p,m,y,v,a=e._root,s={data:i},o=e._x0,l=e._y0,u=e._x1,c=e._y1;if(!a)return e._root=s,e;for(;a.length;)if((p=t>=(f=(o+u)/2))?o=f:u=f,(m=n>=(h=(l+c)/2))?l=h:c=h,r=a,!(a=a[y=m<<1|p]))return r[y]=s,e;if(d=+e._x.call(null,a.data),g=+e._y.call(null,a.data),t===d&&n===g)return s.next=a,r?r[y]=s:e._root=s,e;do{r=r?r[y]=new Array(4):e._root=new Array(4),(p=t>=(f=(o+u)/2))?o=f:u=f,(m=n>=(h=(l+c)/2))?l=h:c=h}while((y=m<<1|p)==(v=(g>=h)<<1|d>=f));return r[v]=a,r[y]=s,e}function xt(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function jB(e){return e[0]}function VB(e){return e[1]}function Fg(e,t,n){var i=new Bg(null==t?jB:t,null==n?VB:n,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function Bg(e,t,n,i,r,a){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function iM(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}Eg.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},z(Eg,F,{transform(e,t){var u,n=this._features,i=this._points,r=e.fields,a=r&&r[0],s=r&&r[1],o=e.geojson||!r&&St,l=t.ADD;u=e.modified()||t.changed(t.REM)||t.modified(Re(o))||a&&t.modified(Re(a))||s&&t.modified(Re(s)),(!this.value||u)&&(l=t.SOURCE,this._features=n=[],this._points=i=[]),o&&t.visit(l,c=>n.push(o(c))),a&&s&&(t.visit(l,c=>{var f=a(c),h=s(c);null!=f&&null!=h&&(f=+f)===f&&(h=+h)===h&&i.push([f,h])}),n=n.concat({type:Mg,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:Dg,features:n}}}),kg.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},z(kg,F,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||St,a=e.as||"path",s=n.SOURCE;!i||e.modified()?(this.value=i=Vw(e.projection),n.materialize().reflow()):s=r===St||t.modified(r.fields)?n.ADD_MOD:n.ADD;const o=function(e,t){const n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}(i,e.pointRadius);return n.visit(s,l=>l[a]=i(r(l))),i.pointRadius(o),n.modifies(a)}}),Ag.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},z(Ag,F,{transform(e,t){var l,n=e.projection,i=e.fields[0],r=e.fields[1],a=e.as||["x","y"],s=a[0],o=a[1];function u(c){const f=n([i(c),r(c)]);f?(c[s]=f[0],c[o]=f[1]):(c[s]=void 0,c[o]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(l=t.modified(i.fields)||t.modified(r.fields),t.visit(l?t.ADD_MOD:t.ADD,u)),t.modifies(a)}}),Cg.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},z(Cg,F,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",a=n.ADD;return(!i||e.modified())&&(this.value=i=function(e,t,n){const i=null==n?r=>e(t(r)):r=>{var a=e.pointRadius(),s=e.pointRadius(n)(t(r));return e.pointRadius(a),s};return i.context=r=>(e.context(r),i),i}(Vw(e.projection),e.field||Pt("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,s=>s[r]=i),n.modifies(r)}}),Sg.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},z(Sg,F,{transform(e,t){var r,n=this.value,i=this.generator;if(!n.length||e.modified())for(const a in e)ne(i[a])&&i[a](e[a]);return r=i(),n.length?t.mod.push(xy(n[0],r)):t.add.push(xe(r)),n[0]=r,t}}),Tg.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},z(Tg,F,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i="shared"===e.resolve,r=e.field||St,a=function(e,t){let n;return ne(e)?(n=i=>e(i,t),n.dep=Qw(e)):e?n=ht(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}(e.opacity,e),s=function(e,t){let n;return ne(e)?(n=i=>Ti(e(i,t)),n.dep=Qw(e)):n=ht(Ti(e||"#888")),n}(e.color,e),o=e.as||"image",l={$x:0,$y:0,$value:0,$max:i?lr(n.map(u=>lr(r(u).values))):0};return n.forEach(u=>{const c=r(u),f=te({},u,l);i||(f.$max=lr(c.values||[])),u[o]=function(e,t,n,i){const r=e.width,s=e.x1||0,o=e.y1||0,l=e.x2||r,u=e.y2||e.height,c=e.values,f=c?m=>c[m]:Ji,h=la(l-s,u-o),d=h.getContext("2d"),g=d.getImageData(0,0,l-s,u-o),p=g.data;for(let m=o,y=0;m<u;++m){t.$y=m-o;for(let v=s,x=m*r;v<l;++v,y+=4){t.$x=v-s,t.$value=f(v+x);const b=n(t);p[y+0]=b.r,p[y+1]=b.g,p[y+2]=b.b,p[y+3]=~~(255*i(t))}}return d.putImageData(g,0,0),h}(c,f,s.dep?s:ht(s(f)),a.dep?a:ht(a(f)))}),t.reflow(!0).modifies(o)}}),z(eM,F,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=qw((e||"mercator").toLowerCase());return t||I("Unrecognized projection type: "+e),t()}(e.type),vg.forEach(i=>{null!=e[i]&&tM(n,i,e[i])})):vg.forEach(i=>{e.modified(i)&&tM(n,i,e[i])}),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=K(e)).length?e[0]:{type:Dg,features:e.reduce((t,n)=>t.concat(function(e){return e.type===Dg?e.features:K(e).filter(t=>null!=t).map(t=>t.type===Mg?t:{type:Mg,geometry:t})}(n)),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var bt=Fg.prototype=Bg.prototype;function _t(e){return function(){return e}}function Gi(e){return 1e-6*(e()-.5)}function GB(e){return e.x+e.vx}function YB(e){return e.y+e.vy}bt.copy=function(){var n,i,e=new Bg(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root;if(!t)return e;if(!t.length)return e._root=iM(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=iM(i));return e},bt.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return nM(this.cover(t,n),t,n,e)},bt.addAll=function(e){var t,n,r,a,i=e.length,s=new Array(i),o=new Array(i),l=1/0,u=1/0,c=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t))||(s[n]=r,o[n]=a,r<l&&(l=r),r>c&&(c=r),a<u&&(u=a),a>f&&(f=a));if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<i;++n)nM(this,s[n],o[n],e[n]);return this},bt.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,a=(i=Math.floor(t))+1;else{for(var l,u,s=r-n||1,o=this._root;n>e||e>=r||i>t||t>=a;)switch(u=(t<i)<<1|e<n,l=new Array(4),l[u]=o,o=l,s*=2,u){case 0:r=n+s,a=i+s;break;case 1:n=r-s,a=i+s;break;case 2:r=n+s,i=a-s;break;case 3:n=r-s,i=a-s}this._root&&this._root.length&&(this._root=o)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this},bt.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},bt.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},bt.find=function(e,t,n){var i,s,o,l,u,g,p,r=this._x0,a=this._y0,c=this._x1,f=this._y1,h=[],d=this._root;for(d&&h.push(new xt(d,r,a,c,f)),null==n?n=1/0:(r=e-n,a=t-n,c=e+n,f=t+n,n*=n);g=h.pop();)if(!(!(d=g.node)||(s=g.x0)>c||(o=g.y0)>f||(l=g.x1)<r||(u=g.y1)<a))if(d.length){var m=(s+l)/2,y=(o+u)/2;h.push(new xt(d[3],m,y,l,u),new xt(d[2],s,y,m,u),new xt(d[1],m,o,l,y),new xt(d[0],s,o,m,y)),(p=(t>=y)<<1|e>=m)&&(g=h[h.length-1],h[h.length-1]=h[h.length-1-p],h[h.length-1-p]=g)}else{var v=e-+this._x.call(null,d.data),x=t-+this._y.call(null,d.data),b=v*v+x*x;if(b<n){var w=Math.sqrt(n=b);r=e-w,a=t-w,c=e+w,f=t+w,i=d.data}}return i},bt.remove=function(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,i,r,a,c,f,h,d,g,p,m,y,n=this._root,s=this._x0,o=this._y0,l=this._x1,u=this._y1;if(!n)return this;if(n.length)for(;;){if((g=c>=(h=(s+l)/2))?s=h:l=h,(p=f>=(d=(o+u)/2))?o=d:u=d,t=n,!(n=n[m=p<<1|g]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,y=m)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(a=n.next)&&delete n.next,r?(a?r.next=a:delete r.next,this):t?(a?t[m]=a:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=a,this)},bt.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},bt.root=function(){return this._root},bt.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},bt.visit=function(e){var n,r,a,s,o,l,t=[],i=this._root;for(i&&t.push(new xt(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,a=n.x0,s=n.y0,o=n.x1,l=n.y1)&&i.length){var u=(a+o)/2,c=(s+l)/2;(r=i[3])&&t.push(new xt(r,u,c,o,l)),(r=i[2])&&t.push(new xt(r,a,c,u,l)),(r=i[1])&&t.push(new xt(r,u,s,o,c)),(r=i[0])&&t.push(new xt(r,a,s,u,c))}return this},bt.visitAfter=function(e){var i,t=[],n=[];for(this._root&&t.push(new xt(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var a,s=i.x0,o=i.y0,l=i.x1,u=i.y1,c=(s+l)/2,f=(o+u)/2;(a=r[0])&&t.push(new xt(a,s,o,c,f)),(a=r[1])&&t.push(new xt(a,c,o,l,f)),(a=r[2])&&t.push(new xt(a,s,f,c,u)),(a=r[3])&&t.push(new xt(a,c,f,l,u))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this},bt.x=function(e){return arguments.length?(this._x=e,this):this._x},bt.y=function(e){return arguments.length?(this._y=e,this):this._y};var HB={value:()=>{}};function rM(){for(var i,e=0,t=arguments.length,n={};e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new tc(n)}function tc(e){this._=e}function XB(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}function ZB(e,t){for(var r,n=0,i=e.length;n<i;++n)if((r=e[n]).name===t)return r.value}function aM(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=HB,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}tc.prototype=rM.prototype={constructor:tc,on:function(e,t){var r,n=this._,i=XB(e+"",n),a=-1,s=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<s;)if(r=(e=i[a]).type)n[r]=aM(n[r],e.name,t);else if(null==t)for(r in n)n[r]=aM(n[r],e.name,null);return this}for(;++a<s;)if((r=(e=i[a]).type)&&(r=ZB(n[r],e.name)))return r},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new tc(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var r,a,n=new Array(r),i=0;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=0,r=(a=this._[e]).length;i<r;++i)a[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,a=i.length;r<a;++r)i[r].value.apply(t,n)}};const KB=rM;var nc,po,Fa=0,ho=0,go=0,ic=0,Cr=0,rc=0,mo="object"==typeof performance&&performance.now?performance:Date,oM="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ig(){return Cr||(oM(JB),Cr=mo.now()+rc)}function JB(){Cr=0}function ac(){this._call=this._time=this._next=null}function lM(e,t,n){var i=new ac;return i.restart(e,t,n),i}function uM(){Cr=(ic=mo.now())+rc,Fa=ho=0;try{!function(){Ig(),++Fa;for(var t,e=nc;e;)(t=Cr-e._time)>=0&&e._call.call(null,t),e=e._next;--Fa}()}finally{Fa=0,function(){for(var e,n,t=nc,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:nc=n);po=e,Rg(i)}(),Cr=0}}function eI(){var e=mo.now(),t=e-ic;t>1e3&&(rc-=t,ic=e)}function Rg(e){Fa||(ho&&(ho=clearTimeout(ho)),e-Cr>24?(e<1/0&&(ho=setTimeout(uM,e-mo.now()-rc)),go&&(go=clearInterval(go))):(go||(ic=mo.now(),go=setInterval(eI,1e3)),Fa=1,oM(uM)))}ac.prototype=lM.prototype={constructor:ac,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ig():+n)+(null==t?0:+t),!this._next&&po!==this&&(po?po._next=this:nc=this,po=this),this._call=e,this._time=n,Rg()},stop:function(){this._call&&(this._call=null,this._time=1/0,Rg())}};const cM=4294967296;function aI(e){return e.x}function sI(e){return e.y}var lI=Math.PI*(3-Math.sqrt(5));function fI(e){return e.index}function fM(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const hM={center:function(e,t){var n,i=1;function r(){var a,o,s=n.length,l=0,u=0;for(a=0;a<s;++a)l+=(o=n[a]).x,u+=o.y;for(l=(l/s-e)*i,u=(u/s-t)*i,a=0;a<s;++a)(o=n[a]).x-=l,o.y-=u}return null==e&&(e=0),null==t&&(t=0),r.initialize=function(a){n=a},r.x=function(a){return arguments.length?(e=+a,r):e},r.y=function(a){return arguments.length?(t=+a,r):t},r.strength=function(a){return arguments.length?(i=+a,r):i},r},collide:function(e){var t,n,i,r=1,a=1;function s(){for(var u,f,h,d,g,p,m,c=t.length,y=0;y<a;++y)for(f=Fg(t,GB,YB).visitAfter(o),u=0;u<c;++u)m=(p=n[(h=t[u]).index])*p,d=h.x+h.vx,g=h.y+h.vy,f.visit(v);function v(x,b,w,M,_){var E=x.data,A=x.r,D=p+A;if(!E)return b>d+D||M<d-D||w>g+D||_<g-D;if(E.index>h.index){var k=d-E.x-E.vx,T=g-E.y-E.vy,S=k*k+T*T;S<D*D&&(0===k&&(S+=(k=Gi(i))*k),0===T&&(S+=(T=Gi(i))*T),S=(D-(S=Math.sqrt(S)))/S*r,h.vx+=(k*=S)*(D=(A*=A)/(m+A)),h.vy+=(T*=S)*D,E.vx-=k*(D=1-D),E.vy-=T*D)}}}function o(u){if(u.data)return u.r=n[u.data.index];for(var c=u.r=0;c<4;++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(t){var u,f,c=t.length;for(n=new Array(c),u=0;u<c;++u)n[(f=t[u]).index]=+e(f,u,t)}}return"function"!=typeof e&&(e=_t(null==e?1:+e)),s.initialize=function(u,c){t=u,i=c,l()},s.iterations=function(u){return arguments.length?(a=+u,s):a},s.strength=function(u){return arguments.length?(r=+u,s):r},s.radius=function(u){return arguments.length?(e="function"==typeof u?u:_t(+u),l(),s):e},s},nbody:function(){var e,t,n,i,a,r=_t(-30),s=1,o=1/0,l=.81;function u(d){var g,p=e.length,m=Fg(e,aI,sI).visitAfter(f);for(i=d,g=0;g<p;++g)t=e[g],m.visit(h)}function c(){if(e){var d,p,g=e.length;for(a=new Array(g),d=0;d<g;++d)a[(p=e[d]).index]=+r(p,d,e)}}function f(d){var p,m,v,x,b,g=0,y=0;if(d.length){for(v=x=b=0;b<4;++b)(p=d[b])&&(m=Math.abs(p.value))&&(g+=p.value,y+=m,v+=m*p.x,x+=m*p.y);d.x=v/y,d.y=x/y}else{(p=d).x=p.data.x,p.y=p.data.y;do{g+=a[p.data.index]}while(p=p.next)}d.value=g}function h(d,g,p,m){if(!d.value)return!0;var y=d.x-t.x,v=d.y-t.y,x=m-g,b=y*y+v*v;if(x*x/l<b)return b<o&&(0===y&&(b+=(y=Gi(n))*y),0===v&&(b+=(v=Gi(n))*v),b<s&&(b=Math.sqrt(s*b)),t.vx+=y*d.value*i/b,t.vy+=v*d.value*i/b),!0;if(!(d.length||b>=o)){(d.data!==t||d.next)&&(0===y&&(b+=(y=Gi(n))*y),0===v&&(b+=(v=Gi(n))*v),b<s&&(b=Math.sqrt(s*b)));do{d.data!==t&&(t.vx+=y*(x=a[d.data.index]*i/b),t.vy+=v*x)}while(d=d.next)}}return u.initialize=function(d,g){e=d,n=g,c()},u.strength=function(d){return arguments.length?(r="function"==typeof d?d:_t(+d),c(),u):r},u.distanceMin=function(d){return arguments.length?(s=d*d,u):Math.sqrt(s)},u.distanceMax=function(d){return arguments.length?(o=d*d,u):Math.sqrt(o)},u.theta=function(d){return arguments.length?(l=d*d,u):Math.sqrt(l)},u},link:function(e){var i,a,s,o,l,u,t=fI,n=function(m){return 1/Math.min(o[m.source.index],o[m.target.index])},r=_t(30),c=1;function h(m){for(var y=0,v=e.length;y<c;++y)for(var b,w,M,_,E,A,D,x=0;x<v;++x)_=(M=(b=e[x]).target).x+M.vx-(w=b.source).x-w.vx||Gi(u),E=M.y+M.vy-w.y-w.vy||Gi(u),E*=A=((A=Math.sqrt(_*_+E*E))-a[x])/A*m*i[x],M.vx-=(_*=A)*(D=l[x]),M.vy-=E*D,w.vx+=_*(D=1-D),w.vy+=E*D}function d(){if(s){var m,b,y=s.length,v=e.length,x=new Map(s.map((w,M)=>[t(w,M,s),w]));for(m=0,o=new Array(y);m<v;++m)(b=e[m]).index=m,"object"!=typeof b.source&&(b.source=fM(x,b.source)),"object"!=typeof b.target&&(b.target=fM(x,b.target)),o[b.source.index]=(o[b.source.index]||0)+1,o[b.target.index]=(o[b.target.index]||0)+1;for(m=0,l=new Array(v);m<v;++m)l[m]=o[(b=e[m]).source.index]/(o[b.source.index]+o[b.target.index]);i=new Array(v),g(),a=new Array(v),p()}}function g(){if(s)for(var m=0,y=e.length;m<y;++m)i[m]=+n(e[m],m,e)}function p(){if(s)for(var m=0,y=e.length;m<y;++m)a[m]=+r(e[m],m,e)}return null==e&&(e=[]),h.initialize=function(m,y){s=m,u=y,d()},h.links=function(m){return arguments.length?(e=m,d(),h):e},h.id=function(m){return arguments.length?(t=m,h):t},h.iterations=function(m){return arguments.length?(c=+m,h):c},h.strength=function(m){return arguments.length?(n="function"==typeof m?m:_t(+m),g(),h):n},h.distance=function(m){return arguments.length?(r="function"==typeof m?m:_t(+m),p(),h):r},h},x:function(e){var n,i,r,t=_t(.1);function a(o){for(var c,l=0,u=n.length;l<u;++l)(c=n[l]).vx+=(r[l]-c.x)*i[l]*o}function s(){if(n){var o,l=n.length;for(i=new Array(l),r=new Array(l),o=0;o<l;++o)i[o]=isNaN(r[o]=+e(n[o],o,n))?0:+t(n[o],o,n)}}return"function"!=typeof e&&(e=_t(null==e?0:+e)),a.initialize=function(o){n=o,s()},a.strength=function(o){return arguments.length?(t="function"==typeof o?o:_t(+o),s(),a):t},a.x=function(o){return arguments.length?(e="function"==typeof o?o:_t(+o),s(),a):e},a},y:function(e){var n,i,r,t=_t(.1);function a(o){for(var c,l=0,u=n.length;l<u;++l)(c=n[l]).vy+=(r[l]-c.y)*i[l]*o}function s(){if(n){var o,l=n.length;for(i=new Array(l),r=new Array(l),o=0;o<l;++o)i[o]=isNaN(r[o]=+e(n[o],o,n))?0:+t(n[o],o,n)}}return"function"!=typeof e&&(e=_t(null==e?0:+e)),a.initialize=function(o){n=o,s()},a.strength=function(o){return arguments.length?(t="function"==typeof o?o:_t(+o),s(),a):t},a.y=function(o){return arguments.length?(e="function"==typeof o?o:_t(+o),s(),a):e},a}},yo="forces",Og=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],pI=["static","iterations"],dM=["x","y","vx","vy"];function Lg(e){F.call(this,null,e)}function gM(e,t,n,i){var a,s,o,l,r=K(t.forces);for(a=0,s=Og.length;a<s;++a)(o=Og[a])!==yo&&t.modified(o)&&e[o](t[o]);for(a=0,s=r.length;a<s;++a)l=yo+a,(o=n||t.modified(yo,a)?xI(r[a]):i&&vI(r[a],i)?e.force(l):null)&&e.force(l,o);for(s=e.numForces||0;a<s;++a)e.force(yo+a,null);return e.numForces=r.length,e}function vI(e,t){var n,i;for(n in e)if(ne(i=e[n])&&t.modified(Re(i)))return 1;return 0}function xI(e){var t,n;for(n in J(hM,e.force)||I("Unrecognized force: "+e.force),t=hM[e.force](),e)ne(t[n])&&bI(t[n],e[n],e);return t}function bI(e,t,n){e(ne(t)?i=>t(i,n):t)}function _I(e){var t=0,n=e.children,i=n&&n.length;if(i)for(;--i>=0;)t+=n[i].value;else t=1;e.value=t}function zg(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=NI)):void 0===t&&(t=zI);for(var i,a,s,o,l,n=new Ba(e),r=[n];i=r.pop();)if((s=t(i.data))&&(l=(s=Array.from(s)).length))for(i.children=s,o=l-1;o>=0;--o)r.push(a=s[o]=new Ba(s[o])),a.parent=i,a.depth=i.depth+1;return n.eachBefore(pM)}function zI(e){return e.children}function NI(e){return Array.isArray(e)?e[1]:null}function PI(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function pM(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function Ba(e){this.data=e,this.depth=this.height=0,this.parent=null}function VI(e,t){var n,i;if(Ng(t,e))return[t];for(n=0;n<e.length;++n)if(sc(t,e[n])&&Ng(vo(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(sc(vo(e[n],e[i]),t)&&sc(vo(e[n],t),e[i])&&sc(vo(e[i],t),e[n])&&Ng(yM(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function sc(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function mM(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function Ng(e,t){for(var n=0;n<t.length;++n)if(!mM(e,t[n]))return!1;return!0}function $I(e){switch(e.length){case 1:return function(e){return{x:e.x,y:e.y,r:e.r}}(e[0]);case 2:return vo(e[0],e[1]);case 3:return yM(e[0],e[1],e[2])}}function vo(e,t){var n=e.x,i=e.y,r=e.r,a=t.x,s=t.y,o=t.r,l=a-n,u=s-i,c=o-r,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(i+s+u/f*c)/2,r:(f+r+o)/2}}function yM(e,t,n){var i=e.x,r=e.y,a=e.r,s=t.x,o=t.y,l=t.r,u=n.x,c=n.y,f=n.r,h=i-s,d=i-u,g=r-o,p=r-c,m=l-a,y=f-a,v=i*i+r*r-a*a,x=v-s*s-o*o+l*l,b=v-u*u-c*c+f*f,w=d*g-h*p,M=(g*b-p*x)/(2*w)-i,_=(p*m-g*y)/w,E=(d*x-h*b)/(2*w)-r,A=(h*y-d*m)/w,D=_*_+A*A-1,k=2*(a+M*_+E*A),T=M*M+E*E-a*a,S=-(D?(k+Math.sqrt(k*k-4*D*T))/(2*D):T/k);return{x:i+M+_*S,y:r+E+A*S,r:S}}function vM(e,t,n){var r,a,o,l,i=e.x-t.x,s=e.y-t.y,u=i*i+s*s;u?(a=t.r+n.r,l=e.r+n.r,(a*=a)>(l*=l)?(r=(u+l-a)/(2*u),o=Math.sqrt(Math.max(0,l/u-r*r)),n.x=e.x-r*i-o*s,n.y=e.y-r*s+o*i):(r=(u+a-l)/(2*u),o=Math.sqrt(Math.max(0,a/u-r*r)),n.x=t.x+r*i-o*s,n.y=t.y+r*s+o*i)):(n.x=t.x+n.r,n.y=t.y)}function xM(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function bM(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,a=(t.y*n.r+n.y*t.r)/i;return r*r+a*a}function oc(e){this._=e,this.next=null,this.previous=null}function _M(e){if(!(r=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,i,r,a,s,o,l,u,c,f;if((t=e[0]).x=0,t.y=0,!(r>1))return t.r;if(t.x=-(n=e[1]).r,n.x=t.r,n.y=0,!(r>2))return t.r+n.r;vM(n,t,i=e[2]),t=new oc(t),n=new oc(n),i=new oc(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(o=3;o<r;++o){vM(t._,n._,i=e[o]),i=new oc(i),l=n.next,u=t.previous,c=n._.r,f=t._.r;do{if(c<=f){if(xM(l._,i._)){t.next=n=l,n.previous=t,--o;continue e}c+=l._.r,l=l.next}else{if(xM(u._,i._)){(t=u).next=n,n.previous=t,--o;continue e}f+=u._.r,u=u.previous}}while(l!==u.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,a=bM(t);(i=i.next)!==n;)(s=bM(i))<a&&(t=i,a=s);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=function(e){for(var r,a,t=0,n=(e=function(e){for(var n,i,t=e.length;t;)i=Math.random()*t--|0,n=e[t],e[t]=e[i],e[i]=n;return e}(Array.from(e))).length,i=[];t<n;)r=e[t],a&&mM(a,r)?++t:(a=$I(i=VI(i,r)),t=0);return a}(t),o=0;o<r;++o)(t=e[o]).x-=i.x,t.y-=i.y;return i.r}function YI(e){return null==e?null:lc(e)}function lc(e){if("function"!=typeof e)throw new Error;return e}function Sr(){return 0}function Ia(e){return function(){return e}}function WI(e){return Math.sqrt(e.value)}function wM(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function Pg(e,t){return function(n){if(i=n.children){var i,r,o,a=i.length,s=e(n)*t||0;if(s)for(r=0;r<a;++r)i[r].r+=s;if(o=_M(i),s)for(r=0;r<a;++r)i[r].r-=s;n.r=o+s}}}function MM(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function DM(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function xo(e,t,n,i,r){for(var s,a=e.children,o=-1,l=a.length,u=e.value&&(i-t)/e.value;++o<l;)(s=a[o]).y0=n,s.y1=r,s.x0=t,s.x1=t+=s.value*u}Lg.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:dM}]},z(Lg,F,{transform(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(Og),a=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&gM(n,e,0,t)):(this.value=n=function(e,t){const n=function(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),a=0,s=.6,o=new Map,l=lM(f),u=KB("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%cM)/cM}();function f(){h(),u.call("tick",t),n<i&&(l.stop(),u.call("end",t))}function h(p){var m,v,y=e.length;void 0===p&&(p=1);for(var x=0;x<p;++x)for(n+=(a-n)*r,o.forEach(function(b){b(n)}),m=0;m<y;++m)null==(v=e[m]).fx?v.x+=v.vx*=s:(v.x=v.fx,v.vx=0),null==v.fy?v.y+=v.vy*=s:(v.y=v.fy,v.vy=0);return t}function d(){for(var y,p=0,m=e.length;p<m;++p){if((y=e[p]).index=p,null!=y.fx&&(y.x=y.fx),null!=y.fy&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var v=10*Math.sqrt(.5+p),x=p*lI;y.x=v*Math.cos(x),y.y=v*Math.sin(x)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function g(p){return p.initialize&&p.initialize(e,c),p}return null==e&&(e=[]),d(),t={tick:h,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(p){return arguments.length?(e=p,d(),o.forEach(g),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(a=+p,t):a},velocityDecay:function(p){return arguments.length?(s=1-p,t):1-s},randomSource:function(p){return arguments.length?(c=p,o.forEach(g),t):c},force:function(p,m){return arguments.length>1?(null==m?o.delete(p):o.set(p,g(m)),t):o.get(p)},find:function(p,m,y){var b,w,M,_,E,v=0,x=e.length;for(null==y?y=1/0:y*=y,v=0;v<x;++v)(M=(b=p-(_=e[v]).x)*b+(w=m-_.y)*w)<y&&(E=_,y=M);return E},on:function(p,m){return arguments.length>1?(u.on(p,m),t):u.on(p)}}}(e),i=n.stop,r=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,r()),n.stop=()=>(a=!0,i()),gM(n,t,!0).on("end",()=>a=!0)}(t.source,e),n.on("tick",function(e,t){return()=>e.touch(t).run()}(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(pI)||t.changed()&&e.restart)if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let c,o=this._argops,l=0,u=o.length;l<u;++l)if(c=o[l],c.name===yo&&"link"===c.op._argval.force)for(var s,i=c.op._argops,r=0,a=i.length;r<a;++r)if("links"===i[r].name&&(s=i[r].op.source)){n.pulse(s,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(dM)}}),Ba.prototype=zg.prototype={constructor:Ba,count:function(){return this.eachAfter(_I)},each:function(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this},eachAfter:function(e,t){for(var a,s,o,n=this,i=[n],r=[],l=-1;n=i.pop();)if(r.push(n),a=n.children)for(s=0,o=a.length;s<o;++s)i.push(a[s]);for(;n=r.pop();)e.call(t,n,++l,this);return this},eachBefore:function(e,t){for(var r,a,n=this,i=[n],s=-1;n=i.pop();)if(e.call(t,n,++s,this),r=n.children)for(a=r.length-1;a>=0;--a)i.push(r[a]);return this},find:function(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}(t,e),i=[t];t!==n;)i.push(t=t.parent);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return zg(this).eachBefore(PI)},[Symbol.iterator]:function*(){var t,i,r,a,e=this,n=[e];do{for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(r=0,a=i.length;r<a;++r)n.push(i[r])}while(n.length)}};var ZI={depth:-1},EM={};function KI(e){return e.id}function JI(e){return e.parentId}function kM(){var e=KI,t=JI;function n(i){var s,o,l,u,c,f,h,r=Array.from(i),a=r.length,d=new Map;for(o=0;o<a;++o)c=r[o]=new Ba(s=r[o]),null!=(f=e(s,o,i))&&(f+="")&&(h=c.id=f,d.set(h,d.has(h)?EM:c)),null!=(f=t(s,o,i))&&(f+="")&&(c.parent=f);for(o=0;o<a;++o)if(f=(c=r[o]).parent){if(!(u=d.get(f)))throw new Error("missing: "+f);if(u===EM)throw new Error("ambiguous: "+f);u.children?u.children.push(c):u.children=[c],c.parent=u}else{if(l)throw new Error("multiple roots");l=c}if(!l)throw new Error("no root");if(l.parent=ZI,l.eachBefore(function(g){g.depth=g.parent.depth+1,--a}).eachBefore(pM),l.parent=null,a>0)throw new Error("cycle");return l}return n.id=function(i){return arguments.length?(e=lc(i),n):e},n.parentId=function(i){return arguments.length?(t=lc(i),n):t},n}function QI(e,t){return e.parent===t.parent?1:2}function Ug(e){var t=e.children;return t?t[0]:e.t}function jg(e){var t=e.children;return t?t[t.length-1]:e.t}function eR(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function nR(e,t,n){return e.a.parent===t.parent?e.a:n}function uc(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function aR(e,t){return e.parent===t.parent?1:2}function oR(e,t){return e+t.x}function uR(e,t){return Math.max(e,t.y)}function cc(e,t,n,i,r){for(var s,a=e.children,o=-1,l=a.length,u=e.value&&(r-n)/e.value;++o<l;)(s=a[o]).x0=t,s.x1=i,s.y0=n,s.y1=n+=s.value*u}uc.prototype=Object.create(Ba.prototype);var AM=(1+Math.sqrt(5))/2;function CM(e,t,n,i,r,a){for(var l,u,d,g,m,y,v,x,b,w,M,s=[],o=t.children,c=0,f=0,h=o.length,p=t.value;c<h;){d=r-n,g=a-i;do{m=o[f++].value}while(!m&&f<h);for(y=v=m,M=m*m*(w=Math.max(g/d,d/g)/(p*e)),b=Math.max(v/M,M/y);f<h;++f){if(m+=u=o[f].value,u<y&&(y=u),u>v&&(v=u),M=m*m*w,(x=Math.max(v/M,M/y))>b){m-=u;break}b=x}s.push(l={value:m,dice:d<g,children:o.slice(c,f)}),l.dice?xo(l,n,i,r,p?i+=g*m/p:a):cc(l,n,i,p?n+=d*m/p:r,a),p-=m,c=f}return s}const SM=function e(t){function n(i,r,a,s,o){CM(t,i,r,a,s,o)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(AM),pR=function e(t){function n(i,r,a,s,o){if((l=i._squarify)&&l.ratio===t)for(var l,u,c,f,d,h=-1,g=l.length,p=i.value;++h<g;){for(c=(u=l[h]).children,f=u.value=0,d=c.length;f<d;++f)u.value+=c[f].value;u.dice?xo(u,r,a,s,p?a+=(o-a)*u.value/p:o):cc(u,r,a,p?r+=(s-r)*u.value/p:s,o),p-=u.value}else i._squarify=l=CM(t,i,r,a,s,o),l.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(AM);function qg(e,t,n){const i={};return e.each(r=>{const a=r.data;n(a)&&(i[t(a)]=r)}),e.lookup=i,e}function Vg(e){F.call(this,null,e)}Vg.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const yR=e=>e.values;function vR(){const e=[],t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)};function n(r,a){if(a>=e.length)return r;const s=r.length,o=e[a++],l={},u={};let f,h,d,c=-1;for(;++c<s;)f=o(h=r[c])+"",(d=l[f])?d.push(h):l[f]=[h];for(f in l)u[f]=n(l[f],a);return u}function i(r,a){if(++a>e.length)return r;const s=[];for(const o in r)s.push({key:o,values:i(r[o],a)});return s}return t}function ui(e){F.call(this,null,e)}z(Vg,F,{transform(e,t){t.source||I("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),a=this.value;return(!a||i||t.changed())&&(a&&a.each(s=>{s.children&&ih(s.data)&&r.rem.push(s.data)}),this.value=a=zg({values:K(e.keys).reduce((s,o)=>(s.key(o),s),vR()).entries(r.source)},yR),n&&a.each(s=>{s.children&&(s=xe(s.data),r.add.push(s),r.source.push(s))}),qg(a,Y,Y)),r.source.root=a,r}});const xR=(e,t)=>e.parent===t.parent?1:2;z(ui,F,{transform(e,t){(!t.source||!t.source.root)&&I(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,r=t.source.root,a=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(sr(e.sort,s=>s.data)),function(e,t,n){for(let i,r=0,a=t.length;r<a;++r)i=t[r],i in n&&e[i](n[i])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?xR:Ga);try{this.value=n(r)}catch(s){I(s)}return r.each(s=>function(e,t,n){const i=e.data,r=t.length-1;for(let a=0;a<r;++a)i[n[a]]=e[t[a]];i[n[r]]=e.children?e.children.length:0}(s,i,a)),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const $g=["x","y","r","depth","children"];function Gg(e){ui.call(this,e)}Gg.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:$g.length,default:$g}]},z(Gg,ui,{layout:function(){var e=null,t=1,n=1,i=Sr;function r(a){return a.x=t/2,a.y=n/2,e?a.eachBefore(wM(e)).eachAfter(Pg(i,.5)).eachBefore(MM(1)):a.eachBefore(wM(WI)).eachAfter(Pg(Sr,1)).eachAfter(Pg(i,a.r/Math.min(t,n))).eachBefore(MM(Math.min(t,n)/(2*a.r))),a}return r.radius=function(a){return arguments.length?(e=YI(a),r):e},r.size=function(a){return arguments.length?(t=+a[0],n=+a[1],r):[t,n]},r.padding=function(a){return arguments.length?(i="function"==typeof a?a:Ia(+a),r):i},r},params:["radius","size","padding"],fields:$g});const Yg=["x0","y0","x1","y1","depth","children"];function Wg(e){ui.call(this,e)}function Hg(e){F.call(this,null,e)}Wg.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Yg.length,default:Yg}]},z(Wg,ui,{layout:function(){var e=1,t=1,n=0,i=!1;function r(s){var o=s.height+1;return s.x0=s.y0=n,s.x1=e,s.y1=t/o,s.eachBefore(function(s,o){return function(l){l.children&&xo(l,l.x0,s*(l.depth+1)/o,l.x1,s*(l.depth+2)/o);var u=l.x0,c=l.y0,f=l.x1-n,h=l.y1-n;f<u&&(u=f=(u+f)/2),h<c&&(c=h=(c+h)/2),l.x0=u,l.y0=c,l.x1=f,l.y1=h}}(t,o)),i&&s.eachBefore(DM),s}return r.round=function(s){return arguments.length?(i=!!s,r):i},r.size=function(s){return arguments.length?(e=+s[0],t=+s[1],r):[e,t]},r.padding=function(s){return arguments.length?(n=+s,r):n},r},params:["size","round","padding"],fields:Yg}),Hg.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},z(Hg,F,{transform(e,t){t.source||I("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),a=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),a&&(n=r.source.length?qg(kM().id(e.key).parentId(e.parentKey)(r.source),e.key,hn):qg(kM()([{}]),e.key,e.key)),r.source.root=this.value=n,r}});const TM={tidy:function(){var e=QI,t=1,n=1,i=null;function r(u){var c=function(e){for(var n,r,a,s,o,t=new uc(e,0),i=[t];n=i.pop();)if(a=n._.children)for(n.children=new Array(o=a.length),s=o-1;s>=0;--s)i.push(r=n.children[s]=new uc(a[s],s)),r.parent=n;return(t.parent=new uc(null,0)).children=[t],t}(u);if(c.eachAfter(a),c.parent.m=-c.z,c.eachBefore(s),i)u.eachBefore(l);else{var f=u,h=u,d=u;u.eachBefore(function(v){v.x<f.x&&(f=v),v.x>h.x&&(h=v),v.depth>d.depth&&(d=v)});var g=f===h?1:e(f,h)/2,p=g-f.x,m=t/(h.x+g+p),y=n/(d.depth||1);u.eachBefore(function(v){v.x=(v.x+p)*m,v.y=v.depth*y})}return u}function a(u){var c=u.children,f=u.parent.children,h=u.i?f[u.i-1]:null;if(c){!function(e){for(var a,t=0,n=0,i=e.children,r=i.length;--r>=0;)(a=i[r]).z+=t,a.m+=t,t+=a.s+(n+=a.c)}(u);var d=(c[0].z+c[c.length-1].z)/2;h?(u.z=h.z+e(u._,h._),u.m=u.z-d):u.z=d}else h&&(u.z=h.z+e(u._,h._));u.parent.A=function(u,c,f){if(c){for(var b,h=u,d=u,g=c,p=h.parent.children[0],m=h.m,y=d.m,v=g.m,x=p.m;g=jg(g),h=Ug(h),g&&h;)p=Ug(p),(d=jg(d)).a=u,(b=g.z+v-h.z-m+e(g._,h._))>0&&(eR(nR(g,u,f),u,b),m+=b,y+=b),v+=g.m,m+=h.m,x+=p.m,y+=d.m;g&&!jg(d)&&(d.t=g,d.m+=v-y),h&&!Ug(p)&&(p.t=h,p.m+=m-x,f=u)}return f}(u,h,u.parent.A||f[0])}function s(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function l(u){u.x*=t,u.y=u.depth*n}return r.separation=function(u){return arguments.length?(e=u,r):e},r.size=function(u){return arguments.length?(i=!1,t=+u[0],n=+u[1],r):i?null:[t,n]},r.nodeSize=function(u){return arguments.length?(i=!0,t=+u[0],n=+u[1],r):i?[t,n]:null},r},cluster:function(){var e=aR,t=1,n=1,i=!1;function r(a){var s,o=0;a.eachAfter(function(h){var d=h.children;d?(h.x=function(e){return e.reduce(oR,0)/e.length}(d),h.y=function(e){return 1+e.reduce(uR,0)}(d)):(h.x=s?o+=e(h,s):0,h.y=0,s=h)});var l=function(e){for(var t;t=e.children;)e=t[0];return e}(a),u=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(a),c=l.x-e(l,u)/2,f=u.x+e(u,l)/2;return a.eachAfter(i?function(h){h.x=(h.x-a.x)*t,h.y=(a.y-h.y)*n}:function(h){h.x=(h.x-c)/(f-c)*t,h.y=(1-(a.y?h.y/a.y:1))*n})}return r.separation=function(a){return arguments.length?(e=a,r):e},r.size=function(a){return arguments.length?(i=!1,t=+a[0],n=+a[1],r):i?null:[t,n]},r.nodeSize=function(a){return arguments.length?(i=!0,t=+a[0],n=+a[1],r):i?[t,n]:null},r}},Xg=["x","y","depth","children"];function Zg(e){ui.call(this,e)}function Kg(e){F.call(this,[],e)}Zg.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:Xg.length,default:Xg}]},z(Zg,ui,{layout(e){const t=e||"tidy";if(J(TM,t))return TM[t]();I("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:Xg}),Kg.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},z(Kg,F,{transform(e,t){const n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),a={};return i||I("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,s=>a[Y(s)]=1),i.each(s=>{const o=s.data,l=s.parent&&s.parent.data;l&&a[Y(o)]&&a[Y(l)]&&r.add.push(xe({source:l,target:o}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,s=>a[Y(s)]=1),n.forEach(s=>{(a[Y(s.source)]||a[Y(s.target)])&&r.mod.push(s)})),r}});const FM={binary:function(e,t,n,i,r){var s,l,a=e.children,o=a.length,u=new Array(o+1);for(u[0]=l=s=0;s<o;++s)u[s+1]=l+=a[s].value;!function c(f,h,d,g,p,m,y){if(f>=h-1){var v=a[f];return v.x0=g,v.y0=p,v.x1=m,void(v.y1=y)}for(var x=u[f],b=d/2+x,w=f+1,M=h-1;w<M;){var _=w+M>>>1;u[_]<b?w=_+1:M=_}b-u[w-1]<u[w]-b&&f+1<w&&--w;var E=u[w]-x,A=d-E;if(m-g>y-p){var D=d?(g*A+m*E)/d:m;c(f,w,E,g,p,D,y),c(w,h,A,D,p,m,y)}else{var k=d?(p*A+y*E)/d:y;c(f,w,E,g,p,m,k),c(w,h,A,g,k,m,y)}}(0,o,e.value,t,n,i,r)},dice:xo,slice:cc,slicedice:function(e,t,n,i,r){(1&e.depth?cc:xo)(e,t,n,i,r)},squarify:SM,resquarify:pR},Jg=["x0","y0","x1","y1","depth","children"];function Qg(e){ui.call(this,e)}function kR(e,t,n,i){const r=e.width,a=e.height,s=n||i,o=la(r,a).getContext("2d");t.forEach(m=>BM(o,m,s));const l=new Uint32Array(o.getImageData(0,0,r,a).data.buffer),u=e.bitmap(),c=s&&e.bitmap();let f,h,d,g,p;for(h=0;h<a;++h)for(f=0;f<r;++f)p=4278190080&l[h*r+f],p&&(d=e(f),g=e(h),i||u.set(d,g),s&&268435456^p&&c.set(d,g));return[u,c]}function BM(e,t,n){if(!t.length)return;const i=t[0].mark.marktype;"group"===i?t.forEach(r=>{r.items.forEach(a=>BM(e,a.items,n))}):rn[i].draw(e,{items:n?t.map(AR):t})}function AR(e){const t=bl(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}Qg.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Jg.length,default:Jg}]},z(Qg,ui,{layout(){const e=function(){var e=SM,t=!1,n=1,i=1,r=[0],a=Sr,s=Sr,o=Sr,l=Sr,u=Sr;function c(h){return h.x0=h.y0=0,h.x1=n,h.y1=i,h.eachBefore(f),r=[0],t&&h.eachBefore(DM),h}function f(h){var d=r[h.depth],g=h.x0+d,p=h.y0+d,m=h.x1-d,y=h.y1-d;m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),h.x0=g,h.y0=p,h.x1=m,h.y1=y,h.children&&(d=r[h.depth+1]=a(h)/2,g+=u(h)-d,p+=s(h)-d,(m-=o(h)-d)<g&&(g=m=(g+m)/2),(y-=l(h)-d)<p&&(p=y=(p+y)/2),e(h,g,p,m,y))}return c.round=function(h){return arguments.length?(t=!!h,c):t},c.size=function(h){return arguments.length?(n=+h[0],i=+h[1],c):[n,i]},c.tile=function(h){return arguments.length?(e=lc(h),c):e},c.padding=function(h){return arguments.length?c.paddingInner(h).paddingOuter(h):c.paddingInner()},c.paddingInner=function(h){return arguments.length?(a="function"==typeof h?h:Ia(+h),c):a},c.paddingOuter=function(h){return arguments.length?c.paddingTop(h).paddingRight(h).paddingBottom(h).paddingLeft(h):c.paddingTop()},c.paddingTop=function(h){return arguments.length?(s="function"==typeof h?h:Ia(+h),c):s},c.paddingRight=function(h){return arguments.length?(o="function"==typeof h?h:Ia(+h),c):o},c.paddingBottom=function(h){return arguments.length?(l="function"==typeof h?h:Ia(+h),c):l},c.paddingLeft=function(h){return arguments.length?(u="function"==typeof h?h:Ia(+h),c):u},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{J(FM,t)?e.tile(FM[t]):I("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:Jg});const Yi=new Uint32Array(33),_n=new Uint32Array(33);_n[0]=0,Yi[0]=~_n[0];for(let e=1;e<=32;++e)_n[e]=_n[e-1]<<1|1,Yi[e]=~_n[e];function FR(e,t,n,i,r,a){let s=n/2;return e-s<0||e+s>r||t-(s=i/2)<0||t+s>a}function BR(){return!1}function IR(e,t,n,i,r,a,s,o){const l=r*a/(2*i),u=e(t-l),c=e(t+l),f=e(n-(a/=2)),h=e(n+a);return s.outOfBounds(u,f,c,h)||s.getRange(u,f,c,h)||o&&o.getRange(u,f,c,h)}function RR(e,t,n,i,r,a,s,o){const l=r*a/(2*i);let u=e(t-l),c=e(t+l),f=e(n-(a/=2)),h=e(n+a);return u=u>0?u:0,f=f>0?f:0,c=c<e.width?c:e.width-1,h=h<e.height?h:e.height-1,s.getRange(u,f,c,h)||o&&o.getRange(u,f,c,h)}function IM(e){return e?[RR,BR]:[IR,FR]}const LR=[-1,-1,1,1],zR=[-1,1,-1,1],PR=["right","center","left"],UR=["bottom","middle","top"];function RM(e,t,n,i,r,a,s,o,l,u,c,f){return!(r.outOfBounds(e,n,t,i)||(f&&a?a.getRange(e,n,t,i)||!function(e,t,n,i,r){return r[0]<=e&&n<=r[2]&&r[3]<=t&&i<=r[5]}(s,l,o,u,c):r.getRange(e,n,t,i)))}const VR={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},$R={naive:function(e,t,n,i){const r=e.width,a=e.height;return function(s){const o=s.datum.datum.items[i].items,l=o.length,u=s.datum.fontSize,c=ii.width(s.datum,s.datum.text);let h,d,g,p,m,y,v,f=0;for(let x=0;x<l;++x)h=o[x].x,g=o[x].y,d=void 0===o[x].x2?h:o[x].x2,p=void 0===o[x].y2?g:o[x].y2,m=(h+d)/2,y=(g+p)/2,v=Math.abs(d-h+p-g),v>=f&&(f=v,s.x=m,s.y=y);return m=c/2,y=u/2,h=s.x-m,d=s.x+m,g=s.y-y,p=s.y+y,s.align="center",h<0&&d<=r?s.align="left":0<=h&&r<d&&(s.align="right"),s.baseline="middle",g<0&&p<=a?s.baseline="top":0<=g&&a<p&&(s.baseline="bottom"),!0}},"reduced-search":function(e,t,n,i,r){const a=e.width,s=e.height,[o,l]=IM(r),u=t[0],c=t[1];function f(h,d,g,p,m){const y=e.invert(h),v=e.invert(d);let w,x=g,b=s;if(!l(y,v,p,m,a,s)&&!o(e,y,v,m,p,x,u,c)&&!o(e,y,v,m,p,m,u,null)){for(;b-x>=1;)w=(x+b)/2,o(e,y,v,m,p,w,u,c)?b=w:x=w;if(x>g)return[y,v,x,!0]}}return function(h){const d=h.datum.datum.items[i].items,g=d.length,p=h.datum.fontSize,m=ii.width(h.datum,h.datum.text);let w,M,_,E,A,D,k,T,S,L,C,O,P,U,Z,oe,Ce,y=n?p:0,v=!1,x=!1,b=0;for(let Te=0;Te<g;++Te){for(w=d[Te].x,_=d[Te].y,M=void 0===d[Te].x2?w:d[Te].x2,E=void 0===d[Te].y2?_:d[Te].y2,w>M&&(Ce=w,w=M,M=Ce),_>E&&(Ce=_,_=E,E=Ce),S=e(w),C=e(M),L=~~((S+C)/2),O=e(_),U=e(E),P=~~((O+U)/2),k=L;k>=S;--k)for(T=P;T>=O;--T)oe=f(k,T,y,m,p),oe&&([h.x,h.y,y,v]=oe);for(k=L;k<=C;++k)for(T=P;T<=U;++T)oe=f(k,T,y,m,p),oe&&([h.x,h.y,y,v]=oe);!v&&!n&&(Z=Math.abs(M-w+E-_),A=(w+M)/2,D=(_+E)/2,Z>=b&&!l(A,D,m,p,a,s)&&!o(e,A,D,p,m,p,u,null)&&(b=Z,h.x=A,h.y=D,x=!0))}return!(!v&&!x||(A=m/2,D=p/2,u.setRange(e(h.x-A),e(h.y-D),e(h.x+A),e(h.y+D)),h.align="center",h.baseline="middle",0))}},floodfill:function(e,t,n,i,r){const a=e.width,s=e.height,[o,l]=IM(r),u=t[0],c=t[1],f=e.bitmap();return function(h){const d=h.datum.datum.items[i].items,g=d.length,p=h.datum.fontSize,m=ii.width(h.datum,h.datum.text),y=[];let M,_,E,A,D,k,T,S,L,C,O,P,v=n?p:0,x=!1,b=!1,w=0;for(let U=0;U<g;++U){for(M=d[U].x,E=d[U].y,_=void 0===d[U].x2?M:d[U].x2,A=void 0===d[U].y2?E:d[U].y2,y.push([e((M+_)/2),e((E+A)/2)]);y.length;)if([T,S]=y.pop(),!(u.get(T,S)||c.get(T,S)||f.get(T,S))){f.set(T,S);for(let Z=0;Z<4;++Z)D=T+LR[Z],k=S+zR[Z],f.outOfBounds(D,k,D,k)||y.push([D,k]);if(D=e.invert(T),k=e.invert(S),L=v,C=s,!l(D,k,m,p,a,s)&&!o(e,D,k,p,m,L,u,c)&&!o(e,D,k,p,m,p,u,null)){for(;C-L>=1;)O=(L+C)/2,o(e,D,k,p,m,O,u,c)?C=O:L=O;L>v&&(h.x=D,h.y=k,v=L,x=!0)}}!x&&!n&&(P=Math.abs(_-M+A-E),D=(M+_)/2,k=(E+A)/2,P>=w&&!l(D,k,m,p,a,s)&&!o(e,D,k,p,m,p,u,null)&&(w=P,h.x=D,h.y=k,b=!0))}return!(!x&&!b||(D=m/2,k=p/2,u.setRange(e(h.x-D),e(h.y-k),e(h.x+D),e(h.y+k)),h.align="center",h.baseline="middle",0))}}};function GR(e,t,n,i,r,a,s,o,l,u,c){if(!e.length)return e;const f=Math.max(i.length,r.length),h=function(e,t){const n=new Float64Array(t),i=e.length;for(let r=0;r<i;++r)n[r]=e[r]||0;for(let r=i;r<t;++r)n[r]=n[i-1];return n}(i,f),d=function(e,t){const n=new Int8Array(t),i=e.length;for(let r=0;r<i;++r)n[r]|=VR[e[r]];for(let r=i;r<t;++r)n[r]=n[i-1];return n}(r,f),g=function(e){return e&&e.mark&&e.mark.marktype}(e[0].datum),p="group"===g&&e[0].datum.items[l].marktype,m="area"===p,y=function(e,t,n,i){const r=a=>[a.x,a.x,a.x,a.y,a.y,a.y];return e?"line"===e||"area"===e?a=>r(a.datum):"line"===t?a=>{const s=a.datum.items[i].items;return r(s.length?s["start"===n?0:s.length-1]:{x:NaN,y:NaN})}:a=>{const s=a.datum.bounds;return[s.x1,(s.x1+s.x2)/2,s.x2,s.y1,(s.y1+s.y2)/2,s.y2]}:r}(g,p,o,l),v=null===u||u===1/0,x=function(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),r=~~((e+2*n+i)/i),a=~~((t+2*n+i)/i),s=o=>~~((o+n)/i);return s.invert=o=>o*i-n,s.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function i(a,s){n[a]|=s}function r(a,s){n[a]&=s}return{array:n,get:(a,s)=>{const o=s*e+a;return n[o>>>5]&1<<(31&o)},set:(a,s)=>{const o=s*e+a;i(o>>>5,1<<(31&o))},clear:(a,s)=>{const o=s*e+a;r(o>>>5,~(1<<(31&o)))},getRange:(a,s,o,l)=>{let c,f,h,d,u=l;for(;u>=s;--u)if(c=u*e+a,f=u*e+o,h=c>>>5,d=f>>>5,h===d){if(n[h]&Yi[31&c]&_n[1+(31&f)])return!0}else{if(n[h]&Yi[31&c]||n[d]&_n[1+(31&f)])return!0;for(let g=h+1;g<d;++g)if(n[g])return!0}return!1},setRange:(a,s,o,l)=>{let u,c,f,h,d;for(;s<=l;++s)if(u=s*e+a,c=s*e+o,f=u>>>5,h=c>>>5,f===h)i(f,Yi[31&u]&_n[1+(31&c)]);else for(i(f,Yi[31&u]),i(h,_n[1+(31&c)]),d=f+1;d<h;++d)i(d,4294967295)},clearRange:(a,s,o,l)=>{let u,c,f,h,d;for(;s<=l;++s)if(u=s*e+a,c=s*e+o,f=u>>>5,h=c>>>5,f===h)r(f,_n[31&u]|Yi[1+(31&c)]);else for(r(f,_n[31&u]),r(h,Yi[1+(31&c)]),d=f+1;d<h;++d)r(d,0)},outOfBounds:(a,s,o,l)=>a<0||s<0||l>=t||o>=e}}(r,a),s.ratio=i,s.padding=n,s.width=e,s.height=t,s}(t[0],t[1],v?0:u),b=m&&"naive"===c,w=e.map(E=>({datum:E,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(E)}));let M;if(!b){n&&w.sort((A,D)=>n(A.datum,D.datum));let E=!1;for(let A=0;A<d.length&&!E;++A)E=5===d[A]||h[A]<0;g&&(s||m)&&(a=[e.map(A=>A.datum)].concat(a)),M=a.length?kR(x,a,E,m):function(e,t){const n=e.bitmap();return(t||[]).forEach(i=>n.set(e(i.boundary[0]),e(i.boundary[3]))),[n,void 0]}(x,s&&w)}const _=m?$R[c](x,M,s,l,v):function(e,t,n,i,r){const a=e.width,s=e.height,o=t[0],l=t[1],u=i.length;return function(c){const f=c.boundary,h=c.datum.fontSize;if(!r&&(f[2]<0||f[5]<0||f[0]>a||f[3]>s))return!1;let g,p,m,y,v,x,b,w,M,_,E,A,D,k,T,d=0;for(let S=0;S<u;++S){if(g=(3&n[S])-1,p=(n[S]>>>2&3)-1,m=0===g&&0===p||i[S]<0,y=g&&p?Math.SQRT1_2:1,v=i[S]<0?-1:1,x=f[1+g]+i[S]*g*y,E=f[4+p]+v*h*p/2+i[S]*p*y,w=E-h/2,M=E+h/2,A=e(x),k=e(w),T=e(M),r&&(A=A<0?0:A,k=k<0?0:k,T=T>=e.height?e.height-1:T),!d){if(!RM(A,A,k,T,o,l,x,x,w,M,f,m))continue;d=ii.width(c.datum,c.datum.text)}if(_=x+v*d*g/2,x=_-d/2,b=_+d/2,A=e(x),D=e(b),r&&(A=A<0?0:A,D=D>=e.width?e.width-1:D),RM(A,D,k,T,o,l,x,b,w,M,f,m))return c.x=g?g*v<0?b:x:_,c.y=p?p*v<0?M:w:E,c.align=PR[g*v+1],c.baseline=UR[p*v+1],o.setRange(A,k,D,T),!0}return!1}}(x,M,d,h,v);return w.forEach(E=>E.opacity=+_(E)),w}const sp=["x","y","opacity","align","baseline"],OM=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function op(e){F.call(this,null,e)}function LM(e,t){var r,a,s,o,l,u,n=[],i=function(c){return c(o)};if(null==t)n.push(e);else for(r={},a=0,s=e.length;a<s;++a)o=e[a],(u=r[l=t.map(i)])||(r[l]=u=[],u.dims=l,n.push(u)),u.push(o);return n}function lp(e){F.call(this,null,e)}op.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:OM},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:sp.length,default:sp}]},z(op,F,{transform(e,t){const i=e.modified();if(!(i||t.changed(t.ADD_REM)||function(a){const s=e.sort;return ne(s)&&t.modified(s.fields)}()))return;(!e.size||2!==e.size.length)&&I("Size parameter should be specified as a [width, height] array.");const r=e.as||sp;return GR(t.materialize(t.SOURCE).source||[],e.size,e.sort,K(null==e.offset?1:e.offset),K(e.anchor||OM),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,void 0===e.padding?0:e.padding,e.method||"naive").forEach(a=>{const s=a.datum;s[r[0]]=a.x,s[r[1]]=a.y,s[r[2]]=a.opacity,s[r[3]]=a.align,s[r[4]]=a.baseline}),t.reflow(i).modifies(r)}}),lp.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},z(lp,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=LM(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(Ee),s=a.length,o=e.as||[Ee(e.x),Ee(e.y)],l=[];r.forEach(u=>{(function(e,t,n,i){const[r,a,s,o]=Dl(e,t,n,!0),l=r.length,u=Math.max(2,~~(i*l)),c=new Float64Array(l),f=new Float64Array(l),h=new Float64Array(l).fill(1);for(let d=-1;++d<=2;){const g=[0,u-1];for(let m=0;m<l;++m){const y=r[m],v=g[0],x=g[1];let w=0,M=0,_=0,E=0,A=0;const D=1/Math.abs(r[y-r[v]>r[x]-y?v:x]-y||1);for(let S=v;S<=x;++S){const L=r[S],C=a[S],O=s5(Math.abs(y-L)*D)*h[S],P=L*O;w+=O,M+=P,_+=C*O,E+=C*P,A+=L*P}const[k,T]=vs(M/w,_/w,E/w,A/w);c[m]=k+T*y,f[m]=Math.abs(a[m]-c[m]),o5(r,m+1,g)}if(2===d)break;const p=Iy(f);if(Math.abs(p)<1e-12)break;for(let y,v,m=0;m<l;++m)y=f[m]/(6*p),h[m]=y>=1?1e-12:(v=1-y*y)*v}return function(e,t,n,i){const r=e.length,a=[];let u,s=0,o=0,l=[];for(;s<r;++s)u=e[s]+n,l[0]===u?l[1]+=(t[s]-l[1])/++o:(o=0,l[1]+=i,l=[u,t[s]],a.push(l));return l[1]+=i,a}(r,c,s,o)})(u,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let h=0;h<s;++h)f[a[h]]=u.dims[h];f[o[0]]=c[0],f[o[1]]=c[1],l.push(xe(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});const up={linear:Zy,log:function(e,t,n){let i=0,r=0,a=0,s=0,o=0;xs(e,t,n,(c,f)=>{++o,c=Math.log(c),i+=(c-i)/o,r+=(f-r)/o,a+=(c*f-a)/o,s+=(c*c-s)/o});const l=vs(i,r,a,s),u=c=>l[0]+l[1]*Math.log(c);return{coef:l,predict:u,rSquared:aa(e,t,n,r,u)}},exp:function(e,t,n){const[i,r,a,s]=Dl(e,t,n);let h,d,g,o=0,l=0,u=0,c=0,f=0;xs(e,t,n,(v,x)=>{h=i[f++],d=Math.log(x),g=h*x,o+=(x*d-o)/f,l+=(g-l)/f,u+=(g*d-u)/f,c+=(h*g-c)/f});const[p,m]=vs(l/s,o/s,u/s,c/s),y=v=>Math.exp(p+m*(v-a));return{coef:[Math.exp(p-m*a),m],predict:y,rSquared:aa(e,t,n,s,y)}},pow:function(e,t,n){let i=0,r=0,a=0,s=0,o=0,l=0;xs(e,t,n,(f,h)=>{const d=Math.log(f),g=Math.log(h);++l,i+=(d-i)/l,r+=(g-r)/l,a+=(d*g-a)/l,s+=(d*d-s)/l,o+=(h-o)/l});const u=vs(i,r,a,s),c=f=>u[0]*Math.pow(f,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:aa(e,t,n,o,c)}},quad:Ky,poly:function(e,t,n,i){if(1===i)return Zy(e,t,n);if(2===i)return Ky(e,t,n);const[r,a,s,o]=Dl(e,t,n),l=r.length,u=[],c=[],f=i+1;let h,d,g,p,m;for(h=0;h<f;++h){for(g=0,p=0;g<l;++g)p+=Math.pow(r[g],h)*a[g];for(u.push(p),m=new Float64Array(f),d=0;d<f;++d){for(g=0,p=0;g<l;++g)p+=Math.pow(r[g],h+d);m[d]=p}c.push(m)}c.push(u);const y=function(e){const t=e.length-1,n=[];let i,r,a,s,o;for(i=0;i<t;++i){for(s=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][s])&&(s=r);for(a=i;a<t+1;++a)o=e[a][i],e[a][i]=e[a][s],e[a][s]=o;for(r=i+1;r<t;++r)for(a=t;a>=i;a--)e[a][r]-=e[a][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(o=0,a=r+1;a<t;++a)o+=e[a][r]*n[a];n[r]=(e[t][r]-o)/e[r][r]}return n}(c),v=x=>{let b=o+y[0]+y[1]*(x-=s)+y[2]*x*x;for(h=3;h<f;++h)b+=y[h]*Math.pow(x,h);return b};return{coef:i5(f,y,-s,o),predict:v,rSquared:aa(e,t,n,o,v)}}};function cp(e){F.call(this,null,e)}cp.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(up)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},z(cp,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=LM(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(Ee),s=e.method||"linear",o=e.order||3,l=((e,t)=>"poly"===e?t:"quad"===e?2:1)(s,o),u=e.as||[Ee(e.x),Ee(e.y)],c=up[s],f=[];let h=e.extent;J(up,s)||I("Invalid regression method: "+s),null!=h&&"log"===s&&h[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),r.forEach(d=>{if(d.length<=l)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const p=c(d,e.x,e.y,o);if(e.params)return void f.push(xe({keys:d.dims,coef:p.coef,rSquared:p.rSquared}));const m=h||Zn(d,e.x),y=v=>{const x={};for(let b=0;b<a.length;++b)x[a[b]]=d.dims[b];x[u[0]]=v[0],x[u[1]]=v[1],f.push(xe(x))};"linear"===s?m.forEach(v=>y([v,p.predict(v)])):vh(p.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const zM=Math.pow(2,-52),fc=new Uint32Array(512);class hc{static from(t,n=tO,i=nO){const r=t.length,a=new Float64Array(2*r);for(let s=0;s<r;s++){const o=t[s];a[2*s]=n(o),a[2*s+1]=i(o)}return new hc(a)}constructor(t){const n=t.length>>1;if(n>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:a}=this,s=t.length>>1;let o=1/0,l=1/0,u=-1/0,c=-1/0;for(let D=0;D<s;D++){const k=t[2*D],T=t[2*D+1];k<o&&(o=k),T<l&&(l=T),k>u&&(u=k),T>c&&(c=T),this._ids[D]=D}const f=(o+u)/2,h=(l+c)/2;let g,p,m,d=1/0;for(let D=0;D<s;D++){const k=fp(f,h,t[2*D],t[2*D+1]);k<d&&(g=D,d=k)}const y=t[2*g],v=t[2*g+1];d=1/0;for(let D=0;D<s;D++){if(D===g)continue;const k=fp(y,v,t[2*D],t[2*D+1]);k<d&&k>0&&(p=D,d=k)}let x=t[2*p],b=t[2*p+1],w=1/0;for(let D=0;D<s;D++){if(D===g||D===p)continue;const k=QR(y,v,x,b,t[2*D],t[2*D+1]);k<w&&(m=D,w=k)}let M=t[2*m],_=t[2*m+1];if(w===1/0){for(let T=0;T<s;T++)this._dists[T]=t[2*T]-t[0]||t[2*T+1]-t[1];Ra(this._ids,this._dists,0,s-1);const D=new Uint32Array(s);let k=0;for(let T=0,S=-1/0;T<s;T++){const L=this._ids[T];this._dists[L]>S&&(D[k++]=L,S=this._dists[L])}return this.hull=D.subarray(0,k),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(dc(y,v,x,b,M,_)){const D=p,k=x,T=b;p=m,x=M,b=_,m=D,M=k,_=T}const E=function(e,t,n,i,r,a){const s=n-e,o=i-t,l=r-e,u=a-t,c=s*s+o*o,f=l*l+u*u,h=.5/(s*u-o*l);return{x:e+(u*c-o*f)*h,y:t+(s*f-l*c)*h}}(y,v,x,b,M,_);this._cx=E.x,this._cy=E.y;for(let D=0;D<s;D++)this._dists[D]=fp(t[2*D],t[2*D+1],E.x,E.y);Ra(this._ids,this._dists,0,s-1),this._hullStart=g;let A=3;i[g]=n[m]=p,i[p]=n[g]=m,i[m]=n[p]=g,r[g]=0,r[p]=1,r[m]=2,a.fill(-1),a[this._hashKey(y,v)]=g,a[this._hashKey(x,b)]=p,a[this._hashKey(M,_)]=m,this.trianglesLen=0,this._addTriangle(g,p,m,-1,-1,-1);for(let k,T,D=0;D<this._ids.length;D++){const S=this._ids[D],L=t[2*S],C=t[2*S+1];if(D>0&&Math.abs(L-k)<=zM&&Math.abs(C-T)<=zM||(k=L,T=C,S===g||S===p||S===m))continue;let O=0;for(let Ce=0,Te=this._hashKey(L,C);Ce<this._hashSize&&(O=a[(Te+Ce)%this._hashSize],-1===O||O===i[O]);Ce++);O=n[O];let U,P=O;for(;U=i[P],!dc(L,C,t[2*P],t[2*P+1],t[2*U],t[2*U+1]);)if(P=U,P===O){P=-1;break}if(-1===P)continue;let Z=this._addTriangle(P,S,i[P],-1,-1,r[P]);r[S]=this._legalize(Z+2),r[P]=Z,A++;let oe=i[P];for(;U=i[oe],dc(L,C,t[2*oe],t[2*oe+1],t[2*U],t[2*U+1]);)Z=this._addTriangle(oe,S,U,r[S],-1,r[oe]),r[S]=this._legalize(Z+2),i[oe]=oe,A--,oe=U;if(P===O)for(;U=n[P],dc(L,C,t[2*U],t[2*U+1],t[2*P],t[2*P+1]);)Z=this._addTriangle(U,S,P,-1,r[P],r[U]),this._legalize(Z+2),r[U]=Z,i[P]=P,A--,P=U;this._hullStart=n[S]=P,i[P]=n[oe]=S,i[S]=oe,a[this._hashKey(L,C)]=S,a[this._hashKey(t[2*P],t[2*P+1])]=P}this.hull=new Uint32Array(A);for(let D=0,k=this._hullStart;D<A;D++)this.hull[D]=k,k=i[k];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let a=0,s=0;for(;;){const o=i[t],l=t-t%3;if(s=l+(t+2)%3,-1===o){if(0===a)break;t=fc[--a];continue}const u=o-o%3,f=u+(o+2)%3,h=n[s],d=n[t],g=n[l+(t+1)%3],p=n[f];if(JR(r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*g],r[2*g+1],r[2*p],r[2*p+1])){n[t]=p,n[o]=h;const y=i[f];if(-1===y){let x=this._hullStart;do{if(this._hullTri[x]===f){this._hullTri[x]=t;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(t,y),this._link(o,i[s]),this._link(s,f);const v=u+(o+1)%3;a<fc.length&&(fc[a++]=v)}else{if(0===a)break;t=fc[--a]}}return s}_link(t,n){this._halfedges[t]=n,-1!==n&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,a,s){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=n,this._triangles[o+2]=i,this._link(o,r),this._link(o+1,a),this._link(o+2,s),this.trianglesLen+=3,o}}function fp(e,t,n,i){const r=e-n,a=t-i;return r*r+a*a}function hp(e,t,n,i,r,a){const s=(i-t)*(r-e),o=(n-e)*(a-t);return Math.abs(s-o)>=33306690738754716e-32*Math.abs(s+o)?s-o:0}function dc(e,t,n,i,r,a){return(hp(r,a,e,t,n,i)||hp(e,t,n,i,r,a)||hp(n,i,r,a,e,t))<0}function JR(e,t,n,i,r,a,s,o){const l=e-s,u=t-o,c=n-s,f=i-o,h=r-s,d=a-o,p=c*c+f*f,m=h*h+d*d;return l*(f*m-p*d)-u*(c*m-p*h)+(l*l+u*u)*(c*d-f*h)<0}function QR(e,t,n,i,r,a){const s=n-e,o=i-t,l=r-e,u=a-t,c=s*s+o*o,f=l*l+u*u,h=.5/(s*u-o*l),d=(u*c-o*f)*h,g=(s*f-l*c)*h;return d*d+g*g}function Ra(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const a=e[r],s=t[a];let o=r-1;for(;o>=n&&t[e[o]]>s;)e[o+1]=e[o--];e[o+1]=a}else{let a=n+1,s=i;_o(e,n+i>>1,a),t[e[n]]>t[e[i]]&&_o(e,n,i),t[e[a]]>t[e[i]]&&_o(e,a,i),t[e[n]]>t[e[a]]&&_o(e,n,a);const o=e[a],l=t[o];for(;;){do{a++}while(t[e[a]]<l);do{s--}while(t[e[s]]>l);if(s<a)break;_o(e,a,s)}e[n+1]=e[s],e[s]=o,i-a+1>=s-n?(Ra(e,t,a,i),Ra(e,t,n,s-1)):(Ra(e,t,n,s-1),Ra(e,t,a,i))}}function _o(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function tO(e){return e[0]}function nO(e){return e[1]}class Tr{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){const r=(t=+t)+(i=+i),a=n=+n;if(i<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${a}`:(Math.abs(this._x1-r)>1e-6||Math.abs(this._y1-a)>1e-6)&&(this._+="L"+r+","+a),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=a}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class dp{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class iO{constructor(t,[n,i,r,a]=[0,0,960,500]){if(!((r=+r)>=(n=+n)&&(a=+a)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=r,this.xmin=n,this.ymax=a,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this,a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let m,y,d=0,g=0,p=i.length;d<p;d+=3,g+=2){const v=2*i[d],x=2*i[d+1],b=2*i[d+2],w=t[v],M=t[v+1],A=t[b],D=t[b+1],k=t[x]-w,T=t[x+1]-M,S=A-w,L=D-M,C=k*k+T*T,O=S*S+L*L,P=2*(k*L-T*S);if(P)if(Math.abs(P)<1e-8)m=(w+A)/2,y=(M+D)/2;else{const U=1/P;m=w+(L*C-T*O)*U,y=M+(k*O-S*C)*U}else m=(w+A)/2-1e8*L,y=(M+D)/2+1e8*S;a[g]=m,a[g+1]=y}let o,u,f,s=n[n.length-1],l=4*s,c=t[2*s],h=t[2*s+1];r.fill(0);for(let d=0;d<n.length;++d)s=n[d],o=l,u=c,f=h,l=4*s,c=t[2*s],h=t[2*s+1],r[o+2]=r[l]=f-h,r[o+3]=r[l+1]=c-u}render(t){const n=null==t?t=new Tr:void 0,{delaunay:{halfedges:i,inedges:r,hull:a},circumcenters:s,vectors:o}=this;if(a.length<=1)return null;for(let c=0,f=i.length;c<f;++c){const h=i[c];if(h<c)continue;const d=2*Math.floor(c/3),g=2*Math.floor(h/3);this._renderSegment(s[d],s[d+1],s[g],s[g+1],t)}let l,u=a[a.length-1];for(let c=0;c<a.length;++c){l=u,u=a[c];const f=2*Math.floor(r[u]/3),h=s[f],d=s[f+1],g=4*l,p=this._project(h,d,o[g+2],o[g+3]);p&&this._renderSegment(h,d,p[0],p[1],t)}return n&&n.value()}renderBounds(t){const n=null==t?t=new Tr:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=null==n?n=new Tr:void 0,r=this._clip(t);if(null===r||!r.length)return;n.moveTo(r[0],r[1]);let a=r.length;for(;r[0]===r[a-2]&&r[1]===r[a-1]&&a>1;)a-=2;for(let s=2;s<a;s+=2)(r[s]!==r[s-2]||r[s+1]!==r[s-1])&&n.lineTo(r[s],r[s+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new dp;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,a){let s;const o=this._regioncode(t,n),l=this._regioncode(i,r);0===o&&0===l?(a.moveTo(t,n),a.lineTo(i,r)):(s=this._clipSegment(t,n,i,r,o,l))&&(a.moveTo(s[0],s[1]),a.lineTo(s[2],s[3]))}contains(t,n,i){return(n=+n)==n&&(i=+i)==i&&this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r)e:for(let a=0,s=n.length;a<s;a+=2)for(let o=0,l=r.length;o<l;o+=2)if(n[a]==r[o]&&n[a+1]==r[o+1]&&n[(a+2)%s]==r[(o+l-2)%l]&&n[(a+3)%s]==r[(o+l-1)%l]){yield i;break e}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:a}}=this,s=i[t];if(-1===s)return null;const o=[];let l=s;do{const u=Math.floor(l/3);if(o.push(n[2*u],n[2*u+1]),l=l%3==2?l-2:l+1,a[l]!==t)break;l=r[l]}while(l!==s&&-1!==l);return o}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(null===n)return null;const{vectors:i}=this,r=4*t;return i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n)}_clipFinite(t,n){const i=n.length;let a,s,u,f,h,r=null,o=n[i-2],l=n[i-1],c=this._regioncode(o,l);for(let d=0;d<i;d+=2)if(a=o,s=l,o=n[d],l=n[d+1],u=c,c=this._regioncode(o,l),0===u&&0===c)f=h,h=0,r?r.push(o,l):r=[o,l];else{let g,p,m,y,v;if(0===u){if(null===(g=this._clipSegment(a,s,o,l,u,c)))continue;[p,m,y,v]=g}else{if(null===(g=this._clipSegment(o,l,a,s,c,u)))continue;[y,v,p,m]=g,f=h,h=this._edgecode(p,m),f&&h&&this._edge(t,f,h,r,r.length),r?r.push(p,m):r=[p,m]}f=h,h=this._edgecode(y,v),f&&h&&this._edge(t,f,h,r,r.length),r?r.push(y,v):r=[y,v]}if(r)f=h,h=this._edgecode(r[0],r[1]),f&&h&&this._edge(t,f,h,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,a,s){for(;;){if(0===a&&0===s)return[t,n,i,r];if(a&s)return null;let o,l,u=a||s;8&u?(o=t+(i-t)*(this.ymax-n)/(r-n),l=this.ymax):4&u?(o=t+(i-t)*(this.ymin-n)/(r-n),l=this.ymin):2&u?(l=n+(r-n)*(this.xmax-t)/(i-t),o=this.xmax):(l=n+(r-n)*(this.xmin-t)/(i-t),o=this.xmin),a?a=this._regioncode(t=o,n=l):s=this._regioncode(i=o,r=l)}}_clipInfinite(t,n,i,r,a,s){let l,o=Array.from(n);if((l=this._project(o[0],o[1],i,r))&&o.unshift(l[0],l[1]),(l=this._project(o[o.length-2],o[o.length-1],a,s))&&o.push(l[0],l[1]),o=this._clipFinite(t,o))for(let f,u=0,c=o.length,h=this._edgecode(o[c-2],o[c-1]);u<c;u+=2)f=h,h=this._edgecode(o[u],o[u+1]),f&&h&&(u=this._edge(t,f,h,o,u),c=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,n,i,r,a){for(;n!==i;){let s,o;switch(n){case 5:n=4;continue;case 4:n=6,s=this.xmax,o=this.ymin;break;case 6:n=2;continue;case 2:n=10,s=this.xmax,o=this.ymax;break;case 10:n=8;continue;case 8:n=9,s=this.xmin,o=this.ymax;break;case 9:n=1;continue;case 1:n=5,s=this.xmin,o=this.ymin}(r[a]!==s||r[a+1]!==o)&&this.contains(t,s,o)&&(r.splice(a,0,s,o),a+=2)}if(r.length>4)for(let s=0;s<r.length;s+=2){const o=(s+2)%r.length,l=(s+4)%r.length;(r[s]===r[o]&&r[o]===r[l]||r[s+1]===r[o+1]&&r[o+1]===r[l+1])&&(r.splice(o,2),s-=2)}return a}_project(t,n,i,r){let s,o,l,a=1/0;if(r<0){if(n<=this.ymin)return null;(s=(this.ymin-n)/r)<a&&(l=this.ymin,o=t+(a=s)*i)}else if(r>0){if(n>=this.ymax)return null;(s=(this.ymax-n)/r)<a&&(l=this.ymax,o=t+(a=s)*i)}if(i>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/i)<a&&(o=this.xmax,l=n+(a=s)*r)}else if(i<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/i)<a&&(o=this.xmin,l=n+(a=s)*r)}return[o,l]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const rO=2*Math.PI,Oa=Math.pow;function aO(e){return e[0]}function sO(e){return e[1]}function lO(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class gp{static from(t,n=aO,i=sO,r){return new gp("length"in t?function(e,t,n,i){const r=e.length,a=new Float64Array(2*r);for(let s=0;s<r;++s){const o=e[s];a[2*s]=t.call(i,o,s,e),a[2*s+1]=n.call(i,o,s,e)}return a}(t,n,i,r):Float64Array.from(function*(e,t,n,i){let r=0;for(const a of e)yield t.call(i,a,r,e),yield n.call(i,a,r,e),++r}(t,n,i,r)))}constructor(t){this._delaunator=new hc(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],a=2*t[i+1],s=2*t[i+2];if((n[s]-n[r])*(n[a+1]-n[r+1])-(n[a]-n[r])*(n[s+1]-n[r+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:n.length/2},(h,d)=>d).sort((h,d)=>n[2*h]-n[2*d]||n[2*h+1]-n[2*d+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],c=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let h=0,d=n.length/2;h<d;++h){const g=lO(n[2*h],n[2*h+1],f);n[2*h]=g[0],n[2*h+1]=g[1]}this._delaunator=new hc(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,a=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let l=0,u=i.length;l<u;++l){const c=a[l%3==2?l-2:l+1];(-1===i[l]||-1===s[c])&&(s[c]=l)}for(let l=0,u=r.length;l<u;++l)o[r[l]]=l;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],s[r[0]]=1,2===r.length&&(s[r[1]]=0))}voronoi(t){return new iO(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:a,triangles:s,collinear:o}=this;if(o){const f=o.indexOf(t);return f>0&&(yield o[f-1]),void(f<o.length-1&&(yield o[f+1]))}const l=n[t];if(-1===l)return;let u=l,c=-1;do{if(yield c=s[u],u=u%3==2?u-2:u+1,s[u]!==t)return;if(u=a[u],-1===u){const f=i[(r[t]+1)%i.length];return void(f!==c&&(yield f))}}while(u!==l)}find(t,n,i=0){if((t=+t)!=t||(n=+n)!=n)return-1;const r=i;let a;for(;(a=this._step(i,t,n))>=0&&a!==i&&a!==r;)i=a;return a}_step(t,n,i){const{inedges:r,hull:a,_hullIndex:s,halfedges:o,triangles:l,points:u}=this;if(-1===r[t]||!u.length)return(t+1)%(u.length>>1);let c=t,f=Oa(n-u[2*t],2)+Oa(i-u[2*t+1],2);const h=r[t];let d=h;do{let g=l[d];const p=Oa(n-u[2*g],2)+Oa(i-u[2*g+1],2);if(p<f&&(f=p,c=g),d=d%3==2?d-2:d+1,l[d]!==t)break;if(d=o[d],-1===d){if(d=a[(s[t]+1)%a.length],d!==g&&Oa(n-u[2*d],2)+Oa(i-u[2*d+1],2)<f)return d;break}}while(d!==h);return c}render(t){const n=null==t?t=new Tr:void 0,{points:i,halfedges:r,triangles:a}=this;for(let s=0,o=r.length;s<o;++s){const l=r[s];if(l<s)continue;const u=2*a[s],c=2*a[l];t.moveTo(i[u],i[u+1]),t.lineTo(i[c],i[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const i=null==t?t=new Tr:void 0,{points:r}=this;for(let a=0,s=r.length;a<s;a+=2){const o=r[a],l=r[a+1];t.moveTo(o+n,l),t.arc(o,l,n,0,rO)}return i&&i.value()}renderHull(t){const n=null==t?t=new Tr:void 0,{hull:i,points:r}=this,a=2*i[0],s=i.length;t.moveTo(r[a],r[a+1]);for(let o=1;o<s;++o){const l=2*i[o];t.lineTo(r[l],r[l+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new dp;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=null==n?n=new Tr:void 0,{points:r,triangles:a}=this,s=2*a[t*=3],o=2*a[t+1],l=2*a[t+2];return n.moveTo(r[s],r[s+1]),n.lineTo(r[o],r[o+1]),n.lineTo(r[l],r[l+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new dp;return this.renderTriangle(t,n),n.value()}}function pp(e){F.call(this,null,e)}pp.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const fO=[-1e5,-1e5,1e5,1e5];function hO(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}z(pp,F,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:fO;const a=this.value=gp.from(i,e.x,e.y).voronoi(r);for(let s=0,o=i.length;s<o;++s){const l=a.cellPolygon(s);i[s][n]=l?hO(l):null}return t.reflow(e.modified()).modifies(n)}});var mp=Math.PI/180;function gO(e,t,n,i){if(!t.sprite){var r=e.context,a=e.ratio;r.clearRect(0,0,2048/a,2048/a);var c,f,h,d,g,s=0,o=0,l=0,u=n.length;for(--i;++i<u;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,c=r.measureText(t.text+"m").width*a,h=t.size<<1,t.rotate){var p=Math.sin(t.rotate*mp),m=Math.cos(t.rotate*mp),y=c*m,v=c*p,x=h*m,b=h*p;c=Math.max(Math.abs(y+b),Math.abs(y-b))+31>>5<<5,h=~~Math.max(Math.abs(v+x),Math.abs(v-x))}else c=c+31>>5<<5;if(h>l&&(l=h),s+c>=2048&&(s=0,o+=l,l=0),o+h>=2048)break;r.translate((s+(c>>1))/a,(o+(h>>1))/a),t.rotate&&r.rotate(t.rotate*mp),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=h,t.xoff=s,t.yoff=o,t.x1=c>>1,t.y1=h>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,s+=c}for(var w=r.getImageData(0,0,2048/a,2048/a).data,M=[];--i>=0;)if((t=n[i]).hasText){for(f=(c=t.width)>>5,h=t.y1-t.y0,d=0;d<h*f;d++)M[d]=0;if(null==(s=t.xoff))return;o=t.yoff;var _=0,E=-1;for(g=0;g<h;g++){for(d=0;d<c;d++){var D=w[2048*(o+g)+(s+d)<<2]?1<<31-d%32:0;M[f*g+(d>>5)]|=D,_|=D}_?E=g:(t.y0++,h--,g--,o++)}t.y1=t.y0+E,t.sprite=M.slice(0,(t.y1-t.y0)*f)}}}function pO(e,t,n){for(var c,i=e.sprite,r=e.width>>5,a=e.x-(r<<4),s=127&a,o=32-s,l=e.y1-e.y0,u=(e.y+e.y0)*(n>>=5)+(a>>5),f=0;f<l;f++){c=0;for(var h=0;h<=r;h++)if((c<<o|(h<r?(c=i[f*r+h])>>>s:0))&t[u+h])return!0;u+=n}return!1}function mO(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function yO(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function PM(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function Fr(e){return"function"==typeof e?e:function(){return e}}var bO={archimedean:PM,rectangular:function(e){var n=4*e[0]/e[1],i=0,r=0;return function(a){var s=a<0?-1:1;switch(Math.sqrt(1+4*s*a)-s&3){case 0:i+=n;break;case 1:r+=4;break;case 2:i-=n;break;default:r-=4}return[i,r]}}};const UM=["x","y","font","fontSize","fontStyle","fontWeight","angle"],_O=["text","font","rotate","fontSize","fontStyle","fontWeight"];function yp(e){F.call(this,function(){var t,n,i,r,a,s,o,e=[256,256],l=PM,u=[],c=Math.random,f={};function d(g,p,m){for(var _,E,A,y=p.x,v=p.y,x=Math.sqrt(e[0]*e[0]+e[1]*e[1]),b=l(e),w=c()<.5?1:-1,M=-w;(_=b(M+=w))&&(E=~~_[0],A=~~_[1],!(Math.min(Math.abs(E),Math.abs(A))>=x));)if(p.x=y+E,p.y=v+A,!(p.x+p.x0<0||p.y+p.y0<0||p.x+p.x1>e[0]||p.y+p.y1>e[1])&&(!m||!pO(p,g,e[0]))&&(!m||yO(p,m))){for(var U,D=p.sprite,k=p.width>>5,T=e[0]>>5,S=p.x-(k<<4),L=127&S,C=32-L,O=p.y1-p.y0,P=(p.y+p.y0)*T+(S>>5),Z=0;Z<O;Z++){U=0;for(var oe=0;oe<=k;oe++)g[P+oe]|=U<<C|(oe<k?(U=D[Z*k+oe])>>>L:0);P+=T}return p.sprite=null,!0}return!1}return f.layout=function(){for(var g=function(g){g.width=g.height=1;var p=Math.sqrt(g.getContext("2d").getImageData(0,0,1,1).data.length>>2);g.width=2048/p,g.height=2048/p;var m=g.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:p}}(la()),p=function(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}((e[0]>>5)*e[1]),m=null,y=u.length,v=-1,x=[],b=u.map(M=>({text:t(M),font:n(M),style:r(M),weight:a(M),rotate:s(M),size:~~(i(M)+1e-14),padding:o(M),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:M})).sort((M,_)=>_.size-M.size);++v<y;){var w=b[v];w.x=e[0]*(c()+.5)>>1,w.y=e[1]*(c()+.5)>>1,gO(g,w,b,v),w.hasText&&d(p,w,m)&&(x.push(w),m?mO(m,w):m=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=e[0]>>1,w.y-=e[1]>>1)}return x},f.words=function(g){return arguments.length?(u=g,f):u},f.size=function(g){return arguments.length?(e=[+g[0],+g[1]],f):e},f.font=function(g){return arguments.length?(n=Fr(g),f):n},f.fontStyle=function(g){return arguments.length?(r=Fr(g),f):r},f.fontWeight=function(g){return arguments.length?(a=Fr(g),f):a},f.rotate=function(g){return arguments.length?(s=Fr(g),f):s},f.text=function(g){return arguments.length?(t=Fr(g),f):t},f.spiral=function(g){return arguments.length?(l=bO[g]||g,f):l},f.fontSize=function(g){return arguments.length?(i=Fr(g),f):i},f.padding=function(g){return arguments.length?(o=Fr(g),f):o},f.random=function(g){return arguments.length?(c=g,f):c},f}(),e)}yp.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:UM}]},z(yp,F,{transform(e,t){e.size&&(!e.size[0]||!e.size[1])&&I("Wordcloud size dimensions must be non-zero.");const i=e.modified();if(!(i||t.changed(t.ADD_REM)||_O.some(function(g){const p=e[g];return ne(p)&&t.modified(p.fields)})))return;const r=t.materialize(t.SOURCE).source,a=this.value,s=e.as||UM;let l,o=e.fontSize||14;if(ne(o)?l=e.fontSizeRange:o=ht(o),l){const g=o,p=ve("sqrt")().domain(Zn(r,g)).range(l);o=m=>p(g(m))}r.forEach(g=>{g[s[0]]=NaN,g[s[1]]=NaN,g[s[3]]=0});const u=a.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(o).random(gn).layout(),c=a.size(),f=c[0]>>1,h=c[1]>>1,d=u.length;for(let p,m,g=0;g<d;++g)p=u[g],m=p.datum,m[s[0]]=p.x+f,m[s[1]]=p.y+h,m[s[2]]=p.font,m[s[3]]=p.size,m[s[4]]=p.style,m[s[5]]=p.weight,m[s[6]]=p.rotate;return t.reflow(i).modifies(s)}});const MO=e=>new Uint8Array(e),DO=e=>new Uint16Array(e),Mo=e=>new Uint32Array(e);function pc(e,t,n){const i=(t<257?MO:t<65537?DO:Mo)(e);return n&&i.set(n),i}function jM(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(r,a){const s=this,o=s.bisect(s.range,r.value),l=r.index,u=o[0],c=o[1],f=l.length;let h;for(h=0;h<u;++h)a[l[h]]|=i;for(h=c;h<f;++h)a[l[h]]|=i;return s}}}function qM(){let e=Mo(0),t=[],n=0;return{insert:function(o,l,u){if(!l.length)return[];const c=n,f=l.length,h=Mo(f);let g,p,m,d=Array(f);for(m=0;m<f;++m)d[m]=o(l[m]),h[m]=m;if(d=function(e,t){return e.sort.call(t,(n,i)=>{const r=e[n],a=e[i];return r<a?-1:r>a?1:0}),function(e,t){return Array.from(t,n=>e[n])}(e,t)}(d,h),c)g=t,p=e,t=Array(c+f),e=Mo(c+f),function(e,t,n,i,r,a,s,o,l){let f,u=0,c=0;for(f=0;u<i&&c<s;++f)t[u]<r[c]?(o[f]=t[u],l[f]=n[u++]):(o[f]=r[c],l[f]=a[c++]+e);for(;u<i;++u,++f)o[f]=t[u],l[f]=n[u];for(;c<s;++c,++f)o[f]=r[c],l[f]=a[c]+e}(u,g,p,c,d,h,f,t,e);else{if(u>0)for(m=0;m<f;++m)h[m]+=u;t=d,e=h}return n=c+f,{index:h,value:d}},remove:function(o,l){const u=n;let c,f,h;for(f=0;!l[e[f]]&&f<u;++f);for(h=f;f<u;++f)l[c=e[f]]||(e[h]=c,t[h]=t[f],++h);n=u-o},bisect:function(o,l){let u;return l?u=l.length:(l=t,u=n),[zT(l,o[0],0,u),Rl(l,o[1],0,u)]},reindex:function(o){for(let l=0,u=n;l<u;++l)e[l]=o[e[l]]},index:()=>e,size:()=>n}}function vp(e){F.call(this,function(){let e=8,t=[],n=Mo(0),i=pc(0,e),r=pc(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(a){for(let u,s=0,o=t.length,l=a.length;s<l;++s)u=a[s],u._index=o++,t.push(u)},remove(a,s){const o=t.length,l=Array(o-a),u=t;let c,f,h;for(f=0;!s[f]&&f<o;++f)l[f]=t[f],u[f]=f;for(h=f;f<o;++f)c=t[f],s[f]?u[f]=-1:(u[f]=h,i[h]=i[f],r[h]=r[f],l[h]=c,c._index=h++),i[f]=0;return t=l,u},size:()=>t.length,curr:()=>i,prev:()=>r,reset:a=>r[a]=i[a],all:()=>e<257?255:e<65537?65535:4294967295,set(a,s){i[a]|=s},clear(a,s){i[a]&=~s},resize(a,s){(a>i.length||s>e)&&(e=Math.max(s,e),i=pc(a,e,i),r=pc(a,e))}}}(),e),this._indices=null,this._dims=null}function xp(e){F.call(this,null,e)}vp.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},z(vp,F,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(i=>t.modified(i.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,i=e.query,r=this._indices={},a=this._dims=[],s=i.length;let l,u,o=0;for(;o<s;++o)l=n[o].fname,u=r[l]||(r[l]=qM()),a.push(jM(u,o,i[o]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,r=e.query,a=this._indices,s=this._dims,o=this.value,l=o.curr(),u=o.prev(),c=o.all(),f=n.rem=n.add,h=n.mod,d=r.length,g={};let p,m,y,v,x,b,w,M,_;if(u.set(l),t.rem.length&&(x=this.remove(e,t,n)),t.add.length&&o.add(t.add),t.mod.length)for(b={},v=t.mod,w=0,M=v.length;w<M;++w)b[v[w]._index]=1;for(w=0;w<d;++w)_=i[w],(!s[w]||e.modified("fields",w)||t.modified(_.fields))&&(y=_.fname,(p=g[y])||(a[y]=m=qM(),g[y]=p=m.insert(_,t.source,0)),s[w]=jM(m,w,r[w]).onAdd(p,l));for(w=0,M=o.data().length;w<M;++w)x[w]||(u[w]!==l[w]?f.push(w):b[w]&&l[w]!==c&&h.push(w));return o.mask=(1<<d)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},insert(e,t,n){const i=t.add,r=this.value,a=this._dims,s=this._indices,o=e.fields,l={},u=n.add,c=r.size()+i.length,f=a.length;let d,g,p,h=r.size();r.resize(c,f),r.add(i);const m=r.curr(),y=r.prev(),v=r.all();for(d=0;d<f;++d)g=o[d].fname,p=l[g]||(l[g]=s[g].insert(o[d],i,h)),a[d].onAdd(p,m);for(;h<c;++h)y[h]=v,m[h]!==v&&u.push(h)},modify(e,t){const n=t.mod,i=this.value,r=i.curr(),a=i.all(),s=e.mod;let o,l,u;for(o=0,l=s.length;o<l;++o)u=s[o]._index,r[u]!==a&&n.push(u)},remove(e,t,n){const i=this._indices,r=this.value,a=r.curr(),s=r.prev(),o=r.all(),l={},u=n.rem,c=t.rem;let f,h,d,g;for(f=0,h=c.length;f<h;++f)d=c[f]._index,l[d]=1,s[d]=g=a[d],a[d]=o,g!==o&&u.push(d);for(d in i)i[d].remove(h,l);return this.reindex(t,h,l),l},reindex(e,t,n){const i=this._indices,r=this.value;e.runAfter(()=>{const a=r.remove(t,n);for(const s in i)i[s].reindex(a)})},update(e,t,n){const i=this._dims,r=e.query,a=t.stamp,s=i.length;let l,u,o=0;for(n.filters=0,u=0;u<s;++u)e.modified("query",u)&&(l=u,++o);if(1===o)o=i[l].one,this.incrementOne(i[l],r[l],n.add,n.rem);else for(u=0,o=0;u<s;++u)!e.modified("query",u)||(o|=i[u].one,this.incrementAll(i[u],r[u],a,n.add),n.rem=n.add);return o},incrementAll(e,t,n,i){const r=this.value,a=r.seen(),s=r.curr(),o=r.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],h=c[1],d=u[0],g=u[1],p=e.one;let m,y,v;if(f<d)for(m=f,y=Math.min(d,h);m<y;++m)v=l[m],a[v]!==n&&(o[v]=s[v],a[v]=n,i.push(v)),s[v]^=p;else if(f>d)for(m=d,y=Math.min(f,g);m<y;++m)v=l[m],a[v]!==n&&(o[v]=s[v],a[v]=n,i.push(v)),s[v]^=p;if(h>g)for(m=Math.max(f,g),y=h;m<y;++m)v=l[m],a[v]!==n&&(o[v]=s[v],a[v]=n,i.push(v)),s[v]^=p;else if(h<g)for(m=Math.max(d,h),y=g;m<y;++m)v=l[m],a[v]!==n&&(o[v]=s[v],a[v]=n,i.push(v)),s[v]^=p;e.range=t.slice()},incrementOne(e,t,n,i){const a=this.value.curr(),s=e.index(),o=e.bisect(e.range),l=e.bisect(t),u=l[0],c=l[1],f=o[0],h=o[1],d=e.one;let g,p,m;if(u<f)for(g=u,p=Math.min(f,c);g<p;++g)m=s[g],a[m]^=d,n.push(m);else if(u>f)for(g=f,p=Math.min(u,h);g<p;++g)m=s[g],a[m]^=d,i.push(m);if(c>h)for(g=Math.max(u,h),p=c;g<p;++g)m=s[g],a[m]^=d,n.push(m);else if(c<h)for(g=Math.max(f,c),p=h;g<p;++g)m=s[g],a[m]^=d,i.push(m);e.range=t.slice()}}),xp.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},z(xp,F,{transform(e,t){const n=~(e.ignore||0),i=e.filter,r=i.mask;if(0==(r&n))return t.StopPropagation;const a=t.fork(t.ALL),s=i.data(),o=i.curr(),l=i.prev(),u=c=>o[c]&n?null:s[c];return a.filter(a.MOD,u),r&r-1?(a.filter(a.ADD,c=>{const f=o[c]&n;return!f&&f^l[c]&n?s[c]:null}),a.filter(a.REM,c=>{const f=o[c]&n;return!f||f^f^l[c]&n?null:s[c]})):(a.filter(a.ADD,u),a.filter(a.REM,c=>(o[c]&n)===r?s[c]:null)),a.filter(a.SOURCE,c=>u(c._index))}});const Br="Literal",VM="CallExpression";function wn(e){this.type=e}var Gn,q,B,lt,_e;wn.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case VM:return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];default:return[]}}(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1},(Gn={})[1]="Boolean",Gn[2]="<end>",Gn[3]="Identifier",Gn[4]="Keyword",Gn[5]="Null",Gn[6]="Numeric",Gn[7]="Punctuator",Gn[8]="String",Gn[9]="RegularExpression";var $M="Identifier",Ge="Unexpected token %0",bp="Invalid regular expression",_p="Invalid regular expression: missing /",GM="Octal literals are not allowed in strict mode.",et="ILLEGAL",ko="Disabled.",iL=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),rL=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function vc(e,t){if(!e)throw new Error("ASSERT: "+t)}function fi(e){return e>=48&&e<=57}function wp(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Ao(e){return"01234567".indexOf(e)>=0}function aL(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Co(e){return 10===e||13===e||8232===e||8233===e}function So(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&iL.test(String.fromCharCode(e))}function xc(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&rL.test(String.fromCharCode(e))}const sL={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function YM(){for(;B<lt;){const e=q.charCodeAt(B);if(!aL(e)&&!Co(e))break;++B}}function Mp(e){var t,n,i,r=0;for(n="u"===e?4:2,t=0;t<n;++t)B<lt&&wp(q[B])?(i=q[B++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):me({},Ge,et);return String.fromCharCode(r)}function oL(){var e,t;for(t=0,"}"===(e=q[B])&&me({},Ge,et);B<lt&&wp(e=q[B++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&me({},Ge,et),t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}function WM(){var e,t;for(e=q.charCodeAt(B++),t=String.fromCharCode(e),92===e&&(117!==q.charCodeAt(B)&&me({},Ge,et),++B,(!(e=Mp("u"))||"\\"===e||!So(e.charCodeAt(0)))&&me({},Ge,et),t=e);B<lt&&xc(e=q.charCodeAt(B));)++B,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==q.charCodeAt(B)&&me({},Ge,et),++B,(!(e=Mp("u"))||"\\"===e||!xc(e.charCodeAt(0)))&&me({},Ge,et),t+=e);return t}function Dp(){var n,r,a,s,e=B,t=q.charCodeAt(B),i=q[B];switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++B,{type:7,value:String.fromCharCode(t),start:e,end:B};default:if(61===(n=q.charCodeAt(B+1)))switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return B+=2,{type:7,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:B};case 33:case 61:return 61===q.charCodeAt(B+=2)&&++B,{type:7,value:q.slice(e,B),start:e,end:B}}}return">>>="===(s=q.substr(B,4))?{type:7,value:s,start:e,end:B+=4}:">>>"===(a=s.substr(0,3))||"<<="===a||">>="===a?{type:7,value:a,start:e,end:B+=3}:i===(r=a.substr(0,2))[1]&&"+-<>&|".indexOf(i)>=0||"=>"===r?{type:7,value:r,start:e,end:B+=2}:("//"===r&&me({},Ge,et),"<>=!+-*%&|^/".indexOf(i)>=0?{type:7,value:i,start:e,end:++B}:void me({},Ge,et))}function HM(){var e,t,n;if(vc(fi((n=q[B]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=B,e="","."!==n){if(e=q[B++],n=q[B],"0"===e){if("x"===n||"X"===n)return++B,function(e){let t="";for(;B<lt&&wp(q[B]);)t+=q[B++];return 0===t.length&&me({},Ge,et),So(q.charCodeAt(B))&&me({},Ge,et),{type:6,value:parseInt("0x"+t,16),start:e,end:B}}(t);if(Ao(n))return function(e){let t="0"+q[B++];for(;B<lt&&Ao(q[B]);)t+=q[B++];return(So(q.charCodeAt(B))||fi(q.charCodeAt(B)))&&me({},Ge,et),{type:6,value:parseInt(t,8),octal:!0,start:e,end:B}}(t);n&&fi(n.charCodeAt(0))&&me({},Ge,et)}for(;fi(q.charCodeAt(B));)e+=q[B++];n=q[B]}if("."===n){for(e+=q[B++];fi(q.charCodeAt(B));)e+=q[B++];n=q[B]}if("e"===n||"E"===n)if(e+=q[B++],("+"===(n=q[B])||"-"===n)&&(e+=q[B++]),fi(q.charCodeAt(B)))for(;fi(q.charCodeAt(B));)e+=q[B++];else me({},Ge,et);return So(q.charCodeAt(B))&&me({},Ge,et),{type:6,value:parseFloat(e),start:t,end:B}}function XM(){if(YM(),B>=lt)return{type:2,start:B,end:B};const e=q.charCodeAt(B);return So(e)?function(){var e,t;return e=B,t=92===q.charCodeAt(B)?WM():function(){var e,t;for(e=B++;B<lt;){if(92===(t=q.charCodeAt(B)))return B=e,WM();if(!xc(t))break;++B}return q.slice(e,B)}(),{type:1===t.length?3:sL.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:B}}():40===e||41===e||59===e?Dp():39===e||34===e?function(){var t,n,i,r,e="",a=!1;for(vc("'"===(t=q[B])||'"'===t,"String literal must starts with a quote"),n=B,++B;B<lt;){if((i=q[B++])===t){t="";break}if("\\"===i)if((i=q[B++])&&Co(i.charCodeAt(0)))"\r"===i&&"\n"===q[B]&&++B;else switch(i){case"u":case"x":"{"===q[B]?(++B,e+=oL()):e+=Mp(i);break;case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Ao(i)?(0!==(r="01234567".indexOf(i))&&(a=!0),B<lt&&Ao(q[B])&&(a=!0,r=8*r+"01234567".indexOf(q[B++]),"0123".indexOf(i)>=0&&B<lt&&Ao(q[B])&&(r=8*r+"01234567".indexOf(q[B++]))),e+=String.fromCharCode(r)):e+=i}else{if(Co(i.charCodeAt(0)))break;e+=i}}return""!==t&&me({},Ge,et),{type:8,value:e,octal:a,start:n,end:B}}():46===e?fi(q.charCodeAt(B+1))?HM():Dp():fi(e)?HM():Dp()}function Rt(){const e=_e;return B=e.end,_e=XM(),B=e.end,e}function ZM(){const e=B;_e=XM(),B=e}function KM(e,t,n){const i=new wn("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return i.operator=e,i.left=t,i.right=n,i}function xL(e,t){const n=new wn("CallExpression");return n.callee=e,n.arguments=t,n}function Ep(e){const t=new wn($M);return t.name=e,t}function To(e){const t=new wn("Literal");return t.value=e.value,t.raw=q.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function JM(e,t,n){const i=new wn("MemberExpression");return i.computed="["===e,i.object=t,i.property=n,i.computed||(n.member=!0),i}function QM(e,t,n){const i=new wn("Property");return i.key=t,i.value=n,i.kind=e,i}function me(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(a,s)=>(vc(s<i.length,"Message reference must be in range"),i[s]));throw(n=new Error(r)).index=B,n.description=r,n}function bc(e){2===e.type&&me(e,"Unexpected end of input"),6===e.type&&me(e,"Unexpected number"),8===e.type&&me(e,"Unexpected string"),3===e.type&&me(e,"Unexpected identifier"),4===e.type&&me(e,"Unexpected reserved word"),me(e,Ge,e.value)}function ut(e){const t=Rt();(7!==t.type||t.value!==e)&&bc(t)}function Ae(e){return 7===_e.type&&_e.value===e}function kp(e){return 4===_e.type&&_e.value===e}function eD(){B=_e.start;const e=Rt();return 8===e.type||6===e.type?(e.octal&&me(e,GM),To(e)):Ep(e.value)}function DL(){var e,t,n;return B=_e.start,3===(e=_e).type?(n=eD(),ut(":"),QM("init",n,Or())):2!==e.type&&7!==e.type?(t=eD(),ut(":"),QM("init",t,Or())):void bc(e)}const AL={if:1};function CL(){var e,t,n;if(Ae("("))return function(){ut("(");const e=Ap();return ut(")"),e}();if(Ae("["))return function(){const e=[];for(B=_e.start,ut("[");!Ae("]");)Ae(",")?(Rt(),e.push(null)):(e.push(Or()),Ae("]")||ut(","));return Rt(),function(e){const t=new wn("ArrayExpression");return t.elements=e,t}(e)}();if(Ae("{"))return function(){var t,i,e=[],r={},a=String;for(B=_e.start,ut("{");!Ae("}");)i="$"+((t=DL()).key.type===$M?t.key.name:a(t.key.value)),Object.prototype.hasOwnProperty.call(r,i)?me({},"Duplicate data property in object literal not allowed in strict mode"):r[i]=!0,e.push(t),Ae("}")||ut(",");return ut("}"),function(e){const t=new wn("ObjectExpression");return t.properties=e,t}(e)}();if(B=_e.start,3===(e=_e.type)||AL[_e.value])n=Ep(Rt().value);else if(8===e||6===e)_e.octal&&me(_e,GM),n=To(Rt());else{if(4===e)throw new Error(ko);1===e?((t=Rt()).value="true"===t.value,n=To(t)):5===e?((t=Rt()).value=null,n=To(t)):Ae("/")||Ae("/=")?(n=To(function(){var e,t,n,i;return _e=null,YM(),e=B,t=function(){var e,t,n,i;for(vc("/"===(e=q[B]),"Regular expression literal must start with a slash"),t=q[B++],n=!1,i=!1;B<lt;)if(t+=e=q[B++],"\\"===e)Co((e=q[B++]).charCodeAt(0))&&me({},_p),t+=e;else if(Co(e.charCodeAt(0)))me({},_p);else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||me({},_p),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";B<lt&&xc((e=q[B]).charCodeAt(0));)++B,"\\"===e&&B<lt?me({},Ge,et):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&me({},bp,n),{value:n,literal:t}}(),i=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";me({},bp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(i){me({},bp)}try{return new RegExp(e,t)}catch(i){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:B}}()),ZM()):bc(Rt())}return n}function SL(){const e=[];if(ut("("),!Ae(")"))for(;B<lt&&(e.push(Or()),!Ae(")"));)ut(",");return ut(")"),e}function BL(){ut("[");const e=Ap();return ut("]"),e}function tD(){const e=function(){var e;for(e=CL();;)if(Ae("."))e=JM(".",e,(ut("."),function(){B=_e.start;const e=Rt();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||bc(e),Ep(e.value)}()));else if(Ae("("))e=xL(e,SL());else{if(!Ae("["))break;e=JM("[",e,BL())}return e}();if(7===_e.type&&(Ae("++")||Ae("--")))throw new Error(ko);return e}function _c(){var e,t;if(7!==_e.type&&4!==_e.type)t=tD();else{if(Ae("++")||Ae("--"))throw new Error(ko);if(Ae("+")||Ae("-")||Ae("~")||Ae("!"))e=Rt(),t=_c(),t=function(e,t){const n=new wn("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(kp("delete")||kp("void")||kp("typeof"))throw new Error(ko);t=tD()}}return t}function nD(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Or(){var e,t;return e=function(){var e,t,n,i,r,a,s,o,l,u;if(e=_e,l=_c(),0===(r=nD(i=_e)))return l;for(i.prec=r,Rt(),t=[e,_e],a=[l,i,s=_c()];(r=nD(_e))>0;){for(;a.length>2&&r<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,l=a.pop(),t.pop(),n=KM(o,l,s),a.push(n);(i=Rt()).prec=r,a.push(i),t.push(_e),n=_c(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=KM(a[u-1].value,a[u-2],n),u-=2;return n}(),Ae("?")&&(Rt(),t=Or(),ut(":"),e=function(e,t,n){const i=new wn("ConditionalExpression");return i.test=e,i.consequent=t,i.alternate=n,i}(e,t,Or())),e}function Ap(){const e=Or();if(Ae(","))throw new Error(ko);return e}var iD={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function rD(e){function n(s,o,l){return u=>function(s,o,l,u){let c=e(o[0]);return l&&(c=l+"("+c+")",0===l.lastIndexOf("new ",0)&&(c="("+c+")")),c+"."+s+(u<0?"":0===u?"()":"("+o.slice(1).map(e).join(",")+")")}(s,u,o,l)}const i="new Date",r="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(s){s.length<3&&I("Missing arguments to clamp function."),s.length>3&&I("Too many arguments to clamp function.");const o=s.map(e);return"Math.max("+o[1]+", Math.min("+o[2]+","+o[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:a,test:n("test",a),if:function(s){s.length<3&&I("Missing arguments to if function."),s.length>3&&I("Too many arguments to if function.");const o=s.map(e);return"("+o[0]+"?"+o[1]+":"+o[2]+")"}}}var aD,sD,Cp,Sp,Tp,wc=new Je,Mc=new Je,Yn={point:Qe,lineStart:Qe,lineEnd:Qe,polygonStart:function(){wc=new Je,Yn.lineStart=NL,Yn.lineEnd=PL},polygonEnd:function(){var e=+wc;Mc.add(e<0?yt+e:e),this.lineStart=this.lineEnd=this.point=Qe},sphere:function(){Mc.add(yt)}};function NL(){Yn.point=UL}function PL(){oD(aD,sD)}function UL(e,t){Yn.point=oD,aD=e,sD=t,Cp=e*=re,Sp=X(t=(t*=re)/2+Tu),Tp=V(t)}function oD(e,t){var n=(e*=re)-Cp,i=n>=0?1:-1,r=i*n,a=X(t=(t*=re)/2+Tu),s=V(t),o=Tp*s,l=Sp*a+o*X(r),u=o*i*V(r);wc.add(an(u,l)),Cp=e,Sp=a,Tp=s}var Fe,Ot,Ie,$t,Lr,lD,uD,La,Fo,Hi,hi,di={point:Fp,lineStart:fD,lineEnd:hD,polygonStart:function(){di.point=dD,di.lineStart=qL,di.lineEnd=VL,Fo=new Je,Yn.polygonStart()},polygonEnd:function(){Yn.polygonEnd(),di.point=Fp,di.lineStart=fD,di.lineEnd=hD,wc<0?(Fe=-(Ie=180),Ot=-($t=90)):Fo>H?$t=90:Fo<-H&&(Ot=-90),hi[0]=Fe,hi[1]=Ie},sphere:function(){Fe=-(Ie=180),Ot=-($t=90)}};function Fp(e,t){Hi.push(hi=[Fe=e,Ie=e]),t<Ot&&(Ot=t),t>$t&&($t=t)}function cD(e,t){var n=Ar([e*re,t*re]);if(La){var i=Ca(La,n),a=Ca([i[1],-i[0],0],i);$u(a),a=ju(a);var u,s=e-Lr,o=s>0?1:-1,l=a[0]*Oe*o,c=he(s)>180;c^(o*Lr<l&&l<o*e)?(u=a[1]*Oe)>$t&&($t=u):c^(o*Lr<(l=(l+360)%360-180)&&l<o*e)?(u=-a[1]*Oe)<Ot&&(Ot=u):(t<Ot&&(Ot=t),t>$t&&($t=t)),c?e<Lr?Gt(Fe,e)>Gt(Fe,Ie)&&(Ie=e):Gt(e,Ie)>Gt(Fe,Ie)&&(Fe=e):Ie>=Fe?(e<Fe&&(Fe=e),e>Ie&&(Ie=e)):e>Lr?Gt(Fe,e)>Gt(Fe,Ie)&&(Ie=e):Gt(e,Ie)>Gt(Fe,Ie)&&(Fe=e)}else Hi.push(hi=[Fe=e,Ie=e]);t<Ot&&(Ot=t),t>$t&&($t=t),La=n,Lr=e}function fD(){di.point=cD}function hD(){hi[0]=Fe,hi[1]=Ie,di.point=Fp,La=null}function dD(e,t){if(La){var n=e-Lr;Fo.add(he(n)>180?n+(n>0?360:-360):n)}else lD=e,uD=t;Yn.point(e,t),cD(e,t)}function qL(){Yn.lineStart()}function VL(){dD(lD,uD),Yn.lineEnd(),he(Fo)>H&&(Fe=-(Ie=180)),hi[0]=Fe,hi[1]=Ie,La=null}function Gt(e,t){return(t-=e)<0?t+360:t}function $L(e,t){return e[0]-t[0]}function gD(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var Bo,Dc,Ec,kc,Ac,Cc,Sc,Tc,Bp,Ip,Rp,pD,mD,Mt,Dt,Et,Mn={sphere:Qe,point:Op,lineStart:yD,lineEnd:vD,polygonStart:function(){Mn.lineStart=HL,Mn.lineEnd=XL},polygonEnd:function(){Mn.lineStart=yD,Mn.lineEnd=vD}};function Op(e,t){e*=re;var n=X(t*=re);Io(n*X(e),n*V(e),V(t))}function Io(e,t,n){++Bo,Ec+=(e-Ec)/Bo,kc+=(t-kc)/Bo,Ac+=(n-Ac)/Bo}function yD(){Mn.point=YL}function YL(e,t){e*=re;var n=X(t*=re);Mt=n*X(e),Dt=n*V(e),Et=V(t),Mn.point=WL,Io(Mt,Dt,Et)}function WL(e,t){e*=re;var n=X(t*=re),i=n*X(e),r=n*V(e),a=V(t),s=an(vt((s=Dt*a-Et*r)*s+(s=Et*i-Mt*a)*s+(s=Mt*r-Dt*i)*s),Mt*i+Dt*r+Et*a);Dc+=s,Cc+=s*(Mt+(Mt=i)),Sc+=s*(Dt+(Dt=r)),Tc+=s*(Et+(Et=a)),Io(Mt,Dt,Et)}function vD(){Mn.point=Op}function HL(){Mn.point=ZL}function XL(){xD(pD,mD),Mn.point=Op}function ZL(e,t){pD=e,mD=t,e*=re,t*=re,Mn.point=xD;var n=X(t);Mt=n*X(e),Dt=n*V(e),Et=V(t),Io(Mt,Dt,Et)}function xD(e,t){e*=re;var n=X(t*=re),i=n*X(e),r=n*V(e),a=V(t),s=Dt*a-Et*r,o=Et*i-Mt*a,l=Mt*r-Dt*i,u=W0(s,o,l),c=Bt(u),f=u&&-c/u;Bp.add(f*s),Ip.add(f*o),Rp.add(f*l),Dc+=c,Cc+=c*(Mt+(Mt=i)),Sc+=c*(Dt+(Dt=r)),Tc+=c*(Et+(Et=a)),Io(Mt,Dt,Et)}const Lp="intersect",Fc="index:unit";function wD(e,t){for(var s,o,n=t.fields,i=t.values,r=n.length,a=0;a<r;++a)if((o=n[a]).getter=Pt.getter||Pt(o.field),er(s=o.getter(e))&&(s=ft(s)),er(i[a])&&(i[a]=ft(i[a])),er(i[a][0])&&(i[a]=i[a].map(ft)),"E"===o.type){if($(i[a])?i[a].indexOf(s)<0:s!==i[a])return!1}else if("R"===o.type){if(!Wa(s,i[a]))return!1}else if("R-RE"===o.type){if(!Wa(s,i[a],!0,!1))return!1}else if("R-E"===o.type){if(!Wa(s,i[a],!1,!1))return!1}else if("R-LE"===o.type&&!Wa(s,i[a],!1,!0))return!1;return!0}const zp=Pt("_vgsid_"),MD=function(e){let t=e,n=e;function i(s,o,l,u){for(null==l&&(l=0),null==u&&(u=s.length);l<u;){const c=l+u>>>1;n(s[c],o)<0?l=c+1:u=c}return l}return 1===e.length&&(t=(s,o)=>e(s)-o,n=function(e){return(t,n)=>function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}(e(t),n)}(e)),{left:i,center:function(s,o,l,u){null==l&&(l=0),null==u&&(u=s.length);const c=i(s,o,l,u-1);return c>l&&t(s[c-1],o)>-t(s[c],o)?c-1:c},right:function(s,o,l,u){for(null==l&&(l=0),null==u&&(u=s.length);l<u;){const c=l+u>>>1;n(s[c],o)>0?u=c:l=c+1}return l}}}(zp),fz=MD.left,hz=MD.right;var DD={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=ft(t[0]),i=ft(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=ft(t[0]),i=ft(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};function Np(e,t,n,i){t[0].type!==Br&&I("First argument to selection functions must be a string literal.");const r=t[0].value,s="unit",o="@"+s,l=":"+r;(t.length>=2&&ce(t).value)===Lp&&!J(i,o)&&(i[o]=n.getData(r).indataRef(n,s)),J(i,l)||(i[l]=n.getData(r).tuplesRef())}function ED(e){const t=this.context.data[e];return t?t.values.value:[]}const Ro=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},_z=Ro("format"),kD=Ro("timeFormat"),wz=Ro("utcFormat"),Mz=Ro("timeParse"),Dz=Ro("utcParse"),Bc=new Date(2e3,0,1);function Ic(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(Bc.setYear(2e3),Bc.setMonth(e),Bc.setDate(t),kD.call(this,Bc,n)):""}function Up(e,t,n,i){t[0].type!==Br&&I("First argument to data functions must be a string literal.");const r=t[0].value,a=":"+r;if(!J(a,i))try{i[a]=n.getData(r).tuplesRef()}catch(s){}}function Lt(e,t,n,i){if(t[0].type===Br)CD(n,i,t[0].value);else for(e in n.scales)CD(n,i,e)}function CD(e,t,n){const i="%"+n;if(!J(t,i))try{t[i]=e.scaleRef(n)}catch(r){}}function gi(e,t){let n;return ne(e)?e:ke(e)?(n=t.scales[e])&&n.value:void 0}function jp(e,t){return function(n,i,r){if(n){const a=gi(n,(r||this).context);return a&&a.path[e](i)}return t(i)}}const Iz=jp("area",function(e){return Mc=new Je,oi(e,Yn),2*Mc}),Rz=jp("bounds",function(e){var t,n,i,r,a,s,o;if($t=Ie=-(Fe=Ot=1/0),Hi=[],oi(e,di),n=Hi.length){for(Hi.sort($L),t=1,a=[i=Hi[0]];t<n;++t)gD(i,(r=Hi[t])[0])||gD(i,r[1])?(Gt(i[0],r[1])>Gt(i[0],i[1])&&(i[1]=r[1]),Gt(r[0],i[1])>Gt(i[0],i[1])&&(i[0]=r[0])):a.push(i=r);for(s=-1/0,t=0,i=a[n=a.length-1];t<=n;i=r,++t)(o=Gt(i[1],(r=a[t])[0]))>s&&(s=o,Fe=r[0],Ie=i[1])}return Hi=hi=null,Fe===1/0||Ot===1/0?[[NaN,NaN],[NaN,NaN]]:[[Fe,Ot],[Ie,$t]]}),Oz=jp("centroid",function(e){Bo=Dc=Ec=kc=Ac=Cc=Sc=Tc=0,Bp=new Je,Ip=new Je,Rp=new Je,oi(e,Mn);var t=+Bp,n=+Ip,i=+Rp,r=W0(t,n,i);return r<Su&&(t=Cc,n=Sc,i=Tc,Dc<H&&(t=Ec,n=kc,i=Ac),(r=W0(t,n,i))<Su)?[NaN,NaN]:[an(n,t)*Oe,Bt(i/r)*Oe]});function qp(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function Vp(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $p(e){const t=Ti(e);return.2126*Vp(t.r)+.7152*Vp(t.g)+.0722*Vp(t.b)}function SD(e,t){return e===t||e!=e&&t!=t||($(e)?!(!$(t)||e.length!==t.length)&&function(e,t){for(let n=0,i=e.length;n<i;++n)if(!SD(e[n],t[n]))return!1;return!0}(e,t):!(!ee(e)||!ee(t))&&TD(e,t))}function TD(e,t){for(const n in e)if(!SD(e[n],t[n]))return!1;return!0}function FD(e){return t=>TD(e,t)}const BD={};function Gp(e){return $(e)||ArrayBuffer.isView(e)?e:null}function Yp(e){return Gp(e)||(ke(e)?e:null)}const ID=e=>e.data;function RD(e,t){const n=ED.call(t,e);return n.root&&n.root.lookup||{}}const OD=()=>"undefined"!=typeof window&&window||null,Oo={random:()=>gn(),cumulativeNormal:mh,cumulativeLogNormal:$y,cumulativeUniform:Hy,densityNormal:Py,densityLogNormal:Vy,densityUniform:Wy,quantileNormal:yh,quantileLogNormal:Gy,quantileUniform:Xy,sampleNormal:ph,sampleLogNormal:qy,sampleUniform:Yy,isArray:$,isBoolean:function(e){return"boolean"==typeof e},isDate:er,isDefined:e=>void 0!==e,isNumber:Ha,isObject:ee,isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},isString:ke,isTuple:ih,isValid:e=>null!=e&&e==e,toBoolean:Zm,toDate:Km,toNumber:ft,toString:Jm,indexof:function(e,...t){return Yp(e).indexOf(...t)},join:function(e,...t){return Gp(e).join(...t)},lastindexof:function(e,...t){return Yp(e).lastIndexOf(...t)},replace:function(e,t,n){return ne(n)&&I("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return Gp(e).slice().reverse()},slice:function(e,...t){return Yp(e).slice(...t)},flush:function(e,t,n,i,r,a){if(!n&&0!==n)return a;const s=+n;let u,o=e[0],l=ce(e);l<o&&(u=o,o=l,l=u),u=Math.abs(t-o);const c=Math.abs(l-t);return u<c&&u<=s?i:c<=s?r:a},lerp:function(e,t){const n=e[0],i=ce(e),r=+t;return r?1===r?i:n+r*(i-n):n},merge:function(){const e=[].slice.call(arguments);return e.unshift({}),te(...e)},pad:function(e,t,n,i){const r=n||" ",a=e+"",s=t-a.length;return s<=0?a:"left"===i?rl(r,s)+a:"center"===i?rl(r,~~(s/2))+a+rl(r,Math.ceil(s/2)):a+rl(r,s)},peek:ce,pluck:function(e,t){const n=BD[t]||(BD[t]=Pt(t));return $(e)?e.map(n):n(e)},span:al,inrange:Wa,truncate:function(e,t,n,i){const r=null!=i?i:"\u2026",a=e+"",s=a.length,o=Math.max(0,t-r.length);return s<=t?a:"left"===n?r+a.slice(s-o):"center"===n?a.slice(0,Math.ceil(o/2))+r+a.slice(s-~~(o/2)):a.slice(0,o)+r},rgb:Ti,lab:$l,hcl:Gl,hsl:Ll,luminance:$p,contrast:function(e,t){const n=$p(e),i=$p(t);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},sequence:qt,format:_z,utcFormat:wz,utcParse:Dz,utcOffset:function(e,t,n){return R1(es(e),t,n)},utcSequence:function(e,t,n,i){return O1(es(e),t,n,i)},timeFormat:kD,timeParse:Mz,timeOffset:function(e,t,n){return R1(Qa(e),t,n)},timeSequence:function(e,t,n,i){return O1(Qa(e),t,n,i)},timeUnitSpecifier:function(e,t){const n=te({},oC,t),i=T1(e),r=i.length;let o,l,a="",s=0;for(s=0;s<r;)for(o=i.length;o>s;--o)if(l=i.slice(s,o).join("-"),null!=n[l]){a+=n[l],s=o;break}return a.trim()},monthFormat:function(e){return Ic.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return Ic.call(this,e,1,"%b")},dayFormat:function(e){return Ic.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return Ic.call(this,0,2+e,"%a")},quarter:function(e){return 1+~~(new Date(e).getMonth()/3)},utcquarter:function(e){return 1+~~(new Date(e).getUTCMonth()/3)},week:function(e){return Of(new Date(e))},utcweek:function(e){return zf(new Date(e))},dayofyear:function(e){return F1(new Date(e))},utcdayofyear:function(e){return B1(new Date(e))},warn:function(){return qp(this.context.dataflow,"warn",arguments)},info:function(){return qp(this.context.dataflow,"info",arguments)},debug:function(){return qp(this.context.dataflow,"debug",arguments)},extent:Zn,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[i,r]=e,a=(new $e).set(i[0],i[1],r[0],r[1]);return function(e,t,n){const i=[],r=(new $e).union(t),a=e.marktype;return a?Kb(e,r,n,i):"group"===a?Jb(e,r,n,i):I("Intersect scene must be mark node or group item.")}(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=K(e.marktype),i=K(e.markname);t=r=>(!n.length||n.some(a=>r.marktype===a))&&(!i.length||i.some(a=>r.name===a))}return t}(t))},clampRange:function(e,t,n){let a,i=e[0],r=e[1];return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]},pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=OD();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=OD();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return Id(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow;return n.pulse(this.context.data[e].input,n.changeset().remove(hn).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?Ql(n,t=t||Ls(e)):e}},panLinear:function(e,t){return tl(e,t,ft,St)},panLog:function(e,t){var n=Math.sign(e[0]);return tl(e,t,jm(n),Um(n))},panPow:function(e,t,n){return tl(e,t,el(n),el(1/n))},panSymlog:function(e,t,n){return tl(e,t,qm(n),Vm(n))},zoomLinear:$m,zoomLog:Gm,zoomPow:ff,zoomSymlog:Ym,encode:function(e,t,n){if(e){const i=this.context.dataflow;i.pulse(e.mark.source,i.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,i,r,a){const s=this.context.dataflow,o=this.context.data[e],l=o.input,u=s.stamp();let f,h,c=o.changes;if(!1===s._trigger||!(l.value.length||t||i))return 0;if((!c||c.stamp<u)&&(o.changes=c=s.changeset(),c.stamp=u,s.runAfter(()=>{o.modified=!0,s.pulse(l,c).run()},!0,1)),n&&(f=!0===n?hn:$(n)||ih(n)?n:FD(n),c.remove(f)),t&&c.insert(t),i&&(f=FD(i),l.value.some(f)?c.remove(f):c.insert(i)),r)for(h in a)c.modify(r,h,a[h]);return 1}},mN=["view","item","group","xy","x","y"],LD="this.",Wp={},zD={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${W("$"+e)}]`,functions:function(e){const t=rD(e);mN.forEach(n=>t[n]="event.vega."+n);for(const n in Oo)t[n]=LD+n;return te(t,function(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=Lt,n._range=Lt,n._scale=Lt;const i=r=>"_["+(r.type===Br?W("%"+r.value):W("%")+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}(e,Oo,Wp)),t},constants:iD,visitors:Wp},Hp=function(e){const t=(e=e||{}).allowed?Sn(e.allowed):{},n=e.forbidden?Sn(e.forbidden):{},i=e.constants||iD,r=(e.functions||rD)(f),a=e.globalvar,s=e.fieldvar,o=ne(a)?a:g=>`${a}["${g}"]`;let l={},u={},c=0;function f(g){if(ke(g))return g;const p=h[g.type];return null==p&&I("Unsupported type: "+g.type),p(g)}const h={Literal:g=>g.raw,Identifier:g=>{const p=g.name;return c>0?p:J(n,p)?I("Illegal identifier: "+p):J(i,p)?i[p]:J(t,p)?p:(l[p]=1,o(p))},MemberExpression:g=>{const p=!g.computed,m=f(g.object);p&&(c+=1);const y=f(g.property);return m===s&&(u[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(y)]=1),p&&(c-=1),m+(p?"."+y:"["+y+"]")},CallExpression:g=>{"Identifier"!==g.callee.type&&I("Illegal callee type: "+g.callee.type);const p=g.callee.name,m=g.arguments,y=J(r,p)&&r[p];return y||I("Unrecognized function: "+p),ne(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:g=>"["+g.elements.map(f).join(",")+"]",BinaryExpression:g=>"("+f(g.left)+" "+g.operator+" "+f(g.right)+")",UnaryExpression:g=>"("+g.operator+f(g.argument)+")",ConditionalExpression:g=>"("+f(g.test)+"?"+f(g.consequent)+":"+f(g.alternate)+")",LogicalExpression:g=>"("+f(g.left)+g.operator+f(g.right)+")",ObjectExpression:g=>"{"+g.properties.map(f).join(",")+"}",Property:g=>{c+=1;const p=f(g.key);return c-=1,p+":"+f(g.value)}};function d(g){const p={code:f(g),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},p}return d.functions=r,d.constants=i,d}(zD);function Ne(e,t,n){return 1===arguments.length?Oo[e]:(Oo[e]=t,n&&(Wp[e]=n),Hp&&(Hp.functions[e]=LD+e),this)}function Wn(e,t){const n={};let i;try{i=function(e){B=0,lt=(q=e).length,_e=null,ZM();const t=Ap();if(2!==_e.type)throw new Error("Unexpect token after expression.");return t}(e=ke(e)?e:W(e)+"")}catch(a){I("Expression parse error: "+e)}i.visit(a=>{if(a.type!==VM)return;const s=a.callee.name,o=zD.visitors[s];o&&o(s,a.arguments,t,n)});const r=Hp(i);return r.globals.forEach(a=>{const s="$"+a;!J(n,s)&&t.getSignal(a)&&(n[s]=t.signalRef(a))}),{$expr:te({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}Ne("bandwidth",function(e,t){const n=gi(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},Lt),Ne("copy",function(e,t){const n=gi(e,(t||this).context);return n?n.copy():void 0},Lt),Ne("domain",function(e,t){const n=gi(e,(t||this).context);return n?n.domain():[]},Lt),Ne("range",function(e,t){const n=gi(e,(t||this).context);return n&&n.range?n.range():[]},Lt),Ne("invert",function(e,t,n){const i=gi(e,(n||this).context);return i?$(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0},Lt),Ne("scale",function(e,t,n){const i=gi(e,(n||this).context);return i?i(t):void 0},Lt),Ne("gradient",function(e,t,n,i,r){e=gi(e,(r||this).context);const a=function(e,t){var i,n=[];return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,a){return n.push({offset:r,color:a}),i}}}(t,n);let s=e.domain(),o=s[0],l=ce(s),u=St;return l-o?u=y2(e,o,l):e=(e.interpolator?ve("sequential")().interpolator(e.interpolator()):ve("linear")().interpolate(e.interpolate()).range(e.range())).domain([o=0,l=1]),e.ticks&&(s=e.ticks(+i||15),o!==s[0]&&s.unshift(o),l!==ce(s)&&s.push(l)),s.forEach(c=>a.stop(u(c),e(c))),a},Lt),Ne("geoArea",Iz,Lt),Ne("geoBounds",Rz,Lt),Ne("geoCentroid",Oz,Lt),Ne("geoShape",function(e,t,n){const i=gi(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}},Lt),Ne("indata",function(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count},function(e,t,n,i){t[0].type!==Br&&I("First argument to indata must be a string literal."),t[1].type!==Br&&I("Second argument to indata must be a string literal.");const r=t[0].value,a=t[1].value,s="@"+a;J(s,i)||(i[s]=n.getData(r).indataRef(n,a))}),Ne("data",ED,Up),Ne("treePath",function(e,t,n){const i=RD(e,this),r=i[t],a=i[n];return r&&a?r.path(a).map(ID):void 0},Up),Ne("treeAncestors",function(e,t){const n=RD(e,this)[t];return n?n.ancestors().map(ID):void 0},Up),Ne("vlSelectionTest",function(e,t,n){for(var u,c,f,h,d,i=this.context.data[e],r=i?i.values.value:[],a=i?i[Fc]&&i[Fc].value:void 0,s=n===Lp,o=r.length,l=0;l<o;++l)if(u=r[l],a&&s){if(-1===(f=(c=c||{})[h=u.unit]||0))continue;if(d=wD(t,u),c[h]=d?-1:++f,d&&1===a.size)return!0;if(!d&&f===a.get(h).count)return!1}else if(s^(d=wD(t,u)))return d;return o&&s},Np),Ne("vlSelectionIdTest",function(e,t,n){const i=this.context.data[e],r=i?i.values.value:[],a=i?i[Fc]&&i[Fc].value:void 0,s=n===Lp,o=zp(t),l=fz(r,o);if(l===r.length||zp(r[l])!==o)return!1;if(a&&s){if(1===a.size)return!0;if(hz(r,o)-l<a.size)return!1}return!0},Np),Ne("vlSelectionResolve",function(e,t,n,i){for(var u,c,f,h,d,g,p,m,b,w,r=this.context.data[e],a=r?r.values.value:[],s={},o={},l={},v=a.length,x=0;x<v;++x){for(h=(u=a[x]).unit,f=u.values,b=0,w=(c=u.fields).length;b<w;++b)p=(g=s[(d=c[b]).field]||(s[d.field]={}))[h]||(g[h]=[]),l[d.field]=m=d.type.charAt(0),g[h]=(0,DD[m+"_union"])(p,K(f[b]));n&&(p=o[h]||(o[h]=[])).push(K(f).reduce((M,_,E)=>(M[c[E].field]=_,M),{}))}return t=t||"union",Object.keys(s).forEach(M=>{s[M]=Object.keys(s[M]).map(_=>s[M][_]).reduce((_,E)=>void 0===_?E:DD[l[M]+"_"+t](_,E))}),a=Object.keys(o),n&&a.length&&(s[i?"vlPoint":"vlMulti"]="union"===t?{or:a.reduce((_,E)=>(_.push(...o[E]),_),[])}:{and:a.map(_=>({or:o[_]}))}),s},Np),Ne("vlSelectionTuples",function(e,t){return e.map(n=>te({values:t.fields.map(i=>(i.getter||(i.getter=Pt(i.field)))(n.datum))},t))});const bN=Sn(["rule"]),ND=Sn(["group","image","rect"]);function Xp(e){return(e+"").toLowerCase()}function Lo(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}var EN={operator:(e,t)=>Lo(e,["_"],t.code),parameter:(e,t)=>Lo(e,["datum","_"],t.code),event:(e,t)=>Lo(e,["event"],t.code),handler:(e,t)=>Lo(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const a in i){const s="o["+W(a)+"]";r+="$=".concat(i[a].code,";if(").concat(s,"!==$)").concat(s,"=$,m=1;")}return r+=function(e,t){let n="";return bN[t]||(e.x2&&(e.x?(ND[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(ND[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(i,n),r+="return m;",Lo(e,["item","_"],r)},codegen:{get(e){const t="[".concat(e.map(W).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map((a,s)=>{const o=t[s];let l,u;return a.path?(l="a".concat(a.path),u="b".concat(a.path)):((n=n||{})["f"+s]=a,l="this.f".concat(s,"(a)"),u="this.f".concat(s,"(b)")),function(e,t,n,i){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(i,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(i," : ")}(l,u,-o,o)}).join("")+"0;");return n?r.bind(n):r}}};function PD(e,t,n){if(!e||!ee(e))return e;for(let a,i=0,r=UD.length;i<r;++i)if(a=UD[i],J(e,a.key))return a.parse(e,t,n);return e}var UD=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||I("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Xm(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=nt(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Pt(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,i={};for(const r in n){const a=n[r];i[r]=nt(t.encodeExpression(a.$expr),a.$fields),i[r].output=a.$output}return i}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,i=K(e.$compare).map(r=>r&&r.$tupleid?Y:r);return t.fn[n]||(t.fn[n]=Wm(i,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(i,r,a){const s=t.fork().parse(n),o=s.get(n.operators[0].id),l=s.signals.parent;return l&&l.set(a),o.detachSubflow=()=>t.detach(s),o}}},{key:"$tupleid",parse:function(){return Y}}];const UN={skip:!0};function jD(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||EN,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function qD(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function VD(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}jD.prototype=qD.prototype={fork(){const e=new qD(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),function(e){return"collect"===Xp(e)}(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){let a=n.get(e.parent.$ref);a?(i.connect(a,[t]),t.targets().add(a)):(n.unresolved=n.unresolved||[]).push(()=>{a=n.get(e.parent.$ref),i.connect(a,[t]),t.targets().add(a)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const a in e.data){const s=n.data[a]||(n.data[a]={});e.data[a].forEach(o=>s[o]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Xp(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()},parseOperator:function(e){const t=this;!function(e){return"operator"===Xp(e)}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||I("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=$(r)?r.map(a=>PD(a,n,t)):PD(r,n,t)}return t},parseStream:function(e){var r,t=this,n=null!=e.filter?t.eventExpression(e.filter):void 0,i=null!=e.stream?t.get(e.stream):void 0;e.source?i=t.events(e.source,e.type,n):e.merge&&(i=(r=e.merge.map(a=>t.get(a)))[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(a=>t.get(a)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&I("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)},parseUpdate:function(e){var r,t=this,n=ee(n=e.source)?n.$ref:n,i=t.get(n),a=e.update,s=void 0;i||I("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),a&&a.$expr&&(a.$params&&(s=t.parseParameters(a.$params)),a=t.handlerExpression(a.$expr)),t.update(e,i,r,a,s)},getState:function(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(a=>{const s=t.signals[a];e.signals(a,s)&&(i[a]=s.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(a=>{const s=t.data[a];e.data(a,s)&&(r[a]=s.input.value)})}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map(a=>a.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(a=>{n.update(t.signals[a],r[a],UN)}),Object.keys(i||{}).forEach(a=>{n.pulse(t.data[a].input,n.changeset().remove(hn).insert(i[a]))}),(e.subcontext||[]).forEach((a,s)=>{const o=t.subcontext[s];o&&o.setState(a)})}};const Zp="default";function Kp(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function Rc(e,t){var n=e._runtime.data;return J(n,t)||I("Unrecognized data set: "+t),n[t]}function Oc(e,t){by(t)||I("Second argument to changes must be a changeset.");const n=Rc(this,e);return n.modified=!0,this.pulse(n.input,t)}function $D(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function GD(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Lc(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}const nP={trap:!1};function WD(e,t,n,i){e._eventListeners.push({type:n,sources:K(t),handler:i})}function zc(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return!(!1===i||ee(i)&&!i[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function HD(e){return e.item}function XD(e){return e.item.mark.source}function ZD(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function Yt(e,t,n){const i=document.createElement(e);for(const r in t)i.setAttribute(r,t[r]);return null!=n&&(i.textContent=n),i}function fP(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:s=>{s!=e.signal(i.signal)&&e.runAsync(null,()=>{r.source=!0,e.signal(i.signal,s)})}},i.debounce&&(r.update=Hm(i.debounce,r.update))),(null==i.input&&i.element?hP:gP)(r,t,i,e),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function hP(e,t,n,i){const r=n.event||"input",a=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(r,a),WD(i,t,r,a),e.set=s=>{t.value=s,t.dispatchEvent(function(e){return"undefined"!=typeof Event?new Event(e):{type:e}}(r))}}function gP(e,t,n,i){const r=i.signal(n.signal),a=Yt("div",{class:"vega-bind"}),s="radio"===n.input?a:a.appendChild(Yt("label"));s.appendChild(Yt("span",{class:"vega-bind-name"},n.name||n.signal)),t.appendChild(a);let o=pP;switch(n.input){case"checkbox":o=mP;break;case"select":o=yP;break;case"radio":o=vP;break;case"range":o=xP}o(e,s,n,r)}function pP(e,t,n,i){const r=Yt("input");for(const a in n)"signal"!==a&&"element"!==a&&r.setAttribute("input"===a?"type":a,n[a]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=a=>r.value=a}function mP(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const a=Yt("input",r);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=s=>a.checked=!!s||null}function yP(e,t,n,i){const r=Yt("select",{name:n.signal}),a=n.labels||[];n.options.forEach((s,o)=>{const l={value:s};Nc(s,i)&&(l.selected=!0),r.appendChild(Yt("option",l,(a[o]||s)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=s=>{for(let o=0,l=n.options.length;o<l;++o)if(Nc(n.options[o],s))return void(r.selectedIndex=o)}}function vP(e,t,n,i){const r=Yt("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(r),e.elements=n.options.map((s,o)=>{const l={type:"radio",name:n.signal,value:s};Nc(s,i)&&(l.checked=!0);const u=Yt("input",l);u.addEventListener("change",()=>e.update(s));const c=Yt("label",{},(a[o]||s)+"");return c.prepend(u),r.appendChild(c),u}),e.set=s=>{const o=e.elements,l=o.length;for(let u=0;u<l;++u)Nc(o[u].value,s)&&(o[u].checked=!0)}}function xP(e,t,n,i){i=void 0!==i?i:(+n.max+ +n.min)/2;const r=null!=n.max?n.max:Math.max(100,+i)||100,a=n.min||Math.min(0,r,+i)||0,s=n.step||yi(a,r,100),o=Yt("input",{type:"range",name:n.signal,min:a,max:r,step:s});o.value=i;const l=Yt("span",{},+i);t.appendChild(o),t.appendChild(l);const u=()=>{l.textContent=o.value,e.update(+o.value)};o.addEventListener("input",u),o.addEventListener("change",u),e.elements=[o],e.set=c=>{o.value=c,l.textContent=c}}function Nc(e,t){return e===t||e+""==t+""}function KD(e,t,n,i,r,a){return(t=t||new i(e.loader())).initialize(n,$D(e),GD(e),Lc(e),r,a).background(e.background())}function Jp(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function Qp(e,t,n){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(i){t=null,e.error(i)}return t}const zo=e=>+e||0;function JD(e){return ee(e)?{top:zo(e.top),bottom:zo(e.bottom),left:zo(e.left),right:zo(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(zo(e))}function em(e,t,n,i){return tm.apply(this,arguments)}function tm(){return tm=(0,Q.Z)(function*(e,t,n,i){const r=F0(t),a=r&&r.headless;return a||I("Unrecognized renderer type: "+t),yield e.runAsync(),KD(e,null,null,a,n,i).renderAsync(e._scenegraph.root)}),tm.apply(this,arguments)}function nm(){return nm=(0,Q.Z)(function*(e,t){"canvas"!==e&&"svg"!==e&&"png"!==e&&I("Unrecognized image type: "+e);const n=yield em(this,e,t);return"svg"===e?DP(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}),nm.apply(this,arguments)}function DP(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}function im(){return im=(0,Q.Z)(function*(e,t){return(yield em(this,"canvas",e,t)).canvas()}),im.apply(this,arguments)}function rm(){return rm=(0,Q.Z)(function*(e){return(yield em(this,"svg",e)).svg()}),rm.apply(this,arguments)}var am="padding",tE={skip:!0};function nE(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===am?i.left+i.right:0)}function iE(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===am?i.top+i.bottom:0)}function BP(e,t){return t.modified&&$(t.input.value)&&e.indexOf("_:vega:_")}function IP(e,t){return!("parent"===e||t instanceof ps.proxy)}function LP(e,t,n,i){const r=e.element();r&&r.setAttribute("title",function(e){return null==e?"":$(e)?rE(e):ee(e)&&!er(e)?function(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+($(n)?rE(n):aE(n))}).join("\n")}(e):e+""}(i))}function rE(e){return"["+e.map(aE).join(", ")+"]"}function aE(e){return $(e)?"[\u2026]":ee(e)&&!er(e)?"{\u2026}":e}function on(e,t){const n=this;if(t=t||{},ds.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const a=te({},e.locale,t.locale);n.locale(function(e,t){const n=e?ay(e):Gf(),i=t?uy(t):ml();return Wf(n,i)}(a.number,a.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||"canvas",n._scenegraph=new pb;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||LP,n._redraw=!0,n._handler=(new _u).scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=te({defaults:{}},e),n=(i,r)=>{r.forEach(a=>{$(i[a])&&(i[a]=Sn(i[a]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=function(e,t,n){return function(e,t,n,i){return new jD(e,t,n,i)}(e,ps,Oo,n).parse(t)}(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(a=>({state:null,param:te({},a)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=nE(n,n._width),n._viewHeight=iE(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,i=t.height,r=t[am];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,o=>{e._width=o.size,e._viewWidth=nE(e,o.size),a()},{size:n}),e._resizeHeight=e.add(null,o=>{e._height=o.size,e._viewHeight=iE(e,o.size),a()},{size:i});const s=e.add(null,a,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,s.rank=r.rank+1}(n),function(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:Zp,item:null}));e.on(e.events("view","mousemove"),t,(n,i)=>{const r=t.value,a=r?ke(r)?r:r.user:Zp,s=i.item&&i.item.cursor||null;return r&&a===r.user&&s==r.item?r:{user:a,item:s}}),e.add(null,function(n){let i=n.cursor,r=this.value;return ke(i)||(r=i.item,i=i.user),Kp(e,i&&i!==Zp?i:r||i),r},{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function Pc(e,t){return J(e._signals,t)?e._signals[t]:I("Unrecognized signal name: "+W(t))}function sE(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function oE(e,t,n,i){let r=sE(n,i);return r||(r=Jp(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function lE(e,t,n){const i=sE(t,n);return i&&t._targets.remove(i),e}z(on,ds,{evaluate(e,t,n){var i=this;return(0,Q.Z)(function*(){if(yield ds.prototype.evaluate.call(i,e,t),i._redraw||i._resize)try{i._renderer&&(i._resize&&(i._resize=0,function(e){var t=Lc(e),n=$D(e),i=GD(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(r=>{try{r(n,i)}catch(a){e.error(a)}})}(i)),yield i._renderer.renderAsync(i._scenegraph.root)),i._redraw=!1}catch(r){i.error(r)}return n&&xl(i,n),i})()},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&VD(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=Pc(this,e);return 1===arguments.length?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",JD(e)):JD(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(F0(e)||I("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(ds.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Pc(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,i,r,a){this.runAfter(s=>{let o=0;s._autosize=0,s.width()!==n&&(o=1,s.signal("width",n,tE),s._resizeWidth.skip(!0)),s.height()!==i&&(o=1,s.signal("height",i,tE),s._resizeHeight.skip(!0)),s._viewWidth!==e&&(s._resize=1,s._viewWidth=e),s._viewHeight!==t&&(s._resize=1,s._viewHeight=t),(s._origin[0]!==r[0]||s._origin[1]!==r[1])&&(s._resize=1,s._origin=r),o&&s.run("enter"),a&&s.runAfter(l=>l.resize())},!1,1)},addEventListener(e,t,n){let i=t;return n&&!1===n.trap||(i=Jp(this,t),i.raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var r,a,n=this._handler.handlers(e),i=n.length;--i>=0;)if(r=n[i].handler,e===(a=n[i].type)&&(t===r||t===r.raw)){this._handler.off(a,r);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return oE(this,e,Pc(this,e),t)},removeSignalListener(e,t){return lE(this,Pc(this,e),t)},addDataListener(e,t){return oE(this,e,Rc(this,e).values,t)},removeDataListener(e,t){return lE(this,Rc(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=Kp(this,null);this._globalCursor=!!e,t&&Kp(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var i=new ac,r=t;return null==t?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(a,s,o){s=+s,o=null==o?Ig():+o,i._restart(function l(u){u+=r,i._restart(l,r+=s,o),a(u)},s,o)},i.restart(e,t,n),i)}(function(i){e({timestamp:Date.now(),elapsed:i})},t))},events:function(e,t,n){var s,i=this,r=new sh(n),a=function(u,c){i.runAsync(null,()=>{"view"===e&&function(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return!1!==i&&!0!==r&&(!0===i||!1===r||(i?i[t]:r?!r[t]:e.preventDefault()))}(i,t)&&u.preventDefault(),r.receive(function(e,t,n){var a,o,i=e._renderer,r=i&&i.canvas();return r&&(o=Lc(e),(a=x0(t.changedTouches?t.changedTouches[0]:t,r))[0]-=o[0],a[1]-=o[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const i=t?"group"===t.mark.marktype?t:t.mark.group:null;function r(s){var l,o=i;if(s)for(l=t;l;l=l.mark.group)if(l.mark.name===s){o=l;break}return o&&o.mark&&o.mark.interactive?o:{}}function a(s){if(!s)return n;ke(s)&&(s=r(s));const o=n.slice();for(;s;)o[0]-=s.x||0,o[1]-=s.y||0,s=s.mark&&s.mark.group;return o}return{view:ht(e),item:ht(t||{}),group:r,xy:a,x:s=>a(s)[0],y:s=>a(s)[1]}}(e,n,a),t}(i,u,c))})};if("timer"===e)zc(i,"timer",t)&&i.timer(a,t);else if("view"===e)zc(i,"view",t)&&i.addEventListener(t,a,nP);else if("window"===e?zc(i,"window",t)&&"undefined"!=typeof window&&(s=[window]):"undefined"!=typeof document&&zc(i,"selector",t)&&(s=document.querySelectorAll(e)),s){for(var o=0,l=s.length;o<l;++o)s[o].addEventListener(t,a);WD(i,s,t,a)}else i.warn("Can not resolve event source: "+e);return r},finalize:function(){var i,r,a,e=this._tooltip,t=this._timers,n=this._eventListeners;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(r=(a=n[i]).sources.length;--r>=0;)a.sources[r].removeEventListener(a.type,a.handler);return e&&e.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",HD),XD,ZD(e)),this.on(this.events("view","mouseout",HD),XD,ZD(t)),this},data:function(e,t){return arguments.length<2?Rc(this,e).values.value:Oc.call(this,e,ia().remove(hn).insert(t))},change:Oc,insert:function(e,t){return Oc.call(this,e,ia().insert(t))},remove:function(e,t){return Oc.call(this,e,ia().remove(t))},scale:function(e){var t=this._runtime.scales;return J(t,e)||I("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,a=F0(i);e=n._el=e?Qp(n,e,!0):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),VD(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+i);const s=a.handler||_u,o=e?a.renderer:a.headless;return n._renderer=o?KD(n,n._renderer,e,o):null,n._handler=function(e,t,n,i){const r=new i(e.loader(),Jp(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Lc(e),e);return t&&t.handlers().forEach(a=>{r.on(a.type,a.handler)}),r}(n,n._handler,e,s),n._redraw=!0,e&&"none"!==r&&(t=t?n._elBind=Qp(n,t,!0):e.appendChild(Yt("form",{class:"vega-bindings"})),n._bind.forEach(l=>{l.param.element&&"container"!==r&&(l.element=Qp(n,l.param.element,!!l.param.input))}),n._bind.forEach(l=>{fP(n,l.element||t,l)})),n},toImageURL:function(e,t){return nm.apply(this,arguments)},toCanvas:function(e,t){return im.apply(this,arguments)},toSVG:function(e){return rm.apply(this,arguments)},getState:function(e){return this._runtime.getState(e||{data:BP,signals:IP,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}});const VP=/[[\]{}]/,$P={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let hE,dE;function No(e,t,n,i,r){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;r&&r.indexOf(o)>=0?--s:i&&i.indexOf(o)>=0&&++s}return t}function gE(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=No(e,r,",","[{","]}"),t.push(e.substring(i,r).trim()),i=++r;if(0===t.length)throw"Empty event selector: "+e;return t}function sm(e){return"["===e[0]?function(e){const t=e.length;let i,n=1;if(n=No(e,n,"]","[","]"),n===t)throw"Empty between selector: "+e;if(i=gE(e.substring(1,n)),2!==i.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(n+1).trim())[0])throw"Expected '>' after between selector: "+e;i=i.map(sm);const r=sm(e.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}(e):function(e){const t={source:hE},n=[];let l,u,i=[0,0],r=0,a=0,s=e.length,o=0;if("}"===e[s-1]){if(o=e.lastIndexOf("{"),!(o>=0))throw"Unmatched right brace: "+e;try{i=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map(n=>{const i=+n;if(i!=i)throw e;return i})}(e.substring(o+1,s-1))}catch(c){throw"Invalid throttle specification: "+e}s=(e=e.slice(0,o).trim()).length,o=0}if(!s)throw e;if("@"===e[0]&&(r=++o),l=No(e,o,":"),l<s&&(n.push(e.substring(a,l).trim()),a=o=++l),o=No(e,o,"["),o===s)n.push(e.substring(a,s).trim());else if(n.push(e.substring(a,o).trim()),u=[],a=++o,a===s)throw"Unmatched left bracket: "+e;for(;o<s;){if(o=No(e,o,"]"),o===s)throw"Unmatched left bracket: "+e;if(u.push(e.substring(a,o).trim()),o<s-1&&"["!==e[++o])throw"Expected left bracket: "+e;a=++o}if(!(s=n.length)||VP.test(n[s-1]))throw"Invalid event selector: "+e;return s>1?(t.type=n[1],r?t.markname=n[0].slice(1):function(e){return dE[e]}(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=u&&(t.filter=u),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}(e)}function ZP(e){return ee(e)?e:{type:e||"pad"}}const Po=e=>+e||0;function JP(e){return ee(e)?e.signal?e:{top:Po(e.top),bottom:Po(e.bottom),left:Po(e.left),right:Po(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(Po(e))}const Ye=e=>ee(e)&&!$(e)?te({},e):{value:e};function pE(e,t,n,i){return null!=n?(ee(n)&&!$(n)||$(n)&&n.length&&ee(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function tt(e,t,n){for(const i in t)pE(e,i,t[i]);for(const i in n)pE(e,i,n[i],"update")}function za(e,t,n){for(const i in t)n&&J(n,i)||(e[i]=te(e[i]||{},t[i]));return e}function Na(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const om="mark",lm="frame",um="scope",mE="legend-label";function cm(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const yE=e=>ke(e)?W(e):e.signal?`(${e.signal})`:vE(e);function qc(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map(n=>null==n?null:W(n));for(;t.length&&null==ce(t);)t.pop();return t.unshift(yE(e.gradient)),`gradient(${t.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(e){return e.c?Vc("hcl",e.h,e.c,e.l):e.h||e.s?Vc("hsl",e.h,e.s,e.l):e.l||e.a?Vc("lab",e.l,e.a,e.b):e.r||e.g||e.b?Vc("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?vE(e.field):void 0!==e.value?W(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=yE(e.scale);return null!=e.range?t=`lerp(_range(${n}), ${+e.range})`:(void 0!==t&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(1==+e.band?"":"*"+$c(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),null==t&&(t="0")),t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t=`pow(${t},${$c(e.exponent)})`),null!=e.mult&&(t+=`*${$c(e.mult)}`),null!=e.offset&&(t+=`+${$c(e.offset)}`),e.round&&(t=`round(${t})`),t}const Vc=(e,t,n,i)=>`(${e}(${[t,n,i].map(qc).join(",")})+'')`;function $c(e){return ee(e)?"("+qc(e)+")":e}function vE(e){return xE(ee(e)?e:{datum:e})}function xE(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):I("Invalid field reference: "+W(e));return e.signal||(i=ke(i)?cf(i).map(W).join("]["):xE(i)),t+"["+i+"]"}function bE(e,t,n,i,r,a){const s={};(a=a||{}).encoders={$encode:s},e=function(e,t,n,i,r){const a={},s={};let o,l,u,c;for(l in l="lineBreak","text"===t&&null!=r[l]&&!Na(l,e)&&cm(a,l,r[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===lm?r.group:n===om?te({},r.mark,r[t]):null,c)u=Na(l,e)||("fill"===l||"stroke"===l)&&(Na("fill",e)||Na("stroke",e)),u||cm(a,l,c[l]);for(l in K(i).forEach(f=>{const h=r.style&&r.style[f];for(const d in h)Na(d,e)||cm(a,d,h[d])}),e=te({},e),a)c=a[l],c.signal?(o=o||{})[l]=c:s[l]=c;return e.enter=te(s,e.enter),o&&(e.update=te(o,e.update)),e}(e,t,n,i,r.config);for(const o in e)s[o]=xU(e[o],t,a,r);return a}function xU(e,t,n,i){const r={},a={};for(const s in e)null!=e[s]&&(r[s]=_U(bU(e[s]),i,n,a));return{$expr:{marktype:t,channels:r},$fields:Object.keys(a),$output:Object.keys(e)}}function bU(e){return $(e)?function(e){let t="";return e.forEach(n=>{const i=qc(n);t+=n.test?`(${n.test})?${i}:`:i}),":"===ce(t)&&(t+="null"),t}(e):qc(e)}function _U(e,t,n,i){const r=Wn(e,t);return r.$fields.forEach(a=>i[a]=1),te(n,r.$params),r.$expr}const MU=["value","update","init","react","bind"];function _E(e,t){I(e+' for "outer" push: '+W(t))}function wE(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||_E("No prior signal definition",n),MU.forEach(i=>{void 0!==e[i]&&_E("Invalid property ",i)});else{const i=t.addSignal(n,e.value);!1===e.react&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function fm(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function Gc(e,t,n,i){return new fm(e,t,n,i)}function Yc(e,t){return Gc("operator",e,t)}function G(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Uo(e,t){return t?{$field:e,$name:t}:{$field:e}}const hm=Uo("key");function ME(e,t){return{$compare:e,$order:t}}function Wc(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const dm="scope",gm="view";function Pe(e){return e&&e.signal}function Hc(e){if(Pe(e))return!0;if(ee(e))for(const t in e)if(Hc(e[t]))return!0;return!1}function Dn(e,t){return null!=e?e:t}function zr(e){return e&&e.signal||e}function jo(e,t){return(e.merge?TU:e.stream?FU:e.type?BU:I("Invalid stream specification: "+W(e)))(e,t)}function TU(e,t){const i=pm({merge:e.merge.map(r=>jo(r,t))},e,t);return t.addStream(i).id}function FU(e,t){const i=pm({stream:jo(e.stream,t)},e,t);return t.addStream(i).id}function BU(e,t){let n;"timer"===e.type?(n=t.event("timer",e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(e){return e===dm?gm:e||gm}(e.source),e.type);const i=pm({stream:n},e,t);return 1===Object.keys(i).length?n:t.addStream(i).id}function pm(e,t,n){let i=t.between;return i&&(2!==i.length&&I('Stream "between" parameter must have 2 entries: '+W(t)),e.between=[jo(i[0],n),jo(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(function(e,t,n){const i="event.item";return i+(e&&"*"!==e?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===dm&&i.push("inScope(event.item)"),i.length&&(e.filter=Wn("("+i.join(")&&(")+")",n).$expr),null!=(i=t.throttle)&&(e.throttle=+i),null!=(i=t.debounce)&&(e.debounce=+i),t.consume&&(e.consume=!0),e}const RU={code:"_.$value",ast:{type:"Identifier",value:"value"}};function zU(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}const we=e=>(t,n,i)=>Gc(e,n,t||void 0,i),EE=we("aggregate"),PU=we("axisticks"),kE=we("bound"),En=we("collect"),AE=we("compare"),UU=we("datajoin"),CE=we("encode"),jU=we("expression"),qU=we("facet"),VU=we("field"),$U=we("key"),GU=we("legendentries"),YU=we("load"),WU=we("mark"),HU=we("multiextent"),XU=we("multivalues"),ZU=we("overlap"),KU=we("params"),SE=we("prefacet"),JU=we("projection"),QU=we("proxy"),ej=we("relay"),TE=we("render"),tj=we("scale"),Nr=we("sieve"),nj=we("sortitems"),FE=we("viewlayout"),ij=we("values");let rj=0;const BE={min:"min",max:"max",count:"sum"};function sj(e,t){const n=t.getScale(e.name).params;let i;for(i in n.domain=IE(e.domain,e,t),null!=e.range&&(n.range=OE(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=ln(e.type||e),null!=e.gamma&&(t.interpolateGamma=ln(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return ee(e)?{interval:ln(e.interval),step:ln(e.step)}:ln(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||$(e)?Xc(e,t):t.objectProperty(e)}(e.bins,t)),e)J(n,i)||"name"===i||(n[i]=ln(e[i],t))}function ln(e,t){return ee(e)?e.signal?t.signalRef(e.signal):I("Unsupported object: "+W(e)):e}function Xc(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>ln(n,t))}function Zc(e){I("Can not find data set: "+W(e))}function IE(e,t,n){if(e)return e.signal?n.signalRef(e.signal):($(e)?oj:e.fields?uj:lj)(e,t,n);(null!=t.domainMin||null!=t.domainMax)&&I("No scale domain defined for domainMin/domainMax to override.")}function oj(e,t,n){return e.map(i=>ln(i,n))}function lj(e,t,n){const i=n.getData(e.data);return i||Zc(e.data),ma(t.type)?i.valuesRef(n,e.field,RE(e.sort,!1)):m2(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function uj(e,t,n){const i=e.data,r=e.fields.reduce((a,s)=>(s=ke(s)?{data:i,field:s}:$(s)||s.signal?function(e,t){const n="_:vega:_"+rj++,i=En({});if($(e))i.value={$ingest:e};else if(e.signal){const r="setdata("+W(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,Nr({})]),{data:n,field:"data"}}(s,n):s,a.push(s),a),[]);return(ma(t.type)?fj:m2(t.type)?hj:dj)(e,n,r)}function fj(e,t,n){const i=RE(e.sort,!0);let r,a;const s=n.map(u=>{const c=t.getData(u.data);return c||Zc(u.data),c.countsRef(t,u.field,i)}),o={groupby:hm,pulse:s};i&&(r=i.op||"count",a=i.field?Wc(r,i.field):"count",o.ops=[BE[r]],o.fields=[t.fieldRef(a)],o.as=[a]),r=t.add(EE(o));const l=t.add(En({pulse:G(r)}));return a=t.add(ij({field:hm,sort:t.sortRef(i),pulse:G(l)})),G(a)}function RE(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!BE[e.op]&&I("Multiple domain scales can not be sorted using "+e.op):I("No field provided for sort aggregate op: "+e.op):ee(e)?e.field="key":e={field:"key"}),e}function hj(e,t,n){const i=n.map(r=>{const a=t.getData(r.data);return a||Zc(r.data),a.domainRef(t,r.field)});return G(t.add(XU({values:i})))}function dj(e,t,n){const i=n.map(r=>{const a=t.getData(r.data);return a||Zc(r.data),a.extentRef(t,r.field)});return G(t.add(HU({extents:i})))}function OE(e,t,n){const i=t.config.range;let r=e.range;if(r.signal)return t.signalRef(r.signal);if(ke(r)){if(i&&J(i,r))return OE(e=te({},e,{range:i[r]}),t,n);"width"===r?r=[0,{signal:"width"}]:"height"===r?r=ma(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:I("Unrecognized scale range value: "+W(r))}else{if(r.scheme)return n.scheme=$(r.scheme)?Xc(r.scheme,t):ln(r.scheme,t),r.extent&&(n.schemeExtent=Xc(r.extent,t)),void(r.count&&(n.schemeCount=ln(r.count,t)));if(r.step)return void(n.rangeStep=ln(r.step,t));if(ma(e.type)&&!$(r))return IE(r,e,t);$(r)||I("Unsupported range type: "+W(r))}return r.map(a=>($(a)?Xc:ln)(a,t))}function mm(e,t,n){return $(e)?e.map(i=>mm(i,t,n)):ee(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:I("Unsupported parameter object: "+W(e)):e}const kn="top",Xi="bottom",vm="label",un="value",qo="guide-label",xm="guide-title",Kc="gradient",bm="discrete",wm=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],Vo={name:1,style:1,interactive:1},de={value:0},cn={value:1},Jc="group",Mm="rule",Pr="text";function $o(e){return e.type=Jc,e.interactive=e.interactive||!1,e}function zt(e,t){const n=(i,r)=>Dn(e[i],Dn(t[i],r));return n.isVertical=i=>"vertical"===Dn(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>Dn(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>Dn(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>Dn(e.columns,Dn(t.columns,+n.isVertical(!0))),n}function PE(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Qc(e,t,n){return`item.anchor === 'start' ? ${e} : item.anchor === 'end' ? ${t} : ${n}`}const Dm=Qc(W("left"),W("right"),W("center"));function UE(e,t){return t?e?ee(e)?Object.assign({},e,{offset:UE(e.offset,t)}):{value:e,offset:t}:t:e}function Wt(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=za(e.encode,t,Vo)):e.interactive=!1,e}function Sj(e,t,n,i){const r=zt(e,n),a=r.isVertical(),s=r.gradientThickness(),o=r.gradientLength();let l,u,c,f,h;a?(u=[0,1],c=[0,0],f=s,h=o):(u=[0,0],c=[1,0],f=o,h=s);const d={enter:l={opacity:de,x:de,y:de,width:Ye(f),height:Ye(h)},update:te({},l,{opacity:cn,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:de}};return tt(d,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),Wt({type:"rect",role:"legend-gradient",encode:d},i)}function Tj(e,t,n,i,r){const a=zt(e,n),s=a.isVertical(),o=a.gradientThickness(),l=a.gradientLength();let u,c,f,h,d="";s?(u="y",f="y2",c="x",h="width",d="1-"):(u="x",f="x2",c="y",h="height");const g={opacity:de,fill:{scale:t,field:un}};g[u]={signal:d+"datum.perc",mult:l},g[c]=de,g[f]={signal:d+"datum.perc2",mult:l},g[h]=Ye(o);const p={enter:g,update:te({},g,{opacity:cn}),exit:{opacity:de}};return tt(p,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),Wt({type:"rect",role:"legend-band",key:un,from:r,encode:p},i)}const Bj=`datum.perc<=0?"${Xi}":datum.perc>=1?"top":"middle"`;function jE(e,t,n,i){const r=zt(e,t),a=r.isVertical(),s=Ye(r.gradientThickness()),o=r.gradientLength();let u,c,f,h,l=r("labelOverlap"),d="";const g={enter:u={opacity:de},update:c={opacity:cn,text:{field:vm}},exit:{opacity:de}};return tt(g,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:Dn(e.labelLimit,t.gradientLabelLimit)}),a?(u.align={value:"left"},u.baseline=c.baseline={signal:Bj},f="y",h="x",d="1-"):(u.align=c.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},u.baseline={value:"top"},f="x",h="y"),u[f]=c[f]={signal:d+"datum.perc",mult:o},u[h]=c[h]=s,s.offset=Dn(e.labelOffset,t.gradientLabelOffset)||0,l=l?{separation:r("labelSeparation"),method:l,order:"datum.index"}:void 0,Wt({type:Pr,role:mE,style:qo,key:un,from:i,encode:g,overlap:l},n)}function Ij(e,t,n,i,r){const a=zt(e,t),s=n.entries,o=!(!s||!s.interactive),l=s?s.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},h=`(${r}) ? datum.offset : datum.size`,d=u?Ye(u):{field:"size"},g="datum.index",p=`max(1, ${r})`;let m,y,v,x,b;d.mult=.5,m={enter:y={opacity:de,x:{signal:h,mult:.5,offset:c},y:d},update:v={opacity:cn,x:y.x,y:y.y},exit:{opacity:de}};let w=null,M=null;e.fill||(w=t.symbolBaseFillColor,M=t.symbolBaseStrokeColor),tt(m,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",M),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),wm.forEach(D=>{e[D]&&(v[D]=y[D]={scale:e[D],field:un})});const _=Wt({type:"symbol",role:"legend-symbol",key:un,from:f,clip:!!u||void 0,encode:m},n.symbols),E=Ye(c);E.offset=a("labelOffset"),m={enter:y={opacity:de,x:{signal:h,offset:E},y:d},update:v={opacity:cn,text:{field:vm},x:y.x,y:y.y},exit:{opacity:de}},tt(m,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const A=Wt({type:Pr,role:mE,style:qo,key:un,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!u},width:de,height:u?Ye(u):de,opacity:de},exit:{opacity:de},update:v={opacity:cn,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(x=`ceil(item.mark.items.length / ${p})`,v.row.signal=`${g}%${x}`,v.column.signal=`floor(${g} / ${x})`,b={field:["row",g]}):(v.row.signal=`floor(${g} / ${p})`,v.column.signal=`${g} % ${p}`,b={field:g}),v.column.signal=`(${r})?${v.column.signal}:${g}`,$o({role:um,from:i={facet:{data:i,name:"value",groupby:"index"}},encode:za(m,s,Vo),marks:[_,A],name:l,interactive:o,sort:b})}const Em='item.orient === "left"',km='item.orient === "right"',ef=`(${Em} || ${km})`,Oj=`datum.vgrad && ${ef}`,Lj=Qc('"top"','"bottom"','"middle"'),Nj=`datum.vgrad && ${km} ? (${Qc('"right"','"left"','"center"')}) : (${ef} && !(datum.vgrad && ${Em})) ? "left" : ${Dm}`,Pj=`item._anchor || (${ef} ? "middle" : "start")`,Uj=`${Oj} ? (${Em} ? -90 : 90) : 0`,jj=`${ef} ? (datum.vgrad ? (${km} ? "bottom" : "top") : ${Lj}) : "top"`;function Vj(e,t){let n;return ee(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+qE(e.path)+")":e.sphere&&(n="geoShape("+qE(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function qE(e){return ee(e)&&e.signal?e.signal:W(e)}function VE(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===Jc?um:t||om:t}function $j(e){return{marktype:e.type,name:e.name||void 0,role:e.role||VE(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function Gj(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function Am(e,t){const n=function(e){const t=function(e){return e=e&&e.toLowerCase(),J(ps,e)?ps[e]:null}(e);return t&&t.Definition||null}(e.type);n||I("Unrecognized transform type: "+W(e.type));const i=Gc(n.type.toLowerCase(),null,$E(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function $E(e,t,n){const i={},r=e.params.length;for(let a=0;a<r;++a){const s=e.params[a];i[s.name]=Yj(s,t,n)}return i}function Yj(e,t,n){const i=e.type,r=t[e.name];return"index"===i?function(e,t,n){return ke(t.from)||I('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==r?"param"===i?function(e,t,n){const i=t[e.name];return e.array?($(i)||I("Expected an array of sub-parameters. Instead: "+W(i)),i.map(r=>YE(e,r,n))):YE(e,i,n)}(e,t,n):"projection"===i?n.projectionRef(t[e.name]):e.array&&!Pe(r)?r.map(a=>GE(e,a,n)):GE(e,r,n):void(e.required&&I("Missing required "+W(t.type)+" parameter: "+W(e.name)))}function GE(e,t,n){const i=e.type;if(Pe(t))return WE(i)?I("Expression references can not be signals."):Cm(i)?n.fieldRef(t):HE(i)?n.compareRef(t):n.signalRef(t.signal);{const r=e.expr||Cm(i);return r&&Xj(t)?n.exprRef(t.expr,t.as):r&&Zj(t)?Uo(t.field,t.as):WE(i)?Wn(t,n):Kj(i)?G(n.getData(t).values):Cm(i)?Uo(t):HE(i)?n.compareRef(t):t}}function YE(e,t,n){const i=e.params.length;let r;for(let s=0;s<i;++s){r=e.params[s];for(const o in r.key)if(r.key[o]!==t[o]){r=null;break}if(r)break}r||I("Unsupported parameter: "+W(t));const a=te($E(r,t,n),r.key);return G(n.add(KU(a)))}const Xj=e=>e&&e.expr,Zj=e=>e&&e.field,Kj=e=>"data"===e,WE=e=>"expr"===e,Cm=e=>"field"===e,HE=e=>"compare"===e;function tf(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:G(t.getData(e.data).output)}function Ur(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}function XE(e){return ke(e)?e:null}function ZE(e,t,n){const i=Wc(n.op,n.field);let r;if(t.ops){for(let a=0,s=t.as.length;a<s;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Go(e,t,n,i,r,a,s){const o=t[n]||(t[n]={}),l=function(e){return ee(e)?("descending"===e.order?"-":"+")+Wc(e.op,e.field):""}(a);let c,f,u=XE(r);if(null!=u&&(e=t.scope,u+=l?"|"+l:"",c=o[u]),!c){const h=a?{field:hm,pulse:t.countsRef(e,r,a)}:{field:e.fieldRef(r),pulse:G(t.output)};l&&(h.sort=e.sortRef(a)),f=e.add(Gc(i,void 0,h)),s&&(t.index[r]=f),c=G(f),null!=u&&(o[u]=c)}return c}function KE(e,t,n){const i=e.remove,r=e.insert,a=e.toggle,s=e.modify,o=e.values,l=t.add(Yc()),c=Wn("if("+e.trigger+',modify("'+n+'",'+[r,i,a,s,o].map(f=>null==f?"null":f).join(",")+"),0)",t);l.update=c.$expr,l.params=c.$params}function nf(e,t){const n=VE(e),i=e.type===Jc,r=e.from&&e.from.facet,a=e.overlap;let o,l,u,c,f,h,d,s=e.layout||n===um||n===lm;const g=n===om||s||r,p=function(e,t,n){let i,r,a,s,o;return e?(i=e.facet)&&(t||I("Only group marks can be faceted."),null!=i.field?s=o=tf(i,n):(e.data?o=G(n.getData(e.data).aggregate):(a=Am(te({type:"aggregate",groupby:K(i.groupby)},i.aggregate),n),a.params.key=n.keyRef(i.groupby),a.params.pulse=tf(i,n),s=o=G(n.add(a))),r=n.keyRef(i.groupby,!0))):s=G(n.add(En(null,[{}]))),s||(s=tf(e,n)),{key:r,pulse:s,parent:o}}(e.from,i,t);l=t.add(UU({key:p.key||(e.key?Uo(e.key):void 0),pulse:p.pulse,clean:!i}));const m=G(l);l=u=t.add(En({pulse:m})),l=t.add(WU({markdef:$j(e),interactive:Gj(e.interactive,t),clip:Vj(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:G(l)}));const y=G(l);l=c=t.add(CE(bE(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),l.params.parent=t.encode(),e.transform&&e.transform.forEach(M=>{const _=Am(M,t),E=_.metadata;(E.generates||E.changes)&&I("Mark transforms should not generate new data."),E.nomod||(c.params.mod=!0),_.params.pulse=G(l),t.add(l=_)}),e.sort&&(l=t.add(nj({sort:t.compareRef(e.sort),pulse:G(l)})));const v=G(l);(r||s)&&(s=t.add(FE({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),h=G(s));const x=t.add(kE({mark:y,pulse:h||v}));d=G(x),i&&(g&&(o=t.operators,o.pop(),s&&o.pop()),t.pushState(v,h||d,m),r?function(e,t,n){const i=e.from.facet,r=i.name,a=tf(i,t);let s;i.name||I("Facet must have a name: "+W(i)),i.data||I("Facet must reference a data set: "+W(i)),i.field?s=t.add(SE({field:t.fieldRef(i.field),pulse:a})):i.groupby?s=t.add(qU({key:t.keyRef(i.groupby),group:G(t.proxy(n.parent)),pulse:a})):I("Facet must specify groupby or field: "+W(i));const o=t.fork(),l=o.add(En()),u=o.add(Nr({pulse:G(l)}));o.addData(r,new Ur(o,l,l,u)),o.addSignal("parent",null),s.params.subflow={$subflow:o.parse(e).toRuntime()}}(e,t,p):g?function(e,t,n){const i=t.add(SE({pulse:n.pulse})),r=t.fork();r.add(Nr()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}(e,t,p):t.parse(e),t.popState(),g&&(s&&o.push(s),o.push(x))),a&&(d=function(e,t,n){const i=e.method,r=e.bound,a=e.separation,s={separation:Pe(a)?n.signalRef(a.signal):a,method:Pe(i)?n.signalRef(i.signal):i,pulse:t};if(e.order&&(s.sort=n.compareRef({field:e.order})),r){const o=r.tolerance;s.boundTolerance=Pe(o)?n.signalRef(o.signal):+o,s.boundScale=n.scaleRef(r.scale),s.boundOrient=r.orient}return G(n.add(ZU(s)))}(a,d,t));const b=t.add(TE({pulse:d})),w=t.add(Nr({pulse:G(b)},void 0,t.parent()));null!=e.name&&(f=e.name,t.addData(f,new Ur(t,u,b,w)),e.on&&e.on.forEach(M=>{(M.insert||M.remove||M.toggle)&&I("Marks only support modify triggers."),KE(M,t,f)}))}function aq(e,t,n){const i={enter:{},update:{}};return tt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function JE(e,t,n){return t[e]?`scale("${t[e]}",datum)`:PE(e,n[0].encode)}function fq(e,t){const n={enter:{},update:{}};return tt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:Dm},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),za(n,t,Vo)}function jr(e){const t=En({},e);return t.metadata={source:!0},t}function QE(e,t){return YU({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}Ur.fromEntries=function(e,t){const n=t.length,i=t[n-1],r=t[n-2];let a=t[0],s=null,o=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);o<n;++o)t[o].params.pulse=G(t[o-1]),e.add(t[o]),"aggregate"===t[o].type&&(s=t[o]);return new Ur(e,a,r,i,s)},Ur.prototype={countsRef(e,t,n){const i=this,r=i.counts||(i.counts={}),a=XE(t);let s,o,l;return null!=a&&(e=i.scope,s=r[a]),s?n&&n.field&&ZE(e,s.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:G(i.output)},n&&n.field&&ZE(e,l,n),o=e.add(EE(l)),s=e.add(En({pulse:G(o)})),s={agg:o,ref:G(s)},null!=a&&(r[a]=s)),s.ref},tuplesRef(){return G(this.values)},extentRef(e,t){return Go(e,this,"extent","extent",t,!1)},domainRef(e,t){return Go(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Go(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Go(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Go(e,this,"indata","tupleindex",t,!0,!0)}};const ek=e=>e===Xi||e===kn,rf=(e,t,n)=>Pe(e)?xq(e.signal,t,n):"left"===e||e===kn?t:n,We=(e,t,n)=>Pe(e)?yq(e.signal,t,n):ek(e)?t:n,An=(e,t,n)=>Pe(e)?vq(e.signal,t,n):ek(e)?n:t,tk=(e,t,n)=>Pe(e)?bq(e.signal,t,n):e===kn?{value:t}:{value:n},yq=(e,t,n)=>nk(`${e} === 'top' || ${e} === '${Xi}'`,t,n),vq=(e,t,n)=>nk(`${e} !== 'top' && ${e} !== '${Xi}'`,t,n),xq=(e,t,n)=>Sm(`${e} === 'left' || ${e} === 'top'`,t,n),bq=(e,t,n)=>Sm(`${e} === 'top'`,t,n),nk=(e,t,n)=>(t=null!=t?Ye(t):t,n=null!=n?Ye(n):n,ik(t)&&ik(n)?{signal:`${e} ? (${t=t?t.signal||W(t.value):null}) : (${n=n?n.signal||W(n.value):null})`}:[te({test:e},t)].concat(n||[])),ik=e=>null==e||1===Object.keys(e).length,Sm=(e,t,n)=>({signal:`${e} ? (${qa(t)}) : (${qa(n)})`}),wq=(e,t,n,i,r)=>({signal:(null!=i?`${e} === 'left' ? (${qa(i)}) : `:"")+(null!=n?`${e} === '${Xi}' ? (${qa(n)}) : `:"")+(null!=r?`${e} === 'right' ? (${qa(r)}) : `:"")+(null!=t?`${e} === 'top' ? (${qa(t)}) : `:"")+"(null)"}),qa=e=>Pe(e)?e.signal:null==e?null:W(e),Va=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function $a(e,t,n,i){let r;if(t&&J(t,e))return t[e];if(J(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[xm][r]}if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[qo][r]}return null}function rk(e){const t={};for(const n of e)if(n)for(const i in n)t[i]=1;return Object.keys(t)}function ak(e,t){return{scale:e.scale,range:t}}function Tm(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function Sq(e,t,n,i,r,a){const s=zt(e,t),o=e.orient,l=e.scale,u=rf(o,-1,1),c=zr(s("labelFlush")),f=zr(s("labelFlushOffset")),h=s("labelAlign"),d=s("labelBaseline");let p,g=0===c||!!c;const m=Ye(r);m.mult=u,m.offset=Ye(s("labelPadding")||0),m.offset.mult=u;const y={scale:l,field:un,band:.5,offset:UE(a.offset,s("labelOffset"))},v=We(o,g?Tm(l,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>Pe(e)?((e,t,n)=>Sm(`${e} === 'right'`,t,n))(e.signal,t,n):"right"===e?{value:t}:{value:n})(o,"left","right")),x=We(o,tk(o,"bottom","top"),g?Tm(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),b=Tm(l,c,`-(${f})`,f,0);g=g&&f;const w={opacity:de,x:We(o,y,m),y:An(o,y,m)},M={enter:w,update:p={opacity:cn,text:{field:vm},x:w.x,y:w.y,align:v,baseline:x},exit:{opacity:de,x:w.x,y:w.y}};tt(M,{dx:!h&&g?We(o,b):null,dy:!d&&g?An(o,b):null}),tt(M,{angle:s("labelAngle"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontWeight:s("labelFontWeight"),fontStyle:s("labelFontStyle"),limit:s("labelLimit"),lineHeight:s("labelLineHeight")},{align:h,baseline:d});const _=s("labelBound");let E=s("labelOverlap");return E=E||_?{separation:s("labelSeparation"),method:E,order:"datum.index",bound:_?{scale:l,orient:o,tolerance:_}:null}:void 0,p.align!==v&&(p.align=Va(p.align,v)),p.baseline!==x&&(p.baseline=Va(p.baseline,x)),Wt({type:Pr,role:"axis-label",style:qo,key:un,from:i,encode:M,overlap:E},n)}function Bq(e,t){const n=function(e,t){var o,l,u,n=t.config,i=n.style,r=n.axis,a="band"===t.scaleType(e.scale)&&n.axisBand,s=e.orient;if(Pe(s)){const f=rk([n.axisX,n.axisY]),h=rk([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);for(u of(o={},f))o[u]=We(s,$a(u,n.axisX,r,i),$a(u,n.axisY,r,i));for(u of(l={},h))l[u]=wq(s.signal,$a(u,n.axisTop,r,i),$a(u,n.axisBottom,r,i),$a(u,n.axisLeft,r,i),$a(u,n.axisRight,r,i))}else o=s===kn||s===Xi?n.axisX:n.axisY,l=n["axis"+s[0].toUpperCase()+s.slice(1)];return o||l||a?te({},r,o,l,a):r}(e,t),i=e.encode||{},r=i.axis||{},a=r.name||void 0,s=r.interactive,o=r.style,l=zt(e,n),u=function(e){const t=e("tickBand");let i,r,n=e("tickOffset");return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},ee(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):"extent"===t?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=e.title},f=G(t.add(En({},[c]))),h=G(t.add(PU({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),d=[];let g;return c.grid&&d.push(function(e,t,n,i,r){const a=zt(e,t),s=e.orient,o=e.gridScale,l=rf(s,1,-1),u=function(e,t){if(1!==t)if(ee(e)){let n=e=te({},e);for(;null!=n.mult;){if(!ee(n.mult))return n.mult=Pe(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n=n.mult=te({},n.mult)}n.mult=t}else e=Pe(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);return e}(e.offset,l);let c,f,h;const d={enter:c={opacity:de},update:h={opacity:cn},exit:f={opacity:de}};tt(d,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const g={scale:e.scale,field:un,band:r.band,extra:r.extra,offset:r.offset,round:a("tickRound")},p=We(s,{signal:"height"},{signal:"width"}),m=o?{scale:o,range:0,mult:l,offset:u}:{value:0,offset:u},y=o?{scale:o,range:1,mult:l,offset:u}:te(p,{mult:l,offset:u});return c.x=h.x=We(s,g,m),c.y=h.y=An(s,g,m),c.x2=h.x2=An(s,y),c.y2=h.y2=We(s,y),f.x=We(s,g),f.y=An(s,g),Wt({type:Mm,role:"axis-grid",key:un,from:i,encode:d},n)}(e,n,i.grid,h,u)),c.ticks&&(g=l("tickSize"),d.push(function(e,t,n,i,r,a){const s=zt(e,t),o=e.orient,l=rf(o,-1,1);let u,c,f;const h={enter:u={opacity:de},update:f={opacity:cn},exit:c={opacity:de}};tt(h,{stroke:s("tickColor"),strokeCap:s("tickCap"),strokeDash:s("tickDash"),strokeDashOffset:s("tickDashOffset"),strokeOpacity:s("tickOpacity"),strokeWidth:s("tickWidth")});const d=Ye(r);d.mult=l;const g={scale:e.scale,field:un,band:a.band,extra:a.extra,offset:a.offset,round:s("tickRound")};return f.y=u.y=We(o,de,g),f.y2=u.y2=We(o,d),c.x=We(o,g),f.x=u.x=An(o,de,g),f.x2=u.x2=An(o,d),c.y=An(o,g),Wt({type:Mm,role:"axis-tick",key:un,from:i,encode:h},n)}(e,n,i.ticks,h,g,u))),c.labels&&(g=c.ticks?g:0,d.push(Sq(e,n,i.labels,h,g,u))),c.domain&&d.push(function(e,t,n,i){const r=zt(e,t),a=e.orient;let s,o;const l={enter:s={opacity:de},update:o={opacity:cn},exit:{opacity:de}};tt(l,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const u=ak(e,0),c=ak(e,1);return s.x=o.x=We(a,u,de),s.x2=o.x2=We(a,c),s.y=o.y=An(a,u,de),s.y2=o.y2=An(a,c),Wt({type:Mm,role:"axis-domain",from:i,encode:l},n)}(e,n,i.domain,f)),c.title&&d.push(function(e,t,n,i){const r=zt(e,t),a=e.orient,s=rf(a,-1,1);let o,l;const u={enter:o={opacity:de,anchor:Ye(r("titleAnchor",null)),align:{signal:Dm}},update:l=te({},o,{opacity:cn,text:Ye(e.title)}),exit:{opacity:de}},c={signal:`lerp(range("${e.scale}"), ${Qc(0,1,.5)})`};return l.x=We(a,c),l.y=An(a,c),o.angle=We(a,de,((e,t)=>Pe(e)?{signal:`(${e.signal}) * 90`}:{value:90*e})(s)),o.baseline=We(a,tk(a,Xi,kn),{value:Xi}),l.angle=o.angle,l.baseline=o.baseline,tt(u,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),function(e,t,n,i){const r=(o,l)=>null!=o?(n.update[l]=Va(Ye(o),n.update[l]),!1):!Na(l,i),a=r(e("titleX"),"x"),s=r(e("titleY"),"y");n.enter.auto=s===a?Ye(s):We(t,Ye(s),Ye(a))}(r,a,u,n),u.update.align=Va(u.update.align,o.align),u.update.angle=Va(u.update.angle,o.angle),u.update.baseline=Va(u.update.baseline,o.baseline),Wt({type:Pr,role:"axis-title",style:xm,from:i,encode:u},n)}(e,n,i.title,f)),nf($o({role:"axis",from:f,encode:za(Iq(l,e),r,Vo),marks:d,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:s,style:o}),t)}function Iq(e,t){const n={enter:{},update:{}};return tt(n,{orient:e("orient"),offset:e("offset")||0,position:Dn(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function sk(e,t,n){const i=K(e.signals),r=K(e.scales);return n||i.forEach(a=>wE(a,t)),K(e.projections).forEach(a=>function(e,t){const n=t.config.projection||{},i={};for(const r in e)"name"!==r&&(i[r]=mm(e[r],r,t));for(const r in n)null==i[r]&&(i[r]=mm(n[r],r,t));t.addProjection(e.name,i)}(a,t)),r.forEach(a=>function(e,t){const n=e.type||"linear";d2(n)||I("Unrecognized scale type: "+W(n)),t.addScale(e.name,{type:n,domain:void 0})}(a,t)),K(e.data).forEach(a=>function(e,t){const n=[];e.transform&&e.transform.forEach(i=>{n.push(Am(i,t))}),e.on&&e.on.forEach(i=>{KE(i,t,e.name)}),t.addDataPipeline(e.name,function(e,t,n){const i=[];let o,l,u,c,f,r=null,a=!1,s=!1;for(e.values?Pe(e.values)||Hc(e.format)?(i.push(QE(t,e)),i.push(r=jr())):i.push(r=jr({$ingest:e.values,$format:e.format})):e.url?Hc(e.url)||Hc(e.format)?(i.push(QE(t,e)),i.push(r=jr())):i.push(r=jr({$request:e.url,$format:e.format})):e.source&&(r=o=K(e.source).map(h=>G(t.getData(h).output)),i.push(null)),l=0,u=n.length;l<u;++l)c=n[l],f=c.metadata,!r&&!f.source&&i.push(r=jr()),i.push(c),f.generates&&(s=!0),f.modifies&&!s&&(a=!0),f.source?r=c:f.changes&&(r=null);return o&&(u=o.length-1,i[0]=ej({derive:a,pulse:u?o:o[0]}),(a||u)&&i.splice(1,0,jr())),r||i.push(jr()),i.push(Nr({})),i}(e,t,n))}(a,t)),r.forEach(a=>sj(a,t)),(n||i).forEach(a=>function(e,t){const n=t.getSignal(e.name);let i=e.update;e.init&&(i?I("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=Wn(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(r=>function(e,t,n){const i=e.encode,r={target:n};let a=e.events,s=e.update,o=[];a||I("Signal update missing events specification."),ke(a)&&(a=function(e,t,n){return hE=t||"view",dE=$P,gE(e.trim()).map(sm)}(a,t.isSubscope()?dm:gm)),a=K(a).filter(l=>l.signal||l.scale?(o.push(l),0):1),o.length>1&&(o=[zU(o)]),a.length&&o.push(a.length>1?{merge:a}:a[0]),null!=i&&(s&&I("Signal encode and update are mutually exclusive."),s="encode(item(),"+W(i)+")"),r.update=ke(s)?Wn(s,t):null!=s.expr?Wn(s.expr,t):null!=s.value?s.value:null!=s.signal?{$expr:RU,$params:{$value:t.signalRef(s.signal)}}:I("Invalid signal update specification."),e.force&&(r.options={force:!0}),o.forEach(l=>t.addUpdate(te(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):jo(e,t)}}(l,t),r)))}(r,t,n.id))}(a,t)),K(e.axes).forEach(a=>Bq(a,t)),K(e.marks).forEach(a=>nf(a,t)),K(e.legends).forEach(a=>function(e,t){const n=t.config.legend,i=e.encode||{},r=zt(e,n),a=i.legend||{},s=a.name||void 0,o=a.interactive,l=a.style,u={};let f,h,d,c=0;wm.forEach(x=>e[x]?(u[x]=e[x],c=c||e[x]):0),c||I("Missing valid scale for legend.");const g=function(e,t){let n=e.type||"symbol";return!e.type&&1===function(e){return wm.reduce((t,n)=>t+(e[n]?1:0),0)}(e)&&(e.fill||e.stroke)&&(n=Pd(t)?Kc:Ud(t)?bm:"symbol"),n!==Kc?n:Ud(t)?bm:Kc}(e,t.scaleType(c)),p={title:null!=e.title,scales:u,type:g,vgrad:"symbol"!==g&&r.isVertical()},m=G(t.add(En(null,[p]))),v=G(t.add(GU(h={type:g,scale:t.scaleRef(c),count:t.objectProperty(r("tickCount")),limit:t.property(r("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return g===Kc?(d=[Sj(e,c,n,i.gradient),jE(e,n,i.labels,v)],h.count=h.count||t.signalRef(`max(2,2*floor((${zr(r.gradientLength())})/100))`)):g===bm?d=[Tj(e,c,n,i.gradient,v),jE(e,n,i.labels,v)]:(f=function(e,t){const n=zt(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),d=[Ij(e,n,i,v,zr(f.columns))],h.size=function(e,t,n){const i=zr(JE("size",e,n)),r=zr(JE("strokeWidth",e,n)),a=zr(function(e,t,n){return PE("fontSize",e)||function(e,t,n){const i=t.config.style["guide-label"];return i&&i.fontSize}(0,t)}(n[1].encode,t));return Wn(`max(ceil(sqrt(${i})+${r}),${a})`,t)}(e,t,d[0].marks)),d=[$o({role:"legend-entry",from:m,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:f,interactive:o})],p.title&&d.push(function(e,t,n,i){const r=zt(e,t),a={enter:{opacity:de},update:{opacity:cn,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:de}};return tt(a,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:Pj},angle:{signal:Uj},align:{signal:Nj},baseline:{signal:jj},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Wt({type:Pr,role:"legend-title",style:xm,from:i,encode:a},n)}(e,n,i.title,m)),nf($o({role:"legend",from:m,encode:za(aq(r,e,n),a,Vo),marks:d,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:s,interactive:o,style:l}),t)}(a,t)),e.title&&function(e,t){const n=zt(e=ke(e)?{text:e}:e,t.config.title),i=e.encode||{},r=i.group||{},a=r.name||void 0,s=r.interactive,o=r.style,l=[],c=G(t.add(En(null,[{}])));l.push(function(e,t,n,i){const r={value:0},s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return tt(s,{text:e.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Wt({type:Pr,role:"title-text",style:"group-title",from:i,encode:s},n)}(e,n,function(e){const t=e.encode;return t&&t.title||te({name:e.name,interactive:e.interactive,style:e.style},t)}(e),c)),e.subtitle&&l.push(function(e,t,n,i){const r={value:0},s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return tt(s,{text:e.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Wt({type:Pr,role:"title-subtitle",style:"group-subtitle",from:i,encode:s},n)}(e,n,i.subtitle,c)),nf($o({role:"title",from:c,encode:fq(n,r),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:s,style:o}),t)}(e.title,t),t.parseLambdas(),t}function Yo(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function ok(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function lk(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function Fm(e){return($(e)?zq:Nq)(e)}function zq(e){const t=e.length;let n="[";for(let i=0;i<t;++i){const r=e[i];n+=(i>0?",":"")+(ee(r)?r.signal||Fm(r):W(r))}return n+"]"}function Nq(e){let i,r,t="{",n=0;for(i in e)r=e[i],t+=(++n>1?",":"")+W(i)+":"+(ee(r)?r.signal||Fm(r):W(r));return t+"}"}function Cn(e,t,n){return ee(e)||I("Input Vega specification must be an object."),t=function(...e){return e.reduce((t,n)=>{for(const i in n)"signals"===i?t.signals=Tk(t.signals,n.signals):Pm(t,i,n[i],"legend"===i?{layout:1}:"style"===i||null);return t},{})}(function(){const e="sans-serif",i="#4c78a8",r="#000",a="#888",s="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:s}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:a,grid:!1,gridWidth:1,gridColor:s,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:a,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:s,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),function(e,t){const n=t.config,i=G(t.root=t.add(Yc())),r=function(e,t){const n=s=>Dn(e[s],t[s]),i=[Yo("background",n("background")),Yo("autosize",ZP(n("autosize"))),Yo("padding",JP(n("padding"))),Yo("width",n("width")||0),Yo("height",n("height")||0)],r=i.reduce((s,o)=>(s[o.name]=o,s),{}),a={};return K(e.signals).forEach(s=>{J(r,s.name)?s=te(r[s.name],s):i.push(s),a[s.name]=s}),K(t.signals).forEach(s=>{!J(a,s.name)&&!J(r,s.name)&&i.push(s)}),i}(e,n);r.forEach(u=>wE(u,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(En()),s=t.add(CE(bE((e=>za({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),Jc,lm,e.style,t,{pulse:G(a)}))),o=t.add(FE({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:G(s)}));t.operators.pop(),t.pushState(G(s),G(o),null),sk(e,t,r),t.operators.push(o);let l=t.add(kE({mark:i,pulse:G(o)}));return l=t.add(TE({pulse:G(l)})),l=t.add(Nr({pulse:G(l)})),t.addData("root",new Ur(t,a,a,l)),t}(e,new ok(t,n)).toRuntime()}ok.prototype=lk.prototype={parse(e){return sk(e,this)},fork(){return new lk(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof fm?G(e):e;return this.add(QU({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(i,r,a){let s,o;i&&(s=i.data||(i.data={}),o=s[r]||(s[r]=[]),o.push(a))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(G(this.add(Nr({pulse:e})))),this._parent.push(t),this._lookup.push(n?G(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ce(this._parent)},encode(){return ce(this._encode)},lookup(){return ce(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(ke(e))return Uo(e,t);e.signal||I("Unsupported field reference: "+W(e));const n=e.signal;let i=this.field[n];if(!i){const r={name:this.signalRef(n)};t&&(r.as=t),this.field[n]=i=G(this.add(VU(r)))}return i},compareRef(e){let t=!1;const n=a=>Pe(a)?(t=!0,this.signalRef(a.signal)):function(e){return e&&e.expr}(a)?(t=!0,this.exprRef(a.expr)):a,i=K(e.field).map(n),r=K(e.order).map(n);return t?G(this.add(AE({fields:i,orders:r}))):ME(i,r)},keyRef(e,t){let n=!1;const r=this.signals;return e=K(e).map(a=>Pe(a)?(n=!0,G(r[a.signal])):a),n?G(this.add($U({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=Wc(e.op,e.field),n=e.order||"ascending";return n.signal?G(this.add(AE({fields:t,orders:this.signalRef(n.signal)}))):ME(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return J(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&I("Duplicate signal name: "+W(e));const n=t instanceof fm?t:this.add(Yc(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||I("Unrecognized signal name: "+W(e)),this.signals[e]},signalRef(e){return this.signals[e]?G(this.signals[e]):(J(this.lambdas,e)||(this.lambdas[e]=this.add(Yc(null))),G(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const i=e[t],r=Wn(i,this),a=this.lambdas[i];a.params=r.$params,a.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&ee(e)?this.signalRef(e.signal||Fm(e)):e},exprRef(e,t){const n={expr:Wn(e,this)};return t&&(n.expr.$name=t),G(this.add(jU(n)))},addBinding(e,t){this.bindings||I("Nested signals do not support binding: "+W(e)),this.bindings.push(te({signal:e},t))},addScaleProj(e,t){J(this.scales,e)&&I("Duplicate scale or projection name: "+W(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,tj(t))},addProjection(e,t){this.addScaleProj(e,JU(t))},getScale(e){return this.scales[e]||I("Unrecognized scale name: "+W(e)),this.scales[e]},scaleRef(e){return G(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return J(this.data,e)&&I("Duplicate data set name: "+W(e)),this.data[e]=t},getData(e){return this.data[e]||I("Undefined data set name: "+W(e)),this.data[e]},addDataPipeline(e,t){return J(this.data,e)&&I("Duplicate data set name: "+W(e)),this.addData(e,Ur.fromEntries(this,t))}},te(ps,Vr,$r,Xn,Gr,pi,Yr,At,mi,ue,ge,Ct);class iV{constructor(){this.data=[],this.offset=0}getLength(){return this.data.length-this.offset}isEmpty(){return 0==this.data.length}enqueue(t){this.data.push(t)}dequeue(){if(0!=this.data.length){var t=this.data[this.offset];return 2*++this.offset>=this.data.length&&(this.data=this.data.slice(this.offset),this.offset=0),t}}peek(){return this.data.length>0?this.data[this.offset]:void 0}}class Wo{constructor(t,n,i){this.graph=t,this.queue=new iV,this.verticesNEW=[],this.visited=new Array(this.graph.numVertices).fill(!1),this.level=new Array(this.graph.numVertices).fill(-1),this.breathFirstSearch(n,i)}breathFirstSearch(t,n){for(this.visited[t]=!0,this.level[t]=0,this.verticesNEW.push(t),this.queue.enqueue(t);!this.queue.isEmpty();){let i=this.queue.dequeue();i in n&&n[i].forEach(a=>{this.visited[a]||(this.visited[a]=!0,this.level[a]=this.level[i]+1,this.queue.enqueue(a),this.verticesNEW.push(a))})}}createLevels(){let t=[];return this.verticesNEW.forEach(n=>{let i=this.level[n];-1!=i&&void 0!==i&&(void 0===t[i]?t.push([n]):t[i].push(n))}),t}reachable(){let t=[];return this.verticesNEW.forEach(n=>{let i=this.level[n];-1!=i&&void 0!==i&&t.push([n])}),t}}class Zi{constructor(t){let n=this.calculatePossibleRoots(t),i=new fe(t,t.verticesAS);this.leaves=[],n.forEach(r=>{this.worker(r,i)})}worker(t,n){t in n.outDegree?n.outDegree[t].forEach(r=>{this.worker(r,n)}):this.leaves.push(t)}calculatePossibleRoots(t){let n=[];return t.verticesAS.forEach(i=>{i in t.inDegree||n.push(i)}),n}}class Hn{constructor(t,n,i){this.graph=t,this.fixedVertices=n,this.freeVertices=i,this.fixedIndex=new Map,this.groups=new Map,this.slots=[],this.createIndexMap(n),this.createGroups(t.inDegree),this.createSlots()}createIndexMap(t){for(let n=0;n<t.length;n++)this.fixedIndex[t[n]]=n}createSlots(){for(const[t,n]of Object.entries(this.groups))n.forEach(i=>{this.slots.push(i)})}createGroups(t){this.freeVertices.forEach(n=>{let i=this.medianAssessment(n,t);i in this.groups?this.groups[i].push(n):this.groups[i]=[n]})}medianAssessment(t,n){if(!(t in n))return-1;{let r=[];if(n[t].forEach(a=>{r.push(this.fixedIndex[a])}),r.length>1){r.sort((s,o)=>s-o);let a=Math.floor(r.length/2);return r[a]}if(1==r.length)return r[0]}}}class uk{constructor(t,n,i,r,a){this.offsetsX=[],this.nextsOffset=a,this.depthMultiplier=r,this.nextConnnectedComponentOffset=0,this.maximumX=0;let s=new fe(t,t.verticesAS),l=new Zi(t).leaves,u=this.calculatePossibleRoots(t);this.neighbourMAP=new Map;let c=0;l.forEach(f=>{if(f in t.outDegree){let h=0;t.outDegree[f].forEach(d=>h+=n[d].y),h/=t.outDegree[f].length,n[f]=new se(i*r+50,h),c=h}else n[f]=new se(i*r+50,c+a),c+=a}),this.maintainMinimumDistanceAS(l,n,a),u.forEach(f=>{this.nextYonLayer=[],this.setup(f,0,t,s,n),this.nextConnnectedComponentOffset=this.nextYonLayer[this.nextYonLayer.length-1];let h=(this.nextYonLayer.length-1)*this.depthMultiplier;h>this.maximumX&&(this.maximumX=h)})}calculatePossibleRoots(t){let n=[];return t.verticesAS.forEach(i=>{i in t.inDegree||n.push(i)}),n}setup(t,n,i,r,a){void 0===this.nextYonLayer[n]&&this.nextYonLayer.push(this.nextConnnectedComponentOffset);let o,s=n*this.depthMultiplier+50;if(t in r.outDegree){let l=r.outDegree[t];l.forEach(u=>{this.setup(u,n+1,i,r,a)}),o=1==l.length?a[l[0]].y:(a[l[0]].y+a[l[l.length-1]].y)/2,a[t]=new se(s,o)}this.nextYonLayer[n]=this.nextYonLayer[n]+this.nextsOffset}maintainMinimumDistanceAS(t,n,i){if(t.length>0){let r=n[t[0]].y;for(let a=1;a<t.length;a++){let s=t[a],o=t[a-1],l=n[s];if(l.y-r<i){let c=r+i;r=c,n[s]=new se(n[o].x,c)}else r=l.y}this.maximumY=r}}}class Bm{constructor(t,n,i){this.layout=t,this.averageSpacingCT(n,i),this.maintainMinimumDistanceCT(n)}calculateNeighborYMean(t){let n=0;if(t in this.layout.graph.outDegree){let i=0;return this.layout.graph.outDegree[t].forEach(r=>{this.layout.graph.vertexType[r]==R.Dy.BM&&1==this.layout.graph.inDegree[r].length&&(n+=this.layout.drawing[r].y,i+=1)}),0!==i?n/i:-1}return-1}averageSpacingCT(t,n){t.forEach(i=>{let r=this.calculateNeighborYMean(i);if(-1==r){let a=new se(this.layout.xPositionCT,n+this.layout.offsetIncrementCT);n=a.y,this.layout.drawing[i]=a}else{let a=new se(this.layout.xPositionCT,r);n=a.y,this.layout.drawing[i]=a}})}maintainMinimumDistanceCT(t){if(t.length>0){let n=this.layout.drawing[t[0]].y;for(let i=1;i<t.length;i++){let r=t[i],a=t[i-1],s=this.layout.drawing[r];if(s.y-n<this.layout.offsetIncrementCT){let l=n+this.layout.offsetIncrementCT;n=l,this.layout.drawing[r]=new se(this.layout.drawing[a].x,l)}else n=s.y}this.finalOffset=n+this.layout.offsetIncrementCT}}}class rV extends sl{constructor(t,n,i,r){super(t,i,r),this.class=Xe.Partial;let a=new Zi(t),s=a.leaves;this.calculateDepth(),this.calculateParameter();let l=new Hn(t,s,t.verticesCT);this.slotsCT=l.slots;let u=new Hn(t,this.slotsCT,t.verticesBM);if(this.slotsBM=u.slots,this.drawCellTypes(this.slotsCT),this.graph.verticesBM.length>0){let f=this.calculateMinY();this.slotsBM.forEach(d=>{let g=new se(this.xPositionBM,f);f+=this.offsetIncrementBM,this.drawing[d]=g}),new Bm(this,this.slotsCT,this.offsetIncrementCT)}new uk(t,this.drawing,this.depth,this.depthMultiplier,this.offsetIncrementAS),this.calculateWidthHeight(),this.applyLinearMap(i,a),this.updateHighlights(n)}updateHighlights(t){t in this.graph.outDegree&&this.graph.outDegree[t].forEach(n=>{this.updateHighlights(n);let i=String(t)+"|"+String(n);this.highlightedEdge[i]=1})}calculateMinY(){let t=Number.POSITIVE_INFINITY;return this.graph.verticesBM.forEach(n=>{n in this.graph.inDegree&&this.graph.inDegree[n].forEach(i=>{this.drawing[i].y<t&&(t=this.drawing[i].y)})}),t}calculateRoot(t){let n=null;return t.vertices.forEach(i=>{i in t.inDegree||(n=i)}),n}drawCellTypes(t){let n=this.properties.heightTopPadding;t.forEach(i=>{let r=new se(this.xPositionCT,n);n+=this.offsetIncrementCT,this.drawing[i]=r})}drawBiomarkers(t){let n=this.properties.heightTopPadding;t.forEach(i=>{let r=new se(this.xPositionBM,n);n+=this.offsetIncrementBM,this.drawing[i]=r})}}class Im{constructor(t,n,i,r,a){this.drawing=t,this.verticesToMove=i,this.ticks=a,this.animation=[];for(let s=1;s<a+1;s++){let o=new Map,l=1/a*s;Object.keys(t).forEach(u=>{o[u]=this.drawing[u]});for(let u=0;u<n.length;u++){let c=n[u],f=r[u],h=new se(c.x+(f.x-c.x)*l,c.y+(f.y-c.y)*l);o[i[u]]=h}this.animation.push(o)}}}class af{constructor(t){this.dummyID=-9e6,this.leafMap=new Map;let n=new fe(t,t.verticesAS);n.vertices.forEach(r=>this.leafMap[r]=!1);let i=this.calculateRoot(n);this.leafWorker(i,n),this.postOrder(i,t)}calculateRoot(t){let n=null;return t.vertices.forEach(i=>{i in t.inDegree||(n=i)}),n}leafWorker(t,n){t in n.outDegree?n.outDegree[t].forEach(i=>{this.leafWorker(i,n)}):this.leafMap[t]=!0}postOrder(t,n){if(t in n.outDegree){let i=[];n.outDegree[t].forEach(r=>{switch(n.vertexType[r]){case R.Dy.AS:this.postOrder(r,n);break;case R.Dy.CT:this.leafMap[t]||i.push(r)}}),i.length>0&&this.extendGraph(n,t,i)}}extendGraph(t,n,i){this.dummyID-=1,t.verticesAS.push(this.dummyID),t.vertices.push(this.dummyID),t.numVertices+=1,t.numVerticesAS+=1,t.vertexType[this.dummyID]=R.Dy.AS,t.vertexColor[this.dummyID]="red",t.vertexLabel[this.dummyID]="",t.vertexVisible[this.dummyID]=0,t.vertexSize[this.dummyID]=300,i.forEach(r=>{this.removeByValue(r,t.outDegree[n]),this.removeByValue(n,t.inDegree[r]),t.inDegree[r].push(this.dummyID)}),t.outDegree[this.dummyID]=i,t.outDegree[n].push(this.dummyID),t.inDegree[this.dummyID]=[n]}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}}class ck{constructor(t,n,i,r){this.sourceID=t,this.middleID=n,this.targetID=i,this.endpointID=r,this.edge={source:t,target:i}}}class sf{constructor(t){this.bends=[],this.bendCount=-1,this.depth=Number.NEGATIVE_INFINITY;let n=new fe(t,t.verticesAS);this.calculatePossibleRoots(t).forEach(r=>{this.treeAugmentation(r,t,n)}),this.processBends(t,n)}treeAugmentation(t,n,i){let a=new Wo(i,t,i.outDegree).createLevels();this.depth<a.length&&(this.depth=a.length);for(let s=0;s<a.length-1;s++)a[s].forEach(l=>{if(!(l in i.outDegree)){let u=l;if(l in n.inDegree){let c=n.inDegree[l][0],f=[];c in i.outDegree&&(i.outDegree[c].forEach(d=>{d!=l&&f.push(d)}),i.outDegree[c]=f);let h=[];for(let d=s+1;d<a.length;d++)i.outDegree[this.bendCount]=[u],h.push(this.bendCount),u=this.bendCount,this.bendCount=this.bendCount-1;this.bends.push(new ck(c,h,l,l)),c in i.outDegree&&i.outDegree[c].push(u)}}})}processBends(t,n){this.bends.forEach(i=>{let r=i.middleID;r.forEach(s=>{t.vertices.push(s),t.verticesAS.push(s),t.numVertices+=1,t.numVerticesAS+=1,t.vertexType[s]=R.Dy.AS,t.vertexColor[s]="red",t.vertexLabel[s]=" ",t.vertexVisible[s]=0,t.vertexSize[s]=300});let a=i.targetID;r.forEach(s=>{s in t.outDegree?t.outDegree[s].push(a):t.outDegree[s]=[a],a in t.inDegree?t.inDegree[a].push(s):t.inDegree[a]=[s],a=s}),t.inDegree[r[r.length-1]]=[i.sourceID],t.outDegree[i.sourceID].push(r[r.length-1]),this.removeByValue(i.targetID,t.outDegree[i.sourceID]),this.removeByValue(i.sourceID,t.inDegree[i.targetID])})}removeByValue(t,n){let i=n.indexOf(t);n.splice(i,1)}calculatePossibleRoots(t){let n=[];return t.verticesAS.forEach(i=>{i in t.inDegree||n.push(i)}),n}}class fk{constructor(t){this.graph=t,this.treeAS=new fe(t,t.verticesAS),this.counter=1,this.subtreeMap=new Map;let n=this.calculateRoot();this.calculateSubtreeMap(n),this.artificialCTID=-2e5,this.artificialBMID=-75e4,this.replicateCTBM()}replicateCTBM(){this.graph.verticesCT.forEach(t=>{if(t in this.graph.inDegree){let n=new Map;this.graph.inDegree[t].forEach(r=>{let a=this.subtreeMap[r];a in n?n[a].push(r):n[a]=[r]});let i=!0;for(const[r,a]of Object.entries(n))i?i=!1:this.augment(t,a)}})}augment(t,n){this.graph.vertices.push(this.artificialCTID),this.graph.verticesCT.push(this.artificialCTID),this.graph.numVertices+=1,this.graph.numVerticesCT+=1,this.graph.vertexType[this.artificialCTID]=R.Dy.CT,this.graph.vertexVisible[this.artificialCTID]=1,this.graph.vertexSize[this.artificialCTID]=this.graph.vertexSize[t],this.graph.vertexLabel[this.artificialCTID]=this.graph.vertexLabel[t],this.graph.vertexColor[this.artificialCTID]=this.graph.vertexColor[t],this.graph.IDtoOntologyType[this.artificialCTID]=this.graph.IDtoOntologyType[t],this.graph.IDtoOntologyID[this.artificialCTID]=this.graph.IDtoOntologyID[t],n.forEach(i=>{this.graph.inDegree[this.artificialCTID]=[i],this.graph.outDegree[i].push(this.artificialCTID),this.removeByValue(i,this.graph.inDegree[t]),this.removeByValue(t,this.graph.outDegree[i])}),t in this.graph.outDegree&&this.augmentBM(this.graph.outDegree[t]),this.artificialCTID-=1}augmentBM(t){let n=[];for(let i=0;i<t.length;i++){let r=t[i];n.push(this.artificialBMID),this.graph.vertices.push(this.artificialBMID),this.graph.verticesBM.push(this.artificialBMID),this.graph.vertexVisible[this.artificialBMID]=1,this.graph.vertexColor[this.artificialBMID]=this.graph.vertexColor[r],this.graph.IDtoOntologyType[this.artificialBMID]=this.graph.IDtoOntologyType[r],this.graph.IDtoOntologyID[this.artificialBMID]=this.graph.IDtoOntologyID[r],this.graph.vertexSize[this.artificialBMID]=this.graph.vertexSize[r],this.graph.numVertices+=1,this.graph.numVerticesBM+=1,this.graph.vertexType[this.artificialBMID]=R.Dy.BM,this.graph.vertexLabel[this.artificialBMID]=this.graph.vertexLabel[r],this.artificialBMID-=1}n.forEach(i=>{i in this.graph.inDegree?this.graph.inDegree[i].push(this.artificialCTID):this.graph.inDegree[i]=[this.artificialCTID],this.artificialCTID in this.graph.outDegree?this.graph.outDegree[this.artificialCTID].push(i):this.graph.outDegree[this.artificialCTID]=[i]})}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}calculateRoot(){let t=-1;return this.treeAS.vertices.forEach(n=>{n in this.treeAS.inDegree||(t=n)}),t}calculateSubtreeMap(t){return t in this.treeAS.outDegree?(this.treeAS.outDegree[t].forEach(n=>{this.calculateSubtreeMap(n)||(this.counter+=1)}),!1):(this.subtreeMap[t]=this.counter,!0)}}class hk{constructor(t){let n=new fe(t,t.verticesAS),i=this.calculateRoot(n),r=new Zi(t),a=new Hn(t,r.leaves,t.verticesCT);this.slotsCT=a.slots,this.slotIndexMap=new Map,this.calculateIndexMap(),this.hasLeaf=new Map,this.calculateLeafMap(i,t,n),this.heuristicAS=new Map,this.calculateASHeuristic(i,t,n),this.balancing(i,t,n)}calculateIndexMap(){for(let t=0;t<this.slotsCT.length;t++)this.slotIndexMap[this.slotsCT[t]]=t}balancing(t,n,i){if(t in i.outDegree){let r=[],a=[],s=!1;return i.outDegree[t].forEach(o=>{this.hasLeaf[o]?r.push(o):a.push(o),s=this.balancing(o,n,i)}),s?this.leafProcessing(t,n):n.outDegree[t].sort((o,l)=>this.heuristicAS[o]-this.heuristicAS[l]),!1}return!0}leafProcessing(t,n){let i=[],r=[];n.outDegree[t].forEach(a=>{this.hasLeaf[a]?i.push(a):r.push(a)}),i.sort((a,s)=>this.medianSlotHeuristic(a,n)-this.medianSlotHeuristic(s,n)),n.outDegree[t]=i.concat(r)}medianSlotHeuristic(t,n){let i=[];return n.outDegree[t].forEach(r=>{i.push(this.slotIndexMap[r])}),this.calculateMedian(i)}calculateMedian(t){return 1==t.length?t[0]:0==t.length?0:(t.sort((i,r)=>i-r),t[Math.floor(t.length/2)])}calculateY(t,n,i){let r=0;return t.outDegree[i].forEach(a=>r+=n[a].y),r/t.outDegree[i].length}calculateASHeuristic(t,n,i){if(t in i.outDegree){let r=0;i.outDegree[t].forEach(a=>{this.calculateASHeuristic(a,n,i),r+=this.heuristicAS[a]}),this.heuristicAS[t]=r}else this.heuristicAS[t]=t in n.outDegree?-10:1}calculateRoot(t){let n=null;return t.vertices.forEach(i=>{i in t.inDegree||(n=i)}),n}calculateLeafMap(t,n,i){if(t in i.outDegree){let r=!1;i.outDegree[t].forEach(a=>{this.calculateLeafMap(a,n,i),this.hasLeaf[a]&&(r=!0)}),this.hasLeaf[t]=r}else this.hasLeaf[t]=t in n.outDegree}}class dk{constructor(t){this.graph=t,this.subtreeMap=new Map,this.treeAS=new fe(t,t.verticesAS),this.counter=1;let n=this.calculateRoot();this.calculateSubtreeMap(n),this.artificialBMID=-85e4,this.replicateBM()}calculateRoot(){let t=-1;return this.treeAS.vertices.forEach(n=>{n in this.treeAS.inDegree||(t=n)}),t}calculateSubtreeMap(t){return t in this.treeAS.outDegree?(this.treeAS.outDegree[t].forEach(n=>{this.calculateSubtreeMap(n)||(this.counter+=1)}),!1):(this.subtreeMap[t]=this.counter,t in this.graph.outDegree&&this.graph.outDegree[t].forEach(n=>this.subtreeMap[n]=this.counter),!0)}replicateBM(){this.graph.verticesBM.forEach(t=>{if(t in this.graph.inDegree){let n=new Map;this.graph.inDegree[t].forEach(r=>{let a=this.subtreeMap[r];a in n?n[a].push(r):n[a]=[r]});let i=!0;for(const[r,a]of Object.entries(n))i?i=!1:this.augment(t,a)}})}augment(t,n){this.graph.vertices.push(this.artificialBMID),this.graph.verticesBM.push(this.artificialBMID),this.graph.numVertices+=1,this.graph.numVerticesBM+=1,this.graph.vertexType[this.artificialBMID]=R.Dy.BM,this.graph.vertexLabel[this.artificialBMID]=this.graph.vertexLabel[t],this.graph.IDtoOntologyType[this.artificialBMID]=this.graph.IDtoOntologyType[t],this.graph.IDtoOntologyID[this.artificialBMID]=this.graph.IDtoOntologyID[t],this.graph.vertexSize[this.artificialBMID]=this.graph.vertexSize[t],this.graph.vertexVisible[this.artificialBMID]=1,this.graph.vertexColor[this.artificialBMID]=this.graph.vertexColor[t],n.forEach(i=>{this.graph.outDegree[i].push(this.artificialBMID),this.artificialBMID in this.graph.inDegree?this.graph.inDegree[this.artificialBMID].push(i):this.graph.inDegree[this.artificialBMID]=[i]}),n.forEach(i=>{this.removeByValue(i,this.graph.inDegree[t]),this.removeByValue(t,this.graph.outDegree[i])}),this.artificialBMID-=1}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}}class aV{constructor(t,n){this.source=t,this.target=n}}class Rm{constructor(t,n,i){let a=new Hn(n,t,n.verticesBM).slots;this.createIndexMapCT(t),this.createIndexMapBMCT(t,a,n.inDegree),this.calculateReplacements(t,a,i,n.inDegree,n.outDegree),this.update(n),this.calculateSlots(a)}calculateSlots(t){this.newSlotsBM=t.slice(0),this.replacements.forEach(n=>{this.newSlotsBM.push(n.newBM)})}deepClone(t,n,i,r,a){i.verticesAS.forEach(s=>{s in n&&(t[s]=n[s].slice(0))}),r.forEach(s=>{s in n&&(t[s]=n[s].slice(0))}),a.forEach(s=>{s in n&&(t[s]=n[s].slice(0))})}update(t){this.replacements.forEach(n=>{t.vertices.push(n.newBM),t.verticesBM.push(n.newBM),t.numVertices+=1,t.numVerticesBM+=1,t.vertexType[n.newBM]=R.Dy.BM,t.vertexLabel[n.newBM]=t.vertexLabel[n.originalBM],t.IDtoOntologyType[n.newBM]=t.IDtoOntologyType[n.originalBM],t.IDtoOntologyID[n.newBM]=t.IDtoOntologyID[n.originalBM],t.vertexSize[n.newBM]=t.vertexSize[n.originalBM],t.vertexVisible[n.newBM]=1,t.vertexColor[n.newBM]=t.vertexColor[n.originalBM],t.inDegree[n.newBM]=[n.originalCT],t.outDegree[n.originalCT].push(n.newBM),this.removeByValue(n.originalCT,t.inDegree[n.originalBM]),this.removeByValue(n.originalBM,t.outDegree[n.originalCT])})}createIndexMapCT(t){this.indexMapCT=new Map;for(let n=0;n<t.length;n++)this.indexMapCT[t[n]]=n}createIndexMapBMCT(t,n,i){this.indexMapBMCT=new Map,n.forEach(r=>{this.indexMapBMCT[r]=r in i?this.calculateCTGroupMean(i[r]):Number.POSITIVE_INFINITY})}calculateCTGroupMean(t){if(t.length>0){let n=0;return t.forEach(i=>{n+=this.indexMapCT[i]}),n/t.length}return 0}replacementEdgeHierarchy(t,n){let i=[];return t.forEach(r=>{r in n&&n[r].forEach(s=>{i.push(new aV(r,s))})}),i.sort((r,a)=>Math.abs(this.indexMapCT[a.source]-this.indexMapBMCT[a.target])-Math.abs(this.indexMapCT[r.source]-this.indexMapBMCT[r.target])),i}calculateReplacements(t,n,i,r,a){this.replacements=[],this.replacementsMap=new Map,n.forEach(l=>{this.replacementsMap[l]=l in r?r[l].length:0});let s=-1e5,o=this.replacementEdgeHierarchy(t,a);if(i>0){let l=o.length*(i/100),u=0;o.forEach(c=>{this.replacementsMap[c.target]>1&&u<l&&(this.replacements.push(new sV(c.source,c.target,s)),this.replacementsMap[c.target]=this.replacementsMap[c.target]-1,s-=1,u+=1)})}}removeByValue(t,n){let i=n.indexOf(t);n.splice(i,1)}}class sV{constructor(t,n,i){this.originalCT=t,this.originalBM=n,this.newBM=i}}class oV{constructor(t,n,i,r,a,s,o){this.drawing=new Map,this.graph=new fe(t,t.vertices),this.biomarkerX=r,this.cellTypeX=a,this.angleThreshold=55,this.feasible=!0,this.augment(i,n),this.draw(o,s),this.isFeasible()}isFeasible(){this.graph.verticesCT.forEach(t=>{t in this.graph.outDegree&&this.graph.outDegree[t].forEach(n=>{this.calculateAngle(this.drawing[t],this.drawing[n])>this.angleThreshold&&(this.feasible=!1)})})}augment(t,n){this.slotsCT=t;let i=new Hn(this.graph,this.slotsCT,this.graph.verticesBM);this.slotsBM=i.slots,new Rm(this.slotsCT,this.graph,n);let a=new Hn(this.graph,this.slotsCT,this.graph.verticesBM);this.slotsBM=a.slots}draw(t,n){let i=0;this.slotsBM.forEach(r=>{let a=new se(this.biomarkerX,i);i+=t,this.drawing[r]=a}),this.averageSpacingCT(this.slotsCT,0,n),this.maintainMinimumDistanceCT(this.slotsCT,n)}calculateNeighborYMean(t){let n=0;if(t in this.graph.outDegree){let i=0;return this.graph.outDegree[t].forEach(r=>{this.graph.vertexType[r]==R.Dy.BM&&1==this.graph.inDegree[r].length&&(n+=this.drawing[r].y,i+=1)}),0!==i?n/i:-1}return-1}averageSpacingCT(t,n,i){t.forEach(r=>{let a=this.calculateNeighborYMean(r);if(-1==a){let s=new se(this.cellTypeX,n+i);n=s.y,this.drawing[r]=s}else{let s=new se(this.cellTypeX,a);n=s.y,this.drawing[r]=s}})}maintainMinimumDistanceCT(t,n){if(t.length>0){let i=this.drawing[t[0]].y;for(let r=1;r<t.length;r++){let a=t[r],s=t[r-1],o=this.drawing[a];if(o.y-i<n){let u=i+n;i=u,this.drawing[a]=new se(this.drawing[s].x,u)}else i=o.y}}}calculateAngle(t,n){let i=Math.atan2(n.y-t.y,n.x-t.x)*(180/Math.PI);return Math.abs(i)}calculateLengthEdge(t,n){return Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y))}}class gk{constructor(t,n,i,r,a,s){this.graph=t,this.binarySearch(n,i,r,a,s)}binarySearch(t,n,i,r,a){let s=0,o=100;for(;s<=o;){let l=Math.floor(s+(o-s)/2);if(o==l)break;new oV(this.graph,l,t,n,i,r,a).feasible?o=l:s=l+1}this.parameterReplication=o}}class pk extends Xa{constructor(t){super(t,"Partial"),this.previousDrawing=new Map,this.frames=10,this.frameTime=800}renderRestoreGraphContext(){return this.currentView=null,this.render(this.lastClick)}initializeGraph(){let t=this.controller.graphs[this.controller.currentOrgan];this.augmentedGraph=new fe(t,t.vertices),new af(this.augmentedGraph),new sf(this.augmentedGraph),new fk(this.augmentedGraph),new hk(this.augmentedGraph),new dk(this.augmentedGraph);let o=new Zi(this.augmentedGraph),u=new Hn(this.augmentedGraph,o.leaves,this.augmentedGraph.verticesCT).slots,c=this.controller.properties.totalWidth,m=new gk(this.augmentedGraph,u,c,c-c/3,this.controller.properties.offsetIncrementTwoLines,this.controller.properties.offsetIncrementTwoLines);new Rm(u,this.augmentedGraph,m.parameterReplication)}calculateLayoutGraph(t){let n=this.augmentedGraph.verticesAS.slice(0).concat(this.augmentedGraph.verticesCT.slice(0));if(null!=t){let r=new Wo(this.augmentedGraph,t,this.augmentedGraph.outDegree).createLevels();n=n.concat(r[r.length-1]);let a=r[r.length-2],s=new fe(this.augmentedGraph,n);return s.verticesCT.forEach(o=>{o in s.outDegree&&!a.includes(o)&&(s.outDegree[o].forEach(l=>{this.removeByValue(o,s.inDegree[l])}),delete s.outDegree[o])}),this.lastClick=t,s}return new fe(this.augmentedGraph,n)}renderRestoreViewContext(){this.render(null!=this.lastClick?this.lastClick:null)}render(t){if(this.controller.graphs[this.controller.currentOrgan].ready){this.firstTime&&this.initializeGraph();let i=this.calculateLayoutGraph(t);return this.renderPartial(i,t).then(()=>this.firstTime=!1).then()}return null}renderPartial(t,n){let r=new rV(t,n,new Wr(this.controller.gui.selectedRotation),this.controller.properties),a=new Za(t,r,this.controller.properties);this.setGraph2DParameter(a);let o,s=a.exportSpecification(!1);return null!=this.currentView?this.animation(t,r,a):(o=new on(Cn(s)).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("click",(l,u)=>this.displayBM(l,u)).addEventListener("mouseover",(l,u)=>this.toolTip.compute(l,u,t)),this.currentView=o,this.setBackground(this.currentView),this.currentView.runAsync().then(()=>this.previousDrawing=r.drawing).then())}animationTick(t,n,i,r){if(t==n.animation.length-1){this.setGraph2DParameter(i);let s=new on(Cn(i.exportSpecification(!1))).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("click",(o,l)=>this.displayBM(o,l)).addEventListener("mouseover",(o,l)=>this.toolTip.compute(o,l,r));return this.updateView(s,this.currentView),this.currentView=s,this.setBackground(this.currentView),this.currentView.runAsync()}{i.graphStyle.labelEnabled=!1;let s=new on(Cn(i.exportSpecification(!0))).renderer("svg").initialize(document.querySelector("#drawing"));return this.updateView(s,this.currentView),this.currentView=s,this.setBackground(this.currentView),this.currentView.runAsync()}}animation(t,n,i){let r=this.calculateVertices2Move(t,n.drawing,this.previousDrawing),a=new Im(n.drawing,this.calculateSourcePoints(r,this.previousDrawing),r,this.calculateTargetPoints(r,n.drawing),this.frames),s=[];for(let o=0;o<this.frames;o++)setTimeout(()=>{i.vertexPosition=a.animation[o],s.push(this.animationTick(o,a,i,t))},this.frameTime);return Promise.all(s).then()}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}displayBM(t,n){if(null!=t&&null!=n&&null!=n.datum){let i=n.datum.id;this.augmentedGraph.verticesBM.includes(i)||this.render(i)}}reset(){this.firstTime=!0,this.lastClick=null,this.currentView=null}calculateSourcePoints(t,n){let i=[];return t.forEach(r=>i.push(n[r])),i}calculateTargetPoints(t,n){let i=[];return t.forEach(r=>i.push(n[r])),i}calculateVertices2Move(t,n,i){let r=[];return t.verticesCT.forEach(a=>{a in i&&a in n&&(i[a].x!=n[a].x||i[a].y!=n[a].y)&&r.push(a)}),r}}class mk extends sl{constructor(t,n,i){super(t,n,i),this.class=Xe.Subgraph,new af(t),new sf(t),this.calculateParameter(),new fk(t),new hk(t);let l=new Zi(t),c=new Hn(t,l.leaves,t.verticesCT).slots,h=(new dk(t),new gk(t,c,this.xPositionBM,this.xPositionCT,this.offsetIncrementCT,this.offsetIncrementBM)),p=(new Rm(c,t,h.parameterReplication),new Hn(t,c,this.graph.verticesBM).slots);this.drawBiomarkers(p),this.drawCellTypes(c),new uk(t,this.drawing,this.depth,this.depthMultiplier,this.offsetIncrementAS),this.calculateWidthHeight(),this.applyLinearMap(n,l)}drawBiomarkers(t){let n=this.properties.heightTopPadding;t.forEach(i=>{let r=new se(this.xPositionBM,n);n+=this.offsetIncrementBM,this.drawing[i]=r})}drawCellTypes(t){let n=this.properties.heightTopPadding;this.feasibleClippingCT()?new Bm(this,t,n):t.forEach(i=>{let r=new se(this.xPositionCT,n);n+=this.offsetIncrementCT,this.drawing[i]=r})}}class yk extends Xa{constructor(t){super(t,"Subgraph"),this.currentString="",this.lastID=null}renderRestoreViewContext(){this.firstTime=!1,this.render(null)}renderRestoreGraphContext(){return this.firstTime=!0,this.render(null)}render(t){let n=this.controller.graphs[this.controller.currentOrgan];if(n.ready){let i=new fe(n,n.vertices);return this.renderSubgraph(i)}return Promise.reject()}renderSubgraph(t){let i=new mk(t,new Wr(this.controller.gui.selectedRotation),this.controller.properties),r=new Za(t,i,this.controller.properties);this.setGraph2DParameter(r);let s=new on(Cn(r.exportSpecification(!1))).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("mouseover",(o,l)=>this.toolTip.compute(o,l,t));return this.firstTime||this.updateView(s,this.currentView),this.currentView=s,this.setBackground(this.currentView),this.currentView.runAsync().then(()=>{this.firstTime=!1}).then()}processZoom(t,n){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=this.currentView.scale("xscale"),l=this.currentView.scale("yscale");t.vertices.forEach(h=>{let d=n[h];o(d.x)<i&&(i=o(d.x)),o(d.x)>r&&(r=o(d.x)),l(d.y)<a&&(a=l(d.y)),l(d.y)>s&&(s=l(d.y))});let u=Math.max(Math.abs(r-i),withDrawingDIV),c=Math.max(Math.abs(s-a),heightDrawingDIV),f=this.currentView.signal("anchor");if(console.log("ANCHOR:",f,"XDOM: ",this.currentView.signal("xdom"),"YDOM",this.currentView.signal("ydom")),console.log(u,c,this.currentView.signal("xdom")),this.currentView.container().querySelector("svg").style.width=u+"px",this.currentView.container().querySelector("svg").style.height=c+"px",null!=this.lastWidth){let d=f[1]/this.lastHeight;this.currentView.container().querySelector("svg").scrollTop=-d}this.lastWidth=u,this.lastHeight=c}reset(){this.firstTime=!0,this.currentView=null}}class lV{constructor(t){this.bends=[],this.bendCount=-1,this.depth=Number.NEGATIVE_INFINITY,this.exploreThreshhold=3;let n=new fe(t,t.verticesAS);this.calculatePossibleRoots(t).forEach(r=>{this.treeAugmentation(r,t,n)}),this.processBends(t,n)}treeAugmentation(t,n,i){let a=new Wo(i,t,i.outDegree).createLevels();this.depth<a.length&&(this.depth=a.length);for(let s=0;s<a.length-1;s++)a[s].forEach(l=>{if(!(l in i.outDegree)){let u=l;if(l in n.inDegree){let c=n.inDegree[l][0],f=[];c in i.outDegree&&(i.outDegree[c].forEach(d=>{d!=l&&f.push(d)}),i.outDegree[c]=f);let h=[];for(let d=s+1;d<Math.min(a.length,s+this.exploreThreshhold);d++)i.outDegree[this.bendCount]=[u],h.push(this.bendCount),u=this.bendCount,this.bendCount=this.bendCount-1;this.bends.push(new ck(c,h,l,l)),c in i.outDegree&&i.outDegree[c].push(u)}}})}processBends(t,n){this.bends.forEach(i=>{let r=i.middleID;r.forEach(s=>{t.vertices.push(s),t.verticesAS.push(s),t.numVertices+=1,t.numVerticesAS+=1,t.vertexType[s]=R.Dy.AS,t.vertexColor[s]="red",t.vertexLabel[s]=" ",t.vertexVisible[s]=0,t.vertexSize[s]=300});let a=i.targetID;r.forEach(s=>{s in t.outDegree?t.outDegree[s].push(a):t.outDegree[s]=[a],a in t.inDegree?t.inDegree[a].push(s):t.inDegree[a]=[s],a=s}),t.inDegree[r[r.length-1]]=[i.sourceID],t.outDegree[i.sourceID].push(r[r.length-1]),this.removeByValue(i.targetID,t.outDegree[i.sourceID]),this.removeByValue(i.sourceID,t.inDegree[i.targetID])})}removeByValue(t,n){let i=n.indexOf(t);n.splice(i,1)}calculatePossibleRoots(t){let n=[];return t.verticesAS.forEach(i=>{i in t.inDegree||n.push(i)}),n}}class uV{constructor(t){this.dummyID=-9e6,this.leafMap=new Map;let n=new fe(t,t.verticesAS);n.vertices.forEach(r=>this.leafMap[r]=!1);let i=this.calculateRoot(n);this.leafWorker(i,n),this.postOrder(i,t)}calculateRoot(t){let n=null;return t.vertices.forEach(i=>{i in t.inDegree||(n=i)}),n}leafWorker(t,n){t in n.outDegree?n.outDegree[t].forEach(i=>{this.leafWorker(i,n)}):this.leafMap[t]=!0}postOrder(t,n){if(t in n.outDegree){let i=[];n.outDegree[t].forEach(r=>{switch(n.vertexType[r]){case R.Dy.AS:this.postOrder(r,n);break;case R.Dy.CT:this.leafMap[t]||i.push(r)}}),i.length>0&&this.shrinkGraph(n,t,i)}}shrinkGraph(t,n,i){i.forEach(r=>{this.removeByValue(r,t.outDegree[n]),this.removeByValue(n,t.inDegree[r])})}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}}class vk extends Xa{constructor(t){super(t,"Explore"),t.promiseExplore.then(n=>{this.allGraph=this.controller.graphs[R.jM.All],this.bfsThreshold=3,this.firstTime=!0,this.frames=25,this.frameTime=700})}calculateLayoutGraph(t){(null==t||0==t)&&(this.root=this.controller.allGraphOrganID[this.controller.currentOrgan]);let n=new Wo(this.allGraph,this.root,this.allGraph.outDegree),i=n.createLevels(),r=[];for(let u=0;u<Math.min(this.bfsThreshold,i.length);u++)i[u].forEach(c=>{r.push(c)});null!=this.previousGraph&&this.root in this.previousGraph.inDegree?r.push(this.previousGraph.inDegree[this.root][0]):this.root in this.allGraph.inDegree&&this.allGraph.inDegree[this.root].forEach(u=>{r.push(u)});let a=new fe(this.allGraph,r);new uV(a),new lV(a),n=new Wo(a,this.root,a.outDegree),i=n.createLevels(),r=[];for(let u=0;u<Math.min(this.bfsThreshold,i.length);u++)i[u].forEach(c=>{r.push(c)});this.root in a.inDegree&&a.inDegree[this.root].forEach(u=>{r.push(u)});let l=new fe(a,r);return l.vertices.forEach(u=>{l.vertexSize[u]=this.controller.properties.vertexSize}),l.inDegree[this.root].forEach(u=>{l.vertexColor[u]="black",l.vertexSize[u]=this.controller.properties.rootExplorationVertexSize}),this.previousGraph=l,l}renderRestoreGraphContext(){return null!=this.lastClick?(this.currentView=null,this.render(this.lastClick)):this.render(null)}renderRestoreViewContext(){this.render(null!=this.root?this.root:null)}render(t){return this.controller.promiseExplore.then(n=>{let i=this.calculateLayoutGraph(t);return null!=i?this.renderExplore(i):null})}renderExplore(t){let i=new mk(t,new Wr(this.controller.gui.selectedRotation),this.controller.properties);i.class=Xe.Exploration;let r=new Za(t,i,this.controller.properties);this.setGraph2DParameter(r);let a=r.exportSpecification(!1);if(null==this.currentView){let s=new on(Cn(a)).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("click",(o,l)=>this.explore(o,l)).addEventListener("mouseover",(o,l)=>this.toolTip.compute(o,l,t));return this.currentView=s,this.setBackground(this.currentView),this.currentView.runAsync().then(()=>{this.firstTime=!1,this.previousDrawing=i.drawing}).then()}return this.animation(i,t,r).then(()=>this.previousDrawing=i.drawing).then()}animationTick(t,n,i,r){if(t==n.animation.length-1){this.setGraph2DParameter(i);let s=new on(Cn(i.exportSpecification(!1))).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("click",(o,l)=>this.explore(o,l)).addEventListener("mouseover",(o,l)=>this.toolTip.compute(o,l,r));return this.updateView(s,this.currentView),this.currentView=s,this.setBackground(this.currentView),this.currentView.runAsync()}{i.graphStyle.labelEnabled=!1;let s=new on(Cn(i.exportSpecification(!0))).renderer("svg").initialize(document.querySelector("#drawing"));return this.updateView(s,this.currentView),this.currentView=s,this.setBackground(this.currentView),this.currentView.runAsync()}}animation(t,n,i){let r=this.calculateVertices2Move(t.drawing,n),a=new Im(t.drawing,this.calculateSourcePoints(r),r,this.calculateTargetPoints(r,t.drawing),this.frames),s=[];for(let o=0;o<this.frames;o++)setTimeout(()=>{i.vertexPosition=a.animation[o],s.push(this.animationTick(o,a,i,n))},this.frameTime);return Promise.all(s).then()}explore(t,n){if(null!=t&&null!=n){let i=n.datum.id;this.allGraph.vertexType[i]!=R.Dy.BM&&(this.root=i,this.render(i)),this.lastClick=i}}reset(){this.firstTime=!0,this.root=this.controller.allGraphOrganID[this.controller.currentOrgan],this.previousGraph=null,this.currentView=null,this.lastClick=null}calculateSourcePoints(t){let n=[];return t.forEach(i=>n.push(this.previousDrawing[i])),n}calculateTargetPoints(t,n){let i=[];return t.forEach(r=>i.push(n[r])),i}calculateVertices2Move(t,n){let i=[];return n.vertices.forEach(r=>{r in this.previousDrawing&&r in t&&(this.previousDrawing[r].x!=t[r].x||this.previousDrawing[r].y!=t[r].y)&&i.push(r)}),i}}class xk{constructor(t,n,i,r,a,s){this.offsetsX=[],this.nextsOffset=a,this.depthMultiplier=s,this.nextConnnectedComponentOffset=r,this.maximumX=0,this.calculatePossibleRoots(t).forEach(l=>{this.nextYonLayer=[],this.setup(l,0,t,n,i),this.nextConnnectedComponentOffset=this.nextYonLayer[this.nextYonLayer.length-1];let u=(this.nextYonLayer.length-1)*this.depthMultiplier;u>this.maximumX&&(this.maximumX=u)})}calculatePossibleRoots(t){let n=[];return t.verticesAS.forEach(i=>{i in t.inDegree||n.push(i)}),n}setup(t,n,i,r,a){void 0===this.nextYonLayer[n]&&this.nextYonLayer.push(this.nextConnnectedComponentOffset);let o,s=n*this.depthMultiplier+50;if(t in r.outDegree&&r.outDegree[t].forEach(u=>{this.setup(u,n+1,i,r,a)}),t in r.outDegree){let l=r.outDegree[t];o=1==l.length?a[l[0]].y:(a[l[0]].y+a[l[l.length-1]].y)/2}else o=this.nextYonLayer[n];a[t]=new se(s,o),this.nextYonLayer[n]=this.nextYonLayer[n]+this.nextsOffset}}class Om{constructor(t,n,i,r){this.positionX=t,this.positionY=n,this.width=i,this.height=r}}class cV{constructor(t,n,i){this.containment=t,this.drawing=n,this.offset=50,this.rectangles=[],this.smallestWidth=window.screen.width/14,this.recursionSteps=0,this.recursionSteps=0,this.calculateHeight(this.containment.root,1),this.recursionSteps-=1,this.offsetCT=i,this.parseRectangles()}parseRectangles(){let t=this.containment.root;t in this.containment.outDegree&&this.containment.outDegree[t].forEach(n=>{this.worker(n,this.recursionSteps)})}worker(t,n){if(t in this.containment.outDegree){let i=this.workerSmallestY(t),r=this.workerLargestY(t),a=this.smallestWidth*Math.exp(n/this.recursionSteps),s=this.offsetCT/5/this.recursionSteps*n,o=i.x-a/2,l=Math.sqrt(window.screen.height*window.screen.height+window.screen.width*window.screen.width)/2,u=i.y-1.5*Math.sqrt(l)-s;this.rectangles.push(new Om(o,u,a,r.y-i.y+(i.y-u)+this.offsetCT/2.5/this.recursionSteps*n)),this.containment.outDegree[t].forEach(d=>{this.worker(d,n-1)})}}workerSmallestY(t){if(t in this.containment.outDegree){let n=new se(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);return this.containment.outDegree[t].forEach(i=>{let r=this.workerSmallestY(i);r.y<n.y&&(n=r)}),n}return this.drawing[t]}workerLargestY(t){if(t in this.containment.outDegree){let n=new se(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);return this.containment.outDegree[t].forEach(i=>{let r=this.workerLargestY(i);r.y>n.y&&(n=r)}),n}return this.drawing[t]}calculateHeight(t,n){t in this.containment.outDegree?this.containment.outDegree[t].forEach(i=>{this.calculateHeight(i,n+1)}):n>this.recursionSteps&&(this.recursionSteps=n)}}class fV{constructor(t,n){let i=new fe(t,t.verticesAS),r=this.calculateRoot(i);this.hasLeaf=new Map,this.idMapCT=new Map,this.heuristicAS=new Map,this.calculateLeafMap(r,t,i),this.initializeCTMap(n),this.calculateASHeuristic(r,t,i),this.balancing(r,t,i)}balancing(t,n,i){if(t in i.outDegree){let r=[],a=[];i.outDegree[t].forEach(s=>{this.hasLeaf[s]?r.push(s):a.push(s),this.balancing(s,n,i)}),r.sort((s,o)=>this.heuristicAS[s]-this.heuristicAS[o]),n.outDegree[t]=r.concat(a)}}calculateMedian(t){return 1==t.length?t[0]:0==t.length?0:(t.sort((i,r)=>i-r),t[Math.floor(t.length/2)])}calculateASHeuristic(t,n,i){let r=[];t in i.outDegree?i.outDegree[t].forEach(a=>{this.calculateASHeuristic(a,n,i),r.push(this.heuristicAS[a])}):t in n.outDegree&&n.outDegree[t].forEach(a=>{r.push(this.idMapCT[a])}),this.heuristicAS[t]=this.calculateMedian(r)}initializeCTMap(t){for(let n=0;n<t.length;n++)this.idMapCT[t[n]]=n}calculateRoot(t){let n=null;return t.vertices.forEach(i=>{i in t.inDegree||(n=i)}),n}calculateLeafMap(t,n,i){if(t in i.outDegree){let r=!1;i.outDegree[t].forEach(a=>{this.calculateLeafMap(a,n,i),this.hasLeaf[a]&&(r=!0)}),this.hasLeaf[t]=r}else this.hasLeaf[t]=t in n.outDegree}}class hV{constructor(t,n,i,r){this.containment=t,this.drawing=n,this.offset=50,this.rectangles=[],this.properties=r,this.smallestWidth=this.properties.heightDrawingDIV/14,this.recursionSteps=0,this.recursionSteps=0,this.calculateHeight(this.containment.root,1),this.recursionSteps-=1,this.offsetCT=i,this.parseRectangles()}parseRectangles(){let t=this.containment.root;t in this.containment.outDegree&&this.containment.outDegree[t].forEach(n=>{this.worker(n,this.recursionSteps)})}worker(t,n){if(t in this.containment.outDegree){let i=this.workerSmallestX(t),r=this.workerLargestX(t),a=this.offsetCT/2.5/this.recursionSteps*n,s=this.smallestWidth*Math.exp(n/this.recursionSteps),l=i.x+this.properties.twoLineLabelOffset-a;a=this.offsetCT/2.5/this.recursionSteps*n,this.rectangles.push(new Om(l,i.y-s/2,r.x-i.x+(i.x-l)+a,s)),this.containment.outDegree[t].forEach(h=>{this.worker(h,n-1)})}}workerSmallestX(t){if(t in this.containment.outDegree){let n=new se(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);return this.containment.outDegree[t].forEach(i=>{let r=this.workerSmallestX(i);r.x<n.x&&(n=r)}),n}return this.drawing[t]}workerSmallestY(t){if(t in this.containment.outDegree){let n=new se(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);return this.containment.outDegree[t].forEach(i=>{let r=this.workerSmallestY(i);r.y<n.y&&(n=r)}),n}return this.drawing[t]}workerLargestX(t){if(t in this.containment.outDegree){let n=new se(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);return this.containment.outDegree[t].forEach(i=>{let r=this.workerLargestX(i);r.x>n.x&&(n=r)}),n}return this.drawing[t]}workerLargestY(t){if(t in this.containment.outDegree){let n=new se(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);return this.containment.outDegree[t].forEach(i=>{let r=this.workerLargestY(i);r.y>n.y&&(n=r)}),n}return this.drawing[t]}calculateHeight(t,n){t in this.containment.outDegree?this.containment.outDegree[t].forEach(i=>{this.calculateHeight(i,n+1)}):n>this.recursionSteps&&(this.recursionSteps=n)}}class dV extends sl{constructor(t,n,i,r){super(t,i,r),this.class=Xe.Containment;let a=new Zi(t);this.calculateParameter();let s=n.containment,o=t.verticesBM;o=new Hn(t,s,o).slots,this.initializeHighlights(t,this.highlightedEdge),this.containment=n,this.drawBiomarkers(o),this.drawCellTypes(s),this.graph.verticesCT.length!=this.graph.vertices.length&&(this.clipBM(o),this.drawCellTypes(s)),new fV(t,s);const c=this.calculateCTSmallestY(s);this.calculateDynamicOffsetIncrementAS(a,s),new xk(t,new fe(t,t.verticesAS),this.drawing,c,this.offsetIncrementAS,this.depthMultiplier),this.applyLinearMap(i,a),0==i.rotateAngle||90==i.rotateAngle?(this.containmentRects=new cV(n,this.drawing,this.offsetIncrementCT),this.rects=this.containmentRects.rectangles,this.adjustmentWorker(this.containment.root,null)):(this.containmentRects=new hV(n,this.drawing,this.offsetIncrementCT,r),this.rects=this.containmentRects.rectangles,this.adjustmentWorker(this.containment.root,null)),this.calculateWidthHeight()}formatLabelTwoLines(t,n){let i=t.vertexLabel[n];if("string"==typeof i){let r=i.split(" "),a="",s="",o=0;return r.forEach(l=>{o>i.length/3?s=s+" "+l:a=a+" "+l,o+=l.length}),s.length>0?[a,s]:[a]}return i}calculateCTSmallestY(t){let n=Number.POSITIVE_INFINITY;return t.forEach(i=>{this.drawing[i].y<n&&i in this.graph.inDegree&&(n=this.drawing[i].y)}),n}calculateCTLargestY(t){let n=Number.NEGATIVE_INFINITY;return t.forEach(i=>{this.drawing[i].y>n&&i in this.graph.inDegree&&(n=this.drawing[i].y)}),n}adjustmentWorker(t,n){if(t in this.containment.outDegree)this.containment.outDegree[t].forEach(i=>{this.adjustmentWorker(i,t)});else if(1==this.containment.outDegree[n].length&&t<=-8e5){let r=this.containmentRects.rectangles[this.containment.artificialIdRectIDMap[n]];this.drawing[t]=new se(r.positionX+r.width/2,r.positionY+r.height/2)}}calculateDynamicOffsetIncrementAS(t,n){let i=this.calculateCTLargestY(n)-this.calculateCTSmallestY(n);if(t.leaves.length>0){let r=i/(t.leaves.length-1);r>this.offsetIncrementAS&&(this.offsetIncrementAS=r)}}clipBM(t){if(t.length>1){let n=[t[0]],i=this.graph.inDegree[t[0]][0],r=0;for(let a=1;a<t.length;a++){let s=t[a];s in this.graph.inDegree?this.graph.inDegree[s].includes(i)?n.push(s):(r=this.redrawBM(n,i,r),n=[s],i=this.graph.inDegree[t[a]][0]):this.drawing[s]=new se(this.drawing[s].x,this.drawing[t[a-1]]+this.offsetIncrementBM)}this.redrawBM(n,i,r)}}redrawBM(t,n,i){const r=this.drawing[n],a=Math.floor(t.length/2);for(let o=0;o<t.length;o++)this.drawing[t[o]]=new se(this.drawing[t[o]].x,o<a?r.y-(o+1)*this.offsetIncrementBM:r.y+(o-a)*this.offsetIncrementBM);let s=r.y-a*this.offsetIncrementBM;if(Math.abs(i-s)<this.offsetIncrementBM||s<i){this.drawing[t[0]]=new se(this.drawing[t[0]].x,i+this.offsetIncrementBM);for(let o=1;o<t.length;o++)this.drawing[t[o]]=new se(this.drawing[t[o]].x,this.drawing[t[o-1]].y+this.offsetIncrementBM)}return this.drawing[t[t.length-1]].y}spacingCTRectangles(t){let n=new Map;t.forEach(i=>n[i]=!1),this.criticalWorker(this.containment.root,this.containment,n),this.processCriticalCT(t,n)}processCriticalCT(t,n){for(let i=0;i<t.length-1;i++){let r=t[i],a=t[i+1],s=this.drawing[a].y-this.drawing[r].y;n[r]&&s<1.2*this.offsetIncrementCT?this.drawing[a].y=this.drawing[r].y+1.2*this.offsetIncrementCT:s<this.offsetIncrementCT&&(this.drawing[a].y=this.drawing[r].y+this.offsetIncrementCT)}}criticalWorker(t,n,i){if(t in n.outDegree){let r=n.outDegree[t];i[r[r.length-1]]=!0,r.forEach(a=>{this.criticalWorker(a,n,i)})}}drawBiomarkers(t){let n=this.offsetIncrementBM;t.forEach(i=>{let r=new se(this.xPositionBM,n);n+=this.offsetIncrementBM,this.drawing[i]=r})}drawCellTypes(t){let n=this.offsetIncrementCT;this.graph.vertices.length!=this.graph.verticesCT.length?new Bm(this,t,n):t.forEach(i=>{let r=new se(this.xPositionCT,n);n+=this.offsetIncrementCT,this.drawing[i]=r}),this.spacingCTRectangles(t)}}class gV{constructor(t,n){this.graph=t,this.treeAS=new fe(t,t.verticesAS),this.counter=1,this.graph.verticesCT.forEach(i=>{}),this.CTRectMap=new Map,t.verticesCT.forEach(i=>{this.CTRectMap[i]=this.search(n,i)}),this.artificialBMID=-85e4,this.replicateBM()}search(t,n){let i=null;for(const[r,a]of Object.entries(t.outDegree))a.includes(n)&&(i=r);return i}replicateBM(){this.graph.verticesBM.forEach(t=>{if(t in this.graph.inDegree){let n=new Map;this.graph.inDegree[t].forEach(r=>{let a=this.CTRectMap[r];a in n?n[a].push(r):n[a]=[r]});let i=!0;for(const[r,a]of Object.entries(n))i?i=!1:this.augment(t,a)}})}augment(t,n){this.graph.vertices.push(this.artificialBMID),this.graph.verticesBM.push(this.artificialBMID),this.graph.numVertices+=1,this.graph.numVerticesBM+=1,this.graph.vertexType[this.artificialBMID]=R.Dy.BM,this.graph.vertexLabel[this.artificialBMID]=this.graph.vertexLabel[t],this.graph.IDtoOntologyType[this.artificialBMID]=this.graph.IDtoOntologyType[t],this.graph.IDtoOntologyID[this.artificialBMID]=this.graph.IDtoOntologyID[t],this.graph.vertexSize[this.artificialBMID]=this.graph.vertexSize[t],this.graph.vertexVisible[this.artificialBMID]=1,this.graph.vertexColor[this.artificialBMID]=this.graph.vertexColor[t],n.forEach(i=>{this.graph.outDegree[i].push(this.artificialBMID),this.artificialBMID in this.graph.inDegree?this.graph.inDegree[this.artificialBMID].push(i):this.graph.inDegree[this.artificialBMID]=[i]}),n.forEach(i=>{this.removeByValue(i,this.graph.inDegree[t]),this.removeByValue(t,this.graph.outDegree[i])}),this.artificialBMID-=1}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}}class pV{constructor(t,n,i){this.properties=i,this.artificialID=-8e5,this.containment=t,this.initialize(n)}evaluate(t){this.artificialIDExpanded[this.containment.rectIDArtificialIDMap[t]]?this.collapse(t):this.expand(t);let i=this.generateASTree();i.merge(this.currentBipartite),this.currentGraph=i,this.addASCTEdges()}expandMapUpdate(t){t in this.containment.outDegree&&(this.artificialIDExpanded[t]=!0,this.containment.outDegree[t].forEach(n=>{this.expandMapUpdate(n)}))}expand(t){let n=this.containment.rectIDArtificialIDMap[t],i=this.currentBipartite.vertices.slice(0).filter(a=>a!=this.containment.outDegree[n][0]);this.currentBipartite=new fe(this.currentBipartite,i),this.containment.outDegree[n]=this.copyContainmentOutDegree[n].slice(0),this.containment.update();let r=this.containment.involved[n];this.expandCellTypes(r),this.expandBiomarker(r),this.expandMapUpdate(n)}customDelete(t,n){let i=[];for(let r=0;r<t.length;r++){let a=t[r];-1==n.indexOf(a)&&i.push(a)}return i}collapseMapUpdate(t){t in this.copyContainmentOutDegree&&(this.artificialIDExpanded[t]=!1,this.copyContainmentOutDegree[t].forEach(n=>{this.collapseMapUpdate(n)}))}collapse(t){let n=this.containment.rectIDArtificialIDMap[t];this.collapseWorker(n),this.containment.update(),this.collapseMapUpdate(n);let i=this.containment.involved[n].slice(0),r=[];i.forEach(s=>{s in this.currentBipartite.outDegree&&this.currentBipartite.outDegree[s].forEach(o=>{r.push(o)})});let a=this.currentBipartite.vertices.slice(0).filter(s=>!i.includes(s)&&!r.includes(s));this.currentBipartite=new fe(this.currentBipartite,a),this.collapseAddBlackVertex(i),this.containment.outDegree[n]=[this.artificialID],this.artificialID-=1,this.containment.update()}collapseWorker(t){t in this.containment.outDegree&&this.containment.outDegree[t].forEach(n=>{if(n in this.containment.artificialIdRectIDMap){let i=this.containment.artificialIdRectIDMap[n];!this.artificialIDExpanded[n]&&n in this.containment.outDegree?this.expand(i):this.collapseWorker(n)}})}addASCTEdges(){this.currentBipartite.verticesCT.forEach(t=>{t in this.initialGraph.inDegree&&this.initialGraph.inDegree[t].forEach(n=>{n in this.currentGraph.outDegree?this.currentGraph.outDegree[n].push(t):this.currentGraph.outDegree[n]=[t],t in this.currentGraph.inDegree?this.currentGraph.inDegree[t].push(n):this.currentGraph.inDegree[t]=[n]})})}generateASTree(){let t=this.reachableLeaves(),n=new Map;this.initialAS.vertices.forEach(r=>n[r]=!1),t.forEach(r=>{this.reachableASTree(r,n)});let i=[];return this.initialAS.vertices.forEach(r=>{n[r]&&i.push(r)}),new fe(this.initialAS,i)}reachableASTree(t,n){if(n[t]=!0,t in this.initialAS.inDegree){let r=this.initialAS.inDegree[t][0];n[r]||this.reachableASTree(r,n)}}reachableLeaves(){let t=[];return this.currentBipartite.verticesCT.forEach(n=>{n in this.initialGraph.inDegree&&this.initialGraph.inDegree[n].forEach(i=>t.push(i))}),t}expandBiomarker(t){t.forEach(n=>{n in this.initialGraph.outDegree&&this.initialGraph.outDegree[n].forEach(i=>{this.currentBipartite.vertices.includes(i)||this.currentBipartite.addVertex(R.Dy.BM,i,this.initialGraph.vertexColor[i],1,this.properties.vertexSize,this.initialGraph.vertexLabel[i]),i in this.currentBipartite.inDegree?this.currentBipartite.inDegree[i].push(n):this.currentBipartite.inDegree[i]=[n]})})}expandCellTypes(t){t.forEach(n=>{this.currentBipartite.addVertex(R.Dy.CT,n,this.initialGraph.vertexColor[n],1,this.properties.vertexSize,this.initialGraph.vertexLabel[n]),n in this.initialGraph.outDegree&&(this.currentBipartite.outDegree[n]=this.initialGraph.outDegree[n].slice(0)),n in this.initialGraph.inDegree&&(this.currentBipartite.inDegree[n]=this.initialGraph.inDegree[n].slice(0))})}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}reset(){this.containment.outDegree=this.copyContainmentOutDegree}initializeContainmentStructures(){this.copyContainmentOutDegree=new Map,Object.keys(this.containment.outDegree).forEach(t=>{this.copyContainmentOutDegree[t]=this.containment.outDegree[t]}),this.artificialIDExpanded=new Map,Object.keys(this.containment.outDegree).forEach(t=>{this.artificialIDExpanded[t]=!0})}calculateInitialInduceSet(t,n){let i=[];return n.verticesAS.forEach(r=>i.push(r)),this.containment.containment.forEach(r=>i.push(r)),t.forEach(r=>i.push(r)),i}initializeGraphs(t){let n=new Set;this.containment.containment.forEach(l=>{l in t.outDegree&&t.outDegree[l].forEach(u=>{n.add(u)})});let i=Array.from(n),r=this.calculateInitialInduceSet(i,t);this.initialGraph=new fe(t,r),new af(this.initialGraph);let s=new sf(this.initialGraph);this.depth=s.depth,new gV(this.initialGraph,this.containment),this.initialAS=new fe(this.initialGraph,this.initialGraph.verticesAS),this.currentBipartite=new fe(this.initialGraph,this.containment.containment.concat(this.initialGraph.verticesBM))}initialize(t){this.initializeContainmentStructures(),this.initializeGraphs(t);let n=this.generateASTree();n.merge(this.currentBipartite),this.currentGraph=n,this.addASCTEdges()}collapseAddBlackVertex(t){let n=0;t.forEach(s=>{s in this.initialGraph.outDegree&&(n+=this.initialGraph.outDegree[s].length)});let i=this.properties.maxContainmentCollapsedVertexSize,r=this.properties.vertexSize;r+=n>12?i:n*(i/12),this.currentBipartite.addVertex(R.Dy.CT,this.artificialID,"black",1,r,""+n)}}class mV{constructor(t,n){this.containment=t,this.graph=n,this.heuristicContainment=new Map,this.asTreeLeafIndex=new Map,this.generateLeafIndex(),this.generateHeuristic(this.containment.root),this.reorder(this.containment.root),this.containment.update()}generateLeafIndex(){let t=new Zi(this.graph);for(let n=0;n<t.leaves.length;n++)this.asTreeLeafIndex[t.leaves[n]]=n+1}calculateMedian(t){return 1==t.length?t[0]:0==t.length?0:(t.sort((i,r)=>i-r),t[Math.floor(t.length/2)])}generateHeuristic(t){if(t in this.containment.outDegree){let n=0;this.containment.outDegree[t].forEach(i=>{this.generateHeuristic(i),n+=this.heuristicContainment[i]}),this.heuristicContainment[t]=n}else if(t in this.graph.inDegree){let n=[];this.graph.inDegree[t].forEach(i=>{n.push(this.asTreeLeafIndex[i])}),this.heuristicContainment[t]=this.calculateMedian(n)}else this.heuristicContainment[t]=0}reorder(t){t in this.containment.outDegree&&(this.containment.outDegree[t].forEach(n=>{this.reorder(n)}),this.containment.outDegree[t].sort((n,i)=>this.heuristicContainment[n]-this.heuristicContainment[i]))}}class yV{constructor(t,n,i){this.properties=i,this.artificialID=-8e5,this.containment=t,this.initialize(n)}evaluate(t){this.artificialIDExpanded[this.containment.rectIDArtificialIDMap[t]]?this.collapse(t):this.expand(t);let i=this.generateASTree();i.merge(this.currentBipartite),this.currentGraph=i,this.addASCTEdges()}expandMapUpdate(t){t in this.containment.outDegree&&(this.artificialIDExpanded[t]=!0,this.containment.outDegree[t].forEach(n=>{this.expandMapUpdate(n)}))}expand(t){let n=this.containment.rectIDArtificialIDMap[t],i=this.currentBipartite.vertices.slice(0).filter(a=>a!=this.containment.outDegree[n][0]);this.currentBipartite=new fe(this.currentBipartite,i),this.containment.outDegree[n]=this.copyContainmentOutDegree[n].slice(0),this.containment.update(),this.expandCellTypes(this.containment.involved[n]),this.expandMapUpdate(n)}customDelete(t,n){let i=[];for(let r=0;r<t.length;r++){let a=t[r];-1==n.indexOf(a)&&i.push(a)}return i}collapseMapUpdate(t){t in this.copyContainmentOutDegree&&(this.artificialIDExpanded[t]=!1,this.copyContainmentOutDegree[t].forEach(n=>{this.collapseMapUpdate(n)}))}collapse(t){let n=this.containment.rectIDArtificialIDMap[t];this.collapseWorker(n),this.containment.update(),this.collapseMapUpdate(n);let i=this.containment.involved[n].slice(0),r=this.currentBipartite.vertices.slice(0).filter(a=>!i.includes(a));this.currentBipartite=new fe(this.currentBipartite,r),this.collapseAddBlackVertex(i),this.containment.outDegree[n]=[this.artificialID],this.artificialID-=1,this.containment.update()}collapseWorker(t){t in this.containment.outDegree&&this.containment.outDegree[t].forEach(n=>{if(n in this.containment.artificialIdRectIDMap){let i=this.containment.artificialIdRectIDMap[n];!this.artificialIDExpanded[n]&&n in this.containment.outDegree?this.expand(i):this.collapseWorker(n)}})}addASCTEdges(){this.currentBipartite.verticesCT.forEach(t=>{t in this.initialGraph.inDegree&&this.initialGraph.inDegree[t].forEach(n=>{n in this.currentGraph.outDegree?this.currentGraph.outDegree[n].push(t):this.currentGraph.outDegree[n]=[t],t in this.currentGraph.inDegree?this.currentGraph.inDegree[t].push(n):this.currentGraph.inDegree[t]=[n]})})}generateASTree(){let t=this.reachableLeaves(),n=new Map;this.initialAS.vertices.forEach(r=>n[r]=!1),t.forEach(r=>{this.reachableASTree(r,n)});let i=[];return this.initialAS.vertices.forEach(r=>{n[r]&&i.push(r)}),new fe(this.initialAS,i)}reachableASTree(t,n){if(n[t]=!0,t in this.initialAS.inDegree){let r=this.initialAS.inDegree[t][0];n[r]||this.reachableASTree(r,n)}}reachableLeaves(){let t=[];return this.currentBipartite.verticesCT.forEach(n=>{n in this.initialGraph.inDegree&&this.initialGraph.inDegree[n].forEach(i=>t.push(i))}),t}expandBiomarker(t){t.forEach(n=>{n in this.initialGraph.outDegree&&this.initialGraph.outDegree[n].forEach(i=>{this.currentBipartite.vertices.includes(i)||this.currentBipartite.addVertex(R.Dy.BM,i,this.initialGraph.vertexColor[i],1,this.properties.vertexSize,this.initialGraph.vertexLabel[i]),i in this.currentBipartite.inDegree?this.currentBipartite.inDegree[i].push(n):this.currentBipartite.inDegree[i]=[n]})})}expandCellTypes(t){t.forEach(n=>{this.currentBipartite.addVertex(R.Dy.CT,n,this.initialGraph.vertexColor[n],1,this.properties.vertexSize,this.initialGraph.vertexLabel[n]),n in this.initialGraph.outDegree&&(this.currentBipartite.outDegree[n]=this.initialGraph.outDegree[n].slice(0)),n in this.initialGraph.inDegree&&(this.currentBipartite.inDegree[n]=this.initialGraph.inDegree[n].slice(0))})}removeByValue(t,n){let i=n.indexOf(t);-1!=i&&n.splice(i,1)}reset(){this.containment.outDegree=this.copyContainmentOutDegree}initializeContainmentStructures(){this.copyContainmentOutDegree=new Map,Object.keys(this.containment.outDegree).forEach(t=>{this.copyContainmentOutDegree[t]=this.containment.outDegree[t]}),this.artificialIDExpanded=new Map,Object.keys(this.containment.outDegree).forEach(t=>{this.artificialIDExpanded[t]=!0})}calculateInitialInduceSet(t,n){let i=[];return n.verticesAS.forEach(r=>i.push(r)),this.containment.containment.forEach(r=>i.push(r)),t.forEach(r=>i.push(r)),i}initializeGraphs(t){let n=this.calculateInitialInduceSet([],t);this.initialGraph=new fe(t,n),new af(this.initialGraph);let r=new sf(this.initialGraph);this.depth=r.depth,this.initialAS=new fe(this.initialGraph,this.initialGraph.verticesAS),this.currentBipartite=new fe(this.initialGraph,this.containment.containment.concat(this.initialGraph.verticesBM))}initialize(t){this.initializeContainmentStructures(),this.initializeGraphs(t);let n=this.generateASTree();n.merge(this.currentBipartite),this.currentGraph=n,this.addASCTEdges()}countExpansion(t){if(console.log(this.initialAS.vertexLabel[t]),this.expansionlabel[t])return 0;if(this.expansionlabel[t]=!0,t in this.initialAS.inDegree){let n=1;return t<0&&(n-=1),n+this.countExpansion(this.initialAS.inDegree[t][0])}return 1}collapseAddBlackVertex(t){this.expansionlabel=new Map,this.initialAS.verticesAS.forEach(s=>this.expansionlabel[s]=!1);let n=0;t.forEach(s=>{s in this.initialGraph.inDegree&&this.initialGraph.inDegree[s].forEach(o=>{n+=this.countExpansion(o)})});let i=this.properties.maxContainmentCollapsedVertexSize,r=this.properties.vertexSize;r+=n>12?i:n*(i/12),this.currentBipartite.addVertex(R.Dy.CT,this.artificialID,"black",1,r,""+n)}}class of extends Xa{constructor(t,n){super(t,"Containment"),this.frames=25,this.frameTime=700,this.controller=t,this.hideBM=n}renderRestoreGraphContext(){return this.currentView=null,this.render(null)}renderRestoreViewContext(){this.firstTime=!1,this.render(null).then()}render(t){let n=this.controller.graphs[this.controller.currentOrgan];return n.ready?this.renderSubgraph(n):null}animationTick(t,n,i,r,a){if(t==n.animation.length-1){i.graphStyle.labelEnabled=this.controller.gui.appearance[0].sel;let o=new on(Cn(i.exportSpecification(!1))).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("click",(l,u)=>this.calculateContainer(l,u,a,this.containmentGraph)).addEventListener("mouseover",(l,u)=>this.toolTip.compute(l,u,r));return this.setBackground(this.currentView),this.updateView(o,this.currentView),this.currentView=o,this.currentView.runAsync()}{i.graphStyle.labelEnabled=!1;let o=new on(Cn(i.exportSpecification(!1))).renderer("svg").initialize(document.querySelector("#drawing"));return this.setBackground(o),this.updateView(o,this.currentView),this.currentView=o,o.runAsync()}}renderSubgraph(t){this.firstTime&&this.firstTimeProcessing(t);let i=new dV(this.containmentGraph,this.manager.containment,new Wr(this.controller.gui.selectedRotation),this.controller.properties),r=new Za(this.containmentGraph,i,this.controller.properties);if(this.setGraph2DParameter(r),null!=this.currentView){let a=this.calculateVertices2Move(i.drawing),s=new Im(i.drawing,this.calculateSourcePoints(a),a,this.calculateTargetPoints(a,i.drawing),this.frames),o=[];for(let l=0;l<this.frames;l++)setTimeout(()=>{r.vertexPosition=s.animation[l],o.push(this.animationTick(l,s,r,t,i))},this.frameTime);return Promise.all(o).then(()=>{this.firstTime=!1,this.previousDrawing=i.drawing}).then()}{let s=new on(Cn(r.exportSpecification(!1))).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("click",(o,l)=>this.calculateContainer(o,l,i,this.containmentGraph)).addEventListener("mouseover",(o,l)=>this.toolTip.compute(o,l,t));return this.currentView=s,this.setBackground(this.currentView),this.currentView.runAsync().then(()=>{this.firstTime=!1,this.previousDrawing=i.drawing}).then()}}calculateSourcePoints(t){let n=[];return t.forEach(i=>n.push(this.previousDrawing[i])),n}calculateTargetPoints(t,n){let i=[];return t.forEach(r=>i.push(n[r])),i}calculateVertices2Move(t){let n=[];return this.containmentGraph.verticesCT.forEach(i=>{i in this.previousDrawing&&i in t&&(this.previousDrawing[i].x!=t[i].x||this.previousDrawing[i].y!=t[i].y)&&n.push(i)}),this.containmentGraph.verticesBM.forEach(i=>{i in this.previousDrawing&&i in t&&(this.previousDrawing[i].x!=t[i].x||this.previousDrawing[i].y!=t[i].y)&&n.push(i)}),n}calculateContainer(t,n,i,r){if(null!=n&&null!=!t&&"rect"==n.mark.marktype){let a=this.calculateRectIndex(t,i.rects);null!=a&&(this.manager.evaluate(a),this.containmentGraph=this.manager.currentGraph,this.render(null))}}calculateRectIndex(t,n){let i=t.originalTarget.__data__.datum,r=new Om(i.x,i.y,i.w,i.h),a=null;for(let s=0;s<n.length;s++)if(n[s].positionX==r.positionX&&n[s].positionY==r.positionY){a=s;break}return a}firstTimeProcessing(t){let n=this.fetchContainmentIndex(),i=this.controller.graphs[this.controller.currentOrgan].containment;i.root=-1==n?i.initialRoot:i.outDegree[i.initialRoot][n-1],i.update(),this.manager=this.hideBM?new yV(i,t,this.controller.properties):new pV(i,t,this.controller.properties),new mV(this.manager.containment,this.manager.currentGraph),this.containmentGraph=this.manager.currentGraph}fetchContainmentIndex(){let t=this.controller.gui.selectedContainer;if("All Container"==t)return-1;{let n=t.split("Container ");return parseInt(n[1])}}reset(){this.firstTime=!0,null!=this.manager&&this.manager.reset(),this.currentView=null}}class vV extends sl{constructor(t,n,i){super(t,n,i),this.class=Xe.Subgraph,this.calculateParameter(),this.drawBiomarkers(this.graph.verticesBM),this.drawCellTypes(this.graph.verticesCT),new xk(t,new fe(t,t.verticesAS),this.drawing,this.offsetIncrementAS,this.offsetIncrementAS,this.depthMultiplier),this.calculateWidthHeight(),this.applyLinearMap(n,new Zi(t))}drawBiomarkers(t){let n=this.properties.heightTopPadding;t.forEach(i=>{let r=new se(this.xPositionBM,n);n+=this.offsetIncrementBM,this.drawing[i]=r})}drawCellTypes(t){let n=this.properties.heightTopPadding;t.forEach(i=>{let r=new se(this.xPositionCT,n);n+=this.offsetIncrementCT,this.drawing[i]=r})}}class xV extends Xa{constructor(t){super(t,"Original")}renderRestoreGraphContext(){return this.firstTime=!0,this.render(null)}renderRestoreViewContext(){this.firstTime=!1,this.render(null)}render(t){let n=this.controller.graphs[this.controller.currentOrgan];if(n.ready){let i=this.controller.gui.selectedRotation,a=(new fe(n,n.vertices),new vV(n,new Wr(i),this.controller.properties)),s=new Za(n,a,this.controller.properties);this.setGraph2DParameter(s);let l=new on(Cn(s.exportSpecification(!1))).renderer("svg").initialize(document.querySelector("#drawing")).addEventListener("mouseover",(u,c)=>this.toolTip.compute(u,c,n));return this.firstTime||this.updateView(l,this.currentView),this.currentView=l,this.setBackground(this.currentView),this.currentView.runAsync().then(()=>this.firstTime=!1).then()}return null}reset(){this.firstTime=!0,this.currentView=null}}class bV{constructor(t){this.initializeGraphs(),this.gui=t,this.currentOrgan=R.jM.Kidney,this.properties=new R.E,this.currentMode=new yk(this)}initializeGraphs(){this.graphs=[new He([R.jM.BoneMarrow]),new He([R.jM.Brain]),new He([R.jM.Heart]),new He([R.jM.Kidney]),new He([R.jM.LargeIntestine]),new He([R.jM.Lung]),new He([R.jM.LymphNodes]),new He([R.jM.Skin]),new He([R.jM.Spleen]),new He([R.jM.Thymus]),new He([R.jM.Vasculature])],this.createEntireGraph()}createEntireGraph(){let t=[];t.push(R.jM.All);let n=[],i=new Map,r=new Map,a=new Map,s=new Map,o=new Map,l=new Map,u=new Map,c=new Map,f=0,h=[];this.graphs.forEach(d=>{d.organ!=R.jM.HeartWithCTTypology&&h.push(d.readyPromise)}),this.promiseExplore=Promise.all(h).then(d=>{this.allGraphOrganID=[];let g=[];n.push(0),a[0]=R.Dy.AS,s[0]="Body",o[0]=1,l[0]="red",u[0]="0013702",c[0]=R.V4.UBERON,this.graphs.forEach(p=>{if(p.organ!=R.jM.HeartWithCTTypology){let m=Number.NEGATIVE_INFINITY;p.vertices.forEach(y=>{if(0!=y){const v=y+f;n.push(v),a[v]=p.vertexType[y],s[v]=p.vertexLabel[y],o[v]=p.vertexVisible[y],l[v]=p.vertexColor[y],y in p.IDtoOntologyType&&(c[v]=p.IDtoOntologyType[y],u[v]=p.IDtoOntologyID[y]);let x=[],b=[];y in p.outDegree&&p.outDegree[y].forEach(w=>{x.push(w+f)}),g.includes(v)?b=[0]:y in p.inDegree&&p.inDegree[y].forEach(w=>{b.push(w+f)}),r[v]=x,i[v]=b,y>m&&(m=y)}else p.outDegree[0].forEach(v=>{g.push(v+f)})}),f+=m,this.allGraphOrganID.push(f+1)}}),r[0]=g,t.push(n),t.push(i),t.push(r),t.push(a),t.push(s),t.push(o),t.push(l),t.push(c),t.push(u),this.graphs.push(new He(t))}).then(()=>{this.allGraphOrganID.pop(),this.allGraphOrganID=[1].concat(this.allGraphOrganID),this.graphs.push(new He([R.jM.HeartWithCTTypology]))})}updateMode(t){this.currentMode instanceof of&&null!=this.currentMode.manager&&this.currentMode.manager.reset(),"Partial Graph"==t?this.currentMode=new pk(this):"Complete Graph"==t?this.currentMode=new yk(this):"Exploration"==t?this.currentMode=new vk(this):"Containment"==t?this.currentMode=new of(this,!this.gui.modes[0].sel):"Unmodified Graph"==t&&(this.currentMode=new xV(this))}updateOrgan(t){this.currentOrgan=(0,R.kG)(t),this.currentMode instanceof pk?this.currentMode.firstTime=!0:this.currentMode instanceof of?(this.currentMode.firstTime=!0,null!=this.currentMode.manager&&this.currentMode.manager.reset()):this.currentMode instanceof vk&&this.currentMode.reset()}renderRestore(){this.currentMode.renderRestoreViewContext()}render(){return this.currentMode.render(null)}}}}]);